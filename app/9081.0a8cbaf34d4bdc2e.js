"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9081],{152(J,H,b){b.d(H,{B:()=>I});var C=b(8839),y=b(9974),h=b(4360);function I(_,D=C.E){return(0,y.N)((e,p)=>{let x=null,$=null,l=null;const m=()=>{if(x){x.unsubscribe(),x=null;const u=$;$=null,p.next(u)}};function d(){const u=l+_,v=D.now();if(v<u)return x=this.schedule(void 0,u-v),void p.add(x);m()}e.subscribe((0,h._)(p,u=>{$=u,l=D.now(),x||(x=D.schedule(d,_),p.add(x))},()=>{m(),p.complete()},void 0,()=>{$=x=null}))})}},1462(J,H,b){b.d(H,{HealthFormPageModule:()=>tt});var C=b(2200),y=b(4341),h=b(7343),I=b(8132),_=b(467),D=b(152),e=b(3664),p=b(2615),x=b(5921),$=b(5858),l=b(5342),m=b(5010),d=b(3205),u=b(8060),v=b(918),M=b(9187),S=b(7643);function w(i,s){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.SpI(" (edited: ",r.getEditedDateTime(),")")}}function Q(i,s){1&i&&e.nrm(0,"ion-icon",64)}function W(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",8),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(!o.viewMode&&o.editZone())}),e.nrm(1,"ion-icon",65),e.j41(2,"span",10),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.JRh(t.getZoneName(null==(r=t.healthForm.get("zoneNumber"))?null:r.value))}}function R(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",8),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(!o.viewMode&&o.editQuad())}),e.nrm(1,"ion-icon",66),e.j41(2,"span",10),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.SpI("Quad ",t.getQuadDisplay(null==(r=t.healthForm.get("quadNumber"))?null:r.value))}}function G(i,s){if(1&i){const r=e.RV6();e.j41(0,"span",67),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.editLocationAdmin())}),e.EFF(1," Edit location "),e.k0s()}}function B(i,s){1&i&&(e.j41(0,"ion-error",68),e.EFF(1," Location is required "),e.k0s())}function z(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",69)(1,"ion-button",70),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.enableEditMode())}),e.nrm(2,"ion-icon",71),e.EFF(3," Edit This Entry "),e.k0s()()}}function Y(i,s){1&i&&(e.j41(0,"div",72),e.nrm(1,"ion-icon",73),e.j41(2,"span"),e.EFF(3,"Editing Entry - Changes will replace the original submission"),e.k0s()())}function le(i,s){1&i&&e.nrm(0,"ion-icon",74)}function se(i,s){1&i&&e.nrm(0,"ion-icon",75)}function ce(i,s){1&i&&(e.j41(0,"ion-error"),e.EFF(1," Observer name is required "),e.k0s())}function de(i,s){1&i&&(e.j41(0,"ion-select",76)(1,"ion-select-option",77),e.EFF(2,"Sunny"),e.k0s(),e.j41(3,"ion-select-option",78),e.EFF(4,"Partly Cloudy"),e.k0s(),e.j41(5,"ion-select-option",79),e.EFF(6,"Cloudy"),e.k0s(),e.j41(7,"ion-select-option",80),e.EFF(8,"Rainy"),e.k0s(),e.j41(9,"ion-select-option",81),e.EFF(10,"Stormy"),e.k0s()())}function ue(i,s){if(1&i&&e.nrm(0,"ion-input",82),2&i){let r;const t=e.XpG();e.Y8G("value",t.getWeatherLabel(null==(r=t.healthForm.get("weather"))?null:r.value))}}function pe(i,s){1&i&&e.nrm(0,"ion-icon",74)}function me(i,s){1&i&&e.nrm(0,"ion-icon",75)}function he(i,s){1&i&&(e.j41(0,"ion-error"),e.EFF(1," Weather selection is required "),e.k0s())}function ge(i,s){1&i&&(e.j41(0,"ion-select",83)(1,"ion-select-option",84),e.EFF(2,"High"),e.k0s(),e.j41(3,"ion-select-option",85),e.EFF(4,"Low"),e.k0s(),e.j41(5,"ion-select-option",86),e.EFF(6,"Incoming"),e.k0s(),e.j41(7,"ion-select-option",87),e.EFF(8,"Outgoing"),e.k0s()())}function fe(i,s){if(1&i&&e.nrm(0,"ion-input",82),2&i){let r;const t=e.XpG();e.Y8G("value",t.getTideLabel(null==(r=t.healthForm.get("tide"))?null:r.value))}}function be(i,s){1&i&&e.nrm(0,"ion-icon",74)}function _e(i,s){1&i&&e.nrm(0,"ion-icon",75)}function ve(i,s){1&i&&(e.j41(0,"ion-error"),e.EFF(1," Tide selection is required "),e.k0s())}function Fe(i,s){1&i&&e.nrm(0,"ion-icon",74)}function ye(i,s){1&i&&e.nrm(0,"ion-icon",75)}function Pe(i,s){1&i&&(e.j41(0,"ion-error"),e.EFF(1," Canopy cover is required "),e.k0s())}function xe(i,s){1&i&&e.nrm(0,"ion-icon",74)}function ke(i,s){1&i&&e.nrm(0,"ion-icon",75)}function Ce(i,s){1&i&&(e.j41(0,"ion-error"),e.EFF(1," Recruitment cover is required "),e.k0s())}function Ee(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-button",88),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.decrementDeadTrees())}),e.nrm(1,"ion-icon",89),e.k0s()}if(2&i){let r;const t=e.XpG();e.Y8G("disabled",(null==(r=t.healthForm.get("deadTrees"))?null:r.value)<=0)}}function Me(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-button",90),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.incrementDeadTrees())}),e.nrm(1,"ion-icon",91),e.k0s()}}function Oe(i,s){1&i&&e.nrm(0,"ion-icon",106)}function Se(i,s){1&i&&e.nrm(0,"ion-icon",107)}function we(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",108)(1,"ion-button",109),e.bIt("click",function(){p.eBV(r);const o=e.XpG(2);return p.Njj(o.capturePollutionPhoto())}),e.nrm(2,"ion-icon",110),e.EFF(3," Add Pollution Photo (Optional) "),e.k0s()()}}function Te(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-button",115),e.bIt("click",function(){p.eBV(r);const o=e.XpG(3);return p.Njj(o.removePollutionPhoto())}),e.nrm(1,"ion-icon",116),e.k0s()}}function je(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",111)(1,"ion-label"),e.EFF(2,"Pollution Photo:"),e.k0s(),e.j41(3,"div",112)(4,"img",113),e.bIt("click",function(){p.eBV(r);const o=e.XpG(2);return p.Njj(o.openFullScreenPhoto(o.pollutionPhoto,"Pollution"))}),e.k0s(),e.DNE(5,Te,2,0,"ion-button",114),e.k0s()()}if(2&i){const r=e.XpG(2);e.R7$(4),e.Y8G("src",r.pollutionPhoto,e.B4B),e.R7$(),e.Y8G("ngIf",!r.viewMode)}}function De(i,s){1&i&&e.nrm(0,"ion-textarea",117)}function Ie(i,s){if(1&i&&e.nrm(0,"ion-textarea",118),2&i){let r;const t=e.XpG(2);e.Y8G("value",null==(r=t.healthForm.get("pollutionObservations"))?null:r.value)}}function $e(i,s){if(1&i&&(e.j41(0,"div",92)(1,"div",93),e.DNE(2,Oe,1,0,"ion-icon",94)(3,Se,1,0,"ion-icon",95),e.k0s(),e.j41(4,"ion-item",44),e.nrm(5,"ion-label",21),e.j41(6,"ion-select",96)(7,"ion-select-option",97),e.EFF(8,"Plastics"),e.k0s(),e.j41(9,"ion-select-option",98),e.EFF(10,"Metal"),e.k0s(),e.j41(11,"ion-select-option",99),e.EFF(12,"Glass"),e.k0s(),e.j41(13,"ion-select-option",100),e.EFF(14,"Fabric"),e.k0s(),e.j41(15,"ion-select-option",101),e.EFF(16,"Paper/Cardboard"),e.k0s(),e.j41(17,"ion-select-option",102),e.EFF(18,"Home appliance/electronics"),e.k0s(),e.j41(19,"ion-select-option",103),e.EFF(20,"Construction debris"),e.k0s(),e.j41(21,"ion-select-option",104),e.EFF(22,"Furniture"),e.k0s()()(),e.DNE(23,we,4,0,"div",54)(24,je,6,2,"div",55),e.j41(25,"ion-item",44)(26,"ion-label",21),e.EFF(27,"Additional Pollution Observations"),e.k0s(),e.DNE(28,De,1,0,"ion-textarea",105)(29,Ie,1,1,"ion-textarea",61),e.k0s()()),2&i){let r,t;const o=e.XpG();e.R7$(2),e.Y8G("ngIf",!(o.viewMode||null!=(r=o.healthForm.get("pollutionTypes"))&&r.value&&0!==(null==(r=o.healthForm.get("pollutionTypes"))||null==r.value?null:r.value.length))),e.R7$(),e.Y8G("ngIf",!o.viewMode&&(null==(t=o.healthForm.get("pollutionTypes"))||null==t.value?null:t.value.length)>0),e.R7$(20),e.Y8G("ngIf",!o.pollutionPhoto&&!o.viewMode),e.R7$(),e.Y8G("ngIf",o.pollutionPhoto),e.R7$(4),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.viewMode)}}function Re(i,s){1&i&&e.nrm(0,"ion-icon",74)}function Ne(i,s){1&i&&e.nrm(0,"ion-icon",75)}function He(i,s){1&i&&(e.j41(0,"ion-error"),e.EFF(1," Soil composition is required "),e.k0s())}function Ge(i,s){if(1&i&&(e.j41(0,"ion-note",119),e.EFF(1),e.k0s()),2&i){let r;const t=e.XpG();e.R7$(),e.SpI(" Mixed composition: ",t.formatSoilComposition(null==(r=t.healthForm.get("soilComposition"))?null:r.value)," ")}}function ze(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",108)(1,"ion-button",109),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.captureSoilPhoto())}),e.nrm(2,"ion-icon",110),e.EFF(3," Add Soil Photo (Optional) "),e.k0s()()}}function Ae(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-button",115),e.bIt("click",function(){p.eBV(r);const o=e.XpG(2);return p.Njj(o.removeSoilPhoto())}),e.nrm(1,"ion-icon",116),e.k0s()}}function Be(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",111)(1,"ion-label"),e.EFF(2,"Soil Photo:"),e.k0s(),e.j41(3,"div",112)(4,"img",120),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.openFullScreenPhoto(o.soilPhoto,"Soil"))}),e.k0s(),e.DNE(5,Ae,2,0,"ion-button",114),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(4),e.Y8G("src",r.soilPhoto,e.B4B),e.R7$(),e.Y8G("ngIf",!r.viewMode)}}function Ye(i,s){1&i&&(e.j41(0,"ion-item")(1,"ion-label",21),e.EFF(2,"Specify Other Predation"),e.k0s(),e.nrm(3,"ion-textarea",121),e.k0s())}function qe(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",108)(1,"ion-button",109),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.capturePredationPhoto())}),e.nrm(2,"ion-icon",110),e.EFF(3," Add Predation Evidence Photo (Optional) "),e.k0s()()}}function Ve(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-button",115),e.bIt("click",function(){p.eBV(r);const o=e.XpG(2);return p.Njj(o.removePredationPhoto())}),e.nrm(1,"ion-icon",116),e.k0s()}}function Le(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",111)(1,"ion-label"),e.EFF(2,"Predation Photo:"),e.k0s(),e.j41(3,"div",112)(4,"img",122),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.openFullScreenPhoto(o.predationPhoto,"Predation"))}),e.k0s(),e.DNE(5,Ve,2,0,"ion-button",114),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(4),e.Y8G("src",r.predationPhoto,e.B4B),e.R7$(),e.Y8G("ngIf",!r.viewMode)}}function Xe(i,s){1&i&&e.nrm(0,"ion-textarea",123)}function Ue(i,s){if(1&i&&e.nrm(0,"ion-textarea",118),2&i){let r;const t=e.XpG();e.Y8G("value",null==(r=t.healthForm.get("otherObservations"))?null:r.value)}}function Qe(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",124)(1,"ion-button",125),e.nrm(2,"ion-icon",126),e.EFF(3," Submit Health Assessment "),e.k0s(),e.j41(4,"ion-button",127),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.saveDraft())}),e.nrm(5,"ion-icon",128),e.EFF(6," Save Draft "),e.k0s(),e.j41(7,"ion-button",129),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.discardForm())}),e.nrm(8,"ion-icon",130),e.EFF(9," Discard "),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(),e.Y8G("disabled",!r.healthForm.valid)}}function We(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",131)(1,"ion-button",132),e.bIt("click",function(){p.eBV(r);const o=e.XpG();return p.Njj(o.deleteEntry())}),e.nrm(2,"ion-icon",130),e.EFF(3," Delete Entry "),e.k0s()()}}let Ke=(()=>{var i;class s{forceDeleteDraftFile(t){var o=this;return(0,_.A)(function*(){for(let n=0;n<3;n++)try{yield o.sharedDataService.deleteJsonFile(t),console.log(`Draft file force deleted successfully (attempt ${n+1})`);break}catch(c){if(console.error(`Error force deleting draft file (attempt ${n+1}):`,c),2===n)try{yield o.sharedDataService.writeJsonFile(t,null),console.log("Draft file cleared with null write")}catch(a){console.error("Failed to clear draft file with null write:",a)}yield new Promise(a=>setTimeout(a,100))}})()}constructor(t,o,n,c,a,f,F,g,k,P,E,O,T,j){this.formBuilder=t,this.alertController=o,this.loadingController=n,this.router=c,this.route=a,this.weatherService=f,this.tideService=F,this.photoService=g,this.auth=k,this.healthSyncService=P,this.sharedDataService=E,this.entryDeletionService=O,this.siteSyncService=T,this.modalController=j,this.progress=0,this.soilPhoto=null,this.predationPhoto=null,this.pollutionPhoto=null,this.currentDateTime="",this.viewMode=!1,this.currentUser=null,this.currentReportId="",this.loadedReport=null,this.mixedSoilTypes=[],this.autosaveSub=null,this.isDiscarded=!1,this.isSubmitted=!1,this.isSubmitting=!1,this.isEditMode=!1,this.originalSubmittedBy="",this.maheLatitude=-4.6796,this.maheLongitude=55.4919,this.availableLocations=[{name:"Ramsar",hasZones:!0,hasQuads:!0,zones:["1","2","3","4","5","6"],quads:Array.from({length:30},(q,N)=>`quad${N+1}`),zoneQuadMap:{1:[1,2,3],2:[13,14,15,16,17,18,20,21,22,23,25,27,28,29],3:[19,26],4:[4,5],5:[6,7,11,12,24,30],6:[8,9,10]}},{name:"Grand Anse",hasZones:!0,hasQuads:!0,zones:["1","2","3","4"],quads:Array.from({length:22},(q,N)=>`ga${N+1}`),zoneQuadMap:{1:[1,2,3,4],2:[5,6,7,8,9,10,21,22],3:[11,12,13,14,15,16,17,18],4:[19,20]}},{name:"Caiman",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4","quad5"]},{name:"Canopy",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4"]},{name:"Petit Barbarons",hasZones:!0,hasQuads:!1,zones:["1","2","3","4"],quads:[]},{name:"Kempinski",hasZones:!1,hasQuads:!1,zones:[],quads:[]},{name:"Roche Caiman",hasZones:!1,hasQuads:!1,zones:[],quads:[]}]}ngOnInit(){var t=this;return(0,_.A)(function*(){t.currentUser=t.auth.getCurrentUser(),t.initializeForm(),t.setCurrentDateTime(),t.fetchWeatherAndTide(),yield t.loadDynamicSites();const o=t.route.snapshot.queryParams;"true"===o.viewMode&&o.reportId?yield t.loadReportForViewing(o.reportId):(t.route.queryParams.subscribe(n=>{n.location&&t.healthForm.patchValue({location:n.location}),n.zone&&t.healthForm.patchValue({zoneNumber:n.zone}),n.quad&&t.healthForm.patchValue({quadNumber:n.quad})}),"true"!==o.fresh&&(yield t.restoreDraftIfAny(),t.setCurrentDateTime()),t.currentReportId||(t.currentReportId=t.healthSyncService.generateReportId()),t.subscribeToFormChanges(),navigator.onLine&&t.healthSyncService.processPendingQueue().catch(n=>{console.error("HealthFormPage: processPendingQueue failed:",n)}))})()}ngOnDestroy(){this.autosaveSub&&(this.autosaveSub.unsubscribe(),this.autosaveSub=null),this.isSubmitted||this.saveDraftOnExit().catch(t=>console.error("HealthFormPage: saveDraftOnExit failed:",t))}setCurrentDateTime(t){if(this.healthForm){const g=this.healthForm.get("date")?.value,k=this.healthForm.get("time")?.value;if(g&&k){const[P,E,O]=g.split("-"),[T,j]=k.split(":");return void(this.currentDateTime=`${O}/${E}/${P}  \u2022  ${T}:${j}`)}}if(t){const g=this.extractDateTimeFromReportId(t);if(g)return void(this.currentDateTime=g)}const o=new Date,n=String(o.getDate()).padStart(2,"0"),c=String(o.getMonth()+1).padStart(2,"0"),a=o.getFullYear(),f=String(o.getHours()).padStart(2,"0"),F=String(o.getMinutes()).padStart(2,"0");this.currentDateTime=`${n}/${c}/${a}  \u2022  ${f}:${F}`}extractDateTimeFromReportId(t){const o=t.match(/(\d{2})(\d{2})(\d{4})_(\d{2})(\d{2})(\d{2})/);if(o){const[,n,c,a,f,F]=o;return`${n}/${c}/${a}  \u2022  ${f}:${F}`}return null}getCurrentDate(){return(new Date).toISOString().split("T")[0]}getCurrentTime(){return(new Date).toTimeString().slice(0,5)}editLocation(){var t=this;return(0,_.A)(function*(){yield(yield t.alertController.create({header:"Location/Site",inputs:[{name:"location",type:"text",placeholder:"Enter location",value:t.healthForm.get("location")?.value||""}],buttons:[{text:"Cancel",role:"cancel"},{text:"Save",handler:n=>{t.healthForm.patchValue({location:n.location})}}]})).present()})()}editZone(){var t=this;return(0,_.A)(function*(){yield(yield t.alertController.create({header:"Zone Number",inputs:[{name:"zoneNumber",type:"text",placeholder:"Enter zone number",value:t.healthForm.get("zoneNumber")?.value||""}],buttons:[{text:"Cancel",role:"cancel"},{text:"Save",handler:n=>{t.healthForm.patchValue({zoneNumber:n.zoneNumber})}}]})).present()})()}editQuad(){var t=this;return(0,_.A)(function*(){yield(yield t.alertController.create({header:"Quad Number",inputs:[{name:"quadNumber",type:"text",placeholder:"Enter quad number",value:t.healthForm.get("quadNumber")?.value||""}],buttons:[{text:"Cancel",role:"cancel"},{text:"Save",handler:n=>{t.healthForm.patchValue({quadNumber:n.quadNumber})}}]})).present()})()}getZoneName(t){return t?`Zone ${t}`:""}getQuadDisplay(t){if(!t)return"";const o=t.match(/\d+/);return o?o[0]:""}locationHasZones(){const t=this.healthForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Petit Barbarons"].includes(t)}locationHasQuads(){const t=this.healthForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Caiman","Canopy"].includes(t)}editLocationAdmin(){var t=this;return(0,_.A)(function*(){if(!t.currentUser||t.currentUser.level<4)return;const o=yield t.selectLocationStep();if(!o)return;const n=t.availableLocations.find(f=>f.name===o);let c="";if(n?.hasZones&&n.zones.length>0){const f=yield t.selectZoneStep(n);if(null===f)return;c=f}let a="";if(n?.hasQuads&&n.quads.length>0){const f=yield t.selectQuadStep(n,c);if(null===f)return;a=f}t.healthForm.patchValue({location:o,zoneNumber:c,quadNumber:a}),t.isEditMode&&t.healthForm.markAsDirty()})()}selectLocationStep(){var t=this;return new Promise(function(){var o=(0,_.A)(function*(n){const c=t.healthForm.get("location")?.value||"",a=t.availableLocations.map(F=>({name:"location",type:"radio",label:F.name,value:F.name,checked:F.name===c}));yield(yield t.alertController.create({header:"Select Location",cssClass:"location-edit-alert",inputs:a,buttons:[{text:"Cancel",role:"cancel",handler:()=>n(null)},{text:"Next",handler:F=>n(F)}]})).present()});return function(n){return o.apply(this,arguments)}}())}selectZoneStep(t){var o=this;return new Promise(function(){var n=(0,_.A)(function*(c){const a=o.healthForm.get("zoneNumber")?.value||"",f=t.zones.map(g=>({name:"zone",type:"radio",label:`Zone ${g}`,value:g,checked:g===a}));yield(yield o.alertController.create({header:"Select Zone",subHeader:t.name,cssClass:"location-edit-alert",inputs:f,buttons:[{text:"Cancel",role:"cancel",handler:()=>c(null)},{text:"Next",handler:g=>c(g)}]})).present()});return function(c){return n.apply(this,arguments)}}())}selectQuadStep(t,o){var n=this;return new Promise(function(){var c=(0,_.A)(function*(a){const f=n.healthForm.get("quadNumber")?.value||"";let F=t.quads;if(o&&t.zoneQuadMap&&t.zoneQuadMap[o]){const P=t.zoneQuadMap[o];F=t.quads.filter(E=>{const O=parseInt(n.getQuadDisplay(E));return P.includes(O)})}const g=F.map(P=>({name:"quad",type:"radio",label:`Quad ${n.getQuadDisplay(P)}`,value:P,checked:n.getQuadDisplay(P)===f||P===f}));yield(yield n.alertController.create({header:"Select Quad",subHeader:t.name,cssClass:"location-edit-alert",inputs:g,buttons:[{text:"Cancel",role:"cancel",handler:()=>a(null)},{text:"Save",handler:P=>a(P)}]})).present()});return function(a){return c.apply(this,arguments)}}())}loadDynamicSites(){var t=this;return(0,_.A)(function*(){try{(yield t.siteSyncService.getAllSites()).forEach(n=>{t.availableLocations.some(c=>c.name===n.name)||t.availableLocations.push({name:n.name,hasZones:n.zones&&n.zones.length>0||!1,hasQuads:n.sample_points&&n.sample_points.length>0||!1,zones:n.zones?n.zones.map(c=>c.name?.replace("Zone ","")||c.id):[],quads:n.sample_points?n.sample_points.map(c=>c.id||c.label):[]})})}catch(o){console.error("Error loading dynamic sites:",o)}})()}initializeForm(){const t=this.getCurrentDate(),o=this.getCurrentTime();this.healthForm=this.formBuilder.group({observer:["",y.k0.required],date:[t,y.k0.required],time:[o,y.k0.required],weather:["",y.k0.required],tide:["",y.k0.required],location:["",y.k0.required],zoneNumber:[""],quadNumber:[""],canopyCover:["",y.k0.required],recruitmentCover:["",y.k0.required],deadTrees:[0,[y.k0.required,y.k0.min(0)]],mushroomEvidence:[!1],pollutionSigns:[!1],pollutionTypes:[[]],pollutionObservations:[""],soilComposition:["",y.k0.required],soilDescription:[""],predation:[""],predationOther:[""],otherObservations:[""]}),this.updateProgress()}fetchWeatherAndTide(){this.weatherService.getWeatherByCoordinates(this.maheLatitude,this.maheLongitude).subscribe({next:t=>{if(t&&t.weather&&t.weather.length>0){const o=this.weatherService.mapWeatherToOption(t.weather[0].main);this.healthForm.patchValue({weather:o}),console.log("Weather auto-populated:",o)}},error:t=>{console.error("Error fetching weather:",t)}}),this.tideService.getTides(this.maheLatitude,this.maheLongitude).subscribe({next:t=>{if(t&&t.extremes){const o=this.tideService.getCurrentTideState(t.extremes);this.healthForm.patchValue({tide:o}),console.log("Tide auto-populated:",o)}},error:t=>{console.error("Error fetching tide:",t)}})}captureSoilPhoto(){var t=this;return(0,_.A)(function*(){try{const o=yield t.photoService.TakePicture();o?(t.soilPhoto=o,t.updateProgress()):yield(yield t.alertController.create({header:"Photo Error",message:"Failed to capture photo",buttons:["OK"]})).present()}catch(o){console.error("Error capturing soil photo:",o),yield(yield t.alertController.create({header:"Photo Error",message:"Failed to capture photo",buttons:["OK"]})).present()}})()}removeSoilPhoto(){this.soilPhoto=null,this.updateProgress()}capturePredationPhoto(){var t=this;return(0,_.A)(function*(){try{const o=yield t.photoService.TakePicture();o?(t.predationPhoto=o,t.updateProgress()):yield(yield t.alertController.create({header:"Photo Error",message:"Failed to capture photo",buttons:["OK"]})).present()}catch(o){console.error("Error capturing predation photo:",o),yield(yield t.alertController.create({header:"Photo Error",message:"Failed to capture photo",buttons:["OK"]})).present()}})()}removePredationPhoto(){this.predationPhoto=null,this.updateProgress()}capturePollutionPhoto(){var t=this;return(0,_.A)(function*(){try{const o=yield t.photoService.TakePicture();o?(t.pollutionPhoto=o,t.updateProgress()):yield(yield t.alertController.create({header:"Photo Error",message:"Failed to capture photo",buttons:["OK"]})).present()}catch(o){console.error("Error capturing pollution photo:",o),yield(yield t.alertController.create({header:"Photo Error",message:"Failed to capture photo",buttons:["OK"]})).present()}})()}removePollutionPhoto(){this.pollutionPhoto=null,this.updateProgress()}openFullScreenPhoto(t,o){var n=this;return(0,_.A)(function*(){yield(yield n.modalController.create({component:Ze,componentProps:{photoUrl:t,photoType:o},cssClass:"fullscreen-photo-modal"})).present()})()}updateProgress(){const t=this.healthForm.value;let o=0,n=9;t.observer&&o++,t.date&&o++,t.time&&o++,t.weather&&o++,t.tide&&o++,t.location&&o++,t.canopyCover&&o++,t.recruitmentCover&&o++,null!==t.deadTrees&&""!==t.deadTrees&&o++,t.soilComposition&&o++,n++,"mixed"===t.soilComposition&&t.soilDescription&&(o++,n++),this.soilPhoto&&(o++,n++),t.predation&&(o++,n++),this.predationPhoto&&(o++,n++),t.pollutionSigns&&t.pollutionTypes&&t.pollutionTypes.length>0&&(o++,n++),this.pollutionPhoto&&(o++,n++),t.pollutionObservations&&(o++,n++),t.otherObservations&&(o++,n++),this.progress=n>0?o/n:0}subscribeToFormChanges(){this.autosaveSub&&this.autosaveSub.unsubscribe(),this.autosaveSub=this.healthForm.valueChanges.pipe((0,D.B)(750)).subscribe(()=>{this.isSubmitted||(this.updateProgress(),this.saveDraftOnExit().catch(t=>console.error("HealthFormPage: autosave failed:",t)))})}onSubmit(){var t=this;return(0,_.A)(function*(){if(t.isSubmitting)return;if(t.isSubmitting=!0,t.healthForm.markAllAsTouched(),!t.healthForm.valid)return t.isSubmitting=!1,void(yield(yield t.alertController.create({header:"Incomplete Form",message:"Please fill in all required fields (Location, Date, Time, Weather, Tide, Canopy Cover, Recruitment Cover, Dead Trees, and Soil Composition).",buttons:["OK"]})).present());t.isSubmitted=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null);const o=yield t.loadingController.create({message:"Submitting health assessment..."});yield o.present();try{const n={...t.healthForm.value};n.status={incomplete:!1,sent:!0,pending:!1};const c={formValue:n,coordinates:null,photos:{soil:t.soilPhoto,predation:t.predationPhoto,pollution:t.pollutionPhoto},existingReportId:t.currentReportId||void 0};t.isEditMode&&(c.isEditMode=!0,c.originalSubmittedBy=t.originalSubmittedBy);const a=yield t.healthSyncService.submitFinal(c);yield o.dismiss();try{t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(T=>setTimeout(T,1e3));const g=t.healthForm.value;yield t.healthSyncService.clearDraft(g);const k=(g?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),P=g?.zoneNumber||"",E=g?.quadNumber||"";let O=`health_draft_${k}`;P&&(O+=`_zone${P}`),E&&(O+=`_quad${E}`),yield t.forceDeleteDraftFile(`${O}.json`),t.isSubmitted=!0,console.log("HealthFormPage: Draft cleared and form reset successfully")}catch(g){console.error("HealthFormPage: Failed to clear draft:",g)}const f=t.isEditMode?a.queued?"Updated assessment saved locally and queued for upload when online.":"Health assessment updated successfully!":a.queued?"Health assessment saved locally and queued for upload when online.":"Health assessment submitted successfully!";yield(yield t.alertController.create({header:"Success",message:f,buttons:[{text:"OK",handler:()=>{t.router.navigate(["/health"])}}]})).present()}catch(n){yield o.dismiss(),console.error("Error submitting assessment:",n),yield(yield t.alertController.create({header:"Error",message:"Failed to submit health assessment. Please try again.",buttons:["OK"]})).present()}})()}discardForm(){var t=this;return(0,_.A)(function*(){var n;yield(yield t.alertController.create({header:"Discard Form",message:"Are you sure you want to discard this form? All entered data will be lost.",buttons:[{text:"Cancel",role:"cancel"},{text:"Discard",role:"destructive",handler:(n=(0,_.A)(function*(){t.isDiscarded=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(k=>setTimeout(k,1e3));const c=t.healthForm.value;yield t.healthSyncService.clearDraft(c);const a=(c?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),f=c?.zoneNumber||"",F=c?.quadNumber||"";let g=`health_draft_${a}`;f&&(g+=`_zone${f}`),F&&(g+=`_quad${F}`),yield t.forceDeleteDraftFile(`${g}.json`),yield new Promise(k=>setTimeout(k,200)),t.initializeForm(),t.router.navigate(["/health"])}),function(){return n.apply(this,arguments)})}]})).present()})()}restoreDraftIfAny(){var t=this;return(0,_.A)(function*(){const o=t.route.snapshot.queryParams,n={location:o.location||t.healthForm.get("location")?.value,zoneNumber:o.zone||t.healthForm.get("zoneNumber")?.value,quadNumber:o.quad||t.healthForm.get("quadNumber")?.value},c=yield t.healthSyncService.loadDraft(n);if(c)try{c.reportId&&(t.currentReportId=c.reportId),c.form&&t.healthForm.patchValue(c.form),t.soilPhoto=c.photos?.soil||null,t.predationPhoto=c.photos?.predation||null,t.pollutionPhoto=c.photos?.pollution||null,t.updateProgress()}catch(a){console.error("HealthFormPage: failed to restore draft:",a)}})()}saveDraft(){var t=this;return(0,_.A)(function*(){var n;t.healthForm&&(yield(yield t.alertController.create({header:"Save Draft",message:"Are you sure you want to save this form as a draft? You can return to complete it later.",buttons:[{text:"Cancel",role:"cancel"},{text:"Save Draft",handler:(n=(0,_.A)(function*(){try{yield t.saveDraftOnExit(),yield(yield t.alertController.create({header:"Draft Saved",message:"Your form has been saved as a draft. You can access it from the health page.",buttons:[{text:"OK",handler:()=>{t.router.navigate(["/health"])}}]})).present()}catch(c){console.error("Failed to save draft:",c),yield(yield t.alertController.create({header:"Save Failed",message:"Failed to save the draft. Please try again.",buttons:["OK"]})).present()}}),function(){return n.apply(this,arguments)})}]})).present())})()}saveDraftOnExit(){var t=this;return(0,_.A)(function*(){if(!t.healthForm||t.viewMode||t.isDiscarded||t.isSubmitted)return;const o=t.healthForm.value;(o?.location||o?.weather||o?.tide||t.soilPhoto||t.predationPhoto)&&(yield t.healthSyncService.saveDraft({reportId:t.currentReportId,form:o,coordinates:null,photos:{soil:t.soilPhoto,predation:t.predationPhoto,pollution:t.pollutionPhoto}}))})()}incrementDeadTrees(){const t=this.healthForm.get("deadTrees")?.value||0;this.healthForm.patchValue({deadTrees:t+1})}decrementDeadTrees(){const t=this.healthForm.get("deadTrees")?.value||0;t>0&&this.healthForm.patchValue({deadTrees:t-1})}formatSoilComposition(t){if(!t||("string"==typeof t&&(t=[t]),!Array.isArray(t)||0===t.length))return"";const o={sand:"Sand",mud:"Mud",gravel:"Gravel",silt:"Silt",clay:"Clay",organic:"Organic matter"};return t.map(n=>o[n]||n).join(", ")}formatMixedSoilTypes(){const t={sand:"Sand",mud:"Mud",gravel:"Gravel",silt:"Silt"};return this.mixedSoilTypes.map(o=>t[o]||o).join(", ")}getWeatherLabel(t){return{sunny:"Sunny",partly_cloudy:"Partly Cloudy",cloudy:"Cloudy",rainy:"Rainy",stormy:"Stormy"}[t]||t}getTideLabel(t){return{high:"High",low:"Low",incoming:"Incoming",outgoing:"Outgoing"}[t]||t}setViewMode(t){this.viewMode=t,t?(this.healthForm.disable(),this.healthForm.get("mushroomEvidence")?.enable()):this.healthForm.enable()}loadReportForViewing(t){var o=this;return(0,_.A)(function*(){try{const n=yield o.healthSyncService.getAllReports();console.log("HealthFormPage: All reports:",n);const c=n.find(f=>f.report.reportId===t);if(!c)return console.error("HealthFormPage: Report not found for viewing:",t),yield(yield o.alertController.create({header:"Report Not Found",message:"The requested report could not be found.",buttons:["OK"]})).present(),void o.router.navigate(["/health"]);const a=c.report;console.log("HealthFormPage: Loading report for viewing:",a),o.loadedReport=a,o.healthForm.patchValue({observer:a.form.observer||"",date:a.form.date||"",time:a.form.time||"",weather:a.form.weather||"",tide:a.form.tide||"",location:a.form.location||"",zoneNumber:a.form.zoneNumber||"",quadNumber:a.form.quadNumber||"",canopyCover:a.form.canopyCover||"",recruitmentCover:a.form.recruitmentCover||"",deadTrees:a.form.deadTrees||0,mushroomEvidence:a.form.mushroomEvidence||!1,pollutionSigns:a.form.pollutionSigns||!1,pollutionTypes:a.form.pollutionTypes||[],pollutionObservations:a.form.pollutionObservations||"",soilComposition:a.form.soilComposition||"",soilDescription:a.form.soilDescription||"",predation:a.form.predation||"",predationOther:a.form.predationOther||"",otherObservations:a.form.otherObservations||""}),a.photos&&(Array.isArray(a.photos)?(a.photos[0]&&(a.photos[0].startsWith("data:image/")||console.warn("\u26a0\ufe0f HealthFormPage: Soil photo is not base64:",a.photos[0].substring(0,50)),o.soilPhoto=a.photos[0]),a.photos[1]&&(a.photos[1].startsWith("data:image/")||console.warn("\u26a0\ufe0f HealthFormPage: Predation photo is not base64:",a.photos[1].substring(0,50)),o.predationPhoto=a.photos[1]),a.photos[2]&&(a.photos[2].startsWith("data:image/")||console.warn("\u26a0\ufe0f HealthFormPage: Pollution photo is not base64:",a.photos[2].substring(0,50)),o.pollutionPhoto=a.photos[2])):(o.soilPhoto=a.photos.soil||null,o.predationPhoto=a.photos.predation||null,o.pollutionPhoto=a.photos.pollution||null)),o.currentReportId=t,o.setCurrentDateTime(t),o.updateProgress(),o.setViewMode(!0)}catch(n){console.error("HealthFormPage: Error loading report for viewing:",n),yield(yield o.alertController.create({header:"Error",message:"Failed to load the report.",buttons:["OK"]})).present(),o.router.navigate(["/health"])}})()}enableEditMode(){!this.currentUser||this.currentUser.level<4||(this.isEditMode=!0,this.viewMode=!1,this.healthForm.enable(),this.originalSubmittedBy=this.loadedReport?.submittedBy||"")}getEditedDateTime(){if(!this.loadedReport)return null;let t=this.loadedReport.editedAt||null;if(!t){const g=this.loadedReport.updatedAt,k=this.loadedReport.createdAt;g&&k&&g!==k&&Math.abs(new Date(g).getTime()-new Date(k).getTime())>5e3&&(t=g)}if(!t)return null;const o=new Date(t);return isNaN(o.getTime())?null:`${o.getDate().toString().padStart(2,"0")}/${(o.getMonth()+1).toString().padStart(2,"0")}/${o.getFullYear()} ${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`}deleteEntry(){var t=this;return(0,_.A)(function*(){const o=t.auth.getCurrentUser();var c;!o||o.level<4?yield(yield t.alertController.create({header:"Permission Denied",message:"Only Level 4 users can delete entries.",buttons:["OK"]})).present():yield(yield t.alertController.create({header:"Delete Entry",message:"Are you sure you want to permanently delete this entry? This will remove it from the database and back it up to deleted files storage. This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",role:"destructive",handler:(c=(0,_.A)(function*(){yield t.performDeletion()}),function(){return c.apply(this,arguments)})}]})).present()})()}performDeletion(){var t=this;return(0,_.A)(function*(){const o=yield t.loadingController.create({message:"Deleting entry..."});yield o.present();try{const n=t.auth.getCurrentUser();yield t.entryDeletionService.deleteEntry({reportId:t.currentReportId,formType:"health",tableName:"health_reports",deletedBy:n?.username||"Unknown",deletedByEmail:n?.email||"",originalSubmittedBy:t.loadedReport?.submittedBy,originalSubmittedAt:t.loadedReport?.createdAt}),yield o.dismiss(),yield(yield t.alertController.create({header:"Success",message:"Entry has been deleted and backed up successfully.",buttons:[{text:"OK",handler:()=>{t.router.navigate(["/health"])}}]})).present()}catch(n){yield o.dismiss(),console.error("Error deleting entry:",n),yield(yield t.alertController.create({header:"Error",message:"Failed to delete entry. Please try again.",buttons:["OK"]})).present()}})()}static#e=i=()=>(this.\u0275fac=function(o){return new(o||s)(e.rXU(y.ok),e.rXU(h.hG),e.rXU(h.Xi),e.rXU(x.Ix),e.rXU(x.nX),e.rXU($.W),e.rXU(l.m),e.rXU(m.I),e.rXU(d.N),e.rXU(u.r),e.rXU(v.H),e.rXU(M.C),e.rXU(S.k),e.rXU(h.W3))},this.\u0275cmp=e.VBU({type:s,selectors:[["app-health-form"]],standalone:!1,decls:167,vars:52,consts:[[1,"health-blue"],["slot","start"],["defaultHref","/health"],[1,"health-blue","compact-toolbar"],[1,"date-time-text"],[4,"ngIf"],[1,"health-blue","metadata-toolbar"],[1,"metadata-container"],[1,"metadata-item",3,"click"],["name","location",1,"metadata-icon"],[1,"metadata-label"],["name","alert-circle","class","status-icon required",4,"ngIf"],["class","metadata-item",3,"click",4,"ngIf"],["class","edit-location-link",3,"click",4,"ngIf"],["style","padding: 0 16px; font-size: 0.75rem; color: #e76f51;",4,"ngIf"],["color","light",3,"value"],[1,"progress-text"],[3,"ngSubmit","formGroup"],["class","edit-mode-banner",4,"ngIf"],["class","edit-mode-banner editing",4,"ngIf"],[2,"position","relative"],["position","stacked"],["formControlName","observer","type","text","placeholder","Enter observer name"],["name","close-circle","color","danger","style","position: absolute; top: 12px; right: 10px;",4,"ngIf"],["name","checkmark-circle","style","position: absolute; top: 12px; right: 10px; color: #52a676;",4,"ngIf"],[1,"two-column"],["lines","none",2,"position","relative"],["formControlName","weather","placeholder","Select weather","interface","popover",4,"ngIf"],["readonly","",3,"value",4,"ngIf"],["formControlName","tide","placeholder","Select tide","interface","popover",4,"ngIf"],["formControlName","canopyCover","placeholder","Select %","interface","popover"],["value","<1%"],["value","1-20%"],["value","21-40%"],["value","41-60%"],["value","61-80%"],["value","81-100%"],["formControlName","recruitmentCover","placeholder","Select %","interface","popover"],[1,"counter-field",2,"padding-bottom","15px !important"],[1,"counter-label"],[1,"counter-controls",2,"padding-bottom","15px !important"],["fill","solid","size","small",3,"disabled","click",4,"ngIf"],[1,"counter-value"],["fill","solid","size","small",3,"click",4,"ngIf"],["lines","none"],["formControlName","mushroomEvidence","slot","start"],["formControlName","pollutionSigns","slot","start"],["class","disturbance-item",4,"ngIf"],["formControlName","soilComposition","placeholder","Select soil type(s)","interface","popover",3,"multiple"],["value","sand"],["value","mud"],["value","gravel"],["value","silt"],["class","mixed-soil-note",4,"ngIf"],["class","photo-section",4,"ngIf"],["class","photo-preview",4,"ngIf"],["formControlName","predation","placeholder","Select type","interface","popover"],["value","holes_in_leaf"],["value","mealy_bugs"],["value","other"],["formControlName","otherObservations","rows","6","placeholder","Enter any additional observations about wetland health, tree vitality, water quality, wildlife presence, etc.",4,"ngIf"],["rows","6","readonly","",3,"value",4,"ngIf"],["class","form-buttons",4,"ngIf"],["class","button-container",4,"ngIf"],["name","alert-circle",1,"status-icon","required"],["name","grid",1,"metadata-icon"],["name","apps",1,"metadata-icon"],[1,"edit-location-link",3,"click"],[2,"padding","0 16px","font-size","0.75rem","color","#e76f51"],[1,"edit-mode-banner"],["expand","block","color","warning",3,"click"],["name","create-outline","slot","start"],[1,"edit-mode-banner","editing"],["name","create-outline"],["name","close-circle","color","danger",2,"position","absolute","top","12px","right","10px"],["name","checkmark-circle",2,"position","absolute","top","12px","right","10px","color","#52a676"],["formControlName","weather","placeholder","Select weather","interface","popover"],["value","sunny"],["value","partly_cloudy"],["value","cloudy"],["value","rainy"],["value","stormy"],["readonly","",3,"value"],["formControlName","tide","placeholder","Select tide","interface","popover"],["value","high"],["value","low"],["value","incoming"],["value","outgoing"],["fill","solid","size","small",3,"click","disabled"],["name","remove","slot","icon-only"],["fill","solid","size","small",3,"click"],["name","add","slot","icon-only"],[1,"disturbance-item"],[1,"disturbance-title"],["name","close-circle","color","danger","style","position: absolute; top: -15px; right: 10px; z-index: 10; font-size: 24px;",4,"ngIf"],["name","checkmark-circle","style","position: absolute; top: -15px; right: 10px; color: #52a676; z-index: 10; font-size: 24px;",4,"ngIf"],["formControlName","pollutionTypes","multiple","true","placeholder","Select type(s)","interface","popover",2,"margin-top","-5px !important"],["value","plastics"],["value","metal"],["value","glass"],["value","fabric"],["value","paper_cardboard"],["value","home_appliance"],["value","construction_debris"],["value","furniture"],["formControlName","pollutionObservations","rows","6","placeholder","Describe the distribution and volume of waste, specific location within the site, potential sources, any observed impacts on wildlife or vegetation, etc.",4,"ngIf"],["name","close-circle","color","danger",2,"position","absolute","top","-15px","right","10px","z-index","10","font-size","24px"],["name","checkmark-circle",2,"position","absolute","top","-15px","right","10px","color","#52a676","z-index","10","font-size","24px"],[1,"photo-section"],["expand","block","fill","outline",1,"photo-button",3,"click"],["name","camera","slot","start"],[1,"photo-preview"],[1,"photo-item"],["alt","Pollution photo",2,"cursor","pointer",3,"click","src"],["size","small","color","danger",3,"click",4,"ngIf"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"],["formControlName","pollutionObservations","rows","6","placeholder","Describe the distribution and volume of waste, specific location within the site, potential sources, any observed impacts on wildlife or vegetation, etc."],["rows","6","readonly","",3,"value"],[1,"mixed-soil-note"],["alt","Soil photo",2,"cursor","pointer",3,"click","src"],["formControlName","predationOther","rows","2","placeholder","Describe the predation observed"],["alt","Predation photo",2,"cursor","pointer",3,"click","src"],["formControlName","otherObservations","rows","6","placeholder","Enter any additional observations about wetland health, tree vitality, water quality, wildlife presence, etc."],[1,"form-buttons"],["expand","block","type","submit",1,"submit-button",3,"disabled"],["name","checkmark-circle","slot","start"],["expand","block","fill","outline","color","medium",1,"save-draft-button",3,"click"],["name","save-outline","slot","start"],["expand","block","fill","outline",1,"discard-button",3,"click"],["name","trash-outline","slot","start"],[1,"button-container"],["expand","block","color","danger",1,"delete-button",3,"click"]],template:function(o,n){if(1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Wetland Health Assessment"),e.k0s()(),e.j41(6,"ion-toolbar",3)(7,"ion-text",4),e.EFF(8),e.DNE(9,w,2,1,"span",5),e.k0s()(),e.j41(10,"ion-toolbar",6)(11,"div",7)(12,"div",8),e.bIt("click",function(){return!n.viewMode&&n.editLocation()}),e.nrm(13,"ion-icon",9),e.j41(14,"span",10),e.EFF(15),e.k0s(),e.DNE(16,Q,1,0,"ion-icon",11),e.k0s(),e.DNE(17,W,4,1,"div",12)(18,R,4,1,"div",12)(19,G,2,0,"span",13),e.k0s(),e.DNE(20,B,2,0,"ion-error",14),e.k0s(),e.j41(21,"ion-toolbar",3),e.nrm(22,"ion-progress-bar",15),e.j41(23,"ion-text",16),e.EFF(24),e.k0s()()(),e.j41(25,"ion-content")(26,"form",17),e.bIt("ngSubmit",function(){return n.onSubmit()}),e.DNE(27,z,4,0,"div",18)(28,Y,4,0,"div",19),e.j41(29,"ion-card")(30,"ion-card-header",0)(31,"ion-card-title"),e.EFF(32,"Assessment Information"),e.k0s()(),e.j41(33,"ion-card-content")(34,"ion-item",20)(35,"ion-label",21),e.EFF(36,"Observer"),e.k0s(),e.nrm(37,"ion-input",22),e.DNE(38,le,1,0,"ion-icon",23)(39,se,1,0,"ion-icon",24)(40,ce,2,0,"ion-error",5),e.k0s(),e.j41(41,"div",25)(42,"ion-item",26)(43,"ion-label",21),e.EFF(44,"Weather"),e.k0s(),e.DNE(45,de,11,0,"ion-select",27)(46,ue,1,1,"ion-input",28)(47,pe,1,0,"ion-icon",23)(48,me,1,0,"ion-icon",24)(49,he,2,0,"ion-error",5),e.k0s(),e.j41(50,"ion-item",26)(51,"ion-label",21),e.EFF(52,"Tide"),e.k0s(),e.DNE(53,ge,9,0,"ion-select",29)(54,fe,1,1,"ion-input",28)(55,be,1,0,"ion-icon",23)(56,_e,1,0,"ion-icon",24)(57,ve,2,0,"ion-error",5),e.k0s()()()(),e.j41(58,"ion-card")(59,"ion-card-header",0)(60,"ion-card-title"),e.EFF(61,"Wetland Health"),e.k0s()(),e.j41(62,"ion-card-content")(63,"div",25)(64,"ion-item",26)(65,"ion-label",21),e.EFF(66,"Canopy Cover %"),e.k0s(),e.j41(67,"ion-select",30)(68,"ion-select-option",31),e.EFF(69,"<1%"),e.k0s(),e.j41(70,"ion-select-option",32),e.EFF(71,"1-20%"),e.k0s(),e.j41(72,"ion-select-option",33),e.EFF(73,"21-40%"),e.k0s(),e.j41(74,"ion-select-option",34),e.EFF(75,"41-60%"),e.k0s(),e.j41(76,"ion-select-option",35),e.EFF(77,"61-80%"),e.k0s(),e.j41(78,"ion-select-option",36),e.EFF(79,"81-100%"),e.k0s()(),e.DNE(80,Fe,1,0,"ion-icon",23)(81,ye,1,0,"ion-icon",24)(82,Pe,2,0,"ion-error",5),e.k0s(),e.j41(83,"ion-item",26)(84,"ion-label",21),e.EFF(85,"Recruitment Cover %"),e.k0s(),e.j41(86,"ion-select",37)(87,"ion-select-option",31),e.EFF(88,"<1%"),e.k0s(),e.j41(89,"ion-select-option",32),e.EFF(90,"1-20%"),e.k0s(),e.j41(91,"ion-select-option",33),e.EFF(92,"21-40%"),e.k0s(),e.j41(93,"ion-select-option",34),e.EFF(94,"41-60%"),e.k0s(),e.j41(95,"ion-select-option",35),e.EFF(96,"61-80%"),e.k0s(),e.j41(97,"ion-select-option",36),e.EFF(98,"81-100%"),e.k0s()(),e.DNE(99,xe,1,0,"ion-icon",23)(100,ke,1,0,"ion-icon",24)(101,Ce,2,0,"ion-error",5),e.k0s()(),e.j41(102,"div",38)(103,"ion-label",39),e.EFF(104,"Dead Trees/Stumps"),e.k0s(),e.j41(105,"div",40),e.DNE(106,Ee,2,1,"ion-button",41),e.j41(107,"span",42),e.EFF(108),e.k0s(),e.DNE(109,Me,2,0,"ion-button",43),e.k0s()(),e.j41(110,"ion-item",44),e.nrm(111,"ion-checkbox",45),e.j41(112,"ion-label"),e.EFF(113,"Evidence of mushrooms observed"),e.k0s()(),e.j41(114,"ion-item",44),e.nrm(115,"ion-checkbox",46),e.j41(116,"ion-label"),e.EFF(117,"Signs of pollution"),e.k0s()(),e.DNE(118,$e,30,6,"div",47),e.k0s()(),e.j41(119,"ion-card")(120,"ion-card-header",0)(121,"ion-card-title"),e.EFF(122,"Soil & Environmental Factors"),e.k0s()(),e.j41(123,"ion-card-content")(124,"ion-item",26)(125,"ion-label",21),e.EFF(126,"Soil Composition"),e.k0s(),e.j41(127,"ion-select",48)(128,"ion-select-option",49),e.EFF(129,"Sand"),e.k0s(),e.j41(130,"ion-select-option",50),e.EFF(131,"Mud"),e.k0s(),e.j41(132,"ion-select-option",51),e.EFF(133,"Gravel"),e.k0s(),e.j41(134,"ion-select-option",52),e.EFF(135,"Silt"),e.k0s()(),e.DNE(136,Re,1,0,"ion-icon",23)(137,Ne,1,0,"ion-icon",24)(138,He,2,0,"ion-error",5),e.k0s(),e.DNE(139,Ge,2,1,"ion-note",53)(140,ze,4,0,"div",54)(141,Be,6,2,"div",55),e.j41(142,"ion-item",44)(143,"ion-label",21),e.EFF(144,"Predation"),e.k0s(),e.j41(145,"ion-select",56)(146,"ion-select-option",57),e.EFF(147,"Holes in leaf (Insect predation)"),e.k0s(),e.j41(148,"ion-select-option",58),e.EFF(149,"White bugs on tree? Mealy bugs (Lipou)"),e.k0s(),e.j41(150,"ion-select-option",59),e.EFF(151,"Other (specify)"),e.k0s()()(),e.DNE(152,Ye,4,0,"ion-item",5)(153,qe,4,0,"div",54)(154,Le,6,2,"div",55),e.k0s()(),e.j41(155,"ion-card")(156,"ion-card-header",0)(157,"ion-card-title"),e.EFF(158,"Other Observations"),e.k0s()(),e.j41(159,"ion-card-content")(160,"ion-item",44)(161,"ion-label",21),e.EFF(162,"Additional Notes"),e.k0s(),e.DNE(163,Xe,1,0,"ion-textarea",60)(164,Ue,1,1,"ion-textarea",61),e.k0s()()(),e.DNE(165,Qe,10,1,"div",62)(166,We,4,0,"div",63),e.k0s()()),2&o){let c,a,f,F,g,k,P,E,O,T,j,q,N,V,ee,te,L,oe,ne,X,ie,re,A,K,U,Z,ae;e.R7$(8),e.SpI(" ",n.currentDateTime),e.R7$(),e.Y8G("ngIf",(n.viewMode||n.isEditMode)&&n.getEditedDateTime()),e.R7$(6),e.JRh((null==(c=n.healthForm.get("location"))?null:c.value)||"Add location"),e.R7$(),e.Y8G("ngIf",!(null!=(a=n.healthForm.get("location"))&&a.value||n.viewMode)),e.R7$(),e.Y8G("ngIf",(null==(f=n.healthForm.get("zoneNumber"))?null:f.value)&&n.locationHasZones()),e.R7$(),e.Y8G("ngIf",(null==(F=n.healthForm.get("quadNumber"))?null:F.value)&&n.locationHasQuads()),e.R7$(),e.Y8G("ngIf",n.isEditMode&&n.currentUser&&n.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",(null==(g=n.healthForm.get("location"))?null:g.hasError("required"))&&(null==(g=n.healthForm.get("location"))?null:g.touched)),e.R7$(2),e.Y8G("value",n.progress),e.R7$(2),e.SpI(" ",(100*n.progress).toFixed(0),"% Complete "),e.R7$(),e.AVh("view-mode",n.viewMode),e.R7$(),e.Y8G("formGroup",n.healthForm),e.R7$(),e.Y8G("ngIf",n.viewMode&&n.currentUser&&n.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",n.isEditMode),e.R7$(10),e.Y8G("ngIf",!(null!=(k=n.healthForm.get("observer"))&&k.value)),e.R7$(),e.Y8G("ngIf",null==(P=n.healthForm.get("observer"))?null:P.value),e.R7$(),e.Y8G("ngIf",(null==(E=n.healthForm.get("observer"))?null:E.hasError("required"))&&(null==(E=n.healthForm.get("observer"))?null:E.touched)),e.R7$(5),e.Y8G("ngIf",!n.viewMode),e.R7$(),e.Y8G("ngIf",n.viewMode),e.R7$(),e.Y8G("ngIf",!(n.viewMode||null!=(O=n.healthForm.get("weather"))&&O.value)),e.R7$(),e.Y8G("ngIf",!n.viewMode&&(null==(T=n.healthForm.get("weather"))?null:T.value)),e.R7$(),e.Y8G("ngIf",!n.viewMode&&(null==(j=n.healthForm.get("weather"))?null:j.hasError("required"))&&(null==(j=n.healthForm.get("weather"))?null:j.touched)),e.R7$(4),e.Y8G("ngIf",!n.viewMode),e.R7$(),e.Y8G("ngIf",n.viewMode),e.R7$(),e.Y8G("ngIf",!(n.viewMode||null!=(q=n.healthForm.get("tide"))&&q.value)),e.R7$(),e.Y8G("ngIf",!n.viewMode&&(null==(N=n.healthForm.get("tide"))?null:N.value)),e.R7$(),e.Y8G("ngIf",!n.viewMode&&(null==(V=n.healthForm.get("tide"))?null:V.hasError("required"))&&(null==(V=n.healthForm.get("tide"))?null:V.touched)),e.R7$(23),e.Y8G("ngIf",!(null!=(ee=n.healthForm.get("canopyCover"))&&ee.value)),e.R7$(),e.Y8G("ngIf",null==(te=n.healthForm.get("canopyCover"))?null:te.value),e.R7$(),e.Y8G("ngIf",(null==(L=n.healthForm.get("canopyCover"))?null:L.hasError("required"))&&(null==(L=n.healthForm.get("canopyCover"))?null:L.touched)),e.R7$(17),e.Y8G("ngIf",!(null!=(oe=n.healthForm.get("recruitmentCover"))&&oe.value)),e.R7$(),e.Y8G("ngIf",null==(ne=n.healthForm.get("recruitmentCover"))?null:ne.value),e.R7$(),e.Y8G("ngIf",(null==(X=n.healthForm.get("recruitmentCover"))?null:X.hasError("required"))&&(null==(X=n.healthForm.get("recruitmentCover"))?null:X.touched)),e.R7$(5),e.Y8G("ngIf",!n.viewMode),e.R7$(2),e.JRh((null==(ie=n.healthForm.get("deadTrees"))?null:ie.value)||0),e.R7$(),e.Y8G("ngIf",!n.viewMode),e.R7$(9),e.Y8G("ngIf",null==(re=n.healthForm.get("pollutionSigns"))?null:re.value),e.R7$(9),e.Y8G("multiple",!0),e.R7$(9),e.Y8G("ngIf",!(null!=(A=n.healthForm.get("soilComposition"))&&A.value)||0===(null==(A=n.healthForm.get("soilComposition"))||null==A.value?null:A.value.length)),e.R7$(),e.Y8G("ngIf",(null==(K=n.healthForm.get("soilComposition"))||null==K.value?null:K.value.length)>0),e.R7$(),e.Y8G("ngIf",(null==(U=n.healthForm.get("soilComposition"))?null:U.hasError("required"))&&(null==(U=n.healthForm.get("soilComposition"))?null:U.touched)),e.R7$(),e.Y8G("ngIf",(null==(Z=n.healthForm.get("soilComposition"))||null==Z.value?null:Z.value.length)>1),e.R7$(),e.Y8G("ngIf",!n.soilPhoto&&!n.viewMode),e.R7$(),e.Y8G("ngIf",n.soilPhoto),e.R7$(11),e.Y8G("ngIf","other"===(null==(ae=n.healthForm.get("predation"))?null:ae.value)),e.R7$(),e.Y8G("ngIf",!n.predationPhoto&&!n.viewMode),e.R7$(),e.Y8G("ngIf",n.predationPhoto),e.R7$(9),e.Y8G("ngIf",!n.viewMode),e.R7$(),e.Y8G("ngIf",n.viewMode),e.R7$(),e.Y8G("ngIf",!n.viewMode),e.R7$(),e.Y8G("ngIf",n.viewMode&&(null==n.currentUser?null:n.currentUser.level)>=4)}},dependencies:[C.bT,y.qT,y.BC,y.cb,y.j4,y.JD,h.Jm,h.QW,h.b_,h.I9,h.ME,h.tN,h.eY,h.W9,h.eU,h.iq,h.$w,h.uz,h.he,h.JI,h.FH,h.Nm,h.Ip,h.IO,h.nc,h.BC,h.ai,h.hB,h.Je,h.Gw,h.el],styles:[".health-blue[_ngcontent-%COMP%]{--background: #4fb3bf;color:#fff}.health-blue[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]{--color: white;transition:transform .2s}.health-blue[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]:hover{transform:translate(-4px)}.health-blue[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;text-align:center}.health-blue.compact-toolbar[_ngcontent-%COMP%]{--min-height: 28px;--padding-top: 5px;--padding-bottom: 5px}.edit-mode-banner[_ngcontent-%COMP%]{padding:.75rem 1rem;margin:.5rem;border-radius:.5rem}.edit-mode-banner[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: .5rem;font-weight:600}.edit-mode-banner.editing[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;display:flex;align-items:center;gap:.5rem;color:#856404;font-weight:500}.edit-mode-banner.editing[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.date-time-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fffffff2;font-size:14px;padding:0;margin:3px 0;font-weight:400;letter-spacing:.3px;line-height:1.2}.metadata-toolbar[_ngcontent-%COMP%]{--min-height: 40px;--padding-top: 6px;--padding-bottom: 6px}.metadata-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px;padding:0 12px;flex-wrap:wrap}.metadata-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;background:#ffffff26;border-radius:16px;padding:5px 10px;cursor:pointer;transition:all .2s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2)}.metadata-item[_ngcontent-%COMP%]:active{transform:scale(.95);background:#ffffff40}.metadata-icon[_ngcontent-%COMP%]{font-size:14px;color:#ffffffe6;min-width:14px}.metadata-label[_ngcontent-%COMP%]{color:#fff;font-size:12px;font-weight:500;letter-spacing:.2px;white-space:nowrap;max-width:120px;overflow:hidden;text-overflow:ellipsis}.edit-location-link[_ngcontent-%COMP%]{color:#ffffffe6;font-size:11px;text-decoration:underline;cursor:pointer;margin-left:8px;padding:4px 8px}.edit-location-link[_ngcontent-%COMP%]:active{opacity:.7}.status-icon[_ngcontent-%COMP%]{font-size:14px;margin-left:2px}.status-icon.success[_ngcontent-%COMP%]{color:#52a676}.status-icon.required[_ngcontent-%COMP%]{color:#ffd93d;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.6}}.progress-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fff;font-size:13px;padding:0;margin:0 0 4px;font-weight:400;line-height:1}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 2px 8px #0000001a}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0;padding:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#fff}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#ffffffe6;font-size:.875rem;margin-top:4px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{background:#fff;padding:16px}.two-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}@media (max-width: 768px){.two-column[_ngcontent-%COMP%]{grid-template-columns:1fr}}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;margin-bottom:12px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[position=stacked][_ngcontent-%COMP%]{margin-bottom:12px}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px;border:1px solid #ddd;border-radius:8px;margin-top:4px}ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{--padding-top: 12px;--padding-bottom: 12px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{color:#6b7c7a;font-size:.75rem;margin-top:4px}ion-select[_ngcontent-%COMP%]{width:100%}ion-checkbox[_ngcontent-%COMP%]{--size: 24px;--checkbox-background-checked: #4fb3bf;--border-color-checked: #4fb3bf}.photo-section[_ngcontent-%COMP%]{margin:16px 0}.disturbance-title[_ngcontent-%COMP%]{font-size:.775rem;font-weight:400;color:#000;margin-bottom:-2px;margin-top:5px;display:block}.disturbance-item[_ngcontent-%COMP%]{margin-top:-10px!important;padding-top:-10px!important;position:relative}.photo-button[_ngcontent-%COMP%]{--border-color: #52a676;--color: #52a676}.photo-button[_ngcontent-%COMP%]:hover{--background: rgba(82, 166, 118, .1)}.photo-preview[_ngcontent-%COMP%]{margin:16px 0}.photo-preview[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{display:block;font-weight:600;color:#0d3d2f;margin-bottom:8px}.photo-item[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:12px;padding:12px;background:#f9f9f9;border-radius:8px;border-left:4px solid #4fb3bf}.photo-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:120px;object-fit:cover;border-radius:8px;border:2px solid #4fb3bf;touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.photo-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: #dc2626;--background-hover: #b91c1c;--background-activated: #b91c1c}.form-buttons[_ngcontent-%COMP%]{padding:0 16px;margin-top:24px;margin-bottom:32px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-bottom:12px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-buttons[_ngcontent-%COMP%]   ion-button.save-draft-button[_ngcontent-%COMP%]{margin:10px 0 12px}.form-buttons[_ngcontent-%COMP%]   .save-draft-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--background: rgba(107, 124, 122, .1);--border-color: #6b7c7a;--color: #6b7c7a;--background-hover: rgba(107, 124, 122, .2);--background-activated: rgba(107, 124, 122, .3)}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{margin:0;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #4fb3bf;--background-hover: #3d9daa;--background-activated: #3d9daa}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}.form-buttons[_ngcontent-%COMP%]   .discard-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--color: #e76f51;--border-color: #e76f51;--border-width: 2px;--background-hover: rgba(231, 111, 81, .1);--background-activated: rgba(231, 111, 81, .2);--ripple-color: rgba(231, 111, 81, .3)}.form-buttons[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{margin-top:20px;--background: #d32f2f;--background-hover: #b71c1c;--background-activated: #b71c1c;font-weight:600;height:48px;font-size:1rem}.submit-button[_ngcontent-%COMP%]{margin:24px 16px 32px;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #4fb3bf;--background-hover: #3d9daa;--background-activated: #3d9daa}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}.counter-field[_ngcontent-%COMP%]{padding:12px 16px;background:#f9f9f9;border-radius:8px;margin:8px 0 18px}.counter-label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:500;color:#333;margin-bottom:8px}.counter-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:16px}.counter-controls[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: #52a676;--border-color: #0d3d2f;--color: #0d3d2f;--background-hover: rgba(13, 61, 47, .1);--border-radius: 50%;width:40px;height:40px;margin:0}.counter-value[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#0d3d2f;min-width:50px;text-align:center}.counter-note[_ngcontent-%COMP%]{display:block;text-align:center;margin-top:8px;font-size:12px;color:#666}.mixed-soil-note[_ngcontent-%COMP%]{display:block;padding:8px 16px;margin-top:4px;font-size:12px;color:#52a676;font-style:italic}.soil-badges-section[_ngcontent-%COMP%]{padding:12px 16px;background:#f9f9f9;border-radius:8px;margin:8px 0}.badges-label[_ngcontent-%COMP%]{display:block;font-size:13px;color:#333;margin-bottom:10px}.soil-badges[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.soil-badges[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{padding:8px 16px;font-size:14px;border-radius:20px;cursor:pointer;background:#e0e0e0;color:#666;transition:all .2s ease}.soil-badges[_ngcontent-%COMP%]   ion-badge.selected[_ngcontent-%COMP%]{background:#52a676;color:#fff}ion-select[_ngcontent-%COMP%]{--placeholder-color: #999;--placeholder-opacity: 1;font-size:.95rem;max-width:100%}  ion-popover.select-popover{--width: auto;--min-width: 250px;--max-width: 90vw}  ion-popover.select-popover .popover-content{border-radius:12px;box-shadow:0 4px 16px #00000026}  ion-popover.select-popover ion-list{padding:8px 0}  ion-popover.select-popover ion-item{--padding-start: 16px;--padding-end: 16px;--min-height: 44px;font-size:.95rem}  ion-popover.select-popover ion-checkbox{--size: 20px;margin-right:12px;--checkbox-background-checked: #52a676 !important;--border-color-checked: #52a676 !important;--border-color: #52a676 !important;--color-checked: #52a676 !important;--checkmark-color: white !important;--background: white !important}  ion-popover.select-popover ion-item.item-checkbox-checked{--color: #52a676}  ion-popover.select-popover ion-item.item-checkbox-checked ion-label{color:#52a676!important;font-weight:500}  .select-interface-option{border-radius:8px}ion-error[_ngcontent-%COMP%]{color:#e76f51!important;font-size:.75rem!important;margin-top:4px;padding-left:16px}ion-item.item-disabled[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%], ion-item.item-select-disabled[_ngcontent-%COMP%]{opacity:1!important;--opacity: 1 !important}ion-item.item-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-item.item-select-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:1!important;color:#000!important;--color: #000 !important}ion-item.item-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%], ion-item.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{opacity:1!important;--opacity: 1 !important;color:#000!important;--color: #000 !important;--placeholder-color: #000 !important;--placeholder-opacity: 1 !important}  .item-disabled,   .item-interactive-disabled,   .item-select-disabled,   ion-item:has(ion-select.select-disabled),   ion-item:has(ion-toggle.toggle-disabled),   ion-item:has(ion-checkbox.checkbox-disabled),   ion-item:has(ion-input.input-disabled){opacity:1!important}  .item-disabled ion-label,   .item-disabled .label-text,   .item-disabled .label-text-wrapper,   .item-disabled .native-input,   .item-disabled .select-text,   .item-disabled .select-icon,   .item-interactive-disabled ion-label,   .item-interactive-disabled .label-text,   .item-interactive-disabled .label-text-wrapper,   .item-interactive-disabled .native-input,   .item-interactive-disabled .select-text,   .item-interactive-disabled .select-icon,   .item-select-disabled ion-label,   .item-select-disabled .label-text,   .item-select-disabled .label-text-wrapper,   .item-select-disabled .native-input,   .item-select-disabled .select-text,   .item-select-disabled .select-icon,   ion-item:has(ion-select.select-disabled) ion-label,   ion-item:has(ion-select.select-disabled) .label-text,   ion-item:has(ion-select.select-disabled) .label-text-wrapper,   ion-item:has(ion-select.select-disabled) .native-input,   ion-item:has(ion-select.select-disabled) .select-text,   ion-item:has(ion-select.select-disabled) .select-icon,   ion-item:has(ion-toggle.toggle-disabled) ion-label,   ion-item:has(ion-toggle.toggle-disabled) .label-text,   ion-item:has(ion-toggle.toggle-disabled) .label-text-wrapper,   ion-item:has(ion-toggle.toggle-disabled) .native-input,   ion-item:has(ion-toggle.toggle-disabled) .select-text,   ion-item:has(ion-toggle.toggle-disabled) .select-icon,   ion-item:has(ion-checkbox.checkbox-disabled) ion-label,   ion-item:has(ion-checkbox.checkbox-disabled) .label-text,   ion-item:has(ion-checkbox.checkbox-disabled) .label-text-wrapper,   ion-item:has(ion-checkbox.checkbox-disabled) .native-input,   ion-item:has(ion-checkbox.checkbox-disabled) .select-text,   ion-item:has(ion-checkbox.checkbox-disabled) .select-icon,   ion-item:has(ion-input.input-disabled) ion-label,   ion-item:has(ion-input.input-disabled) .label-text,   ion-item:has(ion-input.input-disabled) .label-text-wrapper,   ion-item:has(ion-input.input-disabled) .native-input,   ion-item:has(ion-input.input-disabled) .select-text,   ion-item:has(ion-input.input-disabled) .select-icon{opacity:1!important;color:#000!important;--color: #000 !important}  ion-label[position=stacked],   ion-label.label-stacked{opacity:1!important;color:#000!important;--color: #000 !important}  ion-select.select-disabled,   ion-select[disabled]{opacity:1!important;--opacity: 1 !important;color:#000!important;--color: #000 !important;--placeholder-color: #000 !important;--placeholder-opacity: 1 !important}  ion-select.select-disabled .select-text,   ion-select.select-disabled .select-icon,   ion-select.select-disabled .select-placeholder,   ion-select.select-disabled .select-icon-inner,   ion-select[disabled] .select-text,   ion-select[disabled] .select-icon,   ion-select[disabled] .select-placeholder,   ion-select[disabled] .select-icon-inner{opacity:1!important;color:#000!important}  ion-select.select-disabled::part(text),   ion-select.select-disabled::part(icon),   ion-select.select-disabled::part(placeholder),   ion-select[disabled]::part(text),   ion-select[disabled]::part(icon),   ion-select[disabled]::part(placeholder){opacity:1!important;color:#000!important}  ion-toggle.toggle-disabled,   ion-toggle[disabled]{opacity:1!important;--opacity: 1 !important}  ion-checkbox.checkbox-disabled,   ion-checkbox[disabled]{opacity:1!important;--opacity: 1 !important}  ion-input.input-disabled,   ion-input[disabled],   ion-textarea.textarea-disabled,   ion-textarea[disabled]{opacity:1!important;--opacity: 1 !important}  ion-input.input-disabled .native-input,   ion-input.input-disabled .native-textarea,   ion-input.input-disabled input,   ion-input.input-disabled textarea,   ion-input[disabled] .native-input,   ion-input[disabled] .native-textarea,   ion-input[disabled] input,   ion-input[disabled] textarea,   ion-textarea.textarea-disabled .native-input,   ion-textarea.textarea-disabled .native-textarea,   ion-textarea.textarea-disabled input,   ion-textarea.textarea-disabled textarea,   ion-textarea[disabled] .native-input,   ion-textarea[disabled] .native-textarea,   ion-textarea[disabled] input,   ion-textarea[disabled] textarea{opacity:1!important;color:#000!important;-webkit-text-fill-color:#000!important}  ion-input.input-disabled::part(native),   ion-input[disabled]::part(native),   ion-textarea.textarea-disabled::part(native),   ion-textarea[disabled]::part(native){opacity:1!important;color:#000!important;-webkit-text-fill-color:#000!important}  ion-content.view-mode ion-checkbox{pointer-events:none!important;cursor:default!important}@media (max-width: 768px){.photo-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.photo-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:200px}ion-card[_ngcontent-%COMP%]{margin:12px}}  .fullscreen-photo-modal{--width: 100%;--height: 100%;--border-radius: 0}  .fullscreen-photo-modal .modal-wrapper{position:absolute;top:0;left:0;width:100%;height:100%}"]}))}return i(),s})(),Ze=(()=>{var i;class s{constructor(t){this.modalController=t}dismiss(){this.modalController.dismiss()}static#e=i=()=>(this.\u0275fac=function(o){return new(o||s)(e.rXU(h.W3))},this.\u0275cmp=e.VBU({type:s,selectors:[["app-health-fullscreen-photo"]],decls:4,vars:2,consts:[[1,"fullscreen-container",3,"click"],["fill","clear",1,"close-button",3,"click"],["name","close","slot","icon-only"],[3,"src","alt"]],template:function(o,n){1&o&&(e.j41(0,"div",0),e.bIt("click",function(){return n.dismiss()}),e.j41(1,"ion-button",1),e.bIt("click",function(){return n.dismiss()}),e.nrm(2,"ion-icon",2),e.k0s(),e.nrm(3,"img",3),e.k0s()),2&o&&(e.R7$(3),e.Y8G("src",n.photoUrl,e.B4B)("alt",n.photoType+" photo"))},dependencies:[h.bv,h.Jm,h.iq,C.MD],styles:[".fullscreen-container[_ngcontent-%COMP%]{width:100vw;height:100vh;background:#000000f2;display:flex;align-items:center;justify-content:center;position:relative}.close-button[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;z-index:1000;--color: white;--background: rgba(0, 0, 0, .5);--border-radius: 50%;width:44px;height:44px;font-size:28px}img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain;touch-action:none;-webkit-user-select:none;user-select:none}"]}))}return i(),s})();const Je=[{path:"",component:Ke}];let et=(()=>{var i;class s{static#e=i=()=>(this.\u0275fac=function(o){return new(o||s)},this.\u0275mod=e.$C({type:s}),this.\u0275inj=p.G2t({imports:[I.iI.forChild(Je),I.iI]}))}return i(),s})(),tt=(()=>{var i;class s{static#e=i=()=>(this.\u0275fac=function(o){return new(o||s)},this.\u0275mod=e.$C({type:s}),this.\u0275inj=p.G2t({imports:[C.MD,y.YN,y.X1,h.bv,et]}))}return i(),s})()},9187(J,H,b){b.d(H,{C:()=>e});var C=b(467),y=b(2084),h=b(2615),I=b(5029),_=b(918),D=b(8863);let e=(()=>{var p;class x{constructor(l,m,d){this.supabase=l,this.sharedDataService=m,this.monitoringLog=d}deleteEntry(l){var m=this;return(0,C.A)(function*(){console.log("[EntryDeletionService] Starting deletion process for:",l);try{const d=yield m.fetchOriginalEntry(l.tableName,l.reportId);if(!d)throw new Error(`Entry not found in table ${l.tableName} with reportId ${l.reportId}`);console.log("[EntryDeletionService] Original entry fetched:",d);const u=yield m.backupToDeletedFiles(l,d);console.log("[EntryDeletionService] Backup completed:",u),yield m.recordDeletionMetadata(l,u,d),console.log("[EntryDeletionService] Deletion metadata recorded"),yield m.deleteImagesFromBucket(d,l.formType,l.reportId),console.log("[EntryDeletionService] Images deleted from bucket"),yield m.deleteJsonFromStorage(l.formType,l.reportId),console.log("[EntryDeletionService] JSON file deleted from storage"),yield m.deleteFromTable(l.tableName,l.reportId),console.log("[EntryDeletionService] Entry deleted from table"),yield m.deleteLocalFile(l.formType,l.reportId),console.log("[EntryDeletionService] Local file deleted");const v=m.getEntrySummary(d,l.formType);m.monitoringLog.recordFormDeleted(l.deletedBy,l.formType,l.reportId,v),console.log("[EntryDeletionService] \u2705 Deletion process completed successfully")}catch(d){throw console.error("[EntryDeletionService] \u274c Deletion process failed:",d),d}})()}getEntrySummary(l,m){const d=[];return l?.location&&d.push(l.location),l?.zone_number&&d.push(`Z${l.zone_number}`),l?.quad_number&&d.push(`Q${l.quad_number}`),l?.observation_date&&d.push(l.observation_date),d.join(", ")||m}fetchOriginalEntry(l,m){var d=this;return(0,C.A)(function*(){const{data:u,error:v}=yield d.supabase.getClient().from(l).select("*").eq("report_id",m).single();if(v)throw console.error("[EntryDeletionService] Error fetching original entry:",v),v;return u})()}backupToDeletedFiles(l,m){var d=this;return(0,C.A)(function*(){const u=`${l.formType}/${l.reportId}`,v=`${u}/${l.reportId}.json`,M=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),{error:S}=yield d.supabase.getClient().storage.from("deleted_files").upload(v,M);if(S)throw console.error("[EntryDeletionService] Error backing up JSON:",S),S;const w=[],Q=d.getImageBucketName(l.formType),W=d.extractImagePathsFromEntry(m,l.formType,l.reportId);for(const R of W)if(R)try{const{data:G,error:B}=yield d.supabase.getClient().storage.from(Q).download(R);if(B){console.warn("[EntryDeletionService] Could not download image:",R,B);continue}const z=`${u}/${R.split("/").pop()}`,{error:Y}=yield d.supabase.getClient().storage.from("deleted_files").upload(z,G);Y?console.warn("[EntryDeletionService] Could not backup image:",z,Y):w.push(z)}catch(G){console.warn("[EntryDeletionService] Error processing image:",G)}return{backupFolderPath:u,jsonBackupPath:v,imageBackupPaths:w}})()}recordDeletionMetadata(l,m,d){var u=this;return(0,C.A)(function*(){const v={original_entry:d,backup_paths:{json:m.jsonBackupPath,images:m.imageBackupPaths},deletion_timestamp:(0,y.E)()},{error:M}=yield u.supabase.getClient().from("deleted_metadata_files").insert({original_report_id:l.reportId,form_type:l.formType,deleted_by:l.deletedBy,deleted_by_email:l.deletedByEmail,original_submitted_by:l.originalSubmittedBy||d.submittedBy,original_submitted_at:l.originalSubmittedAt||d.createdAt,backup_folder_path:m.backupFolderPath,original_table_name:l.tableName,original_storage_path:u.getStoragePath(l.tableName,l.reportId),metadata:v});if(M)throw console.error("[EntryDeletionService] Error recording deletion metadata:",M),M})()}deleteImagesFromBucket(l,m,d){var u=this;return(0,C.A)(function*(){const v=u.getImageBucketName(m),M=u.extractImagePathsFromEntry(l,m,d);for(const S of M)if(S)try{const{error:w}=yield u.supabase.getClient().storage.from(v).remove([S]);w&&console.warn("[EntryDeletionService] Could not delete image:",S,w)}catch(w){console.warn("[EntryDeletionService] Error deleting image:",w)}})()}deleteJsonFromStorage(l,m){var d=this;return(0,C.A)(function*(){const u=d.getReportsBucketName(l),v=`${m}.json`,{error:M}=yield d.supabase.getClient().storage.from(u).remove([v]);M&&console.warn("[EntryDeletionService] Could not delete JSON from storage:",v,M)})()}deleteFromTable(l,m){var d=this;return(0,C.A)(function*(){const{error:u}=yield d.supabase.getClient().from(l).delete().eq("report_id",m);if(u)throw console.error("[EntryDeletionService] Error deleting from table:",u),u})()}deleteLocalFile(l,m){var d=this;return(0,C.A)(function*(){try{const u=d.getLocalFileName(l,m);yield d.sharedDataService.deleteJsonFile(u)}catch(u){console.warn("[EntryDeletionService] Could not delete local file:",u)}})()}getReportsBucketName(l){return l}getImageBucketName(l){return{"flora-fauna":"flora-fauna-images",biomass:"biomass-images",health:"health-images",outplanting:"outplanting-images",restoration:"restoration-images",cleanup:"cleanup-images",pollution:"pollution-images",disturbances:"disturbances-images"}[l]||`${l}-images`}extractImagePathsFromEntry(l,m,d){const u=[];if("health"===m)return u.push(`${d}/soil.jpg`),u.push(`${d}/predation.jpg`),u.push(`${d}/pollution.jpg`),u;if("pollution"===m){u.push(`${d}/greyWater.jpg`),u.push(`${d}/trash.jpg`),u.push(`${d}/sewage.jpg`);for(let v=1;v<=10;v++)u.push(`${d}/photo_${v}.jpg`);return u}if("disturbances"===m)return u.push(`${d}/harvest.jpg`),u.push(`${d}/clearing.jpg`),u.push(`${d}/construction.jpg`),u.push(`${d}/fallenTree.jpg`),u.push(`${d}/erosion.jpg`),u.push(`${d}/accretion.jpg`),u.push(`${d}/diseases.jpg`),u;for(let v=1;v<=20;v++)u.push(`${d}/photo_${v}.jpg`);return u}getStoragePath(l,m){return`${l}/${m}.json`}getLocalFileName(l,m){return`${m}.json`}static#e=p=()=>(this.\u0275fac=function(m){return new(m||x)(h.KVO(I.L),h.KVO(_.H),h.KVO(D.u))},this.\u0275prov=h.jDH({token:x,factory:x.\u0275fac,providedIn:"root"}))}return p(),x})()}}]);