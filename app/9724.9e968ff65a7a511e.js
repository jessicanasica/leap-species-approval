"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9724],{152(A,C,f){f.d(C,{B:()=>x});var P=f(8839),M=f(9974),p=f(4360);function x(b,O=P.E){return(0,M.N)((e,m)=>{let E=null,w=null,s=null;const g=()=>{if(E){E.unsubscribe(),E=null;const u=w;w=null,m.next(u)}};function d(){const u=s+b,v=O.now();if(v<u)return E=this.schedule(void 0,u-v),void m.add(E);g()}e.subscribe((0,p._)(m,u=>{w=u,s=O.now(),E||(E=O.schedule(d,b),m.add(E))},()=>{g(),m.complete()},void 0,()=>{w=E=null}))})}},4670(A,C,f){f.d(C,{k:()=>p});var P=f(2615),M=f(3664);let p=(()=>{var x;class b{static#e=x=()=>(this.\u0275fac=function(m){return new(m||b)},this.\u0275mod=M.$C({type:b}),this.\u0275inj=P.G2t({}))}return x(),b})()},7314(A,C,f){f.d(C,{D:()=>p});var P=f(3664),M=f(6845);let p=(()=>{var x;class b{constructor(e){this.translationService=e}transform(e){return this.translationService.t(e)}static#e=x=()=>(this.\u0275fac=function(m){return new(m||b)(P.rXU(M.L,16))},this.\u0275pipe=P.EJ8({name:"t",type:b,pure:!1}))}return x(),b})()},9187(A,C,f){f.d(C,{C:()=>e});var P=f(467),M=f(2084),p=f(2615),x=f(5029),b=f(918),O=f(8863);let e=(()=>{var m;class E{constructor(s,g,d){this.supabase=s,this.sharedDataService=g,this.monitoringLog=d}deleteEntry(s){var g=this;return(0,P.A)(function*(){console.log("[EntryDeletionService] Starting deletion process for:",s);try{const d=yield g.fetchOriginalEntry(s.tableName,s.reportId);if(!d)throw new Error(`Entry not found in table ${s.tableName} with reportId ${s.reportId}`);console.log("[EntryDeletionService] Original entry fetched:",d);const u=yield g.backupToDeletedFiles(s,d);console.log("[EntryDeletionService] Backup completed:",u),yield g.recordDeletionMetadata(s,u,d),console.log("[EntryDeletionService] Deletion metadata recorded"),yield g.deleteImagesFromBucket(d,s.formType,s.reportId),console.log("[EntryDeletionService] Images deleted from bucket"),yield g.deleteJsonFromStorage(s.formType,s.reportId),console.log("[EntryDeletionService] JSON file deleted from storage"),yield g.deleteFromTable(s.tableName,s.reportId),console.log("[EntryDeletionService] Entry deleted from table"),yield g.deleteLocalFile(s.formType,s.reportId),console.log("[EntryDeletionService] Local file deleted");const v=g.getEntrySummary(d,s.formType);g.monitoringLog.recordFormDeleted(s.deletedBy,s.formType,s.reportId,v),console.log("[EntryDeletionService] \u2705 Deletion process completed successfully")}catch(d){throw console.error("[EntryDeletionService] \u274c Deletion process failed:",d),d}})()}getEntrySummary(s,g){const d=[];return s?.location&&d.push(s.location),s?.zone_number&&d.push(`Z${s.zone_number}`),s?.quad_number&&d.push(`Q${s.quad_number}`),s?.observation_date&&d.push(s.observation_date),d.join(", ")||g}fetchOriginalEntry(s,g){var d=this;return(0,P.A)(function*(){const{data:u,error:v}=yield d.supabase.getClient().from(s).select("*").eq("report_id",g).single();if(v)throw console.error("[EntryDeletionService] Error fetching original entry:",v),v;return u})()}backupToDeletedFiles(s,g){var d=this;return(0,P.A)(function*(){const u=`${s.formType}/${s.reportId}`,v=`${u}/${s.reportId}.json`,I=new Blob([JSON.stringify(g,null,2)],{type:"application/json"}),{error:S}=yield d.supabase.getClient().storage.from("deleted_files").upload(v,I);if(S)throw console.error("[EntryDeletionService] Error backing up JSON:",S),S;const $=[],X=d.getImageBucketName(s.formType),Q=d.extractImagePathsFromEntry(g,s.formType,s.reportId);for(const j of Q)if(j)try{const{data:z,error:Y}=yield d.supabase.getClient().storage.from(X).download(j);if(Y){console.warn("[EntryDeletionService] Could not download image:",j,Y);continue}const G=`${u}/${j.split("/").pop()}`,{error:U}=yield d.supabase.getClient().storage.from("deleted_files").upload(G,z);U?console.warn("[EntryDeletionService] Could not backup image:",G,U):$.push(G)}catch(z){console.warn("[EntryDeletionService] Error processing image:",z)}return{backupFolderPath:u,jsonBackupPath:v,imageBackupPaths:$}})()}recordDeletionMetadata(s,g,d){var u=this;return(0,P.A)(function*(){const v={original_entry:d,backup_paths:{json:g.jsonBackupPath,images:g.imageBackupPaths},deletion_timestamp:(0,M.E)()},{error:I}=yield u.supabase.getClient().from("deleted_metadata_files").insert({original_report_id:s.reportId,form_type:s.formType,deleted_by:s.deletedBy,deleted_by_email:s.deletedByEmail,original_submitted_by:s.originalSubmittedBy||d.submittedBy,original_submitted_at:s.originalSubmittedAt||d.createdAt,backup_folder_path:g.backupFolderPath,original_table_name:s.tableName,original_storage_path:u.getStoragePath(s.tableName,s.reportId),metadata:v});if(I)throw console.error("[EntryDeletionService] Error recording deletion metadata:",I),I})()}deleteImagesFromBucket(s,g,d){var u=this;return(0,P.A)(function*(){const v=u.getImageBucketName(g),I=u.extractImagePathsFromEntry(s,g,d);for(const S of I)if(S)try{const{error:$}=yield u.supabase.getClient().storage.from(v).remove([S]);$&&console.warn("[EntryDeletionService] Could not delete image:",S,$)}catch($){console.warn("[EntryDeletionService] Error deleting image:",$)}})()}deleteJsonFromStorage(s,g){var d=this;return(0,P.A)(function*(){const u=d.getReportsBucketName(s),v=`${g}.json`,{error:I}=yield d.supabase.getClient().storage.from(u).remove([v]);I&&console.warn("[EntryDeletionService] Could not delete JSON from storage:",v,I)})()}deleteFromTable(s,g){var d=this;return(0,P.A)(function*(){const{error:u}=yield d.supabase.getClient().from(s).delete().eq("report_id",g);if(u)throw console.error("[EntryDeletionService] Error deleting from table:",u),u})()}deleteLocalFile(s,g){var d=this;return(0,P.A)(function*(){try{const u=d.getLocalFileName(s,g);yield d.sharedDataService.deleteJsonFile(u)}catch(u){console.warn("[EntryDeletionService] Could not delete local file:",u)}})()}getReportsBucketName(s){return s}getImageBucketName(s){return{"flora-fauna":"flora-fauna-images",biomass:"biomass-images",health:"health-images",outplanting:"outplanting-images",restoration:"restoration-images",cleanup:"cleanup-images",pollution:"pollution-images",disturbances:"disturbances-images"}[s]||`${s}-images`}extractImagePathsFromEntry(s,g,d){const u=[];if("health"===g)return u.push(`${d}/soil.jpg`),u.push(`${d}/predation.jpg`),u.push(`${d}/pollution.jpg`),u;if("pollution"===g){u.push(`${d}/greyWater.jpg`),u.push(`${d}/trash.jpg`),u.push(`${d}/sewage.jpg`);for(let v=1;v<=10;v++)u.push(`${d}/photo_${v}.jpg`);return u}if("disturbances"===g)return u.push(`${d}/harvest.jpg`),u.push(`${d}/clearing.jpg`),u.push(`${d}/construction.jpg`),u.push(`${d}/fallenTree.jpg`),u.push(`${d}/erosion.jpg`),u.push(`${d}/accretion.jpg`),u.push(`${d}/diseases.jpg`),u;for(let v=1;v<=20;v++)u.push(`${d}/photo_${v}.jpg`);return u}getStoragePath(s,g){return`${s}/${g}.json`}getLocalFileName(s,g){return`${g}.json`}static#e=m=()=>(this.\u0275fac=function(g){return new(g||E)(p.KVO(x.L),p.KVO(b.H),p.KVO(O.u))},this.\u0275prov=p.jDH({token:E,factory:E.\u0275fac,providedIn:"root"}))}return m(),E})()},9724(A,C,f){f.d(C,{BiomassPageModule:()=>He});var P=f(2200),M=f(4341),p=f(7343),x=f(8132),b=f(467),O=f(152),e=f(3664),m=f(2615),E=f(5921),w=f(752),s=f(5858),g=f(5342),d=f(3205),u=f(918),v=f(9187),I=f(7643),S=f(6845),$=f(7314);function X(i,c){if(1&i){const r=e.RV6();e.j41(0,"span",51),e.bIt("click",function(){m.eBV(r),e.XpG();const n=e.sdS(15);return m.Njj(n.showPicker())}),e.EFF(1),e.k0s()}if(2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentDateDisplay)}}function Q(i,c){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentDateDisplay)}}function j(i,c){if(1&i){const r=e.RV6();e.j41(0,"span",51),e.bIt("click",function(){m.eBV(r),e.XpG();const n=e.sdS(17);return m.Njj(n.showPicker())}),e.EFF(1),e.k0s()}if(2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentTimeDisplay)}}function z(i,c){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentTimeDisplay)}}function Y(i,c){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.SpI(" (edited: ",r.getEditedDateTime(),")")}}function G(i,c){1&i&&e.nrm(0,"ion-icon",52)}function U(i,c){if(1&i){const r=e.RV6();e.j41(0,"span",53),e.bIt("click",function(){m.eBV(r);const n=e.XpG();return m.Njj(n.editLocationAdmin())}),e.EFF(1),e.nI1(2,"t"),e.k0s()}2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Edit location")," "))}function ae(i,c){if(1&i){const r=e.RV6();e.j41(0,"div",13),e.bIt("click",function(){m.eBV(r);const n=e.XpG();return m.Njj(!n.viewMode&&n.editZone())}),e.nrm(1,"ion-icon",54),e.j41(2,"span",15),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.JRh(t.getZoneName(null==(r=t.biomassForm.get("zoneNumber"))?null:r.value))}}function se(i,c){if(1&i){const r=e.RV6();e.j41(0,"div",13),e.bIt("click",function(){m.eBV(r);const n=e.XpG();return m.Njj(!n.viewMode&&n.editQuad())}),e.nrm(1,"ion-icon",55),e.j41(2,"span",15),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.SpI("Quad ",t.getQuadDisplay(null==(r=t.biomassForm.get("quadNumber"))?null:r.value))}}function le(i,c){1&i&&(e.j41(0,"ion-error",56),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Location is required")," "))}function ce(i,c){if(1&i){const r=e.RV6();e.j41(0,"div",57)(1,"ion-button",58),e.bIt("click",function(){m.eBV(r);const n=e.XpG();return m.Njj(n.enableEditMode())}),e.nrm(2,"ion-icon",59),e.EFF(3),e.nI1(4,"t"),e.k0s()()}2&i&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"Edit This Entry")," "))}function de(i,c){1&i&&(e.j41(0,"div",60),e.nrm(1,"ion-icon",61),e.j41(2,"span"),e.EFF(3),e.nI1(4,"t"),e.k0s()()),2&i&&(e.R7$(3),e.JRh(e.bMT(4,1,"Editing Entry - Changes will replace the original submission")))}function ue(i,c){1&i&&e.nrm(0,"ion-icon",62)}function me(i,c){1&i&&e.nrm(0,"ion-icon",63)}function ge(i,c){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Observer name is required")," "))}function pe(i,c){1&i&&e.nrm(0,"ion-icon",62)}function fe(i,c){1&i&&e.nrm(0,"ion-icon",63)}function he(i,c){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Weather selection is required")," "))}function _e(i,c){1&i&&e.nrm(0,"ion-icon",62)}function be(i,c){1&i&&e.nrm(0,"ion-icon",63)}function ve(i,c){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Tide selection is required")," "))}function ye(i,c){1&i&&e.nrm(0,"ion-icon",62)}function Me(i,c){1&i&&e.nrm(0,"ion-icon",63)}function Fe(i,c){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Plot size is required")," "))}function Te(i,c){1&i&&e.nrm(0,"ion-icon",62)}function Pe(i,c){1&i&&e.nrm(0,"ion-icon",63)}function Ee(i,c){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Vegetation type is required")," "))}function xe(i,c){1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"and tree height in meters")))}function Ie(i,c){1&i&&e.nrm(0,"ion-icon",62)}function ke(i,c){1&i&&e.nrm(0,"ion-icon",63)}function Re(i,c){1&i&&e.nrm(0,"ion-icon",62)}function De(i,c){1&i&&e.nrm(0,"ion-icon",63)}function Ce(i,c){1&i&&e.nrm(0,"ion-icon",62)}function Se(i,c){1&i&&e.nrm(0,"ion-icon",63)}function $e(i,c){if(1&i){const r=e.RV6();e.j41(0,"ion-col",77)(1,"ion-item",25)(2,"ion-label",26),e.EFF(3),e.nI1(4,"t"),e.k0s(),e.j41(5,"ion-input",85),e.bIt("ionInput",function(n){m.eBV(r);const o=e.XpG(2);return m.Njj(o.newTree.height=+n.detail.value)}),e.k0s(),e.DNE(6,Ce,1,0,"ion-icon",28)(7,Se,1,0,"ion-icon",29),e.k0s()()}if(2&i){const r=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,4,"Height (m)")),e.R7$(2),e.Y8G("value",r.newTree.height),e.R7$(),e.Y8G("ngIf",!r.newTree.height||r.newTree.height<=0),e.R7$(),e.Y8G("ngIf",r.newTree.height>0)}}function Be(i,c){if(1&i&&(e.j41(0,"div",86)(1,"strong",87),e.EFF(2),e.nI1(3,"t"),e.k0s(),e.nrm(4,"br"),e.j41(5,"span",88),e.EFF(6),e.j41(7,"strong"),e.EFF(8),e.k0s()()()),2&i){const r=e.XpG(2);e.R7$(2),e.JRh(e.bMT(3,4,"Estimated Biomass Preview:")),e.R7$(4),e.Lme(" AGB: ",r.calculateTreeBiomass(r.newTree).agb.toFixed(2)," kg | BGB: ",r.calculateTreeBiomass(r.newTree).bgb.toFixed(2)," kg | "),e.R7$(2),e.SpI("Total: ",r.calculateTreeBiomass(r.newTree).total.toFixed(2)," kg")}}function Oe(i,c){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG().$implicit;e.R7$(),e.SpI(" , H: ",r.height," m ")}}function we(i,c){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG().$implicit,t=e.XpG(3);e.R7$(),e.SpI(" / BGB: ",t.calculateTreeBiomass(r).bgb.toFixed(1)," kg ")}}function je(i,c){if(1&i){const r=e.RV6();e.j41(0,"ion-item")(1,"div",3)(2,"div",98)(3,"strong"),e.EFF(4),e.k0s(),e.nrm(5,"br"),e.j41(6,"span",99),e.EFF(7),e.DNE(8,Oe,2,1,"span",8),e.k0s()()(),e.j41(9,"div",100)(10,"div",101)(11,"strong"),e.EFF(12),e.k0s(),e.nrm(13,"br"),e.j41(14,"span",102),e.EFF(15," AGB "),e.DNE(16,we,2,1,"span",8),e.k0s()(),e.j41(17,"ion-button",103),e.bIt("click",function(){const n=m.eBV(r).index,o=e.XpG(3);return m.Njj(o.removeTree(n))}),e.nrm(18,"ion-icon",104),e.k0s()()()}if(2&i){const r=c.$implicit,t=e.XpG(3);e.R7$(4),e.JRh(t.getSpeciesDisplayName(r.species)),e.R7$(3),e.SpI(" DBH: ",r.dbh," cm "),e.R7$(),e.Y8G("ngIf",t.currentUser&&t.currentUser.level>=3&&r.height),e.R7$(4),e.SpI("",t.calculateTreeBiomass(r).agb.toFixed(1)," kg"),e.R7$(4),e.Y8G("ngIf",t.calculateTreeBiomass(r).bgb>0)}}function Ne(i,c){if(1&i&&(e.j41(0,"div",89)(1,"ion-label")(2,"strong"),e.EFF(3),e.nI1(4,"t"),e.k0s()(),e.j41(5,"ion-list"),e.DNE(6,je,19,5,"ion-item",90),e.k0s(),e.j41(7,"div",91)(8,"ion-grid")(9,"ion-row")(10,"ion-col",92)(11,"div",93)(12,"div",94),e.EFF(13),e.nI1(14,"t"),e.k0s(),e.j41(15,"div",95),e.EFF(16),e.k0s()()(),e.j41(17,"ion-col",92)(18,"div",93)(19,"div",94),e.EFF(20),e.nI1(21,"t"),e.k0s(),e.j41(22,"div",95),e.EFF(23),e.k0s()()()(),e.j41(24,"ion-row")(25,"ion-col",66)(26,"div",96)(27,"div",94),e.EFF(28),e.nI1(29,"t"),e.k0s(),e.j41(30,"div",97),e.EFF(31),e.k0s(),e.j41(32,"div",94),e.EFF(33),e.k0s()()()()()()()),2&i){let r;const t=e.XpG(2);e.R7$(3),e.Lme("",e.bMT(4,11,"Measured Trees")," (",t.treeMeasurements.length,")"),e.R7$(3),e.Y8G("ngForOf",t.treeMeasurements),e.R7$(7),e.JRh(e.bMT(14,13,"Total Aboveground")),e.R7$(3),e.SpI("",t.getTotalBiomass().agb.toFixed(1)," kg "),e.R7$(4),e.JRh(e.bMT(21,15,"Total Belowground")),e.R7$(3),e.SpI("",t.getTotalBiomass().bgb.toFixed(1)," kg "),e.R7$(5),e.JRh(e.bMT(29,17,"Total Biomass")),e.R7$(3),e.SpI(" ",t.getTotalBiomass().total.toFixed(1)," kg "),e.R7$(2),e.Lme(" ",t.getBiomassPerArea().toFixed(1)," kg/m\xb2 (",(null==(r=t.biomassForm.get("plotSize"))?null:r.value)||0," m\xb2 plot) ")}}function ze(i,c){1&i&&(e.j41(0,"div",105),e.nrm(1,"ion-icon",106),e.j41(2,"p"),e.EFF(3),e.nI1(4,"t"),e.k0s()()),2&i&&(e.R7$(3),e.JRh(e.bMT(4,1,"No trees measured yet. Add tree measurements above to calculate biomass.")))}function Ge(i,c){if(1&i){const r=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header",2)(2,"ion-card-title"),e.EFF(3),e.nI1(4,"t"),e.k0s(),e.j41(5,"ion-card-subtitle"),e.EFF(6),e.nI1(7,"t"),e.j41(8,"ion-icon",64),e.bIt("click",function(){m.eBV(r);const n=e.XpG();return m.Njj(n.showEquationInfo())}),e.k0s()()(),e.j41(9,"ion-card-content")(10,"div",65)(11,"ion-grid")(12,"ion-row")(13,"ion-col",66)(14,"ion-label",26)(15,"strong"),e.EFF(16),e.nI1(17,"t"),e.k0s(),e.j41(18,"p",67),e.EFF(19),e.nI1(20,"t"),e.DNE(21,xe,3,3,"span",8),e.k0s()()()(),e.j41(22,"ion-row")(23,"ion-col",68)(24,"ion-item",25)(25,"ion-label",26),e.EFF(26),e.nI1(27,"t"),e.k0s(),e.j41(28,"ion-select",69),e.nI1(29,"t"),e.bIt("ionChange",function(n){m.eBV(r);const o=e.XpG();return m.Njj(o.newTree.species=n.detail.value)}),e.j41(30,"ion-select-option",70),e.EFF(31,"Red Mangrove"),e.k0s(),e.j41(32,"ion-select-option",71),e.EFF(33,"White Mangrove"),e.k0s(),e.j41(34,"ion-select-option",72),e.EFF(35,"Yellow Mangrove"),e.k0s(),e.j41(36,"ion-select-option",73),e.EFF(37,"Oriental Mangrove"),e.k0s(),e.j41(38,"ion-select-option",74),e.EFF(39,"Apple Mangrove"),e.k0s(),e.j41(40,"ion-select-option",75),e.EFF(41,"Puzzlenut Mangrove"),e.k0s(),e.j41(42,"ion-select-option",76),e.EFF(43,"Black Mangrove"),e.k0s()(),e.DNE(44,Ie,1,0,"ion-icon",28)(45,ke,1,0,"ion-icon",29),e.k0s()(),e.j41(46,"ion-col",77)(47,"ion-item",25)(48,"ion-label",26),e.EFF(49),e.nI1(50,"t"),e.k0s(),e.j41(51,"ion-input",78),e.nI1(52,"t"),e.bIt("ionInput",function(n){m.eBV(r);const o=e.XpG();return m.Njj(o.newTree.dbh=+n.detail.value)}),e.k0s(),e.DNE(53,Re,1,0,"ion-icon",28)(54,De,1,0,"ion-icon",29),e.k0s()(),e.DNE(55,$e,8,6,"ion-col",79),e.k0s(),e.j41(56,"ion-row")(57,"ion-col",66)(58,"ion-button",80),e.bIt("click",function(){m.eBV(r);const n=e.XpG();return m.Njj(n.addTree())}),e.nrm(59,"ion-icon",81),e.EFF(60),e.nI1(61,"t"),e.k0s()()()()(),e.DNE(62,Be,9,6,"div",82)(63,Ne,34,19,"div",83)(64,ze,5,3,"div",84),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(3),e.JRh(e.bMT(4,21,"Mangrove Tree Measurements")),e.R7$(3),e.SpI(" ",e.bMT(7,23,"Measure trees for biomass calculations")," "),e.R7$(10),e.JRh(e.bMT(17,25,"Add Tree Measurement")),e.R7$(3),e.SpI(" ",e.bMT(20,27,"Measure diameter at breast height (1.3m above ground) in centimeters")," "),e.R7$(2),e.Y8G("ngIf",r.currentUser&&r.currentUser.level>=3),e.R7$(5),e.JRh(e.bMT(27,29,"Species")),e.R7$(2),e.Y8G("value",r.newTree.species)("placeholder",e.bMT(29,31,"Select species")),e.R7$(16),e.Y8G("ngIf",!r.newTree.species),e.R7$(),e.Y8G("ngIf",r.newTree.species),e.R7$(4),e.JRh(e.bMT(50,33,"DBH (cm)")),e.R7$(2),e.Y8G("value",r.newTree.dbh)("placeholder",e.bMT(52,35,"Diameter in cm")),e.R7$(2),e.Y8G("ngIf",!r.newTree.dbh||r.newTree.dbh<=0),e.R7$(),e.Y8G("ngIf",r.newTree.dbh>0),e.R7$(),e.Y8G("ngIf",r.currentUser&&r.currentUser.level>=3),e.R7$(3),e.Y8G("disabled",!r.newTree.species||!r.newTree.dbh||r.newTree.dbh<=0||r.currentUser&&r.currentUser.level>=3&&!r.newTree.height),e.R7$(2),e.SpI(" ",e.bMT(61,37,"Add Tree")," "),e.R7$(2),e.Y8G("ngIf",r.newTree.species&&r.newTree.dbh>0),e.R7$(),e.Y8G("ngIf",r.treeMeasurements.length>0),e.R7$(),e.Y8G("ngIf",0===r.treeMeasurements.length)}}function Ae(i,c){1&i&&e.nrm(0,"ion-icon",62)}function Ye(i,c){1&i&&e.nrm(0,"ion-icon",63)}function Ue(i,c){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Biomass estimate is required")," "))}function Le(i,c){if(1&i&&(e.j41(0,"ion-card")(1,"ion-card-header",2)(2,"ion-card-title"),e.EFF(3),e.nI1(4,"t"),e.k0s()(),e.j41(5,"ion-card-content")(6,"ion-item",25)(7,"ion-label",26),e.EFF(8),e.nI1(9,"t"),e.k0s(),e.nrm(10,"ion-input",107),e.DNE(11,Ae,1,0,"ion-icon",28)(12,Ye,1,0,"ion-icon",29)(13,Ue,3,3,"ion-error",8),e.k0s()()()),2&i){let r,t,n;const o=e.XpG();e.R7$(3),e.JRh(e.bMT(4,5,"Biomass Estimate")),e.R7$(5),e.JRh(e.bMT(9,7,"Biomass Estimate (kg/m\xb2)")),e.R7$(3),e.Y8G("ngIf",!(null!=(r=o.biomassForm.get("biomassEstimate"))&&r.value)),e.R7$(),e.Y8G("ngIf",null==(t=o.biomassForm.get("biomassEstimate"))?null:t.value),e.R7$(),e.Y8G("ngIf",(null==(n=o.biomassForm.get("biomassEstimate"))?null:n.hasError("required"))&&(null==(n=o.biomassForm.get("biomassEstimate"))?null:n.touched))}}function Ve(i,c){if(1&i){const r=e.RV6();e.j41(0,"div",108)(1,"ion-button",109),e.nrm(2,"ion-icon",110),e.EFF(3),e.nI1(4,"t"),e.k0s(),e.j41(5,"ion-button",111),e.bIt("click",function(){m.eBV(r);const n=e.XpG();return m.Njj(n.saveDraft())}),e.nrm(6,"ion-icon",112),e.EFF(7),e.nI1(8,"t"),e.k0s(),e.j41(9,"ion-button",113),e.bIt("click",function(){m.eBV(r);const n=e.XpG();return m.Njj(n.discardForm())}),e.nrm(10,"ion-icon",114),e.EFF(11),e.nI1(12,"t"),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(),e.Y8G("disabled",!r.biomassForm.valid),e.R7$(2),e.SpI(" ",e.bMT(4,4,"Submit Biomass Assessment")," "),e.R7$(4),e.SpI(" ",e.bMT(8,6,"Save Draft")," "),e.R7$(4),e.SpI(" ",e.bMT(12,8,"Discard")," ")}}function qe(i,c){if(1&i){const r=e.RV6();e.j41(0,"div",115)(1,"ion-button",116),e.bIt("click",function(){m.eBV(r);const n=e.XpG();return m.Njj(n.deleteEntry())}),e.nrm(2,"ion-icon",114),e.EFF(3),e.nI1(4,"t"),e.k0s()()}2&i&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"Delete Entry")," "))}const Je={rhizophora_mucronata:.86,rhizophora_apiculata:.965,avicennia_marina:.76,sonneratia_alba:.58,bruguiera_cylindrica:.84,ceriops_tagal:.85,xylocarpus_granatum:.71,lumnitzera_racemosa:.82},Xe={rhizophora_mucronata:"Red Mangrove",rhizophora_apiculata:"Tall-stilt Mangrove",avicennia_marina:"White Mangrove",sonneratia_alba:"Apple Mangrove",bruguiera_cylindrica:"Oriental Mangrove",ceriops_tagal:"Yellow Mangrove",xylocarpus_granatum:"Puzzlenut Mangrove",lumnitzera_racemosa:"Black Mangrove"},Qe=[{path:"",component:(()=>{var i;class c{forceDeleteDraftFile(t){var n=this;return(0,b.A)(function*(){for(let o=0;o<3;o++)try{yield n.sharedDataService.deleteJsonFile(t),console.log(`Draft file force deleted successfully (attempt ${o+1})`);break}catch(a){if(console.error(`Error force deleting draft file (attempt ${o+1}):`,a),2===o)try{yield n.sharedDataService.writeJsonFile(t,null),console.log("Draft file cleared with null write")}catch(l){console.error("Failed to clear draft file with null write:",l)}yield new Promise(l=>setTimeout(l,100))}})()}constructor(t,n,o,a,l,h,y,_,F,T,R,k,D,N){this.formBuilder=t,this.alertController=n,this.loadingController=o,this.modalController=a,this.router=l,this.route=h,this.biomassSyncService=y,this.weatherService=_,this.tideService=F,this.auth=T,this.sharedDataService=R,this.entryDeletionService=k,this.siteSyncService=D,this.ts=N,this.viewMode=!1,this.currentUser=null,this.currentReportId="",this.loadedReport=null,this.locationData=null,this.draftId=null,this.progress=0,this.currentDateTime="",this.currentDateDisplay="",this.currentTimeDisplay="",this.autosaveSub=null,this.isDiscarded=!1,this.isSubmitted=!1,this.isSubmitting=!1,this.isEditMode=!1,this.originalSubmittedBy="",this.treeMeasurements=[],this.newTree={species:"",dbh:0,height:null},this.maheLatitude=-4.6796,this.maheLongitude=55.492,this.availableLocations=[{name:"Ramsar",hasZones:!0,hasQuads:!0,zones:["1","2","3","4","5","6"],quads:Array.from({length:30},(L,B)=>`quad${B+1}`),zoneQuadMap:{1:[1,2,3],2:[13,14,15,16,17,18,20,21,22,23,25,27,28,29],3:[19,26],4:[4,5],5:[6,7,11,12,24,30],6:[8,9,10]}},{name:"Grand Anse",hasZones:!0,hasQuads:!0,zones:["1","2","3","4"],quads:Array.from({length:22},(L,B)=>`ga${B+1}`),zoneQuadMap:{1:[1,2,3,4],2:[5,6,7,8,9,10,21,22],3:[11,12,13,14,15,16,17,18],4:[19,20]}},{name:"Caiman",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4","quad5"]},{name:"Canopy",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4"]},{name:"Petit Barbarons",hasZones:!0,hasQuads:!1,zones:["1","2","3","4"],quads:[]},{name:"Kempinski",hasZones:!1,hasQuads:!1,zones:[],quads:[]},{name:"Roche Caiman",hasZones:!1,hasQuads:!1,zones:[],quads:[]}],this.initializeForm()}initializeForm(){const t=new Date,n=t.toISOString().split("T")[0],o=`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`;this.biomassForm=this.formBuilder.group({location:["",M.k0.required],zoneNumber:[""],quadNumber:[""],observer:["",M.k0.required],observationDate:[n],observationTime:[o],weather:["",M.k0.required],tide:["",M.k0.required],plotSize:["",M.k0.required],vegetationType:["mangrove",M.k0.required],biomassEstimate:["",M.k0.required],notes:[""]})}ngOnInit(){var t=this;return(0,b.A)(function*(){if(t.currentUser=t.auth.getCurrentUser(),t.setCurrentDateTime(),t.fetchWeatherAndTide(),yield t.loadDynamicSites(),t.currentUser&&t.currentUser.level<3)return void(yield(yield t.alertController.create({header:t.ts.t("Access Denied"),message:t.ts.t("You require access level 3 to use the biomass assessment form."),buttons:[{text:"OK",handler:()=>{t.router.navigate(["/biodiversity"])}}]})).present());const n=t.route.snapshot.queryParams;if("true"===n.viewMode&&n.reportId)return void(yield t.loadReportForViewing(n.reportId));const o=t.router.getCurrentNavigation();o?.extras?.state&&(t.locationData=o.extras.state,t.biomassForm.patchValue({location:t.locationData.location,zoneNumber:t.locationData.zoneNumber||"",quadNumber:t.locationData.quadNumber||""})),yield t.loadDraft(),t.setCurrentDateTime(),t.currentReportId||(t.currentReportId=t.biomassSyncService.generateReportId()),t.route.queryParams.subscribe(a=>{a.location&&t.biomassForm.patchValue({location:a.location}),a.zone&&t.biomassForm.patchValue({zoneNumber:a.zone}),a.quad&&t.biomassForm.patchValue({quadNumber:a.quad})}),t.biomassForm.valueChanges.subscribe(()=>{t.updateProgress()}),t.setupAutoSave()})()}ngOnDestroy(){this.autosaveSub&&(this.autosaveSub.unsubscribe(),this.autosaveSub=null),!this.isSubmitted&&!this.isDiscarded&&this.saveDraftOnExit().catch(t=>console.error("BiomassPage: saveDraftOnExit failed:",t))}formatDateToYYYYMMDD(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}setCurrentDateTime(t){if(this.biomassForm){const _=this.biomassForm.get("observationDate")?.value,F=this.biomassForm.get("observationTime")?.value;if(_&&F){const[T,R,k]=_.split("-"),[D,N]=F.split(":");return this.currentDateDisplay=`${k}/${R}/${T}`,this.currentTimeDisplay=`${D}:${N}`,void(this.currentDateTime=`${this.currentDateDisplay}  \u2022  ${this.currentTimeDisplay}`)}}if(t){const _=this.extractDateTimeFromReportId(t);if(_){this.currentDateTime=_;const F=_.split("  \u2022  ");return void(2===F.length&&(this.currentDateDisplay=F[0],this.currentTimeDisplay=F[1]))}}const n=new Date,o=String(n.getDate()).padStart(2,"0"),a=String(n.getMonth()+1).padStart(2,"0"),l=n.getFullYear(),h=String(n.getHours()).padStart(2,"0"),y=String(n.getMinutes()).padStart(2,"0");this.currentDateDisplay=`${o}/${a}/${l}`,this.currentTimeDisplay=`${h}:${y}`,this.currentDateTime=`${this.currentDateDisplay}  \u2022  ${this.currentTimeDisplay}`}extractDateTimeFromReportId(t){const n=t.match(/(\d{2})(\d{2})(\d{4})_(\d{2})(\d{2})(\d{2})/);if(n){const[,o,a,l,h,y]=n;return`${o}/${a}/${l}  \u2022  ${h}:${y}`}return null}fetchWeatherAndTide(){this.weatherService.getWeatherByCoordinates(this.maheLatitude,this.maheLongitude).subscribe({next:t=>{if(t&&t.weather&&t.weather.length>0){const n=this.weatherService.mapWeatherToOption(t.weather[0].main);this.biomassForm.patchValue({weather:n}),console.log("Weather auto-populated:",n)}},error:t=>{console.error("Error fetching weather:",t)}}),this.tideService.getTides(this.maheLatitude,this.maheLongitude).subscribe({next:t=>{if(t&&t.extremes){const n=this.tideService.getCurrentTideState(t.extremes);this.biomassForm.patchValue({tide:n}),console.log("Tide auto-populated:",n)}},error:t=>{console.error("Error fetching tide:",t)}})}loadDraft(){var t=this;return(0,b.A)(function*(){try{const n=t.route.snapshot.queryParams,o={location:n.location||t.biomassForm.get("location")?.value,zoneNumber:n.zone||t.biomassForm.get("zoneNumber")?.value,quadNumber:n.quad||t.biomassForm.get("quadNumber")?.value},a=yield t.biomassSyncService.loadDraft(o);a&&(t.draftId=a.reportId,a.reportId&&(t.currentReportId=a.reportId),t.biomassForm.patchValue(a.form),a.form.treeMeasurements&&Array.isArray(a.form.treeMeasurements)&&(t.treeMeasurements=a.form.treeMeasurements),t.locationData=a.coordinates?{location:a.form.location,coordinates:a.coordinates}:null,t.updateProgress())}catch(n){console.error("Failed to load draft:",n)}})()}setupAutoSave(){this.autosaveSub&&this.autosaveSub.unsubscribe(),this.autosaveSub=this.biomassForm.valueChanges.pipe((0,O.B)(750)).subscribe(()=>{this.isSubmitted||this.isDiscarded||(this.updateProgress(),this.saveDraftOnExit().catch(t=>console.error("BiomassPage: autosave failed:",t)))})}saveDraft(){var t=this;return(0,b.A)(function*(){if(t.viewMode||t.isDiscarded||t.isSubmitted)return;const n=yield t.alertController.create({header:t.ts.t("Save Draft"),message:t.ts.t("Are you sure you want to save this form as a draft? You can return to complete it later."),buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Save Draft"),role:"confirm"}]});yield n.present();const{role:o}=yield n.onDidDismiss();if("confirm"!==o)return;const a=yield t.loadingController.create({message:t.ts.t("Saving draft...")});yield a.present();try{const l={...t.biomassForm.value,treeMeasurements:t.treeMeasurements};yield t.biomassSyncService.saveDraft({reportId:t.currentReportId,form:l,coordinates:t.locationData?.coordinates||null,photos:[]}),t.draftId="current",yield a.dismiss();const h=yield t.alertController.create({header:t.ts.t("Draft Saved"),message:t.ts.t("Your form has been saved as a draft. You can access it from the biodiversity page."),buttons:[{text:"OK",role:"confirm"}]});yield h.present(),yield h.onDidDismiss(),t.router.navigate(["/biodiversity"])}catch(l){yield a.dismiss(),console.error("Failed to save draft:",l),yield(yield t.alertController.create({header:t.ts.t("Save Failed"),message:t.ts.t("Failed to save the draft. Please try again."),buttons:["OK"]})).present()}})()}saveDraftOnExit(){var t=this;return(0,b.A)(function*(){if(!(t.viewMode||t.isDiscarded||t.isSubmitted))try{const n={...t.biomassForm.value,treeMeasurements:t.treeMeasurements};t.draftId?yield t.biomassSyncService.saveDraft({reportId:t.currentReportId,form:n,coordinates:t.locationData?.coordinates||null,photos:[]}):(yield t.biomassSyncService.saveDraft({reportId:t.currentReportId,form:n,coordinates:t.locationData?.coordinates||null,photos:[]}),t.draftId="current")}catch(n){console.error("Failed to save draft:",n)}})()}onSubmit(){var t=this;return(0,b.A)(function*(){if(t.isSubmitting)return;if(t.isSubmitting=!0,t.biomassForm.markAllAsTouched(),!t.biomassForm.valid)return t.isSubmitting=!1,void(yield(yield t.alertController.create({header:t.ts.t("Incomplete Form"),message:t.ts.t("Please fill in all required fields (Location, Observer, Weather, Tide, Plot Size, Vegetation Type, and Sampling Method)."),buttons:["OK"]})).present());t.isSubmitted=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null);const n=yield t.loadingController.create({message:t.ts.t("Submitting biomass assessment...")});yield n.present();try{const o={...t.biomassForm.value,treeMeasurements:t.treeMeasurements};o.status={incomplete:!1,sent:!0,pending:!1};const a={formValue:o,coordinates:t.locationData?.coordinates||null,photos:[],existingReportId:t.currentReportId||void 0};t.isEditMode&&(a.isEditMode=!0,a.originalSubmittedBy=t.originalSubmittedBy);const l=yield t.biomassSyncService.submitFinal(a);yield n.dismiss();try{t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(D=>setTimeout(D,1e3));const _=t.biomassForm.value;yield t.biomassSyncService.clearDraft(_);const F=(_?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),T=_?.zoneNumber||"",R=_?.quadNumber||"";let k=`biomass_draft_${F}`;T&&(k+=`_zone${T}`),R&&(k+=`_quad${R}`),yield t.forceDeleteDraftFile(`${k}.json`),t.isSubmitted=!0,console.log("BiomassPage: Draft cleared and form reset successfully")}catch(_){console.error("BiomassPage: Failed to clear draft:",_)}const h=t.ts.t(t.isEditMode?l.queued?"Updated assessment saved locally and queued for upload when online.":"Biomass assessment updated successfully!":l.queued?"Biomass assessment saved locally and queued for upload when online.":"Biomass assessment submitted successfully!");yield(yield t.alertController.create({header:t.ts.t("Success"),message:h,buttons:[{text:"OK",handler:()=>{t.router.navigate(["/biodiversity"])}}]})).present()}catch(o){yield n.dismiss(),console.error("Error submitting assessment:",o),yield(yield t.alertController.create({header:t.ts.t("Error"),message:t.ts.t("Failed to submit biomass assessment. Please try again."),buttons:["OK"]})).present()}})()}discardForm(){var t=this;return(0,b.A)(function*(){const n=yield t.alertController.create({header:t.ts.t("Discard Form"),message:t.ts.t("Are you sure you want to discard this form? All entered data will be lost."),buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Discard"),role:"destructive"}]});yield n.present();const{role:o}=yield n.onDidDismiss();if("destructive"!==o)return;const a=yield t.loadingController.create({message:t.ts.t("Discarding...")});yield a.present(),t.isDiscarded=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(l=>setTimeout(l,1e3));try{const l=t.biomassForm.value;yield t.biomassSyncService.clearDraft(l);const h=(l?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),y=l?.zoneNumber||"",_=l?.quadNumber||"";let F=`biomass_draft_${h}`;y&&(F+=`_zone${y}`),_&&(F+=`_quad${_}`),yield t.forceDeleteDraftFile(`${F}.json`)}catch(l){console.error("BiomassPage: Error clearing draft during discard:",l)}yield a.dismiss(),t.initializeForm(),t.router.navigate(["/biodiversity"])})()}editLocation(){this.router.navigate(["/location-biomass"])}canEditLocation(){return!this.viewMode}editZone(){console.log("Edit zone clicked")}editQuad(){console.log("Edit quad clicked")}locationHasZones(){const t=this.biomassForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Petit Barbarons"].includes(t)}locationHasQuads(){const t=this.biomassForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Caiman","Canopy"].includes(t)}getZoneName(t){return t?`Zone ${t}`:""}getQuadDisplay(t){if(!t)return"";const n=t.match(/\d+/);return n?n[0]:""}editLocationAdmin(){var t=this;return(0,b.A)(function*(){if(!t.currentUser||t.currentUser.level<4)return;const n=yield t.selectLocationStep();if(!n)return;const o=t.availableLocations.find(h=>h.name===n);let a="";if(o?.hasZones&&o.zones.length>0){const h=yield t.selectZoneStep(o);if(null===h)return;a=h}let l="";if(o?.hasQuads&&o.quads.length>0){const h=yield t.selectQuadStep(o,a);if(null===h)return;l=h}t.biomassForm.patchValue({location:n,zoneNumber:a,quadNumber:l}),t.isEditMode&&t.biomassForm.markAsDirty()})()}selectLocationStep(){var t=this;return new Promise(function(){var n=(0,b.A)(function*(o){const a=t.biomassForm.get("location")?.value||"",l=t.availableLocations.map(y=>({name:"location",type:"radio",label:y.name,value:y.name,checked:y.name===a}));yield(yield t.alertController.create({header:t.ts.t("Select Location"),cssClass:"location-edit-alert",inputs:l,buttons:[{text:t.ts.t("Cancel"),role:"cancel",handler:()=>o(null)},{text:t.ts.t("Next"),handler:y=>o(y)}]})).present()});return function(o){return n.apply(this,arguments)}}())}selectZoneStep(t){var n=this;return new Promise(function(){var o=(0,b.A)(function*(a){const l=n.biomassForm.get("zoneNumber")?.value||"",h=t.zones.map(_=>({name:"zone",type:"radio",label:`Zone ${_}`,value:_,checked:_===l}));yield(yield n.alertController.create({header:n.ts.t("Select Zone"),subHeader:t.name,cssClass:"location-edit-alert",inputs:h,buttons:[{text:n.ts.t("Cancel"),role:"cancel",handler:()=>a(null)},{text:n.ts.t("Next"),handler:_=>a(_)}]})).present()});return function(a){return o.apply(this,arguments)}}())}selectQuadStep(t,n){var o=this;return new Promise(function(){var a=(0,b.A)(function*(l){const h=o.biomassForm.get("quadNumber")?.value||"";let y=t.quads;if(n&&t.zoneQuadMap&&t.zoneQuadMap[n]){const T=t.zoneQuadMap[n];y=t.quads.filter(R=>{const k=parseInt(o.getQuadDisplay(R));return T.includes(k)})}const _=y.map(T=>({name:"quad",type:"radio",label:`Quad ${o.getQuadDisplay(T)}`,value:T,checked:o.getQuadDisplay(T)===h||T===h}));yield(yield o.alertController.create({header:o.ts.t("Select Quad"),subHeader:t.name,cssClass:"location-edit-alert",inputs:_,buttons:[{text:o.ts.t("Cancel"),role:"cancel",handler:()=>l(null)},{text:o.ts.t("Save"),handler:T=>l(T)}]})).present()});return function(l){return a.apply(this,arguments)}}())}loadDynamicSites(){var t=this;return(0,b.A)(function*(){try{(yield t.siteSyncService.getAllSites()).forEach(o=>{t.availableLocations.some(a=>a.name===o.name)||t.availableLocations.push({name:o.name,hasZones:o.zones&&o.zones.length>0||!1,hasQuads:o.sample_points&&o.sample_points.length>0||!1,zones:o.zones?o.zones.map(a=>a.name?.replace("Zone ","")||a.id):[],quads:o.sample_points?o.sample_points.map(a=>a.id||a.label):[]})})}catch(n){console.error("Error loading dynamic sites:",n)}})()}addTree(){if(this.newTree.species&&this.newTree.dbh>0){if(this.currentUser&&this.currentUser.level>=3&&(!this.newTree.height||this.newTree.height<=0))return;this.treeMeasurements.push({...this.newTree}),this.newTree={species:"",dbh:0,height:null},this.updateProgress(),this.saveDraftOnExit()}}removeTree(t){this.treeMeasurements.splice(t,1),this.updateProgress(),this.saveDraftOnExit()}getSpeciesDisplayName(t){return Xe[t]||t}calculateTreeBiomass(t){const n=Je[t.species];if(!n)return{agb:0,bgb:0,total:0};let o,a;return this.currentUser&&this.currentUser.level>=3&&t.height?(o=((i,c,r)=>.0673*r*Math.pow(i*c,.976))(t.dbh,t.height,n),a=((i,c)=>.0189*Math.pow(i,2.13)*Math.pow(c,.652))(t.dbh,t.height)):(o=((i,c)=>.251*c*Math.pow(i,2.46))(t.dbh,n),a=(i=>.199*Math.pow(.251*Math.pow(i,2.46),.899))(t.dbh)),{agb:o,bgb:a,total:o+a}}getTotalBiomass(){let t=0,n=0;return this.treeMeasurements.forEach(o=>{const a=this.calculateTreeBiomass(o);t+=a.agb,n+=a.bgb}),{agb:t,bgb:n,total:t+n}}getBiomassPerArea(){const t=parseFloat(this.biomassForm.get("plotSize")?.value)||0;return t<=0?0:this.getTotalBiomass().total/t}showEquationInfo(){var t=this;return(0,b.A)(function*(){const n=t.currentUser?t.currentUser.level:2,a=`\u{1f4d0} LEVEL 2 (Diameter only)\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n  AGB = \u03c1 \xd7 0.251 \xd7 D\xb2\xb7\u2074\u2076\n  BGB = 0.199 \xd7 AGB\u2070\xb7\u2078\u2079\u2079\n  Komiyama et al. (2005)\n\n\u{1f4cf} LEVEL 3-4 (Diameter + Height)\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n  AGB = \u03c1 \xd7 0.0673 \xd7 (D\xd7H)\u2070\xb7\u2079\u2077\u2076\n  BGB = 0.0189 \xd7 D\xb2\xb7\xb9\xb3 \xd7 H\u2070\xb7\u2076\u2075\xb2\n  Chave et al. (2014)\n\n\u{1f333} WOOD DENSITIES (\u03c1, g/cm\xb3)\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n  R. mucronata: 0.86\n  A. marina: 0.76\n  S. alba: 0.58\n  B. gymnorrhiza: 0.84\n  C. tagal: 0.85\n  X. granatum: 0.71\n  L. racemosa: 0.82\n  Gillerot et al. (2018)\n\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nYour level: ${n} (${n>=3?"Advanced":"Simple"})\n\nD = Diameter (cm)\nH = Height (m)\n\u03c1 = Wood density`;yield(yield t.alertController.create({header:t.ts.t("Biomass Equations"),message:a,buttons:["OK"],cssClass:"equation-info-alert"})).present()})()}updateProgress(){let t=0,n=5;this.biomassForm.get("observer")?.value&&t++,this.biomassForm.get("weather")?.value&&t++,this.biomassForm.get("tide")?.value&&t++,this.biomassForm.get("plotSize")?.value&&t++,this.biomassForm.get("vegetationType")?.value&&t++,"mangrove"===this.biomassForm.get("vegetationType")?.value?(n++,this.treeMeasurements.length>0&&t++):(n++,this.biomassForm.get("biomassEstimate")?.value&&t++),this.progress=t/n}setViewMode(t){this.viewMode=t,t?this.biomassForm.disable():this.biomassForm.enable()}enableEditMode(){!this.currentUser||this.currentUser.level<4||(this.isEditMode=!0,this.viewMode=!1,this.biomassForm.enable(),this.originalSubmittedBy=this.loadedReport?.submittedBy||"")}getEditedDateTime(){if(!this.loadedReport)return null;let t=this.loadedReport.editedAt||null;if(!t){const _=this.loadedReport.updatedAt,F=this.loadedReport.createdAt;_&&F&&_!==F&&Math.abs(new Date(_).getTime()-new Date(F).getTime())>5e3&&(t=_)}if(!t)return null;const n=new Date(t);return isNaN(n.getTime())?null:`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`}onDateChanged(t){const n=t.target;n.value&&(this.biomassForm.get("observationDate")?.setValue(n.value),this.setCurrentDateTime())}onTimeChanged(t){const n=t.target;n.value&&(this.biomassForm.get("observationTime")?.setValue(n.value),this.setCurrentDateTime())}loadReportForViewing(t){var n=this;return(0,b.A)(function*(){try{const o=yield n.biomassSyncService.getAllReports();console.log("BiomassPage: All reports:",o);const a=o.find(h=>h.report.reportId===t);if(!a)return console.error("BiomassPage: Report not found for viewing:",t),yield(yield n.alertController.create({header:n.ts.t("Report Not Found"),message:n.ts.t("The requested report could not be found."),buttons:["OK"]})).present(),void n.router.navigate(["/biodiversity"]);const l=a.report;console.log("BiomassPage: Loading report for viewing:",l),n.loadedReport=l,n.biomassForm.patchValue({location:l.form.location||"",zoneNumber:l.form.zoneNumber||"",quadNumber:l.form.quadNumber||"",observer:l.form.observer||"",observationDate:l.form.observationDate||l.form.date||"",observationTime:l.form.observationTime||"",weather:l.form.weather||"",tide:l.form.tide||"",plotSize:l.form.plotSize||"",vegetationType:l.form.vegetationType||"",biomassEstimate:l.form.biomassEstimate||"",notes:l.form.notes||""}),l.form.treeMeasurements&&Array.isArray(l.form.treeMeasurements)&&(n.treeMeasurements=l.form.treeMeasurements),l.coordinates&&(n.locationData={location:l.form.location,coordinates:l.coordinates}),n.currentReportId=t,n.setCurrentDateTime(t),n.updateProgress(),n.setViewMode(!0)}catch(o){console.error("BiomassPage: Error loading report for viewing:",o),yield(yield n.alertController.create({header:n.ts.t("Error"),message:n.ts.t("Failed to load the report for viewing."),buttons:["OK"]})).present(),n.router.navigate(["/biodiversity"])}})()}deleteEntry(){var t=this;return(0,b.A)(function*(){const n=t.auth.getCurrentUser();var a;!n||n.level<4?yield(yield t.alertController.create({header:t.ts.t("Permission Denied"),message:t.ts.t("Only Level 4 users can delete entries."),buttons:["OK"]})).present():yield(yield t.alertController.create({header:t.ts.t("Delete Entry"),message:t.ts.t("Are you sure you want to permanently delete this entry? This will remove it from the database and back it up to deleted files storage. This action cannot be undone."),buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Delete"),role:"destructive",handler:(a=(0,b.A)(function*(){yield t.performDeletion()}),function(){return a.apply(this,arguments)})}]})).present()})()}performDeletion(){var t=this;return(0,b.A)(function*(){const n=yield t.loadingController.create({message:t.ts.t("Deleting entry...")});yield n.present();try{const o=t.auth.getCurrentUser();yield t.entryDeletionService.deleteEntry({reportId:t.currentReportId,formType:"biomass",tableName:"biomass_reports",deletedBy:o?.username||"Unknown",deletedByEmail:o?.email||"",originalSubmittedBy:t.loadedReport?.submittedBy,originalSubmittedAt:t.loadedReport?.createdAt}),yield n.dismiss(),yield(yield t.alertController.create({header:t.ts.t("Success"),message:t.ts.t("Entry has been deleted and backed up successfully."),buttons:[{text:"OK",handler:()=>{t.router.navigate(["/biodiversity"])}}]})).present()}catch(o){yield n.dismiss(),console.error("Error deleting entry:",o),yield(yield t.alertController.create({header:t.ts.t("Error"),message:t.ts.t("Failed to delete entry. Please try again."),buttons:["OK"]})).present()}})()}static#e=i=()=>(this.\u0275fac=function(n){return new(n||c)(e.rXU(M.ok),e.rXU(p.hG),e.rXU(p.Xi),e.rXU(p.W3),e.rXU(E.Ix),e.rXU(E.nX),e.rXU(w.P),e.rXU(s.W),e.rXU(g.m),e.rXU(d.N),e.rXU(u.H),e.rXU(v.C),e.rXU(I.k),e.rXU(S.L))},this.\u0275cmp=e.VBU({type:c,selectors:[["app-biomass"]],standalone:!1,decls:154,vars:132,consts:[["dateInput",""],["timeInput",""],[1,"green1"],["slot","start"],[3,"defaultHref"],[1,"green1","compact-toolbar"],[1,"date-time-text"],["style","cursor: pointer;",3,"click",4,"ngIf"],[4,"ngIf"],["type","date",2,"position","absolute","opacity","0","width","0","height","0","pointer-events","none",3,"change","value"],["type","time",2,"position","absolute","opacity","0","width","0","height","0","pointer-events","none",3,"change","value"],[1,"green1","metadata-toolbar"],[1,"metadata-container"],[1,"metadata-item",3,"click"],["name","location",1,"metadata-icon"],[1,"metadata-label"],["name","alert-circle","class","status-icon required",4,"ngIf"],["class","edit-location-link",3,"click",4,"ngIf"],["class","metadata-item",3,"click",4,"ngIf"],["style","padding: 0 16px; font-size: 0.75rem; color: #e76f51;",4,"ngIf"],["color","light",3,"value"],[1,"progress-text"],[3,"ngSubmit","formGroup"],["class","edit-mode-banner",4,"ngIf"],["class","edit-mode-banner editing",4,"ngIf"],[2,"position","relative"],["position","stacked"],["formControlName","observer","type","text",3,"placeholder"],["name","close-circle","color","danger","style","position: absolute; top: 12px; right: 10px;",4,"ngIf"],["name","checkmark-circle","style","position: absolute; top: 12px; right: 10px; color: #52a676;",4,"ngIf"],["formControlName","weather","interface","popover",3,"placeholder"],["value","sunny"],["value","partly_cloudy"],["value","cloudy"],["value","rainy"],["value","windy"],["formControlName","tide","interface","popover",3,"placeholder"],["value","high"],["value","low"],["value","incoming"],["value","outgoing"],["formControlName","plotSize","type","number","step","0.1","placeholder","0"],["formControlName","vegetationType","interface","popover",3,"placeholder"],["value","mangrove"],["value","seagrass"],["value","saltmarsh"],["value","algae"],["value","mixed"],["formControlName","notes","rows","6",3,"placeholder"],["class","form-buttons",4,"ngIf"],["class","button-container",4,"ngIf"],[2,"cursor","pointer",3,"click"],["name","alert-circle",1,"status-icon","required"],[1,"edit-location-link",3,"click"],["name","grid",1,"metadata-icon"],["name","apps",1,"metadata-icon"],[2,"padding","0 16px","font-size","0.75rem","color","#e76f51"],[1,"edit-mode-banner"],["expand","block","color","warning",3,"click"],["name","create-outline","slot","start"],[1,"edit-mode-banner","editing"],["name","create-outline"],["name","close-circle","color","danger",2,"position","absolute","top","12px","right","10px"],["name","checkmark-circle",2,"position","absolute","top","12px","right","10px","color","#52a676"],["name","information-circle",2,"vertical-align","middle","margin-left","8px","cursor","pointer",3,"click"],[1,"tree-input-section"],["size","12"],[1,"ion-text-wrap","ion-color-medium",2,"font-size","12px","margin-top","4px"],["size","12","size-md","4"],["interface","popover",3,"ionChange","value","placeholder"],["value","rhizophora_mucronata"],["value","avicennia_marina"],["value","ceriops_tagal"],["value","bruguiera_cylindrica"],["value","sonneratia_alba"],["value","xylocarpus_granatum"],["value","lumnitzera_racemosa"],["size","6","size-md","4"],["type","number","step","0.1","min","0",3,"ionInput","value","placeholder"],["size","6","size-md","4",4,"ngIf"],["expand","block","fill","outline",1,"coastal-blue-btn",3,"click","disabled"],["name","add","slot","start"],["style","padding: 12px; background: #e8f5e9; margin: 10px 0; border-radius: 8px; border-left: 4px solid #4fb3bf;",4,"ngIf"],["class","tree-list-section",4,"ngIf"],["style","text-align: center; padding: 20px; color: var(--ion-color-medium);",4,"ngIf"],["type","number","step","0.1","min","0","placeholder","0",3,"ionInput","value"],[2,"padding","12px","background","#e8f5e9","margin","10px 0","border-radius","8px","border-left","4px solid #4fb3bf"],[2,"color","#52a676"],[2,"font-size","14px"],[1,"tree-list-section"],[4,"ngFor","ngForOf"],[1,"biomass-summary",2,"margin-top","16px","padding","12px","background","var(--ion-color-light)","border-radius","8px"],["size","6"],[2,"text-align","center"],[2,"font-size","12px","color","var(--ion-color-medium)"],[2,"font-size","18px","font-weight","bold"],[2,"text-align","center","margin-top","8px","padding-top","8px","border-top","1px solid var(--ion-color-medium-tint)"],[2,"font-size","20px","font-weight","bold","color","#52a676"],[1,"tree-info"],[1,"ion-color-medium"],["slot","end"],[1,"tree-biomass",2,"text-align","right"],[1,"ion-color-medium",2,"font-size","12px"],["slot","end","fill","clear","size","small","color","danger",3,"click"],["name","remove-circle"],[2,"text-align","center","padding","20px","color","var(--ion-color-medium)"],["name","leaf-outline",2,"font-size","48px","opacity","0.3"],["formControlName","biomassEstimate","type","number","step","0.1","placeholder","0"],[1,"form-buttons"],["expand","block","size","large","type","submit",1,"green-button",3,"disabled"],["name","leaf","slot","start"],["expand","block","fill","outline","color","medium",1,"save-draft-button",3,"click"],["name","save-outline","slot","start"],["expand","block","fill","outline",1,"discard-button",3,"click"],["name","trash-outline","slot","start"],[1,"button-container"],["expand","block","color","danger",1,"delete-button",3,"click"]],template:function(n,o){if(1&n){const a=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3),e.nrm(3,"ion-back-button",4),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.nI1(6,"t"),e.k0s()(),e.j41(7,"ion-toolbar",5)(8,"ion-text",6),e.DNE(9,X,2,1,"span",7)(10,Q,2,1,"span",8),e.EFF(11," \xa0 \u2022 \xa0 "),e.DNE(12,j,2,1,"span",7)(13,z,2,1,"span",8),e.j41(14,"input",9,0),e.bIt("change",function(h){return m.eBV(a),m.Njj(o.onDateChanged(h))}),e.k0s(),e.j41(16,"input",10,1),e.bIt("change",function(h){return m.eBV(a),m.Njj(o.onTimeChanged(h))}),e.k0s(),e.DNE(18,Y,2,1,"span",8),e.k0s()(),e.j41(19,"ion-toolbar",11)(20,"div",12)(21,"div",13),e.bIt("click",function(){return m.eBV(a),m.Njj(!o.viewMode&&o.editLocation())}),e.nrm(22,"ion-icon",14),e.j41(23,"span",15),e.EFF(24),e.nI1(25,"t"),e.k0s(),e.DNE(26,G,1,0,"ion-icon",16),e.k0s(),e.DNE(27,U,3,3,"span",17)(28,ae,4,1,"div",18)(29,se,4,1,"div",18),e.k0s(),e.DNE(30,le,3,3,"ion-error",19),e.k0s(),e.j41(31,"ion-toolbar",5),e.nrm(32,"ion-progress-bar",20),e.j41(33,"ion-text",21),e.EFF(34),e.nI1(35,"t"),e.k0s()()(),e.j41(36,"ion-content")(37,"form",22),e.bIt("ngSubmit",function(){return m.eBV(a),m.Njj(o.onSubmit())}),e.DNE(38,ce,5,3,"div",23)(39,de,5,3,"div",24),e.j41(40,"ion-card")(41,"ion-card-header",2)(42,"ion-card-title"),e.EFF(43),e.nI1(44,"t"),e.k0s()(),e.j41(45,"ion-card-content")(46,"ion-item",25)(47,"ion-label",26),e.EFF(48),e.nI1(49,"t"),e.k0s(),e.nrm(50,"ion-input",27),e.nI1(51,"t"),e.DNE(52,ue,1,0,"ion-icon",28)(53,me,1,0,"ion-icon",29)(54,ge,3,3,"ion-error",8),e.k0s(),e.j41(55,"ion-item",25)(56,"ion-label",26),e.EFF(57),e.nI1(58,"t"),e.k0s(),e.j41(59,"ion-select",30),e.nI1(60,"t"),e.j41(61,"ion-select-option",31),e.EFF(62),e.nI1(63,"t"),e.k0s(),e.j41(64,"ion-select-option",32),e.EFF(65),e.nI1(66,"t"),e.k0s(),e.j41(67,"ion-select-option",33),e.EFF(68),e.nI1(69,"t"),e.k0s(),e.j41(70,"ion-select-option",34),e.EFF(71),e.nI1(72,"t"),e.k0s(),e.j41(73,"ion-select-option",35),e.EFF(74),e.nI1(75,"t"),e.k0s()(),e.DNE(76,pe,1,0,"ion-icon",28)(77,fe,1,0,"ion-icon",29)(78,he,3,3,"ion-error",8),e.k0s(),e.j41(79,"ion-item",25)(80,"ion-label",26),e.EFF(81),e.nI1(82,"t"),e.k0s(),e.j41(83,"ion-select",36),e.nI1(84,"t"),e.j41(85,"ion-select-option",37),e.EFF(86),e.nI1(87,"t"),e.k0s(),e.j41(88,"ion-select-option",38),e.EFF(89),e.nI1(90,"t"),e.k0s(),e.j41(91,"ion-select-option",39),e.EFF(92),e.nI1(93,"t"),e.k0s(),e.j41(94,"ion-select-option",40),e.EFF(95),e.nI1(96,"t"),e.k0s()(),e.DNE(97,_e,1,0,"ion-icon",28)(98,be,1,0,"ion-icon",29)(99,ve,3,3,"ion-error",8),e.k0s()()(),e.j41(100,"ion-card")(101,"ion-card-header",2)(102,"ion-card-title"),e.EFF(103),e.nI1(104,"t"),e.k0s()(),e.j41(105,"ion-card-content")(106,"ion-item",25)(107,"ion-label",26),e.EFF(108),e.nI1(109,"t"),e.k0s(),e.nrm(110,"ion-input",41),e.DNE(111,ye,1,0,"ion-icon",28)(112,Me,1,0,"ion-icon",29)(113,Fe,3,3,"ion-error",8),e.k0s(),e.j41(114,"ion-item",25)(115,"ion-label",26),e.EFF(116),e.nI1(117,"t"),e.k0s(),e.j41(118,"ion-select",42),e.nI1(119,"t"),e.j41(120,"ion-select-option",43),e.EFF(121),e.nI1(122,"t"),e.k0s(),e.j41(123,"ion-select-option",44),e.EFF(124),e.nI1(125,"t"),e.k0s(),e.j41(126,"ion-select-option",45),e.EFF(127),e.nI1(128,"t"),e.k0s(),e.j41(129,"ion-select-option",46),e.EFF(130),e.nI1(131,"t"),e.k0s(),e.j41(132,"ion-select-option",47),e.EFF(133),e.nI1(134,"t"),e.k0s()(),e.DNE(135,Te,1,0,"ion-icon",28)(136,Pe,1,0,"ion-icon",29)(137,Ee,3,3,"ion-error",8),e.k0s()()(),e.DNE(138,Ge,65,39,"ion-card",8)(139,Le,14,9,"ion-card",8),e.j41(140,"ion-card")(141,"ion-card-header",2)(142,"ion-card-title"),e.EFF(143),e.nI1(144,"t"),e.k0s()(),e.j41(145,"ion-card-content")(146,"ion-item")(147,"ion-label",26),e.EFF(148),e.nI1(149,"t"),e.k0s(),e.nrm(150,"ion-textarea",48),e.nI1(151,"t"),e.k0s()()(),e.DNE(152,Ve,13,10,"div",49)(153,qe,5,3,"div",50),e.k0s()()}if(2&n){let a,l,h,y,_,F,T,R,k,D,N,L,B,H,Z,V,ee,te,q,ne,oe,J,ie,re;e.R7$(3),e.Y8G("defaultHref",o.viewMode?"/biodiversity":"/home"),e.R7$(2),e.JRh(e.bMT(6,70,"Biomass Assessment")),e.R7$(4),e.Y8G("ngIf",(null==o.currentUser?null:o.currentUser.level)>=4&&!o.viewMode),e.R7$(),e.Y8G("ngIf",!((null==o.currentUser?null:o.currentUser.level)>=4&&!o.viewMode)),e.R7$(2),e.Y8G("ngIf",(null==o.currentUser?null:o.currentUser.level)>=4&&!o.viewMode),e.R7$(),e.Y8G("ngIf",!((null==o.currentUser?null:o.currentUser.level)>=4&&!o.viewMode)),e.R7$(),e.Y8G("value",null==(a=o.biomassForm.get("observationDate"))?null:a.value),e.R7$(2),e.Y8G("value",null==(l=o.biomassForm.get("observationTime"))?null:l.value),e.R7$(2),e.Y8G("ngIf",(o.viewMode||o.isEditMode)&&o.getEditedDateTime()),e.R7$(6),e.JRh((null==(h=o.biomassForm.get("location"))?null:h.value)||e.bMT(25,72,"Add location")),e.R7$(2),e.Y8G("ngIf",!(null!=(y=o.biomassForm.get("location"))&&y.value||o.viewMode)),e.R7$(),e.Y8G("ngIf",o.isEditMode&&o.currentUser&&o.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",(null==(_=o.biomassForm.get("zoneNumber"))?null:_.value)&&o.locationHasZones()),e.R7$(),e.Y8G("ngIf",(null==(F=o.biomassForm.get("quadNumber"))?null:F.value)&&o.locationHasQuads()),e.R7$(),e.Y8G("ngIf",(null==(T=o.biomassForm.get("location"))?null:T.hasError("required"))&&(null==(T=o.biomassForm.get("location"))?null:T.touched)),e.R7$(2),e.Y8G("value",o.progress),e.R7$(2),e.Lme(" ",(100*o.progress).toFixed(0),"% ",e.bMT(35,74,"Complete")," "),e.R7$(2),e.AVh("view-mode",o.viewMode),e.R7$(),e.Y8G("formGroup",o.biomassForm),e.R7$(),e.Y8G("ngIf",o.viewMode&&o.currentUser&&o.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",o.isEditMode),e.R7$(4),e.JRh(e.bMT(44,76,"Survey Information")),e.R7$(5),e.JRh(e.bMT(49,78,"Observer")),e.R7$(2),e.Y8G("placeholder",e.bMT(51,80,"Enter observer name")),e.R7$(2),e.Y8G("ngIf",!(null!=(R=o.biomassForm.get("observer"))&&R.value)),e.R7$(),e.Y8G("ngIf",null==(k=o.biomassForm.get("observer"))?null:k.value),e.R7$(),e.Y8G("ngIf",(null==(D=o.biomassForm.get("observer"))?null:D.hasError("required"))&&(null==(D=o.biomassForm.get("observer"))?null:D.touched)),e.R7$(3),e.JRh(e.bMT(58,82,"Weather")),e.R7$(2),e.Y8G("placeholder",e.bMT(60,84,"Select weather")),e.R7$(3),e.JRh(e.bMT(63,86,"Sunny")),e.R7$(3),e.JRh(e.bMT(66,88,"Partly Cloudy")),e.R7$(3),e.JRh(e.bMT(69,90,"Cloudy")),e.R7$(3),e.JRh(e.bMT(72,92,"Rainy")),e.R7$(3),e.JRh(e.bMT(75,94,"Windy")),e.R7$(2),e.Y8G("ngIf",!(null!=(N=o.biomassForm.get("weather"))&&N.value)),e.R7$(),e.Y8G("ngIf",null==(L=o.biomassForm.get("weather"))?null:L.value),e.R7$(),e.Y8G("ngIf",(null==(B=o.biomassForm.get("weather"))?null:B.hasError("required"))&&(null==(B=o.biomassForm.get("weather"))?null:B.touched)),e.R7$(3),e.JRh(e.bMT(82,96,"Tide")),e.R7$(2),e.Y8G("placeholder",e.bMT(84,98,"Select tide")),e.R7$(3),e.JRh(e.bMT(87,100,"High")),e.R7$(3),e.JRh(e.bMT(90,102,"Low")),e.R7$(3),e.JRh(e.bMT(93,104,"Incoming")),e.R7$(3),e.JRh(e.bMT(96,106,"Outgoing")),e.R7$(2),e.Y8G("ngIf",!(null!=(H=o.biomassForm.get("tide"))&&H.value)),e.R7$(),e.Y8G("ngIf",null==(Z=o.biomassForm.get("tide"))?null:Z.value),e.R7$(),e.Y8G("ngIf",(null==(V=o.biomassForm.get("tide"))?null:V.hasError("required"))&&(null==(V=o.biomassForm.get("tide"))?null:V.touched)),e.R7$(4),e.JRh(e.bMT(104,108,"Plot Information")),e.R7$(5),e.JRh(e.bMT(109,110,"Plot Size (m\xb2)")),e.R7$(3),e.Y8G("ngIf",!(null!=(ee=o.biomassForm.get("plotSize"))&&ee.value)),e.R7$(),e.Y8G("ngIf",null==(te=o.biomassForm.get("plotSize"))?null:te.value),e.R7$(),e.Y8G("ngIf",(null==(q=o.biomassForm.get("plotSize"))?null:q.hasError("required"))&&(null==(q=o.biomassForm.get("plotSize"))?null:q.touched)),e.R7$(3),e.JRh(e.bMT(117,112,"Vegetation Type")),e.R7$(2),e.Y8G("placeholder",e.bMT(119,114,"Select vegetation type")),e.R7$(3),e.JRh(e.bMT(122,116,"Mangrove")),e.R7$(3),e.JRh(e.bMT(125,118,"Seagrass")),e.R7$(3),e.JRh(e.bMT(128,120,"Salt Marsh")),e.R7$(3),e.JRh(e.bMT(131,122,"Algae")),e.R7$(3),e.JRh(e.bMT(134,124,"Mixed Vegetation")),e.R7$(2),e.Y8G("ngIf",!(null!=(ne=o.biomassForm.get("vegetationType"))&&ne.value)),e.R7$(),e.Y8G("ngIf",null==(oe=o.biomassForm.get("vegetationType"))?null:oe.value),e.R7$(),e.Y8G("ngIf",(null==(J=o.biomassForm.get("vegetationType"))?null:J.hasError("required"))&&(null==(J=o.biomassForm.get("vegetationType"))?null:J.touched)),e.R7$(),e.Y8G("ngIf","mangrove"===(null==(ie=o.biomassForm.get("vegetationType"))?null:ie.value)),e.R7$(),e.Y8G("ngIf","mangrove"!==(null==(re=o.biomassForm.get("vegetationType"))?null:re.value)),e.R7$(4),e.JRh(e.bMT(144,126,"Additional Notes")),e.R7$(5),e.JRh(e.bMT(149,128,"Notes")),e.R7$(2),e.Y8G("placeholder",e.bMT(151,130,"Enter any additional observations, methodology notes, environmental conditions, etc.")),e.R7$(2),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.viewMode&&(null==o.currentUser?null:o.currentUser.level)>=4)}},dependencies:[P.Sq,P.bT,M.qT,M.BC,M.cb,M.j4,M.JD,p.Jm,p.QW,p.b_,p.I9,p.ME,p.HW,p.tN,p.hU,p.W9,p.lO,p.eU,p.iq,p.$w,p.uz,p.he,p.nf,p.FH,p.ln,p.Nm,p.Ip,p.IO,p.nc,p.BC,p.ai,p.su,p.Je,p.Gw,p.el,$.D],styles:[".equation-info-alert{--max-width: 360px}  .equation-info-alert .alert-message{max-height:70vh;overflow-y:auto;white-space:pre-line!important;font-family:monospace!important;font-size:13px!important;line-height:1.5!important}.coastal-blue-btn[_ngcontent-%COMP%]{--color: #4fb3bf;--border-color: #4fb3bf;--background-hover: rgba(79, 179, 191, .1)}.coastal-blue-btn.ion-activated[_ngcontent-%COMP%]{--background: rgba(79, 179, 191, .2)}.green-background[_ngcontent-%COMP%]{--background: #f0f9f0}.green1[_ngcontent-%COMP%]{--background: #52a676;color:#fff}.green1[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]{--color: white;transition:transform .2s}.green1[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]:hover{transform:translate(-4px)}.green1[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;text-align:center;position:absolute;left:0;right:0;padding:0 50px}.green1.compact-toolbar[_ngcontent-%COMP%]{--min-height: 28px;--padding-top: 5px;--padding-bottom: 5px}.edit-mode-banner[_ngcontent-%COMP%]{padding:.75rem 1rem;margin:.5rem;border-radius:.5rem}.edit-mode-banner[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: .5rem;font-weight:600}.edit-mode-banner.editing[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;display:flex;align-items:center;gap:.5rem;color:#856404;font-weight:500}.edit-mode-banner.editing[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.date-time-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fffffff2;font-size:14px;padding:0;margin:3px 0;font-weight:400;letter-spacing:.3px;line-height:1.2}.progress-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fff;font-size:13px;padding:0;margin:0 0 4px}.metadata-toolbar[_ngcontent-%COMP%]{--min-height: 40px;--padding-top: 6px;--padding-bottom: 6px}.metadata-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px;padding:0 12px;flex-wrap:wrap}.metadata-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;background:#ffffff26;border-radius:16px;padding:5px 10px;cursor:pointer;transition:all .2s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2)}.metadata-item[_ngcontent-%COMP%]:active{transform:scale(.95);background:#ffffff40}.metadata-icon[_ngcontent-%COMP%]{font-size:14px;color:#ffffffe6;min-width:14px}.metadata-label[_ngcontent-%COMP%]{color:#fff;font-size:12px;font-weight:500;letter-spacing:.2px;white-space:nowrap;max-width:120px;overflow:hidden;text-overflow:ellipsis}.edit-location-link[_ngcontent-%COMP%]{color:#ffffffe6;font-size:11px;text-decoration:underline;cursor:pointer;margin-left:8px;padding:4px 8px}.edit-location-link[_ngcontent-%COMP%]:active{opacity:.7}.status-icon.required[_ngcontent-%COMP%]{color:#ffcdd2;font-size:14px}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 2px 8px #0000001a}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0;padding:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#fff}@media (min-width: 400px) and (max-width: 800px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem}}@media (max-width: 399px) and (min-width: 360px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.1rem}}@media (max-width: 359px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:.95rem}}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#ffffffe6;font-size:.875rem;margin-top:4px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{background:#fff;padding:16px}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;margin-bottom:16px;background:transparent;border:none}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:8px;color:#52a676;font-weight:600}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;color:#52a676;margin:0}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:.875rem;margin:4px 0 0}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--background: white;--border-color: #e0e0e0;--border-radius: 8px;--padding-start: 12px;--padding-end: 12px;--padding-top: 12px;--padding-bottom: 12px;margin-top:8px;border:1px solid #e0e0e0;border-radius:8px;box-shadow:0 1px 3px #0000001a;transition:all .2s ease}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]:focus, ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]:focus, ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]:focus{--border-color: #52a676;box-shadow:0 2px 8px #52a67633}ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{min-height:120px}ion-icon[name=checkmark-circle][_ngcontent-%COMP%]{color:#52a676;animation:_ngcontent-%COMP%_checkmark .3s ease}ion-icon[name=close-circle][_ngcontent-%COMP%]{color:#f44336;animation:_ngcontent-%COMP%_shake .3s ease}@keyframes _ngcontent-%COMP%_checkmark{0%{transform:scale(0)}50%{transform:scale(1.2)}to{transform:scale(1)}}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}25%{transform:translate(-4px)}75%{transform:translate(4px)}}.form-buttons[_ngcontent-%COMP%]{padding:0 16px;margin-top:24px;margin-bottom:32px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-bottom:12px;height:56px;font-weight:600;border-radius:12px;transition:all .2s ease}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-buttons[_ngcontent-%COMP%]   ion-button.save-draft-button[_ngcontent-%COMP%]{margin:10px 0 12px}.form-buttons[_ngcontent-%COMP%]   .save-draft-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--background: rgba(107, 124, 122, .1);--border-color: #6b7c7a;--color: #6b7c7a;--background-hover: rgba(107, 124, 122, .2);--background-activated: rgba(107, 124, 122, .3)}.form-buttons[_ngcontent-%COMP%]   .discard-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--color: #e76f51;--border-color: #e76f51;--border-width: 2px;--background-hover: rgba(231, 111, 81, .1);--background-activated: rgba(231, 111, 81, .2);--ripple-color: rgba(231, 111, 81, .3)}.form-buttons[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{margin-top:20px;--background: #d32f2f;--background-hover: #b71c1c;--background-activated: #b71c1c;font-weight:600;height:48px;font-size:1rem}.green-button[_ngcontent-%COMP%]{--background: #52a676;--color: white}.green-button.compact-toolbar[_ngcontent-%COMP%]{--min-height: 28px;--padding-top: 5px;--padding-bottom: 5px;box-shadow:0 6px 16px #52a67666}.green-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.discard-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--color: #e76f51;--border-color: #e76f51;--border-width: 2px;--background-hover: rgba(231, 111, 81, .1);--background-activated: rgba(231, 111, 81, .2);--ripple-color: rgba(231, 111, 81, .3)}@media (max-width: 768px){.metadata-container[_ngcontent-%COMP%]{gap:6px}.metadata-item[_ngcontent-%COMP%]{padding:4px 8px}.metadata-label[_ngcontent-%COMP%]{font-size:11px}.progress-container[_ngcontent-%COMP%]{padding:12px}ion-card[_ngcontent-%COMP%]{margin:12px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding:12px 16px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:16px}.form-buttons[_ngcontent-%COMP%]{padding:0 12px}}@media (max-width: 480px){.metadata-container[_ngcontent-%COMP%]{gap:4px}.metadata-item[_ngcontent-%COMP%]{padding:3px 6px}.metadata-label[_ngcontent-%COMP%]{font-size:10px}.progress-container[_ngcontent-%COMP%]{padding:8px}ion-card[_ngcontent-%COMP%]{margin:8px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding:10px 12px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:12px}.form-buttons[_ngcontent-%COMP%]{padding:0 8px;margin-top:20px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{height:48px;font-size:16px}}ion-error[_ngcontent-%COMP%]{color:#e76f51!important;font-size:.75rem!important;margin-top:4px;padding-left:16px}  ion-content.view-mode ion-checkbox{pointer-events:none!important;cursor:default!important}  ion-content.view-mode ion-input,   ion-content.view-mode ion-textarea,   ion-content.view-mode ion-select{pointer-events:none!important;cursor:default!important}  ion-content.view-mode ion-button{pointer-events:none!important;cursor:default!important;opacity:.6}"]}))}return i(),c})()}];let We=(()=>{var i;class c{static#e=i=()=>(this.\u0275fac=function(n){return new(n||c)},this.\u0275mod=e.$C({type:c}),this.\u0275inj=m.G2t({imports:[x.iI.forChild(Qe),x.iI]}))}return i(),c})();var Ke=f(4670);let He=(()=>{var i;class c{static#e=i=()=>(this.\u0275fac=function(n){return new(n||c)},this.\u0275mod=e.$C({type:c}),this.\u0275inj=m.G2t({imports:[P.MD,M.YN,M.X1,p.bv,We,Ke.k]}))}return i(),c})()}}]);