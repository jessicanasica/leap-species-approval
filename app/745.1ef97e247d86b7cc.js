"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[745],{152(L,N,_){_.d(N,{B:()=>R});var C=_(8839),x=_(9974),g=_(4360);function R(b,E=C.E){return(0,x.N)((G,t)=>{let s=null,I=null,c=null;const m=()=>{if(s){s.unsubscribe(),s=null;const u=I;I=null,t.next(u)}};function d(){const u=c+b,P=E.now();if(P<u)return s=this.schedule(void 0,u-P),void t.add(s);m()}G.subscribe((0,g._)(t,u=>{I=u,c=E.now(),s||(s=E.schedule(d,b),t.add(s))},()=>{m(),t.complete()},void 0,()=>{I=s=null}))})}},745(L,N,_){_.d(N,{PollutionPageModule:()=>xt});var C=_(2200),x=_(4341),g=_(7343),R=_(8132),b=_(467),E=_(7762),G=_(152),t=_(3664),s=_(2615),I=_(5921),c=_(3205),m=_(4632),d=_(5010),u=_(918),P=_(9187),k=_(7643),w=_(6845),D=_(7314);function W(i,p){if(1&i){const l=t.RV6();t.j41(0,"span",68),t.bIt("click",function(){s.eBV(l),t.XpG();const o=t.sdS(15);return s.Njj(o.showPicker())}),t.EFF(1),t.k0s()}if(2&i){const l=t.XpG();t.R7$(),t.JRh(l.currentDateDisplay)}}function X(i,p){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const l=t.XpG();t.R7$(),t.JRh(l.currentDateDisplay)}}function S(i,p){if(1&i){const l=t.RV6();t.j41(0,"span",68),t.bIt("click",function(){s.eBV(l),t.XpG();const o=t.sdS(17);return s.Njj(o.showPicker())}),t.EFF(1),t.k0s()}if(2&i){const l=t.XpG();t.R7$(),t.JRh(l.currentTimeDisplay)}}function z(i,p){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const l=t.XpG();t.R7$(),t.JRh(l.currentTimeDisplay)}}function B(i,p){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const l=t.XpG();t.R7$(),t.SpI(" (edited: ",l.getEditedDateTime(),")")}}function A(i,p){1&i&&t.nrm(0,"ion-icon",69)}function V(i,p){if(1&i){const l=t.RV6();t.j41(0,"div",13),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(!o.viewMode&&o.editZone())}),t.nrm(1,"ion-icon",70),t.j41(2,"span",15),t.EFF(3),t.k0s()()}if(2&i){let l;const e=t.XpG();t.R7$(3),t.JRh(e.getZoneName(null==(l=e.pollutionForm.get("zoneNumber"))?null:l.value))}}function q(i,p){if(1&i){const l=t.RV6();t.j41(0,"div",13),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(!o.viewMode&&o.editQuad())}),t.nrm(1,"ion-icon",71),t.j41(2,"span",15),t.EFF(3),t.k0s()()}if(2&i){let l;const e=t.XpG();t.R7$(3),t.SpI("Quad ",e.getQuadDisplay(null==(l=e.pollutionForm.get("quadNumber"))?null:l.value))}}function J(i,p){if(1&i){const l=t.RV6();t.j41(0,"span",72),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.editLocationAdmin())}),t.EFF(1),t.nI1(2,"t"),t.k0s()}2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Edit location")," "))}function Q(i,p){1&i&&(t.j41(0,"ion-error",73),t.EFF(1),t.nI1(2,"t"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Location is required")," "))}function K(i,p){if(1&i){const l=t.RV6();t.j41(0,"div",74)(1,"ion-button",75),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.enableEditMode())}),t.nrm(2,"ion-icon",76),t.EFF(3),t.nI1(4,"t"),t.k0s()()}2&i&&(t.R7$(3),t.SpI(" ",t.bMT(4,1,"Edit This Entry")," "))}function Z(i,p){1&i&&(t.j41(0,"div",77),t.nrm(1,"ion-icon",78),t.j41(2,"span"),t.EFF(3),t.nI1(4,"t"),t.k0s()()),2&i&&(t.R7$(3),t.JRh(t.bMT(4,1,"Editing Entry - Changes will replace the original submission")))}function H(i,p){1&i&&(t.j41(0,"p",79),t.nrm(1,"ion-icon",80),t.EFF(2),t.nI1(3,"t"),t.k0s()),2&i&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"Tap to get current GPS location")," "))}function tt(i,p){if(1&i&&(t.j41(0,"p",81),t.nrm(1,"ion-icon",82),t.EFF(2),t.k0s()),2&i){const l=t.XpG();t.R7$(2),t.Lme(" ",l.coordinates.latitude.toFixed(6),", ",l.coordinates.longitude.toFixed(6)," ")}}function et(i,p){1&i&&(t.j41(0,"p",83),t.nrm(1,"ion-icon",84),t.EFF(2),t.nI1(3,"t"),t.k0s()),2&i&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"GPS captured when creating new site")," "))}function ot(i,p){if(1&i){const l=t.RV6();t.j41(0,"ion-button",85),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.captureIndividualPhoto("greyWater"))}),t.nrm(1,"ion-icon",86),t.EFF(2),t.nI1(3,"t"),t.k0s()}2&i&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"Take Photo")," "))}function nt(i,p){if(1&i){const l=t.RV6();t.j41(0,"ion-button",92),t.bIt("click",function(){s.eBV(l);const o=t.XpG(2);return s.Njj(o.removeIndividualPhoto("greyWater"))}),t.nrm(1,"ion-icon",93),t.k0s()}}function it(i,p){if(1&i){const l=t.RV6();t.j41(0,"div",87)(1,"div",88)(2,"img",89),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.openFullScreenPhoto(o.greyWaterPhoto,"Grey Water"))}),t.k0s(),t.j41(3,"small",90),t.EFF(4),t.nI1(5,"t"),t.k0s()(),t.DNE(6,nt,2,0,"ion-button",91),t.k0s()}if(2&i){const l=t.XpG();t.R7$(2),t.Y8G("src",l.greyWaterPhoto,t.B4B),t.R7$(2),t.JRh(t.bMT(5,3,"Tap to view full size")),t.R7$(2),t.Y8G("ngIf",!l.viewMode)}}function rt(i,p){if(1&i){const l=t.RV6();t.j41(0,"ion-button",85),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.captureIndividualPhoto("sewage"))}),t.nrm(1,"ion-icon",86),t.EFF(2),t.nI1(3,"t"),t.k0s()}2&i&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"Take Photo")," "))}function at(i,p){if(1&i){const l=t.RV6();t.j41(0,"ion-button",92),t.bIt("click",function(){s.eBV(l);const o=t.XpG(2);return s.Njj(o.removeIndividualPhoto("sewage"))}),t.nrm(1,"ion-icon",93),t.k0s()}}function lt(i,p){if(1&i){const l=t.RV6();t.j41(0,"div",87)(1,"div",88)(2,"img",94),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.openFullScreenPhoto(o.sewagePhoto,"Sewage"))}),t.k0s(),t.j41(3,"small",90),t.EFF(4),t.nI1(5,"t"),t.k0s()(),t.DNE(6,at,2,0,"ion-button",91),t.k0s()}if(2&i){const l=t.XpG();t.R7$(2),t.Y8G("src",l.sewagePhoto,t.B4B),t.R7$(2),t.JRh(t.bMT(5,3,"Tap to view full size")),t.R7$(2),t.Y8G("ngIf",!l.viewMode)}}function st(i,p){if(1&i){const l=t.RV6();t.j41(0,"ion-button",85),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.captureIndividualPhoto("trash"))}),t.nrm(1,"ion-icon",86),t.EFF(2),t.nI1(3,"t"),t.k0s()}2&i&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"Take Photo")," "))}function ct(i,p){if(1&i){const l=t.RV6();t.j41(0,"ion-button",92),t.bIt("click",function(){s.eBV(l);const o=t.XpG(2);return s.Njj(o.removeIndividualPhoto("trash"))}),t.nrm(1,"ion-icon",93),t.k0s()}}function dt(i,p){if(1&i){const l=t.RV6();t.j41(0,"div",87)(1,"div",88)(2,"img",95),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.openFullScreenPhoto(o.trashPhoto,"Trash"))}),t.k0s(),t.j41(3,"small",90),t.EFF(4),t.nI1(5,"t"),t.k0s()(),t.DNE(6,ct,2,0,"ion-button",91),t.k0s()}if(2&i){const l=t.XpG();t.R7$(2),t.Y8G("src",l.trashPhoto,t.B4B),t.R7$(2),t.JRh(t.bMT(5,3,"Tap to view full size")),t.R7$(2),t.Y8G("ngIf",!l.viewMode)}}function ut(i,p){if(1&i){const l=t.RV6();t.j41(0,"ion-button",92),t.bIt("click",function(){s.eBV(l);const o=t.XpG().index,n=t.XpG();return s.Njj(n.removePhoto(o))}),t.nrm(1,"ion-icon",93),t.k0s()}}function pt(i,p){if(1&i){const l=t.RV6();t.j41(0,"div",96)(1,"div",88)(2,"img",97),t.bIt("click",function(){const o=s.eBV(l).$implicit,n=t.XpG();return s.Njj(n.openFullScreenPhoto(o,"Pollution"))}),t.k0s(),t.j41(3,"small",90),t.EFF(4),t.nI1(5,"t"),t.k0s()(),t.DNE(6,ut,2,0,"ion-button",91),t.k0s()}if(2&i){const l=p.$implicit,e=p.index,o=t.XpG();t.R7$(2),t.Y8G("alt",t.VkB("Pollution photo ",e+1))("src",l,t.B4B),t.R7$(2),t.JRh(t.bMT(5,5,"Tap to view full size")),t.R7$(2),t.Y8G("ngIf",!o.viewMode)}}function gt(i,p){if(1&i){const l=t.RV6();t.j41(0,"ion-button",98),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.capturePhoto())}),t.nrm(1,"ion-icon",86),t.EFF(2),t.nI1(3,"t"),t.k0s()}if(2&i){const l=t.XpG();t.R7$(2),t.Lme(" ",t.bMT(3,2,"Add Photo")," (",l.photos.length,"/5) ")}}function mt(i,p){1&i&&t.nrm(0,"ion-icon",99)}function ht(i,p){1&i&&t.nrm(0,"ion-icon",100)}function ft(i,p){1&i&&(t.j41(0,"ion-error"),t.EFF(1),t.nI1(2,"t"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Description is required")," "))}function _t(i,p){if(1&i){const l=t.RV6();t.j41(0,"div",101)(1,"ion-button",102),t.nrm(2,"ion-icon",103),t.EFF(3),t.nI1(4,"t"),t.k0s(),t.j41(5,"ion-button",104),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.saveDraft())}),t.nrm(6,"ion-icon",105),t.EFF(7),t.nI1(8,"t"),t.k0s(),t.j41(9,"ion-button",106),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.discardForm())}),t.nrm(10,"ion-icon",107),t.EFF(11),t.nI1(12,"t"),t.k0s()()}if(2&i){const l=t.XpG();t.R7$(),t.Y8G("disabled",!l.pollutionForm.valid),t.R7$(2),t.SpI(" ",t.bMT(4,4,"Submit Pollution Report")," "),t.R7$(4),t.SpI(" ",t.bMT(8,6,"Save Draft")," "),t.R7$(4),t.SpI(" ",t.bMT(12,8,"Discard")," ")}}function bt(i,p){if(1&i){const l=t.RV6();t.j41(0,"div",108)(1,"ion-button",109),t.bIt("click",function(){s.eBV(l);const o=t.XpG();return s.Njj(o.deleteEntry())}),t.nrm(2,"ion-icon",107),t.EFF(3),t.nI1(4,"t"),t.k0s()()}2&i&&(t.R7$(3),t.SpI(" ",t.bMT(4,1,"Delete Entry")," "))}let Pt=(()=>{var i;class p{forceDeleteDraftFile(e){var o=this;return(0,b.A)(function*(){for(let n=0;n<3;n++)try{yield o.sharedDataService.deleteJsonFile(e),console.log(`Draft file force deleted successfully (attempt ${n+1})`);break}catch(a){if(console.error(`Error force deleting draft file (attempt ${n+1}):`,a),2===n)try{yield o.sharedDataService.writeJsonFile(e,null),console.log("Draft file cleared with null write")}catch(r){console.error("Failed to clear draft file with null write:",r)}yield new Promise(r=>setTimeout(r,100))}})()}constructor(e,o,n,a,r,h,v,f,y,M,F,O,T,$){this.formBuilder=e,this.alertController=o,this.loadingController=n,this.modalController=a,this.router=r,this.route=h,this.popoverController=v,this.auth=f,this.pollutionSyncService=y,this.photoService=M,this.sharedDataService=F,this.entryDeletionService=O,this.siteSyncService=T,this.ts=$,this.progress=0,this.photos=[],this.coordinates=null,this.currentDateTime="",this.currentDateDisplay="",this.currentTimeDisplay="",this.viewMode=!1,this.currentUser=null,this.currentReportId="",this.loadedReport=null,this.gpsFromLocation=!1,this.greyWaterPhoto="",this.trashPhoto="",this.sewagePhoto="",this.autosaveSub=null,this.isDiscarded=!1,this.isSubmitted=!1,this.isSubmitting=!1,this.isEditMode=!1,this.originalSubmittedBy="",this.availableLocations=[{name:"Ramsar",hasZones:!0,hasQuads:!0,zones:["1","2","3","4","5","6"],quads:Array.from({length:30},(U,j)=>`quad${j+1}`),zoneQuadMap:{1:[1,2,3],2:[13,14,15,16,17,18,20,21,22,23,25,27,28,29],3:[19,26],4:[4,5],5:[6,7,11,12,24,30],6:[8,9,10]}},{name:"Grand Anse",hasZones:!0,hasQuads:!0,zones:["1","2","3","4"],quads:Array.from({length:22},(U,j)=>`ga${j+1}`),zoneQuadMap:{1:[1,2,3,4],2:[5,6,7,8,9,10,21,22],3:[11,12,13,14,15,16,17,18],4:[19,20]}},{name:"Caiman",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4","quad5"]},{name:"Canopy",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4"]},{name:"Petit Barbarons",hasZones:!0,hasQuads:!1,zones:["1","2","3","4"],quads:[]},{name:"Kempinski",hasZones:!1,hasQuads:!1,zones:[],quads:[]},{name:"Roche Caiman",hasZones:!1,hasQuads:!1,zones:[],quads:[]}]}ngOnInit(){var e=this;return(0,b.A)(function*(){e.currentUser=e.auth.getCurrentUser(),e.initializeForm(),e.setCurrentDateTime(),yield e.loadDynamicSites();const o=e.route.snapshot.queryParams;"true"===o.viewMode&&o.reportId?yield e.loadReportForViewing(o.reportId):(e.route.queryParams.subscribe(n=>{n.location&&e.pollutionForm.patchValue({location:n.location}),n.zone&&e.pollutionForm.patchValue({zoneNumber:n.zone}),n.quad&&e.pollutionForm.patchValue({quadNumber:n.quad}),n.lat&&n.lng&&(e.coordinates={latitude:parseFloat(n.lat),longitude:parseFloat(n.lng)},e.gpsFromLocation=!0,e.updateProgress())}),"true"!==o.fresh&&(yield e.restoreDraftIfAny(),e.setCurrentDateTime()),e.currentReportId||(e.currentReportId=e.pollutionSyncService.generateReportId()),e.subscribeToFormChanges(),navigator.onLine&&e.pollutionSyncService.processPendingQueue().catch(n=>{console.error("PollutionPage: processPendingQueue failed:",n)}))})()}ngOnDestroy(){this.autosaveSub&&(this.autosaveSub.unsubscribe(),this.autosaveSub=null),!this.isSubmitted&&!this.isDiscarded&&this.saveDraftOnExit().catch(e=>console.error("PollutionPage: saveDraftOnExit failed:",e))}setCurrentDateTime(e){if(this.pollutionForm){const f=this.pollutionForm.get("reportDate")?.value,y=this.pollutionForm.get("observationTime")?.value;if(f&&y){const[M,F,O]=f.split("-"),[T,$]=y.split(":");return this.currentDateDisplay=`${O}/${F}/${M}`,this.currentTimeDisplay=`${T}:${$}`,void(this.currentDateTime=`${this.currentDateDisplay}  \u2022  ${this.currentTimeDisplay}`)}}if(e){const f=this.extractDateTimeFromReportId(e);if(f){this.currentDateTime=f;const y=f.split("  \u2022  ");return void(2===y.length&&(this.currentDateDisplay=y[0],this.currentTimeDisplay=y[1]))}}const o=new Date,n=String(o.getDate()).padStart(2,"0"),a=String(o.getMonth()+1).padStart(2,"0"),r=o.getFullYear(),h=String(o.getHours()).padStart(2,"0"),v=String(o.getMinutes()).padStart(2,"0");this.currentDateDisplay=`${n}/${a}/${r}`,this.currentTimeDisplay=`${h}:${v}`,this.currentDateTime=`${this.currentDateDisplay}  \u2022  ${this.currentTimeDisplay}`}extractDateTimeFromReportId(e){const o=e.match(/(\d{2})(\d{2})(\d{4})_(\d{2})(\d{2})(\d{2})/);if(o){const[,n,a,r,h,v]=o;return`${n}/${a}/${r}  \u2022  ${h}:${v}`}return null}getCurrentDate(){return(new Date).toISOString().split("T")[0]}initializeForm(){const e=this.getCurrentDate(),o=new Date,n=`${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}`;this.pollutionForm=this.formBuilder.group({reportDate:[e,x.k0.required],observationTime:[n],location:["",x.k0.required],zoneNumber:[""],quadNumber:[""],greyWaterDumping:[!1],dumpingTrash:[[]],sewageDischarge:[!1],description:["",x.k0.required],possibleSource:[""],requiresUrgentAction:[!1]}),this.updateProgress()}editLocation(){var e=this;return(0,b.A)(function*(){yield(yield e.alertController.create({header:e.ts.t("Location/Site"),inputs:[{name:"location",type:"text",placeholder:e.ts.t("Enter location"),value:e.pollutionForm.get("location")?.value||""}],buttons:[{text:e.ts.t("Cancel"),role:"cancel"},{text:e.ts.t("Save"),handler:n=>{e.pollutionForm.patchValue({location:n.location})}}]})).present()})()}editZone(){var e=this;return(0,b.A)(function*(){yield(yield e.alertController.create({header:e.ts.t("Zone Number"),inputs:[{name:"zoneNumber",type:"text",placeholder:e.ts.t("Enter zone number"),value:e.pollutionForm.get("zoneNumber")?.value||""}],buttons:[{text:e.ts.t("Cancel"),role:"cancel"},{text:e.ts.t("Save"),handler:n=>{e.pollutionForm.patchValue({zoneNumber:n.zoneNumber})}}]})).present()})()}editQuad(){var e=this;return(0,b.A)(function*(){yield(yield e.alertController.create({header:e.ts.t("Quad Number"),inputs:[{name:"quadNumber",type:"text",placeholder:e.ts.t("Enter quad number"),value:e.pollutionForm.get("quadNumber")?.value||""}],buttons:[{text:e.ts.t("Cancel"),role:"cancel"},{text:e.ts.t("Save"),handler:n=>{e.pollutionForm.patchValue({quadNumber:n.quadNumber})}}]})).present()})()}getZoneName(e){return e?`Zone ${e}`:""}getQuadDisplay(e){if(!e)return"";const o=e.match(/\d+/);return o?o[0]:""}locationHasZones(){const e=this.pollutionForm.get("location")?.value;return!!e&&["Ramsar","Grand Anse","Petit Barbarons"].includes(e)}locationHasQuads(){const e=this.pollutionForm.get("location")?.value;return!!e&&["Ramsar","Grand Anse","Caiman","Canopy"].includes(e)}editLocationAdmin(){var e=this;return(0,b.A)(function*(){if(!e.currentUser||e.currentUser.level<4)return;const o=yield e.selectLocationStep();if(!o)return;const n=e.availableLocations.find(h=>h.name===o);let a="";if(n?.hasZones&&n.zones.length>0){const h=yield e.selectZoneStep(n);if(null===h)return;a=h}let r="";if(n?.hasQuads&&n.quads.length>0){const h=yield e.selectQuadStep(n,a);if(null===h)return;r=h}e.pollutionForm.patchValue({location:o,zoneNumber:a,quadNumber:r}),e.isEditMode&&e.pollutionForm.markAsDirty()})()}selectLocationStep(){var e=this;return new Promise(function(){var o=(0,b.A)(function*(n){const a=e.pollutionForm.get("location")?.value||"",r=e.availableLocations.map(v=>({name:"location",type:"radio",label:v.name,value:v.name,checked:v.name===a}));yield(yield e.alertController.create({header:e.ts.t("Select Location"),cssClass:"location-edit-alert",inputs:r,buttons:[{text:e.ts.t("Cancel"),role:"cancel",handler:()=>n(null)},{text:e.ts.t("Next"),handler:v=>n(v)}]})).present()});return function(n){return o.apply(this,arguments)}}())}selectZoneStep(e){var o=this;return new Promise(function(){var n=(0,b.A)(function*(a){const r=o.pollutionForm.get("zoneNumber")?.value||"",h=e.zones.map(f=>({name:"zone",type:"radio",label:`Zone ${f}`,value:f,checked:f===r}));yield(yield o.alertController.create({header:o.ts.t("Select Zone"),subHeader:e.name,cssClass:"location-edit-alert",inputs:h,buttons:[{text:o.ts.t("Cancel"),role:"cancel",handler:()=>a(null)},{text:o.ts.t("Next"),handler:f=>a(f)}]})).present()});return function(a){return n.apply(this,arguments)}}())}selectQuadStep(e,o){var n=this;return new Promise(function(){var a=(0,b.A)(function*(r){const h=n.pollutionForm.get("quadNumber")?.value||"";let v=e.quads;if(o&&e.zoneQuadMap&&e.zoneQuadMap[o]){const M=e.zoneQuadMap[o];v=e.quads.filter(F=>{const O=parseInt(n.getQuadDisplay(F));return M.includes(O)})}const f=v.map(M=>({name:"quad",type:"radio",label:`Quad ${n.getQuadDisplay(M)}`,value:M,checked:n.getQuadDisplay(M)===h||M===h}));yield(yield n.alertController.create({header:n.ts.t("Select Quad"),subHeader:e.name,cssClass:"location-edit-alert",inputs:f,buttons:[{text:n.ts.t("Cancel"),role:"cancel",handler:()=>r(null)},{text:n.ts.t("Save"),handler:M=>r(M)}]})).present()});return function(r){return a.apply(this,arguments)}}())}loadDynamicSites(){var e=this;return(0,b.A)(function*(){try{(yield e.siteSyncService.getAllSites()).forEach(n=>{e.availableLocations.some(a=>a.name===n.name)||e.availableLocations.push({name:n.name,hasZones:n.zones&&n.zones.length>0||!1,hasQuads:n.sample_points&&n.sample_points.length>0||!1,zones:n.zones?n.zones.map(a=>a.name?.replace("Zone ","")||a.id):[],quads:n.sample_points?n.sample_points.map(a=>a.id||a.label):[]})})}catch(o){console.error("Error loading dynamic sites:",o)}})()}getGPSCoordinates(){var e=this;return(0,b.A)(function*(){try{const o=yield e.loadingController.create({message:e.ts.t("Getting GPS coordinates...")});yield o.present();const n=yield E.L.getCurrentPosition({enableHighAccuracy:!0,timeout:15e3,maximumAge:0});e.coordinates={latitude:n.coords.latitude,longitude:n.coords.longitude},yield e.saveDraftOnExit(),yield o.dismiss(),e.updateProgress(),yield(yield e.alertController.create({header:e.ts.t("GPS Captured"),message:`${e.ts.t("Location")}: ${e.coordinates.latitude.toFixed(6)}, ${e.coordinates.longitude.toFixed(6)}`,buttons:["OK"]})).present()}catch(o){console.error("Error getting GPS coordinates:",o);let n=e.ts.t("Failed to get GPS coordinates. Please ensure location services are enabled and try again.");o instanceof Error&&(o.message.includes("Location services are not enabled")?n=e.ts.t("Location services are disabled. Please enable GPS/location services on your device."):o.message.includes("User denied")?n=e.ts.t("Location permission was denied. Please enable location access for this app in your device settings."):o.message.includes("timeout")&&(n=e.ts.t("GPS signal timeout. Please try again with a clear view of the sky."))),yield(yield e.alertController.create({header:e.ts.t("GPS Error"),message:n,buttons:["OK"]})).present()}})()}capturePhoto(){var e=this;return(0,b.A)(function*(){if(e.photos.length>=5)yield(yield e.alertController.create({header:e.ts.t("Maximum Photos"),message:e.ts.t("You can only add up to 5 photos."),buttons:["OK"]})).present();else try{const o=yield e.photoService.TakePicture();o?(e.photos.push(o),e.updateProgress(),yield e.saveDraftOnExit()):yield(yield e.alertController.create({header:e.ts.t("Photo Error"),message:e.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}catch(o){console.error("Error capturing photo:",o),yield(yield e.alertController.create({header:e.ts.t("Photo Error"),message:e.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}})()}removePhoto(e){this.photos.splice(e,1),this.updateProgress(),this.saveDraftOnExit().catch(o=>console.error("PollutionPage: saveDraftOnExit failed:",o))}captureIndividualPhoto(e){var o=this;return(0,b.A)(function*(){try{const n=yield o.photoService.TakePicture();if(n){switch(e){case"greyWater":o.greyWaterPhoto=n;break;case"trash":o.trashPhoto=n;break;case"sewage":o.sewagePhoto=n}o.updateProgress(),yield o.saveDraftOnExit()}else yield(yield o.alertController.create({header:o.ts.t("Photo Error"),message:o.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}catch(n){console.error("Error capturing photo:",n),yield(yield o.alertController.create({header:o.ts.t("Photo Error"),message:o.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}})()}removeIndividualPhoto(e){switch(e){case"greyWater":this.greyWaterPhoto="";break;case"trash":this.trashPhoto="";break;case"sewage":this.sewagePhoto=""}this.updateProgress(),this.saveDraftOnExit().catch(o=>console.error("PollutionPage: saveDraftOnExit failed:",o))}showGreyWaterInfo(e){var o=this;return(0,b.A)(function*(){yield(yield o.alertController.create({header:o.ts.t("Grey Water"),message:o.ts.t("Grey water is wastewater from household activities such as laundry, dishwashing, and bathing. It may contain traces of soap, detergent, food particles, and other contaminants."),buttons:["OK"]})).present()})()}updateProgress(){const e=this.pollutionForm.value;let o=0,n=2;e.location&&o++,e.description&&o++,this.coordinates&&(o++,n++),this.photos.length>0&&(o++,n++),e.possibleSource&&(o++,n++),this.progress=n>0?o/n:0}subscribeToFormChanges(){this.autosaveSub&&this.autosaveSub.unsubscribe(),this.autosaveSub=this.pollutionForm.valueChanges.pipe((0,G.B)(750)).subscribe(()=>{this.isSubmitted||this.isDiscarded||(this.updateProgress(),this.saveDraftOnExit().catch(e=>console.error("PollutionPage: autosave failed:",e)))})}onSubmit(){var e=this;return(0,b.A)(function*(){if(e.isSubmitting)return;if(e.isSubmitting=!0,e.pollutionForm.markAllAsTouched(),!e.pollutionForm.valid)return e.isSubmitting=!1,void(yield(yield e.alertController.create({header:e.ts.t("Incomplete Form"),message:e.ts.t("Please fill in all required fields (Location, Date, and Description)."),buttons:["OK"]})).present());e.isSubmitted=!0,e.autosaveSub&&(e.autosaveSub.unsubscribe(),e.autosaveSub=null);const o=yield e.loadingController.create({message:e.ts.t("Submitting pollution report...")});yield o.present();try{const n={...e.pollutionForm.value};n.status={incomplete:!1,sent:!0,pending:!1};const a={formValue:n,coordinates:e.coordinates,photos:{general:e.photos,greyWater:e.greyWaterPhoto,trash:e.trashPhoto,sewage:e.sewagePhoto},existingReportId:e.currentReportId||void 0};e.isEditMode&&(a.isEditMode=!0,a.originalSubmittedBy=e.originalSubmittedBy);const r=yield e.pollutionSyncService.submitFinal(a);yield o.dismiss();try{e.autosaveSub&&(e.autosaveSub.unsubscribe(),e.autosaveSub=null),yield new Promise(T=>setTimeout(T,1e3));const f=e.pollutionForm.value;yield e.pollutionSyncService.clearDraft(f);const y=(f?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),M=f?.zoneNumber||"",F=f?.quadNumber||"";let O=`pollution_draft_${y}`;M&&(O+=`_zone${M}`),F&&(O+=`_quad${F}`),yield e.forceDeleteDraftFile(`${O}.json`),e.isSubmitted=!0,console.log("PollutionPage: Draft cleared and form reset successfully")}catch(f){console.error("PollutionPage: Failed to clear draft:",f)}const h=e.ts.t(e.isEditMode?r.queued?"Updated report saved locally and queued for upload when online.":"Pollution report updated successfully!":r.queued?"Pollution report saved locally and queued for upload when online.":"Pollution report submitted successfully!");yield(yield e.alertController.create({header:e.ts.t("Success"),message:h,buttons:[{text:"OK",handler:()=>{e.router.navigate(["/threats"])}}]})).present()}catch(n){yield o.dismiss(),console.error("Error submitting report:",n),yield(yield e.alertController.create({header:e.ts.t("Error"),message:e.ts.t("Failed to submit pollution report. Please try again."),buttons:["OK"]})).present()}})()}discardForm(){var e=this;return(0,b.A)(function*(){const o=yield e.alertController.create({header:e.ts.t("Discard Form"),message:e.ts.t("Are you sure you want to discard this form? All entered data will be lost."),buttons:[{text:e.ts.t("Cancel"),role:"cancel"},{text:e.ts.t("Discard"),role:"destructive"}]});yield o.present();const{role:n}=yield o.onDidDismiss();if("destructive"!==n)return;const a=yield e.loadingController.create({message:e.ts.t("Discarding...")});yield a.present(),e.isDiscarded=!0,e.autosaveSub&&(e.autosaveSub.unsubscribe(),e.autosaveSub=null),yield new Promise(r=>setTimeout(r,1e3));try{const r=e.pollutionForm.value;yield e.pollutionSyncService.clearDraft(r);const h=(r?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),v=r?.zoneNumber||"",f=r?.quadNumber||"";let y=`pollution_draft_${h}`;v&&(y+=`_zone${v}`),f&&(y+=`_quad${f}`),yield e.forceDeleteDraftFile(`${y}.json`)}catch(r){console.error("PollutionPage: Error clearing draft during discard:",r)}yield a.dismiss(),e.initializeForm(),e.router.navigate(["/threats"])})()}restoreDraftIfAny(){var e=this;return(0,b.A)(function*(){const o=e.route.snapshot.queryParams,n={location:o.location||e.pollutionForm.get("location")?.value,zoneNumber:o.zone||e.pollutionForm.get("zoneNumber")?.value,quadNumber:o.quad||e.pollutionForm.get("quadNumber")?.value},a=yield e.pollutionSyncService.loadDraft(n);if(a)try{a.reportId&&(e.currentReportId=a.reportId),a.form&&e.pollutionForm.patchValue(a.form),e.coordinates=a.coordinates||null,e.photos=Array.isArray(a.photos?.general)?a.photos.general:[],e.greyWaterPhoto=a.photos?.greyWater||"",e.trashPhoto=a.photos?.trash||"",e.sewagePhoto=a.photos?.sewage||"",e.updateProgress()}catch(r){console.error("PollutionPage: failed to restore draft:",r)}})()}saveDraft(){var e=this;return(0,b.A)(function*(){if(!e.pollutionForm)return;const o=yield e.alertController.create({header:e.ts.t("Save Draft"),message:e.ts.t("Are you sure you want to save this form as a draft? You can return to complete it later."),buttons:[{text:e.ts.t("Cancel"),role:"cancel"},{text:e.ts.t("Save Draft"),role:"confirm"}]});yield o.present();const{role:n}=yield o.onDidDismiss();if("confirm"!==n)return;const a=yield e.loadingController.create({message:e.ts.t("Saving draft...")});yield a.present();try{yield e.saveDraftOnExit(),yield a.dismiss();const r=yield e.alertController.create({header:e.ts.t("Draft Saved"),message:e.ts.t("Your form has been saved as a draft. You can access it from the threats page."),buttons:[{text:"OK",role:"confirm"}]});yield r.present(),yield r.onDidDismiss(),e.router.navigate(["/threats"])}catch(r){yield a.dismiss(),console.error("Failed to save draft:",r),yield(yield e.alertController.create({header:e.ts.t("Save Failed"),message:e.ts.t("Failed to save the draft. Please try again."),buttons:["OK"]})).present()}})()}saveDraftOnExit(){var e=this;return(0,b.A)(function*(){if(!e.pollutionForm||e.viewMode||e.isDiscarded||e.isSubmitted)return;const o=e.pollutionForm.value;(o?.location||o?.description||e.coordinates||e.photos&&e.photos.length>0||e.greyWaterPhoto||e.trashPhoto||e.sewagePhoto)&&(yield e.pollutionSyncService.saveDraft({reportId:e.currentReportId,form:o,coordinates:e.coordinates,photos:{general:e.photos,greyWater:e.greyWaterPhoto||null,trash:e.trashPhoto||null,sewage:e.sewagePhoto||null}}))})()}setViewMode(e){this.viewMode=e,e?(this.pollutionForm.disable(),this.enableToggleAndCheckboxControls()):this.pollutionForm.enable()}enableEditMode(){!this.currentUser||this.currentUser.level<4||(this.isEditMode=!0,this.viewMode=!1,this.pollutionForm.enable(),this.originalSubmittedBy=this.loadedReport?.submittedBy||"")}getEditedDateTime(){if(!this.loadedReport)return null;let e=this.loadedReport.editedAt||null;if(!e){const f=this.loadedReport.updatedAt,y=this.loadedReport.createdAt;f&&y&&f!==y&&Math.abs(new Date(f).getTime()-new Date(y).getTime())>5e3&&(e=f)}if(!e)return null;const o=new Date(e);return isNaN(o.getTime())?null:`${o.getDate().toString().padStart(2,"0")}/${(o.getMonth()+1).toString().padStart(2,"0")}/${o.getFullYear()} ${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`}onDateChanged(e){const o=e.target;o.value&&(this.pollutionForm.get("reportDate")?.setValue(o.value),this.setCurrentDateTime())}onTimeChanged(e){const o=e.target;o.value&&(this.pollutionForm.get("observationTime")?.setValue(o.value),this.setCurrentDateTime())}enableToggleAndCheckboxControls(){this.pollutionForm.get("greyWaterDumping")?.enable(),this.pollutionForm.get("sewageDischarge")?.enable(),this.pollutionForm.get("requiresUrgentAction")?.enable()}loadReportForViewing(e){var o=this;return(0,b.A)(function*(){try{const n=yield o.pollutionSyncService.getAllReports();console.log("PollutionPage: All reports:",n);const a=n.find(h=>h.report.reportId===e);if(!a)return console.error("PollutionPage: Report not found for viewing:",e),yield(yield o.alertController.create({header:o.ts.t("Report Not Found"),message:o.ts.t("The requested report could not be found."),buttons:["OK"]})).present(),void o.router.navigate(["/threats"]);const r=a.report;console.log("PollutionPage: Loading report for viewing:",r),o.loadedReport=r,o.pollutionForm.patchValue({reportDate:r.form.reportDate||r.form.date||"",observationTime:r.form.observationTime||"",location:r.form.location||"",zoneNumber:r.form.zoneNumber||"",quadNumber:r.form.quadNumber||"",greyWaterDumping:r.form.greyWaterDumping||!1,dumpingTrash:r.form.dumpingTrash||[],sewageDischarge:r.form.sewageDischarge||!1,description:r.form.description||"",possibleSource:r.form.possibleSource||"",requiresUrgentAction:r.form.requiresUrgentAction||!1}),r.coordinates&&(o.coordinates=r.coordinates),r.photos&&(r.photos.general&&Array.isArray(r.photos.general)&&(o.photos=r.photos.general.map(h=>(h.startsWith("data:image/")||console.warn("\u26a0\ufe0f PollutionPage: General photo is not base64:",h.substring(0,50)),h))),r.photos.greyWater&&(r.photos.greyWater.startsWith("data:image/")||console.warn("\u26a0\ufe0f PollutionPage: GreyWater photo is not base64:",r.photos.greyWater.substring(0,50)),o.greyWaterPhoto=r.photos.greyWater),r.photos.trash&&(r.photos.trash.startsWith("data:image/")||console.warn("\u26a0\ufe0f PollutionPage: Trash photo is not base64:",r.photos.trash.substring(0,50)),o.trashPhoto=r.photos.trash),r.photos.sewage&&(r.photos.sewage.startsWith("data:image/")||console.warn("\u26a0\ufe0f PollutionPage: Sewage photo is not base64:",r.photos.sewage.substring(0,50)),o.sewagePhoto=r.photos.sewage)),o.currentReportId=e,o.setCurrentDateTime(e),o.updateProgress(),o.setViewMode(!0)}catch(n){console.error("PollutionPage: Error loading report for viewing:",n),yield(yield o.alertController.create({header:o.ts.t("Error"),message:o.ts.t("Failed to load the report."),buttons:["OK"]})).present(),o.router.navigate(["/threats"])}})()}deleteEntry(){var e=this;return(0,b.A)(function*(){const o=e.auth.getCurrentUser();var a;!o||o.level<4?yield(yield e.alertController.create({header:e.ts.t("Permission Denied"),message:e.ts.t("Only Level 4 users can delete entries."),buttons:["OK"]})).present():yield(yield e.alertController.create({header:e.ts.t("Delete Entry"),message:e.ts.t("Are you sure you want to permanently delete this entry? This will remove it from the database and back it up to deleted files storage. This action cannot be undone."),buttons:[{text:e.ts.t("Cancel"),role:"cancel"},{text:e.ts.t("Delete"),role:"destructive",handler:(a=(0,b.A)(function*(){yield e.performDeletion()}),function(){return a.apply(this,arguments)})}]})).present()})()}performDeletion(){var e=this;return(0,b.A)(function*(){const o=yield e.loadingController.create({message:e.ts.t("Deleting entry...")});yield o.present();try{const n=e.auth.getCurrentUser();yield e.entryDeletionService.deleteEntry({reportId:e.currentReportId,formType:"pollution",tableName:"pollution_reports",deletedBy:n?.username||"Unknown",deletedByEmail:n?.email||"",originalSubmittedBy:e.loadedReport?.submittedBy,originalSubmittedAt:e.loadedReport?.createdAt}),yield o.dismiss(),yield(yield e.alertController.create({header:e.ts.t("Success"),message:e.ts.t("Entry has been deleted and backed up successfully."),buttons:[{text:"OK",handler:()=>{e.router.navigate(["/threats"])}}]})).present()}catch(n){yield o.dismiss(),console.error("Error deleting entry:",n),yield(yield e.alertController.create({header:e.ts.t("Error"),message:e.ts.t("Failed to delete entry. Please try again."),buttons:["OK"]})).present()}})()}openFullScreenPhoto(e,o){var n=this;return(0,b.A)(function*(){yield(yield n.modalController.create({component:vt,componentProps:{photoUrl:e,photoType:o},cssClass:"fullscreen-photo-modal"})).present()})()}static#t=i=()=>(this.\u0275fac=function(o){return new(o||p)(t.rXU(x.ok),t.rXU(g.hG),t.rXU(g.Xi),t.rXU(g.W3),t.rXU(I.Ix),t.rXU(I.nX),t.rXU(g.IE),t.rXU(c.N),t.rXU(m.T),t.rXU(d.I),t.rXU(u.H),t.rXU(P.C),t.rXU(k.k),t.rXU(w.L))},this.\u0275cmp=t.VBU({type:p,selectors:[["app-pollution"]],standalone:!1,decls:174,vars:139,consts:[["dateInput",""],["timeInput",""],[1,"coral"],["slot","start"],["defaultHref","/threats"],[1,"coral","compact-toolbar"],[1,"date-time-text"],["style","cursor: pointer;",3,"click",4,"ngIf"],[4,"ngIf"],["type","date",2,"position","absolute","opacity","0","width","0","height","0","pointer-events","none",3,"change","value"],["type","time",2,"position","absolute","opacity","0","width","0","height","0","pointer-events","none",3,"change","value"],[1,"coral","metadata-toolbar"],[1,"metadata-container"],[1,"metadata-item",3,"click"],["name","location",1,"metadata-icon"],[1,"metadata-label"],["name","alert-circle","class","status-icon required",4,"ngIf"],["class","metadata-item",3,"click",4,"ngIf"],["class","edit-location-link",3,"click",4,"ngIf"],["style","padding: 0 16px; font-size: 0.75rem; color: #e76f51;",4,"ngIf"],["color","light",3,"value"],[1,"progress-text"],[3,"ngSubmit","formGroup"],["class","edit-mode-banner",4,"ngIf"],["class","edit-mode-banner editing",4,"ngIf"],[1,"gps-card"],["lines","none",1,"gps-item",3,"click","button"],["slot","start",1,"gps-icon-container"],["name","navigate",3,"color"],[1,"gps-title"],["class","gps-hint",4,"ngIf"],["class","coordinates-text",4,"ngIf"],["class","gps-source-hint",4,"ngIf"],[1,"disturbance-item"],[1,"disturbance-title"],["name","information-circle-outline",1,"info-icon",3,"click"],["lines","none",1,"toggle-item"],[1,"toggle-labels"],[1,"toggle-no",3,"hidden"],["formControlName","greyWaterDumping",1,"coastal-toggle"],[1,"toggle-yes",3,"hidden"],[1,"inline-photo-section"],["size","small","class","coastal-button",3,"click",4,"ngIf"],["class","photo-preview-only",4,"ngIf"],["formControlName","sewageDischarge",1,"coastal-toggle"],["position","stacked"],["formControlName","dumpingTrash","multiple","true","interface","popover",3,"placeholder"],["value","plastics"],["value","metal"],["value","glass"],["value","fabric"],["value","paper_cardboard"],["value","home_appliance"],["value","construction_debris"],["value","furniture"],[1,"inline-photo-section","centered"],[1,"photos-container"],["class","photo-item",4,"ngFor","ngForOf"],["expand","block","fill","outline","class","add-photo-button",3,"click",4,"ngIf"],[2,"position","relative"],["formControlName","description","rows","6",3,"placeholder"],["name","close-circle","color","danger","style","position: absolute; top: 12px; right: 10px;",4,"ngIf"],["name","checkmark-circle","style","position: absolute; top: 12px; right: 10px; color: #52a676;",4,"ngIf"],["formControlName","possibleSource","type","text",3,"placeholder"],["lines","none"],["formControlName","requiresUrgentAction","slot","start"],["class","form-buttons",4,"ngIf"],["class","button-container",4,"ngIf"],[2,"cursor","pointer",3,"click"],["name","alert-circle",1,"status-icon","required"],["name","grid",1,"metadata-icon"],["name","apps",1,"metadata-icon"],[1,"edit-location-link",3,"click"],[2,"padding","0 16px","font-size","0.75rem","color","#e76f51"],[1,"edit-mode-banner"],["expand","block","color","warning",3,"click"],["name","create-outline","slot","start"],[1,"edit-mode-banner","editing"],["name","create-outline"],[1,"gps-hint"],["name","location","size","small"],[1,"coordinates-text"],["name","pin","size","small"],[1,"gps-source-hint"],["name","information-circle","size","small"],["size","small",1,"coastal-button",3,"click"],["name","camera","slot","start"],[1,"photo-preview-only"],[1,"photo-wrapper"],["alt","Grey water photo",2,"cursor","pointer",3,"click","src"],[1,"click-hint"],["size","small","color","danger",3,"click",4,"ngIf"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"],["alt","Sewage photo",2,"cursor","pointer",3,"click","src"],["alt","Trash photo",2,"cursor","pointer",3,"click","src"],[1,"photo-item"],[2,"cursor","pointer",3,"click","src","alt"],["expand","block","fill","outline",1,"add-photo-button",3,"click"],["name","close-circle","color","danger",2,"position","absolute","top","12px","right","10px"],["name","checkmark-circle",2,"position","absolute","top","12px","right","10px","color","#52a676"],[1,"form-buttons"],["expand","block","type","submit",1,"submit-button",3,"disabled"],["name","checkmark-circle","slot","start"],["expand","block","fill","outline","color","medium",1,"save-draft-button",3,"click"],["name","save-outline","slot","start"],["expand","block","fill","outline",1,"discard-button",3,"click"],["name","trash-outline","slot","start"],[1,"button-container"],["expand","block","color","danger",1,"delete-button",3,"click"]],template:function(o,n){if(1&o){const a=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3),t.nrm(3,"ion-back-button",4),t.k0s(),t.j41(4,"ion-title"),t.EFF(5),t.nI1(6,"t"),t.k0s()(),t.j41(7,"ion-toolbar",5)(8,"ion-text",6),t.DNE(9,W,2,1,"span",7)(10,X,2,1,"span",8),t.EFF(11," \xa0 \u2022 \xa0 "),t.DNE(12,S,2,1,"span",7)(13,z,2,1,"span",8),t.j41(14,"input",9,0),t.bIt("change",function(h){return s.eBV(a),s.Njj(n.onDateChanged(h))}),t.k0s(),t.j41(16,"input",10,1),t.bIt("change",function(h){return s.eBV(a),s.Njj(n.onTimeChanged(h))}),t.k0s(),t.DNE(18,B,2,1,"span",8),t.k0s()(),t.j41(19,"ion-toolbar",11)(20,"div",12)(21,"div",13),t.bIt("click",function(){return s.eBV(a),s.Njj(!n.viewMode&&n.editLocation())}),t.nrm(22,"ion-icon",14),t.j41(23,"span",15),t.EFF(24),t.nI1(25,"t"),t.k0s(),t.DNE(26,A,1,0,"ion-icon",16),t.k0s(),t.DNE(27,V,4,1,"div",17)(28,q,4,1,"div",17)(29,J,3,3,"span",18),t.k0s(),t.DNE(30,Q,3,3,"ion-error",19),t.k0s(),t.j41(31,"ion-toolbar",5),t.nrm(32,"ion-progress-bar",20),t.j41(33,"ion-text",21),t.EFF(34),t.nI1(35,"t"),t.k0s()()(),t.j41(36,"ion-content")(37,"form",22),t.bIt("ngSubmit",function(){return s.eBV(a),s.Njj(n.onSubmit())}),t.DNE(38,K,5,3,"div",23)(39,Z,5,3,"div",24),t.j41(40,"ion-card",25)(41,"ion-card-header",2)(42,"ion-card-title"),t.EFF(43),t.nI1(44,"t"),t.k0s()(),t.j41(45,"ion-card-content")(46,"ion-item",26),t.bIt("click",function(){return s.eBV(a),s.Njj(!n.viewMode&&n.getGPSCoordinates())}),t.j41(47,"div",27),t.nrm(48,"ion-icon",28),t.k0s(),t.j41(49,"ion-label")(50,"h3",29),t.EFF(51),t.nI1(52,"t"),t.nI1(53,"t"),t.nI1(54,"t"),t.k0s(),t.DNE(55,H,4,3,"p",30)(56,tt,3,2,"p",31)(57,et,4,3,"p",32),t.k0s()()()(),t.j41(58,"ion-card")(59,"ion-card-header",2)(60,"ion-card-title"),t.EFF(61),t.nI1(62,"t"),t.k0s()(),t.j41(63,"ion-card-content")(64,"div",33)(65,"div",34),t.EFF(66),t.nI1(67,"t"),t.j41(68,"ion-icon",35),t.bIt("click",function(h){return s.eBV(a),s.Njj(n.showGreyWaterInfo(h))}),t.k0s()(),t.j41(69,"ion-item",36)(70,"div",37)(71,"span",38),t.EFF(72),t.nI1(73,"t"),t.k0s(),t.nrm(74,"ion-toggle",39),t.j41(75,"span",40),t.EFF(76),t.nI1(77,"t"),t.k0s()(),t.j41(78,"div",41),t.DNE(79,ot,4,3,"ion-button",42),t.k0s()(),t.DNE(80,it,7,5,"div",43),t.k0s(),t.nrm(81,"ion-item-divider"),t.j41(82,"div",33)(83,"div",34),t.EFF(84),t.nI1(85,"t"),t.k0s(),t.j41(86,"ion-item",36)(87,"div",37)(88,"span",38),t.EFF(89),t.nI1(90,"t"),t.k0s(),t.nrm(91,"ion-toggle",44),t.j41(92,"span",40),t.EFF(93),t.nI1(94,"t"),t.k0s()(),t.j41(95,"div",41),t.DNE(96,rt,4,3,"ion-button",42),t.k0s()(),t.DNE(97,lt,7,5,"div",43),t.k0s(),t.nrm(98,"ion-item-divider"),t.j41(99,"div",33)(100,"div",34),t.EFF(101),t.nI1(102,"t"),t.k0s(),t.j41(103,"ion-item"),t.nrm(104,"ion-label",45),t.j41(105,"ion-select",46),t.nI1(106,"t"),t.j41(107,"ion-select-option",47),t.EFF(108),t.nI1(109,"t"),t.k0s(),t.j41(110,"ion-select-option",48),t.EFF(111),t.nI1(112,"t"),t.k0s(),t.j41(113,"ion-select-option",49),t.EFF(114),t.nI1(115,"t"),t.k0s(),t.j41(116,"ion-select-option",50),t.EFF(117),t.nI1(118,"t"),t.k0s(),t.j41(119,"ion-select-option",51),t.EFF(120),t.nI1(121,"t"),t.k0s(),t.j41(122,"ion-select-option",52),t.EFF(123),t.nI1(124,"t"),t.k0s(),t.j41(125,"ion-select-option",53),t.EFF(126),t.nI1(127,"t"),t.k0s(),t.j41(128,"ion-select-option",54),t.EFF(129),t.nI1(130,"t"),t.k0s()()(),t.j41(131,"div",55),t.DNE(132,st,4,3,"ion-button",42),t.k0s(),t.DNE(133,dt,7,5,"div",43),t.k0s()()(),t.j41(134,"ion-card")(135,"ion-card-header",2)(136,"ion-card-title"),t.EFF(137),t.nI1(138,"t"),t.k0s(),t.j41(139,"ion-card-subtitle"),t.EFF(140),t.nI1(141,"t"),t.k0s()(),t.j41(142,"ion-card-content")(143,"div",56),t.DNE(144,pt,7,7,"div",57)(145,gt,4,4,"ion-button",58),t.k0s()()(),t.j41(146,"ion-card")(147,"ion-card-header",2)(148,"ion-card-title"),t.EFF(149),t.nI1(150,"t"),t.k0s()(),t.j41(151,"ion-card-content")(152,"ion-item",59)(153,"ion-label",45),t.EFF(154),t.nI1(155,"t"),t.k0s(),t.nrm(156,"ion-textarea",60),t.nI1(157,"t"),t.DNE(158,mt,1,0,"ion-icon",61)(159,ht,1,0,"ion-icon",62)(160,ft,3,3,"ion-error",8),t.k0s(),t.j41(161,"ion-item")(162,"ion-label",45),t.EFF(163),t.nI1(164,"t"),t.k0s(),t.nrm(165,"ion-input",63),t.nI1(166,"t"),t.k0s(),t.j41(167,"ion-item",64),t.nrm(168,"ion-checkbox",65),t.j41(169,"ion-label"),t.EFF(170),t.nI1(171,"t"),t.k0s()()()(),t.DNE(172,_t,13,10,"div",66)(173,bt,5,3,"div",67),t.k0s()()}if(2&o){let a,r,h,v,f,y,M,F,O,T,$,U,j,Y;t.R7$(5),t.JRh(t.bMT(6,75,"Pollution Report")),t.R7$(4),t.Y8G("ngIf",(null==n.currentUser?null:n.currentUser.level)>=4&&!n.viewMode),t.R7$(),t.Y8G("ngIf",!((null==n.currentUser?null:n.currentUser.level)>=4&&!n.viewMode)),t.R7$(2),t.Y8G("ngIf",(null==n.currentUser?null:n.currentUser.level)>=4&&!n.viewMode),t.R7$(),t.Y8G("ngIf",!((null==n.currentUser?null:n.currentUser.level)>=4&&!n.viewMode)),t.R7$(),t.Y8G("value",null==(a=n.pollutionForm.get("reportDate"))?null:a.value),t.R7$(2),t.Y8G("value",null==(r=n.pollutionForm.get("observationTime"))?null:r.value),t.R7$(2),t.Y8G("ngIf",(n.viewMode||n.isEditMode)&&n.getEditedDateTime()),t.R7$(6),t.JRh((null==(h=n.pollutionForm.get("location"))?null:h.value)||t.bMT(25,77,"Add location")),t.R7$(2),t.Y8G("ngIf",!(null!=(v=n.pollutionForm.get("location"))&&v.value||n.viewMode)),t.R7$(),t.Y8G("ngIf",(null==(f=n.pollutionForm.get("zoneNumber"))?null:f.value)&&n.locationHasZones()),t.R7$(),t.Y8G("ngIf",(null==(y=n.pollutionForm.get("quadNumber"))?null:y.value)&&n.locationHasQuads()),t.R7$(),t.Y8G("ngIf",n.isEditMode&&n.currentUser&&n.currentUser.level>=4),t.R7$(),t.Y8G("ngIf",(null==(M=n.pollutionForm.get("location"))?null:M.hasError("required"))&&(null==(M=n.pollutionForm.get("location"))?null:M.touched)),t.R7$(2),t.Y8G("value",n.progress),t.R7$(2),t.Lme(" ",(100*n.progress).toFixed(0),"% ",t.bMT(35,79,"Complete")," "),t.R7$(2),t.AVh("view-mode",n.viewMode),t.R7$(),t.Y8G("formGroup",n.pollutionForm),t.R7$(),t.Y8G("ngIf",n.viewMode&&n.currentUser&&n.currentUser.level>=4),t.R7$(),t.Y8G("ngIf",n.isEditMode),t.R7$(4),t.JRh(t.bMT(44,81,"GPS Coordinates")),t.R7$(3),t.AVh("gps-captured",n.coordinates),t.Y8G("button",!n.viewMode),t.R7$(2),t.Y8G("color",n.coordinates?"success":"medium"),t.R7$(3),t.SpI(" ",n.coordinates?n.gpsFromLocation?t.bMT(52,83,"GPS Location from New Site"):t.bMT(53,85,"GPS Location Captured"):t.bMT(54,87,"Capture GPS Location")," "),t.R7$(4),t.Y8G("ngIf",!n.coordinates),t.R7$(),t.Y8G("ngIf",n.coordinates),t.R7$(),t.Y8G("ngIf",n.coordinates&&n.gpsFromLocation),t.R7$(4),t.JRh(t.bMT(62,89,"Pollution Types")),t.R7$(5),t.SpI(" ",t.bMT(67,91,"Grey water dumping")," "),t.R7$(5),t.Y8G("hidden",null==(F=n.pollutionForm.get("greyWaterDumping"))?null:F.value),t.R7$(),t.JRh(t.bMT(73,93,"No")),t.R7$(3),t.Y8G("hidden",!(null!=(O=n.pollutionForm.get("greyWaterDumping"))&&O.value)),t.R7$(),t.JRh(t.bMT(77,95,"Yes")),t.R7$(3),t.Y8G("ngIf",!n.viewMode),t.R7$(),t.Y8G("ngIf",n.greyWaterPhoto),t.R7$(4),t.JRh(t.bMT(85,97,"Sewage discharge")),t.R7$(4),t.Y8G("hidden",null==(T=n.pollutionForm.get("sewageDischarge"))?null:T.value),t.R7$(),t.JRh(t.bMT(90,99,"No")),t.R7$(3),t.Y8G("hidden",!(null!=($=n.pollutionForm.get("sewageDischarge"))&&$.value)),t.R7$(),t.JRh(t.bMT(94,101,"Yes")),t.R7$(3),t.Y8G("ngIf",!n.viewMode),t.R7$(),t.Y8G("ngIf",n.sewagePhoto),t.R7$(4),t.JRh(t.bMT(102,103,"Dumping of Trash")),t.R7$(4),t.Y8G("placeholder",t.bMT(106,105,"Select type(s)")),t.R7$(3),t.JRh(t.bMT(109,107,"Plastics")),t.R7$(3),t.JRh(t.bMT(112,109,"Metal")),t.R7$(3),t.JRh(t.bMT(115,111,"Glass")),t.R7$(3),t.JRh(t.bMT(118,113,"Fabric")),t.R7$(3),t.JRh(t.bMT(121,115,"Paper/Cardboard")),t.R7$(3),t.JRh(t.bMT(124,117,"Home appliance/electronics")),t.R7$(3),t.JRh(t.bMT(127,119,"Construction debris")),t.R7$(3),t.JRh(t.bMT(130,121,"Furniture")),t.R7$(3),t.Y8G("ngIf",!n.viewMode),t.R7$(),t.Y8G("ngIf",n.trashPhoto),t.R7$(4),t.JRh(t.bMT(138,123,"Photo Evidence")),t.R7$(3),t.JRh(t.bMT(141,125,"Take photos of the pollution (up to 5 photos)")),t.R7$(4),t.Y8G("ngForOf",n.photos),t.R7$(),t.Y8G("ngIf",n.photos.length<5&&!n.viewMode),t.R7$(4),t.JRh(t.bMT(150,127,"Detailed Description")),t.R7$(5),t.JRh(t.bMT(155,129,"Description")),t.R7$(2),t.Y8G("placeholder",t.bMT(157,131,"Provide a detailed description of the pollution observed, including any potential sources, visible impacts on wildlife or vegetation, and any other relevant information.")),t.R7$(2),t.Y8G("ngIf",!(null!=(U=n.pollutionForm.get("description"))&&U.value)),t.R7$(),t.Y8G("ngIf",null==(j=n.pollutionForm.get("description"))?null:j.value),t.R7$(),t.Y8G("ngIf",(null==(Y=n.pollutionForm.get("description"))?null:Y.hasError("required"))&&(null==(Y=n.pollutionForm.get("description"))?null:Y.touched)),t.R7$(3),t.JRh(t.bMT(164,133,"Possible Source (if known)")),t.R7$(2),t.Y8G("placeholder",t.bMT(166,135,"Enter possible pollution source")),t.R7$(2),t.AVh("view-mode-item",n.viewMode),t.R7$(3),t.JRh(t.bMT(171,137,"This requires urgent action")),t.R7$(2),t.Y8G("ngIf",!n.viewMode),t.R7$(),t.Y8G("ngIf",n.viewMode&&(null==n.currentUser?null:n.currentUser.level)>=4)}},dependencies:[C.Sq,C.bT,x.qT,x.BC,x.cb,x.j4,x.JD,g.Jm,g.QW,g.b_,g.I9,g.ME,g.HW,g.tN,g.eY,g.W9,g.eU,g.iq,g.$w,g.uz,g.Dg,g.he,g.FH,g.Nm,g.Ip,g.IO,g.nc,g.BC,g.BY,g.ai,g.hB,g.Je,g.Gw,g.el,D.D],styles:[".coral[_ngcontent-%COMP%]{--background: #e76f51;color:#fff}.coral[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]{--color: white;transition:transform .2s}.coral[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]:hover{transform:translate(-4px)}.coral[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);width:100%;pointer-events:none}.coral.compact-toolbar[_ngcontent-%COMP%]{--min-height: 28px;--padding-top: 5px;--padding-bottom: 5px}.edit-mode-banner[_ngcontent-%COMP%]{padding:.75rem 1rem;margin:.5rem;border-radius:.5rem}.edit-mode-banner[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: .5rem;font-weight:600}.edit-mode-banner.editing[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;display:flex;align-items:center;gap:.5rem;color:#856404;font-weight:500}.edit-mode-banner.editing[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.date-time-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fffffff2;font-size:14px;padding:0;margin:3px 0;font-weight:400;letter-spacing:.3px;line-height:1.2}.metadata-toolbar[_ngcontent-%COMP%]{--min-height: 40px;--padding-top: 6px;--padding-bottom: 6px}.metadata-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px;padding:0 12px;flex-wrap:wrap}.metadata-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;background:#ffffff26;border-radius:16px;padding:5px 10px;cursor:pointer;transition:all .2s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2)}.metadata-item[_ngcontent-%COMP%]:active{transform:scale(.95);background:#ffffff40}.metadata-icon[_ngcontent-%COMP%]{font-size:14px;color:#ffffffe6;min-width:14px}.metadata-label[_ngcontent-%COMP%]{color:#fff;font-size:12px;font-weight:500;letter-spacing:.2px;white-space:nowrap;max-width:120px;overflow:hidden;text-overflow:ellipsis}.edit-location-link[_ngcontent-%COMP%]{color:#ffffffe6;font-size:11px;text-decoration:underline;cursor:pointer;margin-left:8px;padding:4px 8px}.edit-location-link[_ngcontent-%COMP%]:active{opacity:.7}.status-icon[_ngcontent-%COMP%]{font-size:14px;margin-left:2px}.status-icon.success[_ngcontent-%COMP%]{color:#52a676}.status-icon.required[_ngcontent-%COMP%]{color:#ffd93d;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.6}}.progress-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fff;font-size:13px;padding:0;margin:0 0 4px;font-weight:400;line-height:1}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 2px 8px #0000001a}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0;padding:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#fff}@media (min-width: 400px) and (max-width: 800px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem}}@media (max-width: 399px) and (max-width: 360px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.1rem}}@media (max-width: 359px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:.95rem}}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#ffffffe6;font-size:.875rem;margin-top:4px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{background:#fff;padding:16px}.gps-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 2px 8px #0000001a;overflow:hidden}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;--background: #f8f9fa;--border-radius: 8px;margin:0;border-radius:8px;transition:all .2s ease}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]:hover:not(.item-disabled){--background: #e9ecef;transform:translateY(-1px);box-shadow:0 4px 12px #0000001a}.gps-card[_ngcontent-%COMP%]   .gps-item.gps-captured[_ngcontent-%COMP%]{--background: #e8f5e9;border:1px solid #4caf50}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-icon-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;background:#ffffffe6;margin:12px;box-shadow:0 2px 4px #0000001a}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-icon-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:#333;margin-bottom:4px}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-hint[_ngcontent-%COMP%]{display:flex;align-items:center;color:#666;font-size:.9rem}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-hint[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:#999}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .coordinates-text[_ngcontent-%COMP%]{display:flex;align-items:center;color:#e76f51!important;font-weight:600;font-family:SF Mono,Monaco,Inconsolata,Roboto Mono,monospace;font-size:.9rem}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .coordinates-text[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:#e76f51}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-source-hint[_ngcontent-%COMP%]{display:flex;align-items:center;color:#666;font-size:.8rem;font-style:italic;margin-top:4px}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-source-hint[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:#999}.coordinates-text[_ngcontent-%COMP%]{color:#e76f51!important;font-weight:600;font-family:monospace}.photos-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.photo-item[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:12px;padding:12px;background:#f9f9f9;border-radius:8px;border-left:4px solid #e76f51}.photo-item[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px}.photo-item[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:120px;object-fit:cover;border-radius:8px;border:2px solid #e76f51;transition:transform .2s ease,box-shadow .2s ease;touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.photo-item[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #e76f5166}.photo-item[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:active{transform:scale(.98)}.photo-item[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   .click-hint[_ngcontent-%COMP%]{font-size:10px;color:#999;font-style:italic;text-align:center;white-space:nowrap}.photo-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: #dc2626;--background-hover: #b91c1c;--background-activated: #b91c1c}.add-photo-button[_ngcontent-%COMP%]{--border-color: #e76f51;--color: #e76f51;margin-top:8px}.add-photo-button[_ngcontent-%COMP%]:hover{--background: rgba(231, 111, 81, .1)}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;margin-bottom:12px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;color:#0d3d2f;margin:0}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6b7c7a;font-size:.875rem;margin:4px 0 0}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px;border:1px solid #ddd;border-radius:8px;margin-top:4px}ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{--padding-top: 12px;--padding-bottom: 12px}ion-item[button][_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s}ion-item[button][_ngcontent-%COMP%]:hover{--background: rgba(231, 111, 81, .05)}ion-select[_ngcontent-%COMP%]{width:100%}  ion-popover.select-popover{--width: auto;--min-width: 250px;--max-width: 90vw}  ion-popover.select-popover .popover-content{border-radius:12px;box-shadow:0 4px 16px #00000026}  ion-popover.select-popover ion-list{padding:8px 0}  ion-popover.select-popover ion-item{--padding-start: 16px;--padding-end: 16px;--min-height: 44px;font-size:.95rem}  ion-popover.select-popover ion-checkbox{--size: 20px;margin-right:12px;--checkbox-background-checked: #4fb3bf !important;--border-color-checked: #4fb3bf !important;--border-color: #4fb3bf !important;--color-checked: #4fb3bf !important;--checkmark-color: white !important;--background: white !important}  ion-popover.select-popover ion-item.item-checkbox-checked{--color: #4fb3bf}  ion-popover.select-popover ion-item.item-checkbox-checked ion-label{color:#4fb3bf!important;font-weight:500}ion-checkbox[_ngcontent-%COMP%]{--size: 24px;--checkbox-background-checked: #e76f51;--border-color-checked: #e76f51}ion-item-divider[_ngcontent-%COMP%]{--padding-top: 4px;--padding-bottom: 4px;min-height:0;margin:8px 0}.disturbance-item[_ngcontent-%COMP%]{padding:12px 0 0}.disturbance-item[_ngcontent-%COMP%]:not(:last-child){margin-bottom:0}.disturbance-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#0d3d2f;margin-bottom:12px;display:flex;align-items:center;gap:8px}@media (max-width: 359px){.disturbance-title[_ngcontent-%COMP%]{font-size:.85rem;font-weight:700}}.info-icon[_ngcontent-%COMP%]{font-size:1.2rem;color:#e76f51;cursor:pointer}.info-icon[_ngcontent-%COMP%]:hover{color:#d65d43}.inline-photo-section[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:16px;margin-top:12px;margin-bottom:8px}.toggle-item[_ngcontent-%COMP%]   .inline-photo-section[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.inline-photo-section.centered[_ngcontent-%COMP%]{justify-content:center;margin-left:0}.photo-preview-only[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;margin-top:8px;background:#f9f9f9;border-radius:8px;border-left:4px solid #52a676}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;object-fit:cover;border-radius:8px;border:2px solid #52a676;transition:transform .2s ease,box-shadow .2s ease;touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #2d865966}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:active{transform:scale(.98)}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   .click-hint[_ngcontent-%COMP%]{font-size:10px;color:#999;font-style:italic;text-align:center;white-space:nowrap}.coastal-button[_ngcontent-%COMP%]{--background: #4fb3bf;--background-hover: #3a9aa5;--background-activated: #3a9aa5;--color: white;--border-radius: 8px;font-weight:600;text-transform:none;letter-spacing:.3px;margin-left:20px;margin-right:5px}.coastal-button[_ngcontent-%COMP%]:hover{--background: #3a9aa5}.centered[_ngcontent-%COMP%]   .coastal-button[_ngcontent-%COMP%]{margin-left:0}.toggle-item[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;--inner-padding-end: 0;margin-bottom:0;display:flex;align-items:center;justify-content:space-between;gap:16px}.toggle-labels[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0px;position:relative}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[_ngcontent-%COMP%], .toggle-labels[_ngcontent-%COMP%]   .toggle-yes[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;min-width:35px;width:35px;text-align:center;flex-shrink:0}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[_ngcontent-%COMP%]{color:#888;visibility:visible}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[_ngcontent-%COMP%]:not(:last-child){margin-right:5px}.toggle-labels[_ngcontent-%COMP%]   .toggle-yes[_ngcontent-%COMP%]{color:#52a676;visibility:visible}.toggle-labels[_ngcontent-%COMP%]   .toggle-yes[_ngcontent-%COMP%]:not(:first-child){margin-left:5px}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[hidden][_ngcontent-%COMP%], .toggle-labels[_ngcontent-%COMP%]   .toggle-yes[hidden][_ngcontent-%COMP%]{visibility:hidden;display:block!important}.coastal-toggle[_ngcontent-%COMP%]{--background: #ddd;--background-checked: #52a676;--handle-background: white;--handle-background-checked: white;--handle-width: 26px;--handle-height: 26px;--handle-spacing: 3px;width:52px;height:32px;min-width:52px;flex-shrink:0}.coastal-toggle[_ngcontent-%COMP%]::part(track){height:32px;width:52px;border-radius:16px}.coastal-toggle[_ngcontent-%COMP%]::part(handle){width:26px;height:26px}.form-buttons[_ngcontent-%COMP%]{padding:0 16px;margin-top:24px;margin-bottom:32px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-bottom:12px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-buttons[_ngcontent-%COMP%]   ion-button.save-draft-button[_ngcontent-%COMP%]{margin:10px 0 12px}.form-buttons[_ngcontent-%COMP%]   .save-draft-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--background: rgba(107, 124, 122, .1);--border-color: #6b7c7a;--color: #6b7c7a;--background-hover: rgba(107, 124, 122, .2);--background-activated: rgba(107, 124, 122, .3)}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{margin:0;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #e76f51;--background-hover: #d65d43;--background-activated: #d65d43}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}.form-buttons[_ngcontent-%COMP%]   .discard-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--color: #e76f51;--border-color: #e76f51;--border-width: 2px;--background-hover: rgba(231, 111, 81, .1);--background-activated: rgba(231, 111, 81, .2);--ripple-color: rgba(231, 111, 81, .3)}.form-buttons[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{margin-top:20px;--background: #d32f2f;--background-hover: #b71c1c;--background-activated: #b71c1c;font-weight:600;height:48px;font-size:1rem}.submit-button[_ngcontent-%COMP%]{margin:24px 16px 32px;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #e76f51;--background-hover: #d65d43;--background-activated: #d65d43}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}ion-error[_ngcontent-%COMP%]{color:#e76f51!important;font-size:.75rem!important;margin-top:4px;padding-left:16px}ion-item.item-disabled[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]{opacity:1!important;--opacity: 1 !important}ion-item.item-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:1!important;color:#000!important}  .item-disabled,   .item-interactive-disabled{opacity:1!important}  .item-disabled ion-label,   .item-disabled .label-text,   .item-disabled .native-input,   .item-disabled .select-text,   .item-disabled .select-icon,   .item-interactive-disabled ion-label,   .item-interactive-disabled .label-text,   .item-interactive-disabled .native-input,   .item-interactive-disabled .select-text,   .item-interactive-disabled .select-icon{opacity:1!important;color:#000!important}  ion-select.select-disabled{opacity:1!important}  ion-select.select-disabled .select-text,   ion-select.select-disabled .select-icon,   ion-select.select-disabled .select-placeholder{opacity:1!important;color:#000!important}  ion-toggle.toggle-disabled{opacity:1!important}  ion-checkbox.checkbox-disabled{opacity:1!important}  ion-input.input-disabled,   ion-textarea.textarea-disabled{opacity:1!important}  ion-input.input-disabled .native-input,   ion-input.input-disabled .native-textarea,   ion-textarea.textarea-disabled .native-input,   ion-textarea.textarea-disabled .native-textarea{opacity:1!important;color:#000!important;-webkit-text-fill-color:#000!important}  ion-content.view-mode ion-checkbox,   ion-content.view-mode ion-toggle{pointer-events:none!important;cursor:default!important}  ion-content.view-mode ion-item:has(ion-checkbox){pointer-events:none!important}ion-item[_ngcontent-%COMP%]:has(ion-checkbox[formControlName=requiresUrgentAction])   ion-checkbox[_ngcontent-%COMP%]{--checkbox-background-checked: #e76f51 !important;--border-color-checked: #e76f51 !important;--border-color: #e76f51 !important;--checkmark-color: white !important}@media (max-width: 399px){.gps-title[_ngcontent-%COMP%]{font-size:.9rem!important}.gps-hint[_ngcontent-%COMP%], .coordinates-text[_ngcontent-%COMP%], .gps-source-hint[_ngcontent-%COMP%]{font-size:.75rem!important}}@media (max-width: 768px){.photo-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.photo-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:200px}ion-card[_ngcontent-%COMP%]{margin:12px}}"]}))}return i(),p})(),vt=(()=>{var i;class p{constructor(e){this.modalController=e}dismiss(){this.modalController.dismiss()}static#t=i=()=>(this.\u0275fac=function(o){return new(o||p)(t.rXU(g.W3))},this.\u0275cmp=t.VBU({type:p,selectors:[["app-fullscreen-photo-modal-pollution"]],decls:10,vars:2,consts:[["slot","end"],[3,"click"],["name","close"],[1,"ion-padding"],[1,"photo-container"],["alt","Full screen photo",3,"src"]],template:function(o,n){1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return n.dismiss()}),t.nrm(6,"ion-icon",2),t.k0s()()()(),t.j41(7,"ion-content",3)(8,"div",4),t.nrm(9,"img",5),t.k0s()()),2&o&&(t.R7$(3),t.SpI("",n.photoType," Photo"),t.R7$(6),t.Y8G("src",n.photoUrl,t.B4B))},dependencies:[g.bv,g.Jm,g.QW,g.W9,g.eU,g.iq,g.BC,g.ai,C.MD],styles:[".photo-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.photo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}"]}))}return i(),p})();const yt=[{path:"",component:Pt}];let Mt=(()=>{var i;class p{static#t=i=()=>(this.\u0275fac=function(o){return new(o||p)},this.\u0275mod=t.$C({type:p}),this.\u0275inj=s.G2t({imports:[R.iI.forChild(yt),R.iI]}))}return i(),p})();var Ct=_(4670);let xt=(()=>{var i;class p{static#t=i=()=>(this.\u0275fac=function(o){return new(o||p)},this.\u0275mod=t.$C({type:p}),this.\u0275inj=s.G2t({imports:[C.MD,x.YN,x.X1,g.bv,Mt,Ct.k]}))}return i(),p})()},9187(L,N,_){_.d(N,{C:()=>G});var C=_(467),x=_(2084),g=_(2615),R=_(5029),b=_(918),E=_(8863);let G=(()=>{var t;class s{constructor(c,m,d){this.supabase=c,this.sharedDataService=m,this.monitoringLog=d}deleteEntry(c){var m=this;return(0,C.A)(function*(){console.log("[EntryDeletionService] Starting deletion process for:",c);try{const d=yield m.fetchOriginalEntry(c.tableName,c.reportId);if(!d)throw new Error(`Entry not found in table ${c.tableName} with reportId ${c.reportId}`);console.log("[EntryDeletionService] Original entry fetched:",d);const u=yield m.backupToDeletedFiles(c,d);console.log("[EntryDeletionService] Backup completed:",u),yield m.recordDeletionMetadata(c,u,d),console.log("[EntryDeletionService] Deletion metadata recorded"),yield m.deleteImagesFromBucket(d,c.formType,c.reportId),console.log("[EntryDeletionService] Images deleted from bucket"),yield m.deleteJsonFromStorage(c.formType,c.reportId),console.log("[EntryDeletionService] JSON file deleted from storage"),yield m.deleteFromTable(c.tableName,c.reportId),console.log("[EntryDeletionService] Entry deleted from table"),yield m.deleteLocalFile(c.formType,c.reportId),console.log("[EntryDeletionService] Local file deleted");const P=m.getEntrySummary(d,c.formType);m.monitoringLog.recordFormDeleted(c.deletedBy,c.formType,c.reportId,P),console.log("[EntryDeletionService] \u2705 Deletion process completed successfully")}catch(d){throw console.error("[EntryDeletionService] \u274c Deletion process failed:",d),d}})()}getEntrySummary(c,m){const d=[];return c?.location&&d.push(c.location),c?.zone_number&&d.push(`Z${c.zone_number}`),c?.quad_number&&d.push(`Q${c.quad_number}`),c?.observation_date&&d.push(c.observation_date),d.join(", ")||m}fetchOriginalEntry(c,m){var d=this;return(0,C.A)(function*(){const{data:u,error:P}=yield d.supabase.getClient().from(c).select("*").eq("report_id",m).single();if(P)throw console.error("[EntryDeletionService] Error fetching original entry:",P),P;return u})()}backupToDeletedFiles(c,m){var d=this;return(0,C.A)(function*(){const u=`${c.formType}/${c.reportId}`,P=`${u}/${c.reportId}.json`,k=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),{error:w}=yield d.supabase.getClient().storage.from("deleted_files").upload(P,k);if(w)throw console.error("[EntryDeletionService] Error backing up JSON:",w),w;const D=[],W=d.getImageBucketName(c.formType),X=d.extractImagePathsFromEntry(m,c.formType,c.reportId);for(const S of X)if(S)try{const{data:z,error:B}=yield d.supabase.getClient().storage.from(W).download(S);if(B){console.warn("[EntryDeletionService] Could not download image:",S,B);continue}const A=`${u}/${S.split("/").pop()}`,{error:V}=yield d.supabase.getClient().storage.from("deleted_files").upload(A,z);V?console.warn("[EntryDeletionService] Could not backup image:",A,V):D.push(A)}catch(z){console.warn("[EntryDeletionService] Error processing image:",z)}return{backupFolderPath:u,jsonBackupPath:P,imageBackupPaths:D}})()}recordDeletionMetadata(c,m,d){var u=this;return(0,C.A)(function*(){const P={original_entry:d,backup_paths:{json:m.jsonBackupPath,images:m.imageBackupPaths},deletion_timestamp:(0,x.E)()},{error:k}=yield u.supabase.getClient().from("deleted_metadata_files").insert({original_report_id:c.reportId,form_type:c.formType,deleted_by:c.deletedBy,deleted_by_email:c.deletedByEmail,original_submitted_by:c.originalSubmittedBy||d.submittedBy,original_submitted_at:c.originalSubmittedAt||d.createdAt,backup_folder_path:m.backupFolderPath,original_table_name:c.tableName,original_storage_path:u.getStoragePath(c.tableName,c.reportId),metadata:P});if(k)throw console.error("[EntryDeletionService] Error recording deletion metadata:",k),k})()}deleteImagesFromBucket(c,m,d){var u=this;return(0,C.A)(function*(){const P=u.getImageBucketName(m),k=u.extractImagePathsFromEntry(c,m,d);for(const w of k)if(w)try{const{error:D}=yield u.supabase.getClient().storage.from(P).remove([w]);D&&console.warn("[EntryDeletionService] Could not delete image:",w,D)}catch(D){console.warn("[EntryDeletionService] Error deleting image:",D)}})()}deleteJsonFromStorage(c,m){var d=this;return(0,C.A)(function*(){const u=d.getReportsBucketName(c),P=`${m}.json`,{error:k}=yield d.supabase.getClient().storage.from(u).remove([P]);k&&console.warn("[EntryDeletionService] Could not delete JSON from storage:",P,k)})()}deleteFromTable(c,m){var d=this;return(0,C.A)(function*(){const{error:u}=yield d.supabase.getClient().from(c).delete().eq("report_id",m);if(u)throw console.error("[EntryDeletionService] Error deleting from table:",u),u})()}deleteLocalFile(c,m){var d=this;return(0,C.A)(function*(){try{const u=d.getLocalFileName(c,m);yield d.sharedDataService.deleteJsonFile(u)}catch(u){console.warn("[EntryDeletionService] Could not delete local file:",u)}})()}getReportsBucketName(c){return c}getImageBucketName(c){return{"flora-fauna":"flora-fauna-images",biomass:"biomass-images",health:"health-images",outplanting:"outplanting-images",restoration:"restoration-images",cleanup:"cleanup-images",pollution:"pollution-images",disturbances:"disturbances-images"}[c]||`${c}-images`}extractImagePathsFromEntry(c,m,d){const u=[];if("health"===m)return u.push(`${d}/soil.jpg`),u.push(`${d}/predation.jpg`),u.push(`${d}/pollution.jpg`),u;if("pollution"===m){u.push(`${d}/greyWater.jpg`),u.push(`${d}/trash.jpg`),u.push(`${d}/sewage.jpg`);for(let P=1;P<=10;P++)u.push(`${d}/photo_${P}.jpg`);return u}if("disturbances"===m)return u.push(`${d}/harvest.jpg`),u.push(`${d}/clearing.jpg`),u.push(`${d}/construction.jpg`),u.push(`${d}/fallenTree.jpg`),u.push(`${d}/erosion.jpg`),u.push(`${d}/accretion.jpg`),u.push(`${d}/diseases.jpg`),u;for(let P=1;P<=20;P++)u.push(`${d}/photo_${P}.jpg`);return u}getStoragePath(c,m){return`${c}/${m}.json`}getLocalFileName(c,m){return`${m}.json`}static#t=t=()=>(this.\u0275fac=function(m){return new(m||s)(g.KVO(R.L),g.KVO(b.H),g.KVO(E.u))},this.\u0275prov=g.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}))}return t(),s})()}}]);