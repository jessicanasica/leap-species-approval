"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9081],{152(ee,H,f){f.d(H,{B:()=>$});var M=f(8839),y=f(9974),m=f(4360);function $(_,S=M.E){return(0,y.N)((e,d)=>{let k=null,D=null,s=null;const h=()=>{if(k){k.unsubscribe(),k=null;const p=D;D=null,d.next(p)}};function u(){const p=s+_,v=S.now();if(v<p)return k=this.schedule(void 0,p-v),void d.add(k);h()}e.subscribe((0,m._)(d,p=>{D=p,s=S.now(),k||(k=S.schedule(u,_),d.add(k))},()=>{h(),d.complete()},void 0,()=>{D=k=null}))})}},1462(ee,H,f){f.d(H,{HealthFormPageModule:()=>dt});var M=f(2200),y=f(4341),m=f(7343),$=f(8132),_=f(467),S=f(152),e=f(3664),d=f(2615),k=f(5921),D=f(5858),s=f(5342),h=f(5010),u=f(3205),p=f(8060),v=f(918),C=f(9187),E=f(7643),O=f(6845),Q=f(7314);function W(i,l){if(1&i){const r=e.RV6();e.j41(0,"span",69),e.bIt("click",function(){d.eBV(r),e.XpG();const o=e.sdS(15);return d.Njj(o.showPicker())}),e.EFF(1),e.k0s()}if(2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentDateDisplay)}}function j(i,l){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentDateDisplay)}}function z(i,l){if(1&i){const r=e.RV6();e.j41(0,"span",69),e.bIt("click",function(){d.eBV(r),e.XpG();const o=e.sdS(17);return d.Njj(o.showPicker())}),e.EFF(1),e.k0s()}if(2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentTimeDisplay)}}function Y(i,l){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentTimeDisplay)}}function A(i,l){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.SpI(" (edited: ",r.getEditedDateTime(),")")}}function V(i,l){1&i&&e.nrm(0,"ion-icon",70)}function ce(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",13),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(!o.viewMode&&o.editZone())}),e.nrm(1,"ion-icon",71),e.j41(2,"span",15),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.JRh(t.getZoneName(null==(r=t.healthForm.get("zoneNumber"))?null:r.value))}}function de(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",13),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(!o.viewMode&&o.editQuad())}),e.nrm(1,"ion-icon",72),e.j41(2,"span",15),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.SpI("Quad ",t.getQuadDisplay(null==(r=t.healthForm.get("quadNumber"))?null:r.value))}}function ue(i,l){if(1&i){const r=e.RV6();e.j41(0,"span",73),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.editLocationAdmin())}),e.EFF(1),e.nI1(2,"t"),e.k0s()}2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Edit location")," "))}function pe(i,l){1&i&&(e.j41(0,"ion-error",74),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Location is required")," "))}function he(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",75)(1,"ion-button",76),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.enableEditMode())}),e.nrm(2,"ion-icon",77),e.EFF(3),e.nI1(4,"t"),e.k0s()()}2&i&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"Edit This Entry")," "))}function me(i,l){1&i&&(e.j41(0,"div",78),e.nrm(1,"ion-icon",79),e.j41(2,"span"),e.EFF(3),e.nI1(4,"t"),e.k0s()()),2&i&&(e.R7$(3),e.JRh(e.bMT(4,1,"Editing Entry - Changes will replace the original submission")))}function ge(i,l){1&i&&e.nrm(0,"ion-icon",80)}function fe(i,l){1&i&&e.nrm(0,"ion-icon",81)}function be(i,l){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Observer name is required")," "))}function _e(i,l){1&i&&(e.j41(0,"ion-select",82),e.nI1(1,"t"),e.j41(2,"ion-select-option",83),e.EFF(3),e.nI1(4,"t"),e.k0s(),e.j41(5,"ion-select-option",84),e.EFF(6),e.nI1(7,"t"),e.k0s(),e.j41(8,"ion-select-option",85),e.EFF(9),e.nI1(10,"t"),e.k0s(),e.j41(11,"ion-select-option",86),e.EFF(12),e.nI1(13,"t"),e.k0s(),e.j41(14,"ion-select-option",87),e.EFF(15),e.nI1(16,"t"),e.k0s()()),2&i&&(e.Y8G("placeholder",e.bMT(1,6,"Select weather")),e.R7$(3),e.JRh(e.bMT(4,8,"Sunny")),e.R7$(3),e.JRh(e.bMT(7,10,"Partly Cloudy")),e.R7$(3),e.JRh(e.bMT(10,12,"Cloudy")),e.R7$(3),e.JRh(e.bMT(13,14,"Rainy")),e.R7$(3),e.JRh(e.bMT(16,16,"Stormy")))}function ve(i,l){if(1&i&&e.nrm(0,"ion-input",88),2&i){let r;const t=e.XpG();e.Y8G("value",t.getWeatherLabel(null==(r=t.healthForm.get("weather"))?null:r.value))}}function Fe(i,l){1&i&&e.nrm(0,"ion-icon",80)}function ye(i,l){1&i&&e.nrm(0,"ion-icon",81)}function Pe(i,l){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Weather selection is required")," "))}function xe(i,l){1&i&&(e.j41(0,"ion-select",89),e.nI1(1,"t"),e.j41(2,"ion-select-option",90),e.EFF(3),e.nI1(4,"t"),e.k0s(),e.j41(5,"ion-select-option",91),e.EFF(6),e.nI1(7,"t"),e.k0s(),e.j41(8,"ion-select-option",92),e.EFF(9),e.nI1(10,"t"),e.k0s(),e.j41(11,"ion-select-option",93),e.EFF(12),e.nI1(13,"t"),e.k0s()()),2&i&&(e.Y8G("placeholder",e.bMT(1,5,"Select tide")),e.R7$(3),e.JRh(e.bMT(4,7,"High")),e.R7$(3),e.JRh(e.bMT(7,9,"Low")),e.R7$(3),e.JRh(e.bMT(10,11,"Incoming")),e.R7$(3),e.JRh(e.bMT(13,13,"Outgoing")))}function ke(i,l){if(1&i&&e.nrm(0,"ion-input",88),2&i){let r;const t=e.XpG();e.Y8G("value",t.getTideLabel(null==(r=t.healthForm.get("tide"))?null:r.value))}}function Me(i,l){1&i&&e.nrm(0,"ion-icon",80)}function Ce(i,l){1&i&&e.nrm(0,"ion-icon",81)}function Te(i,l){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Tide selection is required")," "))}function Re(i,l){1&i&&e.nrm(0,"ion-icon",80)}function Ie(i,l){1&i&&e.nrm(0,"ion-icon",81)}function Ee(i,l){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Canopy cover is required")," "))}function Oe(i,l){1&i&&e.nrm(0,"ion-icon",80)}function Se(i,l){1&i&&e.nrm(0,"ion-icon",81)}function $e(i,l){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Recruitment cover is required")," "))}function De(i,l){if(1&i){const r=e.RV6();e.j41(0,"ion-button",94),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.decrementDeadTrees())}),e.nrm(1,"ion-icon",95),e.k0s()}if(2&i){let r;const t=e.XpG();e.Y8G("disabled",(null==(r=t.healthForm.get("deadTrees"))?null:r.value)<=0)}}function je(i,l){if(1&i){const r=e.RV6();e.j41(0,"ion-button",96),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.incrementDeadTrees())}),e.nrm(1,"ion-icon",97),e.k0s()}}function we(i,l){1&i&&e.nrm(0,"ion-icon",112)}function Ne(i,l){1&i&&e.nrm(0,"ion-icon",113)}function Ge(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",114)(1,"ion-button",115),e.bIt("click",function(){d.eBV(r);const o=e.XpG(2);return d.Njj(o.capturePollutionPhoto())}),e.nrm(2,"ion-icon",116),e.EFF(3),e.nI1(4,"t"),e.k0s()()}2&i&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"Add Pollution Photo (Optional)")," "))}function He(i,l){if(1&i){const r=e.RV6();e.j41(0,"ion-button",121),e.bIt("click",function(){d.eBV(r);const o=e.XpG(3);return d.Njj(o.removePollutionPhoto())}),e.nrm(1,"ion-icon",122),e.k0s()}}function ze(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",117)(1,"ion-label"),e.EFF(2),e.nI1(3,"t"),e.k0s(),e.j41(4,"div",118)(5,"img",119),e.bIt("click",function(){d.eBV(r);const o=e.XpG(2);return d.Njj(o.openFullScreenPhoto(o.pollutionPhoto,"Pollution"))}),e.k0s(),e.DNE(6,He,2,0,"ion-button",120),e.k0s()()}if(2&i){const r=e.XpG(2);e.R7$(2),e.JRh(e.bMT(3,3,"Pollution Photo:")),e.R7$(3),e.Y8G("src",r.pollutionPhoto,e.B4B),e.R7$(),e.Y8G("ngIf",!r.viewMode)}}function Ae(i,l){1&i&&(e.nrm(0,"ion-textarea",123),e.nI1(1,"t")),2&i&&e.Y8G("placeholder",e.bMT(1,1,"Describe the distribution and volume of waste, specific location within the site, potential sources, any observed impacts on wildlife or vegetation, etc."))}function Be(i,l){if(1&i&&e.nrm(0,"ion-textarea",124),2&i){let r;const t=e.XpG(2);e.Y8G("value",null==(r=t.healthForm.get("pollutionObservations"))?null:r.value)}}function Ye(i,l){if(1&i&&(e.j41(0,"div",98)(1,"div",99),e.DNE(2,we,1,0,"ion-icon",100)(3,Ne,1,0,"ion-icon",101),e.k0s(),e.j41(4,"ion-item",49),e.nrm(5,"ion-label",26),e.j41(6,"ion-select",102),e.nI1(7,"t"),e.j41(8,"ion-select-option",103),e.EFF(9),e.nI1(10,"t"),e.k0s(),e.j41(11,"ion-select-option",104),e.EFF(12),e.nI1(13,"t"),e.k0s(),e.j41(14,"ion-select-option",105),e.EFF(15),e.nI1(16,"t"),e.k0s(),e.j41(17,"ion-select-option",106),e.EFF(18),e.nI1(19,"t"),e.k0s(),e.j41(20,"ion-select-option",107),e.EFF(21),e.nI1(22,"t"),e.k0s(),e.j41(23,"ion-select-option",108),e.EFF(24),e.nI1(25,"t"),e.k0s(),e.j41(26,"ion-select-option",109),e.EFF(27),e.nI1(28,"t"),e.k0s(),e.j41(29,"ion-select-option",110),e.EFF(30),e.nI1(31,"t"),e.k0s()()(),e.DNE(32,Ge,5,3,"div",59)(33,ze,7,5,"div",60),e.j41(34,"ion-item",49)(35,"ion-label",26),e.EFF(36),e.nI1(37,"t"),e.k0s(),e.DNE(38,Ae,2,3,"ion-textarea",111)(39,Be,1,1,"ion-textarea",66),e.k0s()()),2&i){let r,t;const o=e.XpG();e.R7$(2),e.Y8G("ngIf",!(o.viewMode||null!=(r=o.healthForm.get("pollutionTypes"))&&r.value&&0!==(null==(r=o.healthForm.get("pollutionTypes"))||null==r.value?null:r.value.length))),e.R7$(),e.Y8G("ngIf",!o.viewMode&&(null==(t=o.healthForm.get("pollutionTypes"))||null==t.value?null:t.value.length)>0),e.R7$(3),e.Y8G("placeholder",e.bMT(7,16,"Select type(s)")),e.R7$(3),e.JRh(e.bMT(10,18,"Plastics")),e.R7$(3),e.JRh(e.bMT(13,20,"Metal")),e.R7$(3),e.JRh(e.bMT(16,22,"Glass")),e.R7$(3),e.JRh(e.bMT(19,24,"Fabric")),e.R7$(3),e.JRh(e.bMT(22,26,"Paper/Cardboard")),e.R7$(3),e.JRh(e.bMT(25,28,"Home appliance/electronics")),e.R7$(3),e.JRh(e.bMT(28,30,"Construction debris")),e.R7$(3),e.JRh(e.bMT(31,32,"Furniture")),e.R7$(2),e.Y8G("ngIf",!o.pollutionPhoto&&!o.viewMode),e.R7$(),e.Y8G("ngIf",o.pollutionPhoto),e.R7$(3),e.JRh(e.bMT(37,34,"Additional Pollution Observations")),e.R7$(2),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.viewMode)}}function Ve(i,l){1&i&&e.nrm(0,"ion-icon",80)}function Je(i,l){1&i&&e.nrm(0,"ion-icon",81)}function qe(i,l){1&i&&(e.j41(0,"ion-error"),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Soil composition is required")," "))}function Ue(i,l){if(1&i&&(e.j41(0,"ion-note",125),e.EFF(1),e.k0s()),2&i){let r;const t=e.XpG();e.R7$(),e.SpI(" Mixed composition: ",t.formatSoilComposition(null==(r=t.healthForm.get("soilComposition"))?null:r.value)," ")}}function Xe(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",114)(1,"ion-button",115),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.captureSoilPhoto())}),e.nrm(2,"ion-icon",116),e.EFF(3),e.nI1(4,"t"),e.k0s()()}2&i&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"Add Soil Photo (Optional)")," "))}function Le(i,l){if(1&i){const r=e.RV6();e.j41(0,"ion-button",121),e.bIt("click",function(){d.eBV(r);const o=e.XpG(2);return d.Njj(o.removeSoilPhoto())}),e.nrm(1,"ion-icon",122),e.k0s()}}function Qe(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",117)(1,"ion-label"),e.EFF(2),e.nI1(3,"t"),e.k0s(),e.j41(4,"div",118)(5,"img",126),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.openFullScreenPhoto(o.soilPhoto,"Soil"))}),e.k0s(),e.DNE(6,Le,2,0,"ion-button",120),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(2),e.JRh(e.bMT(3,3,"Soil Photo:")),e.R7$(3),e.Y8G("src",r.soilPhoto,e.B4B),e.R7$(),e.Y8G("ngIf",!r.viewMode)}}function We(i,l){1&i&&(e.j41(0,"ion-item")(1,"ion-label",26),e.EFF(2),e.nI1(3,"t"),e.k0s(),e.nrm(4,"ion-textarea",127),e.nI1(5,"t"),e.k0s()),2&i&&(e.R7$(2),e.JRh(e.bMT(3,2,"Specify Other Predation")),e.R7$(2),e.Y8G("placeholder",e.bMT(5,4,"Describe the predation observed")))}function Ke(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",114)(1,"ion-button",115),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.capturePredationPhoto())}),e.nrm(2,"ion-icon",116),e.EFF(3),e.nI1(4,"t"),e.k0s()()}2&i&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"Add Predation Evidence Photo (Optional)")," "))}function Ze(i,l){if(1&i){const r=e.RV6();e.j41(0,"ion-button",121),e.bIt("click",function(){d.eBV(r);const o=e.XpG(2);return d.Njj(o.removePredationPhoto())}),e.nrm(1,"ion-icon",122),e.k0s()}}function et(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",117)(1,"ion-label"),e.EFF(2),e.nI1(3,"t"),e.k0s(),e.j41(4,"div",118)(5,"img",128),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.openFullScreenPhoto(o.predationPhoto,"Predation"))}),e.k0s(),e.DNE(6,Ze,2,0,"ion-button",120),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(2),e.JRh(e.bMT(3,3,"Predation Photo:")),e.R7$(3),e.Y8G("src",r.predationPhoto,e.B4B),e.R7$(),e.Y8G("ngIf",!r.viewMode)}}function tt(i,l){1&i&&(e.nrm(0,"ion-textarea",129),e.nI1(1,"t")),2&i&&e.Y8G("placeholder",e.bMT(1,1,"Enter any additional observations about wetland health, tree vitality, water quality, wildlife presence, etc."))}function ot(i,l){if(1&i&&e.nrm(0,"ion-textarea",124),2&i){let r;const t=e.XpG();e.Y8G("value",null==(r=t.healthForm.get("otherObservations"))?null:r.value)}}function nt(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",130)(1,"ion-button",131),e.nrm(2,"ion-icon",132),e.EFF(3),e.nI1(4,"t"),e.k0s(),e.j41(5,"ion-button",133),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.saveDraft())}),e.nrm(6,"ion-icon",134),e.EFF(7),e.nI1(8,"t"),e.k0s(),e.j41(9,"ion-button",135),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.discardForm())}),e.nrm(10,"ion-icon",136),e.EFF(11),e.nI1(12,"t"),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(),e.Y8G("disabled",!r.healthForm.valid),e.R7$(2),e.SpI(" ",e.bMT(4,4,"Submit Health Assessment")," "),e.R7$(4),e.SpI(" ",e.bMT(8,6,"Save Draft")," "),e.R7$(4),e.SpI(" ",e.bMT(12,8,"Discard")," ")}}function it(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",137)(1,"ion-button",138),e.bIt("click",function(){d.eBV(r);const o=e.XpG();return d.Njj(o.deleteEntry())}),e.nrm(2,"ion-icon",136),e.EFF(3),e.nI1(4,"t"),e.k0s()()}2&i&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"Delete Entry")," "))}let rt=(()=>{var i;class l{forceDeleteDraftFile(t){var o=this;return(0,_.A)(function*(){for(let n=0;n<3;n++)try{yield o.sharedDataService.deleteJsonFile(t),console.log(`Draft file force deleted successfully (attempt ${n+1})`);break}catch(c){if(console.error(`Error force deleting draft file (attempt ${n+1}):`,c),2===n)try{yield o.sharedDataService.writeJsonFile(t,null),console.log("Draft file cleared with null write")}catch(a){console.error("Failed to clear draft file with null write:",a)}yield new Promise(a=>setTimeout(a,100))}})()}constructor(t,o,n,c,a,g,F,b,P,x,R,T,I,w,J){this.formBuilder=t,this.alertController=o,this.loadingController=n,this.router=c,this.route=a,this.weatherService=g,this.tideService=F,this.photoService=b,this.auth=P,this.healthSyncService=x,this.sharedDataService=R,this.entryDeletionService=T,this.siteSyncService=I,this.modalController=w,this.ts=J,this.progress=0,this.soilPhoto=null,this.predationPhoto=null,this.pollutionPhoto=null,this.currentDateTime="",this.currentDateDisplay="",this.currentTimeDisplay="",this.viewMode=!1,this.currentUser=null,this.currentReportId="",this.loadedReport=null,this.mixedSoilTypes=[],this.autosaveSub=null,this.isDiscarded=!1,this.isSubmitted=!1,this.isSubmitting=!1,this.isEditMode=!1,this.originalSubmittedBy="",this.maheLatitude=-4.6796,this.maheLongitude=55.4919,this.availableLocations=[{name:"Ramsar",hasZones:!0,hasQuads:!0,zones:["1","2","3","4","5","6"],quads:Array.from({length:30},(N,G)=>`quad${G+1}`),zoneQuadMap:{1:[1,2,3],2:[13,14,15,16,17,18,20,21,22,23,25,27,28,29],3:[19,26],4:[4,5],5:[6,7,11,12,24,30],6:[8,9,10]}},{name:"Grand Anse",hasZones:!0,hasQuads:!0,zones:["1","2","3","4"],quads:Array.from({length:22},(N,G)=>`ga${G+1}`),zoneQuadMap:{1:[1,2,3,4],2:[5,6,7,8,9,10,21,22],3:[11,12,13,14,15,16,17,18],4:[19,20]}},{name:"Caiman",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4","quad5"]},{name:"Canopy",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4"]},{name:"Petit Barbarons",hasZones:!0,hasQuads:!1,zones:["1","2","3","4"],quads:[]},{name:"Kempinski",hasZones:!1,hasQuads:!1,zones:[],quads:[]},{name:"Roche Caiman",hasZones:!1,hasQuads:!1,zones:[],quads:[]}]}ngOnInit(){var t=this;return(0,_.A)(function*(){t.currentUser=t.auth.getCurrentUser(),t.initializeForm(),t.setCurrentDateTime(),t.fetchWeatherAndTide(),yield t.loadDynamicSites();const o=t.route.snapshot.queryParams;"true"===o.viewMode&&o.reportId?yield t.loadReportForViewing(o.reportId):(t.route.queryParams.subscribe(n=>{n.location&&t.healthForm.patchValue({location:n.location}),n.zone&&t.healthForm.patchValue({zoneNumber:n.zone}),n.quad&&t.healthForm.patchValue({quadNumber:n.quad})}),"true"!==o.fresh&&(yield t.restoreDraftIfAny(),t.setCurrentDateTime()),t.currentReportId||(t.currentReportId=t.healthSyncService.generateReportId()),t.subscribeToFormChanges(),navigator.onLine&&t.healthSyncService.processPendingQueue().catch(n=>{console.error("HealthFormPage: processPendingQueue failed:",n)}))})()}ngOnDestroy(){this.autosaveSub&&(this.autosaveSub.unsubscribe(),this.autosaveSub=null),!this.isSubmitted&&!this.isDiscarded&&this.saveDraftOnExit().catch(t=>console.error("HealthFormPage: saveDraftOnExit failed:",t))}setCurrentDateTime(t){if(this.healthForm){const b=this.healthForm.get("date")?.value,P=this.healthForm.get("time")?.value;if(b&&P){const[x,R,T]=b.split("-"),[I,w]=P.split(":");return this.currentDateDisplay=`${T}/${R}/${x}`,this.currentTimeDisplay=`${I}:${w}`,void(this.currentDateTime=`${this.currentDateDisplay}  \u2022  ${this.currentTimeDisplay}`)}}if(t){const b=this.extractDateTimeFromReportId(t);if(b){this.currentDateTime=b;const P=b.split("  \u2022  ");return void(2===P.length&&(this.currentDateDisplay=P[0],this.currentTimeDisplay=P[1]))}}const o=new Date,n=String(o.getDate()).padStart(2,"0"),c=String(o.getMonth()+1).padStart(2,"0"),a=o.getFullYear(),g=String(o.getHours()).padStart(2,"0"),F=String(o.getMinutes()).padStart(2,"0");this.currentDateDisplay=`${n}/${c}/${a}`,this.currentTimeDisplay=`${g}:${F}`,this.currentDateTime=`${this.currentDateDisplay}  \u2022  ${this.currentTimeDisplay}`}extractDateTimeFromReportId(t){const o=t.match(/(\d{2})(\d{2})(\d{4})_(\d{2})(\d{2})(\d{2})/);if(o){const[,n,c,a,g,F]=o;return`${n}/${c}/${a}  \u2022  ${g}:${F}`}return null}getCurrentDate(){return(new Date).toISOString().split("T")[0]}getCurrentTime(){return(new Date).toTimeString().slice(0,5)}editLocation(){var t=this;return(0,_.A)(function*(){yield(yield t.alertController.create({header:t.ts.t("Location/Site"),inputs:[{name:"location",type:"text",placeholder:t.ts.t("Enter location"),value:t.healthForm.get("location")?.value||""}],buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Save"),handler:n=>{t.healthForm.patchValue({location:n.location})}}]})).present()})()}editZone(){var t=this;return(0,_.A)(function*(){yield(yield t.alertController.create({header:t.ts.t("Zone Number"),inputs:[{name:"zoneNumber",type:"text",placeholder:t.ts.t("Enter zone number"),value:t.healthForm.get("zoneNumber")?.value||""}],buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Save"),handler:n=>{t.healthForm.patchValue({zoneNumber:n.zoneNumber})}}]})).present()})()}editQuad(){var t=this;return(0,_.A)(function*(){yield(yield t.alertController.create({header:t.ts.t("Quad Number"),inputs:[{name:"quadNumber",type:"text",placeholder:t.ts.t("Enter quad number"),value:t.healthForm.get("quadNumber")?.value||""}],buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Save"),handler:n=>{t.healthForm.patchValue({quadNumber:n.quadNumber})}}]})).present()})()}getZoneName(t){return t?`Zone ${t}`:""}getQuadDisplay(t){if(!t)return"";const o=t.match(/\d+/);return o?o[0]:""}locationHasZones(){const t=this.healthForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Petit Barbarons"].includes(t)}locationHasQuads(){const t=this.healthForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Caiman","Canopy"].includes(t)}editLocationAdmin(){var t=this;return(0,_.A)(function*(){if(!t.currentUser||t.currentUser.level<4)return;const o=yield t.selectLocationStep();if(!o)return;const n=t.availableLocations.find(g=>g.name===o);let c="";if(n?.hasZones&&n.zones.length>0){const g=yield t.selectZoneStep(n);if(null===g)return;c=g}let a="";if(n?.hasQuads&&n.quads.length>0){const g=yield t.selectQuadStep(n,c);if(null===g)return;a=g}t.healthForm.patchValue({location:o,zoneNumber:c,quadNumber:a}),t.isEditMode&&t.healthForm.markAsDirty()})()}selectLocationStep(){var t=this;return new Promise(function(){var o=(0,_.A)(function*(n){const c=t.healthForm.get("location")?.value||"",a=t.availableLocations.map(F=>({name:"location",type:"radio",label:F.name,value:F.name,checked:F.name===c}));yield(yield t.alertController.create({header:t.ts.t("Select Location"),cssClass:"location-edit-alert",inputs:a,buttons:[{text:t.ts.t("Cancel"),role:"cancel",handler:()=>n(null)},{text:t.ts.t("Next"),handler:F=>n(F)}]})).present()});return function(n){return o.apply(this,arguments)}}())}selectZoneStep(t){var o=this;return new Promise(function(){var n=(0,_.A)(function*(c){const a=o.healthForm.get("zoneNumber")?.value||"",g=t.zones.map(b=>({name:"zone",type:"radio",label:`Zone ${b}`,value:b,checked:b===a}));yield(yield o.alertController.create({header:o.ts.t("Select Zone"),subHeader:t.name,cssClass:"location-edit-alert",inputs:g,buttons:[{text:o.ts.t("Cancel"),role:"cancel",handler:()=>c(null)},{text:o.ts.t("Next"),handler:b=>c(b)}]})).present()});return function(c){return n.apply(this,arguments)}}())}selectQuadStep(t,o){var n=this;return new Promise(function(){var c=(0,_.A)(function*(a){const g=n.healthForm.get("quadNumber")?.value||"";let F=t.quads;if(o&&t.zoneQuadMap&&t.zoneQuadMap[o]){const x=t.zoneQuadMap[o];F=t.quads.filter(R=>{const T=parseInt(n.getQuadDisplay(R));return x.includes(T)})}const b=F.map(x=>({name:"quad",type:"radio",label:`Quad ${n.getQuadDisplay(x)}`,value:x,checked:n.getQuadDisplay(x)===g||x===g}));yield(yield n.alertController.create({header:n.ts.t("Select Quad"),subHeader:t.name,cssClass:"location-edit-alert",inputs:b,buttons:[{text:n.ts.t("Cancel"),role:"cancel",handler:()=>a(null)},{text:n.ts.t("Save"),handler:x=>a(x)}]})).present()});return function(a){return c.apply(this,arguments)}}())}loadDynamicSites(){var t=this;return(0,_.A)(function*(){try{(yield t.siteSyncService.getAllSites()).forEach(n=>{t.availableLocations.some(c=>c.name===n.name)||t.availableLocations.push({name:n.name,hasZones:n.zones&&n.zones.length>0||!1,hasQuads:n.sample_points&&n.sample_points.length>0||!1,zones:n.zones?n.zones.map(c=>c.name?.replace("Zone ","")||c.id):[],quads:n.sample_points?n.sample_points.map(c=>c.id||c.label):[]})})}catch(o){console.error("Error loading dynamic sites:",o)}})()}initializeForm(){const t=this.getCurrentDate(),o=this.getCurrentTime();this.healthForm=this.formBuilder.group({observer:["",y.k0.required],date:[t,y.k0.required],time:[o,y.k0.required],weather:["",y.k0.required],tide:["",y.k0.required],location:["",y.k0.required],zoneNumber:[""],quadNumber:[""],canopyCover:["",y.k0.required],recruitmentCover:["",y.k0.required],deadTrees:[0,[y.k0.required,y.k0.min(0)]],mushroomEvidence:[!1],pollutionSigns:[!1],pollutionTypes:[[]],pollutionObservations:[""],soilComposition:["",y.k0.required],soilDescription:[""],predation:[""],predationOther:[""],otherObservations:[""]}),this.updateProgress()}fetchWeatherAndTide(){this.weatherService.getWeatherByCoordinates(this.maheLatitude,this.maheLongitude).subscribe({next:t=>{if(t&&t.weather&&t.weather.length>0){const o=this.weatherService.mapWeatherToOption(t.weather[0].main);this.healthForm.patchValue({weather:o}),console.log("Weather auto-populated:",o)}},error:t=>{console.error("Error fetching weather:",t)}}),this.tideService.getTides(this.maheLatitude,this.maheLongitude).subscribe({next:t=>{if(t&&t.extremes){const o=this.tideService.getCurrentTideState(t.extremes);this.healthForm.patchValue({tide:o}),console.log("Tide auto-populated:",o)}},error:t=>{console.error("Error fetching tide:",t)}})}captureSoilPhoto(){var t=this;return(0,_.A)(function*(){try{const o=yield t.photoService.TakePicture();o?(t.soilPhoto=o,t.updateProgress()):yield(yield t.alertController.create({header:t.ts.t("Photo Error"),message:t.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}catch(o){console.error("Error capturing soil photo:",o),yield(yield t.alertController.create({header:t.ts.t("Photo Error"),message:t.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}})()}removeSoilPhoto(){this.soilPhoto=null,this.updateProgress()}capturePredationPhoto(){var t=this;return(0,_.A)(function*(){try{const o=yield t.photoService.TakePicture();o?(t.predationPhoto=o,t.updateProgress()):yield(yield t.alertController.create({header:t.ts.t("Photo Error"),message:t.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}catch(o){console.error("Error capturing predation photo:",o),yield(yield t.alertController.create({header:t.ts.t("Photo Error"),message:t.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}})()}removePredationPhoto(){this.predationPhoto=null,this.updateProgress()}capturePollutionPhoto(){var t=this;return(0,_.A)(function*(){try{const o=yield t.photoService.TakePicture();o?(t.pollutionPhoto=o,t.updateProgress()):yield(yield t.alertController.create({header:t.ts.t("Photo Error"),message:t.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}catch(o){console.error("Error capturing pollution photo:",o),yield(yield t.alertController.create({header:t.ts.t("Photo Error"),message:t.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}})()}removePollutionPhoto(){this.pollutionPhoto=null,this.updateProgress()}openFullScreenPhoto(t,o){var n=this;return(0,_.A)(function*(){yield(yield n.modalController.create({component:at,componentProps:{photoUrl:t,photoType:o},cssClass:"fullscreen-photo-modal"})).present()})()}updateProgress(){const t=this.healthForm.value;let o=0,n=9;t.observer&&o++,t.date&&o++,t.time&&o++,t.weather&&o++,t.tide&&o++,t.location&&o++,t.canopyCover&&o++,t.recruitmentCover&&o++,null!==t.deadTrees&&""!==t.deadTrees&&o++,t.soilComposition&&o++,n++,"mixed"===t.soilComposition&&t.soilDescription&&(o++,n++),this.soilPhoto&&(o++,n++),t.predation&&(o++,n++),this.predationPhoto&&(o++,n++),t.pollutionSigns&&t.pollutionTypes&&t.pollutionTypes.length>0&&(o++,n++),this.pollutionPhoto&&(o++,n++),t.pollutionObservations&&(o++,n++),t.otherObservations&&(o++,n++),this.progress=n>0?o/n:0}subscribeToFormChanges(){this.autosaveSub&&this.autosaveSub.unsubscribe(),this.autosaveSub=this.healthForm.valueChanges.pipe((0,S.B)(750)).subscribe(()=>{this.isSubmitted||this.isDiscarded||(this.updateProgress(),this.saveDraftOnExit().catch(t=>console.error("HealthFormPage: autosave failed:",t)))})}onSubmit(){var t=this;return(0,_.A)(function*(){if(t.isSubmitting)return;if(t.isSubmitting=!0,t.healthForm.markAllAsTouched(),!t.healthForm.valid)return t.isSubmitting=!1,void(yield(yield t.alertController.create({header:t.ts.t("Incomplete Form"),message:t.ts.t("Please fill in all required fields (Location, Date, Time, Weather, Tide, Canopy Cover, Recruitment Cover, Dead Mangrove Trees, and Soil Composition)."),buttons:["OK"]})).present());t.isSubmitted=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null);const o=yield t.loadingController.create({message:t.ts.t("Submitting health assessment...")});yield o.present();try{const n={...t.healthForm.value};n.status={incomplete:!1,sent:!0,pending:!1};const c={formValue:n,coordinates:null,photos:{soil:t.soilPhoto,predation:t.predationPhoto,pollution:t.pollutionPhoto},existingReportId:t.currentReportId||void 0};t.isEditMode&&(c.isEditMode=!0,c.originalSubmittedBy=t.originalSubmittedBy);const a=yield t.healthSyncService.submitFinal(c);yield o.dismiss();try{t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(I=>setTimeout(I,1e3));const b=t.healthForm.value;yield t.healthSyncService.clearDraft(b);const P=(b?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),x=b?.zoneNumber||"",R=b?.quadNumber||"";let T=`health_draft_${P}`;x&&(T+=`_zone${x}`),R&&(T+=`_quad${R}`),yield t.forceDeleteDraftFile(`${T}.json`),t.isSubmitted=!0,console.log("HealthFormPage: Draft cleared and form reset successfully")}catch(b){console.error("HealthFormPage: Failed to clear draft:",b)}const g=t.ts.t(t.isEditMode?a.queued?"Updated assessment saved locally and queued for upload when online.":"Health assessment updated successfully!":a.queued?"Health assessment saved locally and queued for upload when online.":"Health assessment submitted successfully!");yield(yield t.alertController.create({header:t.ts.t("Success"),message:g,buttons:[{text:"OK",handler:()=>{t.router.navigate(["/health"])}}]})).present()}catch(n){yield o.dismiss(),console.error("Error submitting assessment:",n),yield(yield t.alertController.create({header:t.ts.t("Error"),message:t.ts.t("Failed to submit health assessment. Please try again."),buttons:["OK"]})).present()}})()}discardForm(){var t=this;return(0,_.A)(function*(){const o=yield t.alertController.create({header:t.ts.t("Discard Form"),message:t.ts.t("Are you sure you want to discard this form? All entered data will be lost."),buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Discard"),role:"destructive"}]});yield o.present();const{role:n}=yield o.onDidDismiss();if("destructive"!==n)return;const c=yield t.loadingController.create({message:t.ts.t("Discarding...")});yield c.present(),t.isDiscarded=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(a=>setTimeout(a,1e3));try{const a=t.healthForm.value;yield t.healthSyncService.clearDraft(a);const g=(a?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),F=a?.zoneNumber||"",b=a?.quadNumber||"";let P=`health_draft_${g}`;F&&(P+=`_zone${F}`),b&&(P+=`_quad${b}`),yield t.forceDeleteDraftFile(`${P}.json`)}catch(a){console.error("HealthFormPage: Error clearing draft during discard:",a)}yield c.dismiss(),t.initializeForm(),t.router.navigate(["/health"])})()}restoreDraftIfAny(){var t=this;return(0,_.A)(function*(){const o=t.route.snapshot.queryParams,n={location:o.location||t.healthForm.get("location")?.value,zoneNumber:o.zone||t.healthForm.get("zoneNumber")?.value,quadNumber:o.quad||t.healthForm.get("quadNumber")?.value},c=yield t.healthSyncService.loadDraft(n);if(c)try{c.reportId&&(t.currentReportId=c.reportId),c.form&&t.healthForm.patchValue(c.form),t.soilPhoto=c.photos?.soil||null,t.predationPhoto=c.photos?.predation||null,t.pollutionPhoto=c.photos?.pollution||null,t.updateProgress()}catch(a){console.error("HealthFormPage: failed to restore draft:",a)}})()}saveDraft(){var t=this;return(0,_.A)(function*(){if(!t.healthForm)return;const o=yield t.alertController.create({header:t.ts.t("Save Draft"),message:t.ts.t("Are you sure you want to save this form as a draft? You can return to complete it later."),buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Save Draft"),role:"confirm"}]});yield o.present();const{role:n}=yield o.onDidDismiss();if("confirm"!==n)return;const c=yield t.loadingController.create({message:t.ts.t("Saving draft...")});yield c.present();try{yield t.saveDraftOnExit(),yield c.dismiss();const a=yield t.alertController.create({header:t.ts.t("Draft Saved"),message:t.ts.t("Your form has been saved as a draft. You can access it from the health page."),buttons:[{text:"OK",role:"confirm"}]});yield a.present(),yield a.onDidDismiss(),t.router.navigate(["/health"])}catch(a){yield c.dismiss(),console.error("Failed to save draft:",a),yield(yield t.alertController.create({header:t.ts.t("Save Failed"),message:t.ts.t("Failed to save the draft. Please try again."),buttons:["OK"]})).present()}})()}saveDraftOnExit(){var t=this;return(0,_.A)(function*(){if(!t.healthForm||t.viewMode||t.isDiscarded||t.isSubmitted)return;const o=t.healthForm.value;(o?.location||o?.weather||o?.tide||t.soilPhoto||t.predationPhoto)&&(yield t.healthSyncService.saveDraft({reportId:t.currentReportId,form:o,coordinates:null,photos:{soil:t.soilPhoto,predation:t.predationPhoto,pollution:t.pollutionPhoto}}))})()}incrementDeadTrees(){const t=this.healthForm.get("deadTrees")?.value||0;this.healthForm.patchValue({deadTrees:t+1})}decrementDeadTrees(){const t=this.healthForm.get("deadTrees")?.value||0;t>0&&this.healthForm.patchValue({deadTrees:t-1})}formatSoilComposition(t){if(!t||("string"==typeof t&&(t=[t]),!Array.isArray(t)||0===t.length))return"";const o={sand:"Sand",mud:"Mud",gravel:"Gravel",silt:"Silt",clay:"Clay",organic:"Organic matter"};return t.map(n=>o[n]||n).join(", ")}formatMixedSoilTypes(){const t={sand:"Sand",mud:"Mud",gravel:"Gravel",silt:"Silt"};return this.mixedSoilTypes.map(o=>t[o]||o).join(", ")}getWeatherLabel(t){return{sunny:"Sunny",partly_cloudy:"Partly Cloudy",cloudy:"Cloudy",rainy:"Rainy",stormy:"Stormy"}[t]||t}getTideLabel(t){return{high:"High",low:"Low",incoming:"Incoming",outgoing:"Outgoing"}[t]||t}setViewMode(t){this.viewMode=t,t?(this.healthForm.disable(),this.healthForm.get("mushroomEvidence")?.enable()):this.healthForm.enable()}onDateChanged(t){const o=t.target;o.value&&(this.healthForm.get("date")?.setValue(o.value),this.setCurrentDateTime())}onTimeChanged(t){const o=t.target;o.value&&(this.healthForm.get("time")?.setValue(o.value),this.setCurrentDateTime())}loadReportForViewing(t){var o=this;return(0,_.A)(function*(){try{const n=yield o.healthSyncService.getAllReports();console.log("HealthFormPage: All reports:",n);const c=n.find(g=>g.report.reportId===t);if(!c)return console.error("HealthFormPage: Report not found for viewing:",t),yield(yield o.alertController.create({header:o.ts.t("Report Not Found"),message:o.ts.t("The requested report could not be found."),buttons:["OK"]})).present(),void o.router.navigate(["/health"]);const a=c.report;console.log("HealthFormPage: Loading report for viewing:",a),o.loadedReport=a,o.healthForm.patchValue({observer:a.form.observer||"",date:a.form.date||"",time:a.form.time||"",weather:a.form.weather||"",tide:a.form.tide||"",location:a.form.location||"",zoneNumber:a.form.zoneNumber||"",quadNumber:a.form.quadNumber||"",canopyCover:a.form.canopyCover||"",recruitmentCover:a.form.recruitmentCover||"",deadTrees:a.form.deadTrees||0,mushroomEvidence:a.form.mushroomEvidence||!1,pollutionSigns:a.form.pollutionSigns||!1,pollutionTypes:a.form.pollutionTypes||[],pollutionObservations:a.form.pollutionObservations||"",soilComposition:a.form.soilComposition||"",soilDescription:a.form.soilDescription||"",predation:a.form.predation||"",predationOther:a.form.predationOther||"",otherObservations:a.form.otherObservations||""}),a.photos&&(Array.isArray(a.photos)?(a.photos[0]&&(a.photos[0].startsWith("data:image/")||console.warn("\u26a0\ufe0f HealthFormPage: Soil photo is not base64:",a.photos[0].substring(0,50)),o.soilPhoto=a.photos[0]),a.photos[1]&&(a.photos[1].startsWith("data:image/")||console.warn("\u26a0\ufe0f HealthFormPage: Predation photo is not base64:",a.photos[1].substring(0,50)),o.predationPhoto=a.photos[1]),a.photos[2]&&(a.photos[2].startsWith("data:image/")||console.warn("\u26a0\ufe0f HealthFormPage: Pollution photo is not base64:",a.photos[2].substring(0,50)),o.pollutionPhoto=a.photos[2])):(o.soilPhoto=a.photos.soil||null,o.predationPhoto=a.photos.predation||null,o.pollutionPhoto=a.photos.pollution||null)),o.currentReportId=t,o.setCurrentDateTime(t),o.updateProgress(),o.setViewMode(!0)}catch(n){console.error("HealthFormPage: Error loading report for viewing:",n),yield(yield o.alertController.create({header:o.ts.t("Error"),message:o.ts.t("Failed to load the report."),buttons:["OK"]})).present(),o.router.navigate(["/health"])}})()}enableEditMode(){!this.currentUser||this.currentUser.level<4||(this.isEditMode=!0,this.viewMode=!1,this.healthForm.enable(),this.originalSubmittedBy=this.loadedReport?.submittedBy||"")}getEditedDateTime(){if(!this.loadedReport)return null;let t=this.loadedReport.editedAt||null;if(!t){const b=this.loadedReport.updatedAt,P=this.loadedReport.createdAt;b&&P&&b!==P&&Math.abs(new Date(b).getTime()-new Date(P).getTime())>5e3&&(t=b)}if(!t)return null;const o=new Date(t);return isNaN(o.getTime())?null:`${o.getDate().toString().padStart(2,"0")}/${(o.getMonth()+1).toString().padStart(2,"0")}/${o.getFullYear()} ${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`}deleteEntry(){var t=this;return(0,_.A)(function*(){const o=t.auth.getCurrentUser();var c;!o||o.level<4?yield(yield t.alertController.create({header:t.ts.t("Permission Denied"),message:t.ts.t("Only Level 4 users can delete entries."),buttons:["OK"]})).present():yield(yield t.alertController.create({header:t.ts.t("Delete Entry"),message:t.ts.t("Are you sure you want to permanently delete this entry? This will remove it from the database and back it up to deleted files storage. This action cannot be undone."),buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Delete"),role:"destructive",handler:(c=(0,_.A)(function*(){yield t.performDeletion()}),function(){return c.apply(this,arguments)})}]})).present()})()}performDeletion(){var t=this;return(0,_.A)(function*(){const o=yield t.loadingController.create({message:t.ts.t("Deleting entry...")});yield o.present();try{const n=t.auth.getCurrentUser();yield t.entryDeletionService.deleteEntry({reportId:t.currentReportId,formType:"health",tableName:"health_reports",deletedBy:n?.username||"Unknown",deletedByEmail:n?.email||"",originalSubmittedBy:t.loadedReport?.submittedBy,originalSubmittedAt:t.loadedReport?.createdAt}),yield o.dismiss(),yield(yield t.alertController.create({header:t.ts.t("Success"),message:t.ts.t("Entry has been deleted and backed up successfully."),buttons:[{text:"OK",handler:()=>{t.router.navigate(["/health"])}}]})).present()}catch(n){yield o.dismiss(),console.error("Error deleting entry:",n),yield(yield t.alertController.create({header:t.ts.t("Error"),message:t.ts.t("Failed to delete entry. Please try again."),buttons:["OK"]})).present()}})()}static#e=i=()=>(this.\u0275fac=function(o){return new(o||l)(e.rXU(y.ok),e.rXU(m.hG),e.rXU(m.Xi),e.rXU(k.Ix),e.rXU(k.nX),e.rXU(D.W),e.rXU(s.m),e.rXU(h.I),e.rXU(u.N),e.rXU(p.r),e.rXU(v.H),e.rXU(C.C),e.rXU(E.k),e.rXU(m.W3),e.rXU(O.L))},this.\u0275cmp=e.VBU({type:l,selectors:[["app-health-form"]],standalone:!1,decls:205,vars:146,consts:[["dateInput",""],["timeInput",""],[1,"health-blue"],["slot","start"],["defaultHref","/health"],[1,"health-blue","compact-toolbar"],[1,"date-time-text"],["style","cursor: pointer;",3,"click",4,"ngIf"],[4,"ngIf"],["type","date",2,"position","absolute","opacity","0","width","0","height","0","pointer-events","none",3,"change","value"],["type","time",2,"position","absolute","opacity","0","width","0","height","0","pointer-events","none",3,"change","value"],[1,"health-blue","metadata-toolbar"],[1,"metadata-container"],[1,"metadata-item",3,"click"],["name","location",1,"metadata-icon"],[1,"metadata-label"],["name","alert-circle","class","status-icon required",4,"ngIf"],["class","metadata-item",3,"click",4,"ngIf"],["class","edit-location-link",3,"click",4,"ngIf"],["style","padding: 0 16px; font-size: 0.75rem; color: #e76f51;",4,"ngIf"],["color","light",3,"value"],[1,"progress-text"],[3,"ngSubmit","formGroup"],["class","edit-mode-banner",4,"ngIf"],["class","edit-mode-banner editing",4,"ngIf"],[2,"position","relative"],["position","stacked"],["formControlName","observer","type","text",3,"placeholder"],["name","close-circle","color","danger","style","position: absolute; top: 12px; right: 10px;",4,"ngIf"],["name","checkmark-circle","style","position: absolute; top: 12px; right: 10px; color: #52a676;",4,"ngIf"],[1,"two-column"],["lines","none",2,"position","relative"],["formControlName","weather","interface","popover",3,"placeholder",4,"ngIf"],["readonly","",3,"value",4,"ngIf"],["formControlName","tide","interface","popover",3,"placeholder",4,"ngIf"],["formControlName","canopyCover","interface","popover",3,"placeholder"],["value","<1%"],["value","1-20%"],["value","21-40%"],["value","41-60%"],["value","61-80%"],["value","81-100%"],["formControlName","recruitmentCover","interface","popover",3,"placeholder"],[1,"counter-field",2,"padding-bottom","15px !important"],[1,"counter-label"],[1,"counter-controls",2,"padding-bottom","15px !important"],["fill","solid","size","small",3,"disabled","click",4,"ngIf"],[1,"counter-value"],["fill","solid","size","small",3,"click",4,"ngIf"],["lines","none"],["formControlName","mushroomEvidence","slot","start"],["formControlName","pollutionSigns","slot","start"],["class","disturbance-item",4,"ngIf"],["formControlName","soilComposition","interface","popover",3,"placeholder","multiple"],["value","sand"],["value","mud"],["value","gravel"],["value","silt"],["class","mixed-soil-note",4,"ngIf"],["class","photo-section",4,"ngIf"],["class","photo-preview",4,"ngIf"],["formControlName","predation","interface","popover",3,"placeholder"],["value","holes_in_leaf"],["value","mealy_bugs"],["value","other"],["formControlName","otherObservations","rows","6",3,"placeholder",4,"ngIf"],["rows","6","readonly","",3,"value",4,"ngIf"],["class","form-buttons",4,"ngIf"],["class","button-container",4,"ngIf"],[2,"cursor","pointer",3,"click"],["name","alert-circle",1,"status-icon","required"],["name","grid",1,"metadata-icon"],["name","apps",1,"metadata-icon"],[1,"edit-location-link",3,"click"],[2,"padding","0 16px","font-size","0.75rem","color","#e76f51"],[1,"edit-mode-banner"],["expand","block","color","warning",3,"click"],["name","create-outline","slot","start"],[1,"edit-mode-banner","editing"],["name","create-outline"],["name","close-circle","color","danger",2,"position","absolute","top","12px","right","10px"],["name","checkmark-circle",2,"position","absolute","top","12px","right","10px","color","#52a676"],["formControlName","weather","interface","popover",3,"placeholder"],["value","sunny"],["value","partly_cloudy"],["value","cloudy"],["value","rainy"],["value","stormy"],["readonly","",3,"value"],["formControlName","tide","interface","popover",3,"placeholder"],["value","high"],["value","low"],["value","incoming"],["value","outgoing"],["fill","solid","size","small",3,"click","disabled"],["name","remove","slot","icon-only"],["fill","solid","size","small",3,"click"],["name","add","slot","icon-only"],[1,"disturbance-item"],[1,"disturbance-title"],["name","close-circle","color","danger","style","position: absolute; top: -15px; right: 10px; z-index: 10; font-size: 24px;",4,"ngIf"],["name","checkmark-circle","style","position: absolute; top: -15px; right: 10px; color: #52a676; z-index: 10; font-size: 24px;",4,"ngIf"],["formControlName","pollutionTypes","multiple","true","interface","popover",2,"margin-top","-5px !important",3,"placeholder"],["value","plastics"],["value","metal"],["value","glass"],["value","fabric"],["value","paper_cardboard"],["value","home_appliance"],["value","construction_debris"],["value","furniture"],["formControlName","pollutionObservations","rows","6",3,"placeholder",4,"ngIf"],["name","close-circle","color","danger",2,"position","absolute","top","-15px","right","10px","z-index","10","font-size","24px"],["name","checkmark-circle",2,"position","absolute","top","-15px","right","10px","color","#52a676","z-index","10","font-size","24px"],[1,"photo-section"],["expand","block","fill","outline",1,"photo-button",3,"click"],["name","camera","slot","start"],[1,"photo-preview"],[1,"photo-item"],["alt","Pollution photo",2,"cursor","pointer",3,"click","src"],["size","small","color","danger",3,"click",4,"ngIf"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"],["formControlName","pollutionObservations","rows","6",3,"placeholder"],["rows","6","readonly","",3,"value"],[1,"mixed-soil-note"],["alt","Soil photo",2,"cursor","pointer",3,"click","src"],["formControlName","predationOther","rows","2",3,"placeholder"],["alt","Predation photo",2,"cursor","pointer",3,"click","src"],["formControlName","otherObservations","rows","6",3,"placeholder"],[1,"form-buttons"],["expand","block","type","submit",1,"submit-button",3,"disabled"],["name","checkmark-circle","slot","start"],["expand","block","fill","outline","color","medium",1,"save-draft-button",3,"click"],["name","save-outline","slot","start"],["expand","block","fill","outline",1,"discard-button",3,"click"],["name","trash-outline","slot","start"],[1,"button-container"],["expand","block","color","danger",1,"delete-button",3,"click"]],template:function(o,n){if(1&o){const c=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3),e.nrm(3,"ion-back-button",4),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.nI1(6,"t"),e.k0s()(),e.j41(7,"ion-toolbar",5)(8,"ion-text",6),e.DNE(9,W,2,1,"span",7)(10,j,2,1,"span",8),e.EFF(11," \xa0 \u2022 \xa0 "),e.DNE(12,z,2,1,"span",7)(13,Y,2,1,"span",8),e.j41(14,"input",9,0),e.bIt("change",function(g){return d.eBV(c),d.Njj(n.onDateChanged(g))}),e.k0s(),e.j41(16,"input",10,1),e.bIt("change",function(g){return d.eBV(c),d.Njj(n.onTimeChanged(g))}),e.k0s(),e.DNE(18,A,2,1,"span",8),e.k0s()(),e.j41(19,"ion-toolbar",11)(20,"div",12)(21,"div",13),e.bIt("click",function(){return d.eBV(c),d.Njj(!n.viewMode&&n.editLocation())}),e.nrm(22,"ion-icon",14),e.j41(23,"span",15),e.EFF(24),e.nI1(25,"t"),e.k0s(),e.DNE(26,V,1,0,"ion-icon",16),e.k0s(),e.DNE(27,ce,4,1,"div",17)(28,de,4,1,"div",17)(29,ue,3,3,"span",18),e.k0s(),e.DNE(30,pe,3,3,"ion-error",19),e.k0s(),e.j41(31,"ion-toolbar",5),e.nrm(32,"ion-progress-bar",20),e.j41(33,"ion-text",21),e.EFF(34),e.nI1(35,"t"),e.k0s()()(),e.j41(36,"ion-content")(37,"form",22),e.bIt("ngSubmit",function(){return d.eBV(c),d.Njj(n.onSubmit())}),e.DNE(38,he,5,3,"div",23)(39,me,5,3,"div",24),e.j41(40,"ion-card")(41,"ion-card-header",2)(42,"ion-card-title"),e.EFF(43),e.nI1(44,"t"),e.k0s()(),e.j41(45,"ion-card-content")(46,"ion-item",25)(47,"ion-label",26),e.EFF(48),e.nI1(49,"t"),e.k0s(),e.nrm(50,"ion-input",27),e.nI1(51,"t"),e.DNE(52,ge,1,0,"ion-icon",28)(53,fe,1,0,"ion-icon",29)(54,be,3,3,"ion-error",8),e.k0s(),e.j41(55,"div",30)(56,"ion-item",31)(57,"ion-label",26),e.EFF(58),e.nI1(59,"t"),e.k0s(),e.DNE(60,_e,17,18,"ion-select",32)(61,ve,1,1,"ion-input",33)(62,Fe,1,0,"ion-icon",28)(63,ye,1,0,"ion-icon",29)(64,Pe,3,3,"ion-error",8),e.k0s(),e.j41(65,"ion-item",31)(66,"ion-label",26),e.EFF(67),e.nI1(68,"t"),e.k0s(),e.DNE(69,xe,14,15,"ion-select",34)(70,ke,1,1,"ion-input",33)(71,Me,1,0,"ion-icon",28)(72,Ce,1,0,"ion-icon",29)(73,Te,3,3,"ion-error",8),e.k0s()()()(),e.j41(74,"ion-card")(75,"ion-card-header",2)(76,"ion-card-title"),e.EFF(77),e.nI1(78,"t"),e.k0s()(),e.j41(79,"ion-card-content")(80,"div",30)(81,"ion-item",31)(82,"ion-label",26),e.EFF(83),e.nI1(84,"t"),e.k0s(),e.j41(85,"ion-select",35),e.nI1(86,"t"),e.j41(87,"ion-select-option",36),e.EFF(88,"<1%"),e.k0s(),e.j41(89,"ion-select-option",37),e.EFF(90,"1-20%"),e.k0s(),e.j41(91,"ion-select-option",38),e.EFF(92,"21-40%"),e.k0s(),e.j41(93,"ion-select-option",39),e.EFF(94,"41-60%"),e.k0s(),e.j41(95,"ion-select-option",40),e.EFF(96,"61-80%"),e.k0s(),e.j41(97,"ion-select-option",41),e.EFF(98,"81-100%"),e.k0s()(),e.DNE(99,Re,1,0,"ion-icon",28)(100,Ie,1,0,"ion-icon",29)(101,Ee,3,3,"ion-error",8),e.k0s(),e.j41(102,"ion-item",31)(103,"ion-label",26),e.EFF(104),e.nI1(105,"t"),e.k0s(),e.j41(106,"ion-select",42),e.nI1(107,"t"),e.j41(108,"ion-select-option",36),e.EFF(109,"<1%"),e.k0s(),e.j41(110,"ion-select-option",37),e.EFF(111,"1-20%"),e.k0s(),e.j41(112,"ion-select-option",38),e.EFF(113,"21-40%"),e.k0s(),e.j41(114,"ion-select-option",39),e.EFF(115,"41-60%"),e.k0s(),e.j41(116,"ion-select-option",40),e.EFF(117,"61-80%"),e.k0s(),e.j41(118,"ion-select-option",41),e.EFF(119,"81-100%"),e.k0s()(),e.DNE(120,Oe,1,0,"ion-icon",28)(121,Se,1,0,"ion-icon",29)(122,$e,3,3,"ion-error",8),e.k0s()(),e.j41(123,"div",43)(124,"ion-label",44),e.EFF(125),e.nI1(126,"t"),e.k0s(),e.j41(127,"div",45),e.DNE(128,De,2,1,"ion-button",46),e.j41(129,"span",47),e.EFF(130),e.k0s(),e.DNE(131,je,2,0,"ion-button",48),e.k0s()(),e.j41(132,"ion-item",49),e.nrm(133,"ion-checkbox",50),e.j41(134,"ion-label"),e.EFF(135),e.nI1(136,"t"),e.k0s()(),e.j41(137,"ion-item",49),e.nrm(138,"ion-checkbox",51),e.j41(139,"ion-label"),e.EFF(140),e.nI1(141,"t"),e.k0s()(),e.DNE(142,Ye,40,36,"div",52),e.k0s()(),e.j41(143,"ion-card")(144,"ion-card-header",2)(145,"ion-card-title"),e.EFF(146),e.nI1(147,"t"),e.k0s()(),e.j41(148,"ion-card-content")(149,"ion-item",31)(150,"ion-label",26),e.EFF(151),e.nI1(152,"t"),e.k0s(),e.j41(153,"ion-select",53),e.nI1(154,"t"),e.j41(155,"ion-select-option",54),e.EFF(156),e.nI1(157,"t"),e.k0s(),e.j41(158,"ion-select-option",55),e.EFF(159),e.nI1(160,"t"),e.k0s(),e.j41(161,"ion-select-option",56),e.EFF(162),e.nI1(163,"t"),e.k0s(),e.j41(164,"ion-select-option",57),e.EFF(165),e.nI1(166,"t"),e.k0s()(),e.DNE(167,Ve,1,0,"ion-icon",28)(168,Je,1,0,"ion-icon",29)(169,qe,3,3,"ion-error",8),e.k0s(),e.DNE(170,Ue,2,1,"ion-note",58)(171,Xe,5,3,"div",59)(172,Qe,7,5,"div",60),e.j41(173,"ion-item",49)(174,"ion-label",26),e.EFF(175),e.nI1(176,"t"),e.k0s(),e.j41(177,"ion-select",61),e.nI1(178,"t"),e.j41(179,"ion-select-option",62),e.EFF(180),e.nI1(181,"t"),e.k0s(),e.j41(182,"ion-select-option",63),e.EFF(183),e.nI1(184,"t"),e.k0s(),e.j41(185,"ion-select-option",64),e.EFF(186),e.nI1(187,"t"),e.k0s()()(),e.DNE(188,We,6,6,"ion-item",8)(189,Ke,5,3,"div",59)(190,et,7,5,"div",60),e.k0s()(),e.j41(191,"ion-card")(192,"ion-card-header",2)(193,"ion-card-title"),e.EFF(194),e.nI1(195,"t"),e.k0s()(),e.j41(196,"ion-card-content")(197,"ion-item",49)(198,"ion-label",26),e.EFF(199),e.nI1(200,"t"),e.k0s(),e.DNE(201,tt,2,3,"ion-textarea",65)(202,ot,1,1,"ion-textarea",66),e.k0s()()(),e.DNE(203,nt,13,10,"div",67)(204,it,5,3,"div",68),e.k0s()()}if(2&o){let c,a,g,F,b,P,x,R,T,I,w,J,N,G,te,q,oe,ne,U,ie,re,X,ae,le,B,K,L,Z,se;e.R7$(5),e.JRh(e.bMT(6,86,"Wetland Health Assessment")),e.R7$(4),e.Y8G("ngIf",(null==n.currentUser?null:n.currentUser.level)>=4&&!n.viewMode),e.R7$(),e.Y8G("ngIf",!((null==n.currentUser?null:n.currentUser.level)>=4&&!n.viewMode)),e.R7$(2),e.Y8G("ngIf",(null==n.currentUser?null:n.currentUser.level)>=4&&!n.viewMode),e.R7$(),e.Y8G("ngIf",!((null==n.currentUser?null:n.currentUser.level)>=4&&!n.viewMode)),e.R7$(),e.Y8G("value",null==(c=n.healthForm.get("date"))?null:c.value),e.R7$(2),e.Y8G("value",null==(a=n.healthForm.get("time"))?null:a.value),e.R7$(2),e.Y8G("ngIf",(n.viewMode||n.isEditMode)&&n.getEditedDateTime()),e.R7$(6),e.JRh((null==(g=n.healthForm.get("location"))?null:g.value)||e.bMT(25,88,"Add location")),e.R7$(2),e.Y8G("ngIf",!(null!=(F=n.healthForm.get("location"))&&F.value||n.viewMode)),e.R7$(),e.Y8G("ngIf",(null==(b=n.healthForm.get("zoneNumber"))?null:b.value)&&n.locationHasZones()),e.R7$(),e.Y8G("ngIf",(null==(P=n.healthForm.get("quadNumber"))?null:P.value)&&n.locationHasQuads()),e.R7$(),e.Y8G("ngIf",n.isEditMode&&n.currentUser&&n.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",(null==(x=n.healthForm.get("location"))?null:x.hasError("required"))&&(null==(x=n.healthForm.get("location"))?null:x.touched)),e.R7$(2),e.Y8G("value",n.progress),e.R7$(2),e.Lme(" ",(100*n.progress).toFixed(0),"% ",e.bMT(35,90,"Complete")," "),e.R7$(2),e.AVh("view-mode",n.viewMode),e.R7$(),e.Y8G("formGroup",n.healthForm),e.R7$(),e.Y8G("ngIf",n.viewMode&&n.currentUser&&n.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",n.isEditMode),e.R7$(4),e.JRh(e.bMT(44,92,"Assessment Information")),e.R7$(5),e.JRh(e.bMT(49,94,"Observer")),e.R7$(2),e.Y8G("placeholder",e.bMT(51,96,"Enter observer name")),e.R7$(2),e.Y8G("ngIf",!(null!=(R=n.healthForm.get("observer"))&&R.value)),e.R7$(),e.Y8G("ngIf",null==(T=n.healthForm.get("observer"))?null:T.value),e.R7$(),e.Y8G("ngIf",(null==(I=n.healthForm.get("observer"))?null:I.hasError("required"))&&(null==(I=n.healthForm.get("observer"))?null:I.touched)),e.R7$(4),e.JRh(e.bMT(59,98,"Weather")),e.R7$(2),e.Y8G("ngIf",!n.viewMode),e.R7$(),e.Y8G("ngIf",n.viewMode),e.R7$(),e.Y8G("ngIf",!(n.viewMode||null!=(w=n.healthForm.get("weather"))&&w.value)),e.R7$(),e.Y8G("ngIf",!n.viewMode&&(null==(J=n.healthForm.get("weather"))?null:J.value)),e.R7$(),e.Y8G("ngIf",!n.viewMode&&(null==(N=n.healthForm.get("weather"))?null:N.hasError("required"))&&(null==(N=n.healthForm.get("weather"))?null:N.touched)),e.R7$(3),e.JRh(e.bMT(68,100,"Tide")),e.R7$(2),e.Y8G("ngIf",!n.viewMode),e.R7$(),e.Y8G("ngIf",n.viewMode),e.R7$(),e.Y8G("ngIf",!(n.viewMode||null!=(G=n.healthForm.get("tide"))&&G.value)),e.R7$(),e.Y8G("ngIf",!n.viewMode&&(null==(te=n.healthForm.get("tide"))?null:te.value)),e.R7$(),e.Y8G("ngIf",!n.viewMode&&(null==(q=n.healthForm.get("tide"))?null:q.hasError("required"))&&(null==(q=n.healthForm.get("tide"))?null:q.touched)),e.R7$(4),e.JRh(e.bMT(78,102,"Wetland Health")),e.R7$(6),e.JRh(e.bMT(84,104,"Canopy Cover %")),e.R7$(2),e.Y8G("placeholder",e.bMT(86,106,"Select %")),e.R7$(14),e.Y8G("ngIf",!(null!=(oe=n.healthForm.get("canopyCover"))&&oe.value)),e.R7$(),e.Y8G("ngIf",null==(ne=n.healthForm.get("canopyCover"))?null:ne.value),e.R7$(),e.Y8G("ngIf",(null==(U=n.healthForm.get("canopyCover"))?null:U.hasError("required"))&&(null==(U=n.healthForm.get("canopyCover"))?null:U.touched)),e.R7$(3),e.JRh(e.bMT(105,108,"Recruitment Cover %")),e.R7$(2),e.Y8G("placeholder",e.bMT(107,110,"Select %")),e.R7$(14),e.Y8G("ngIf",!(null!=(ie=n.healthForm.get("recruitmentCover"))&&ie.value)),e.R7$(),e.Y8G("ngIf",null==(re=n.healthForm.get("recruitmentCover"))?null:re.value),e.R7$(),e.Y8G("ngIf",(null==(X=n.healthForm.get("recruitmentCover"))?null:X.hasError("required"))&&(null==(X=n.healthForm.get("recruitmentCover"))?null:X.touched)),e.R7$(3),e.JRh(e.bMT(126,112,"Dead Mangrove Trees/Stumps")),e.R7$(3),e.Y8G("ngIf",!n.viewMode),e.R7$(2),e.JRh((null==(ae=n.healthForm.get("deadTrees"))?null:ae.value)||0),e.R7$(),e.Y8G("ngIf",!n.viewMode),e.R7$(4),e.JRh(e.bMT(136,114,"Evidence of mushrooms observed")),e.R7$(5),e.JRh(e.bMT(141,116,"Signs of pollution")),e.R7$(2),e.Y8G("ngIf",null==(le=n.healthForm.get("pollutionSigns"))?null:le.value),e.R7$(4),e.JRh(e.bMT(147,118,"Soil & Environmental Factors")),e.R7$(5),e.JRh(e.bMT(152,120,"Soil Composition")),e.R7$(2),e.Y8G("placeholder",e.bMT(154,122,"Select soil type(s)"))("multiple",!0),e.R7$(3),e.JRh(e.bMT(157,124,"Sand")),e.R7$(3),e.JRh(e.bMT(160,126,"Mud")),e.R7$(3),e.JRh(e.bMT(163,128,"Gravel")),e.R7$(3),e.JRh(e.bMT(166,130,"Silt")),e.R7$(2),e.Y8G("ngIf",!(null!=(B=n.healthForm.get("soilComposition"))&&B.value)||0===(null==(B=n.healthForm.get("soilComposition"))||null==B.value?null:B.value.length)),e.R7$(),e.Y8G("ngIf",(null==(K=n.healthForm.get("soilComposition"))||null==K.value?null:K.value.length)>0),e.R7$(),e.Y8G("ngIf",(null==(L=n.healthForm.get("soilComposition"))?null:L.hasError("required"))&&(null==(L=n.healthForm.get("soilComposition"))?null:L.touched)),e.R7$(),e.Y8G("ngIf",(null==(Z=n.healthForm.get("soilComposition"))||null==Z.value?null:Z.value.length)>1),e.R7$(),e.Y8G("ngIf",!n.soilPhoto&&!n.viewMode),e.R7$(),e.Y8G("ngIf",n.soilPhoto),e.R7$(3),e.JRh(e.bMT(176,132,"Predation")),e.R7$(2),e.Y8G("placeholder",e.bMT(178,134,"Select type")),e.R7$(3),e.JRh(e.bMT(181,136,"Holes in leaf (Insect predation)")),e.R7$(3),e.JRh(e.bMT(184,138,"White bugs on tree? Mealy bugs (Lipou)")),e.R7$(3),e.JRh(e.bMT(187,140,"Other (specify)")),e.R7$(2),e.Y8G("ngIf","other"===(null==(se=n.healthForm.get("predation"))?null:se.value)),e.R7$(),e.Y8G("ngIf",!n.predationPhoto&&!n.viewMode),e.R7$(),e.Y8G("ngIf",n.predationPhoto),e.R7$(4),e.JRh(e.bMT(195,142,"Other Observations")),e.R7$(5),e.JRh(e.bMT(200,144,"Additional Notes")),e.R7$(2),e.Y8G("ngIf",!n.viewMode),e.R7$(),e.Y8G("ngIf",n.viewMode),e.R7$(),e.Y8G("ngIf",!n.viewMode),e.R7$(),e.Y8G("ngIf",n.viewMode&&(null==n.currentUser?null:n.currentUser.level)>=4)}},dependencies:[M.bT,y.qT,y.BC,y.cb,y.j4,y.JD,m.Jm,m.QW,m.b_,m.I9,m.ME,m.tN,m.eY,m.W9,m.eU,m.iq,m.$w,m.uz,m.he,m.JI,m.FH,m.Nm,m.Ip,m.IO,m.nc,m.BC,m.ai,m.hB,m.Je,m.Gw,m.el,Q.D],styles:[".health-blue[_ngcontent-%COMP%]{--background: #4fb3bf;color:#fff}.health-blue[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]{--color: white;transition:transform .2s}.health-blue[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]:hover{transform:translate(-4px)}.health-blue[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);width:100%;pointer-events:none}.health-blue.compact-toolbar[_ngcontent-%COMP%]{--min-height: 28px;--padding-top: 5px;--padding-bottom: 5px}.edit-mode-banner[_ngcontent-%COMP%]{padding:.75rem 1rem;margin:.5rem;border-radius:.5rem}.edit-mode-banner[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: .5rem;font-weight:600}.edit-mode-banner.editing[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;display:flex;align-items:center;gap:.5rem;color:#856404;font-weight:500}.edit-mode-banner.editing[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.date-time-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fffffff2;font-size:14px;padding:0;margin:3px 0;font-weight:400;letter-spacing:.3px;line-height:1.2}.metadata-toolbar[_ngcontent-%COMP%]{--min-height: 40px;--padding-top: 6px;--padding-bottom: 6px}.metadata-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px;padding:0 12px;flex-wrap:wrap}.metadata-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;background:#ffffff26;border-radius:16px;padding:5px 10px;cursor:pointer;transition:all .2s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2)}.metadata-item[_ngcontent-%COMP%]:active{transform:scale(.95);background:#ffffff40}.metadata-icon[_ngcontent-%COMP%]{font-size:14px;color:#ffffffe6;min-width:14px}.metadata-label[_ngcontent-%COMP%]{color:#fff;font-size:12px;font-weight:500;letter-spacing:.2px;white-space:nowrap;max-width:120px;overflow:hidden;text-overflow:ellipsis}.edit-location-link[_ngcontent-%COMP%]{color:#ffffffe6;font-size:11px;text-decoration:underline;cursor:pointer;margin-left:8px;padding:4px 8px}.edit-location-link[_ngcontent-%COMP%]:active{opacity:.7}.status-icon[_ngcontent-%COMP%]{font-size:14px;margin-left:2px}.status-icon.success[_ngcontent-%COMP%]{color:#52a676}.status-icon.required[_ngcontent-%COMP%]{color:#ffd93d;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.6}}.progress-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fff;font-size:13px;padding:0;margin:0 0 4px;font-weight:400;line-height:1}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 2px 8px #0000001a}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0;padding:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#fff}@media (min-width: 400px) and (max-width: 800px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem}}@media (max-width: 399px) and (min-width: 360px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.1rem}}@media (max-width: 359px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:.95rem}}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#ffffffe6;font-size:.875rem;margin-top:4px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{background:#fff;padding:16px}.two-column[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}@media (max-width: 768px){.two-column[_ngcontent-%COMP%]{grid-template-columns:1fr}}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;margin-bottom:12px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[position=stacked][_ngcontent-%COMP%]{margin-bottom:12px}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px;border:1px solid #ddd;border-radius:8px;margin-top:4px}ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{--padding-top: 12px;--padding-bottom: 12px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{color:#6b7c7a;font-size:.75rem;margin-top:4px}ion-select[_ngcontent-%COMP%]{width:100%}ion-checkbox[_ngcontent-%COMP%]{--size: 24px;--checkbox-background-checked: #4fb3bf;--border-color-checked: #4fb3bf}.photo-section[_ngcontent-%COMP%]{margin:16px 0}.disturbance-title[_ngcontent-%COMP%]{font-size:.775rem;font-weight:400;color:#000;margin-bottom:-2px;margin-top:5px;display:block}.disturbance-item[_ngcontent-%COMP%]{margin-top:-10px!important;padding-top:-10px!important;position:relative}.photo-button[_ngcontent-%COMP%]{--border-color: #52a676;--color: #52a676}.photo-button[_ngcontent-%COMP%]:hover{--background: rgba(82, 166, 118, .1)}.photo-preview[_ngcontent-%COMP%]{margin:16px 0}.photo-preview[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{display:block;font-weight:600;color:#0d3d2f;margin-bottom:8px}.photo-item[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:12px;padding:12px;background:#f9f9f9;border-radius:8px;border-left:4px solid #4fb3bf}.photo-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:120px;object-fit:cover;border-radius:8px;border:2px solid #4fb3bf;touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.photo-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: #dc2626;--background-hover: #b91c1c;--background-activated: #b91c1c}.form-buttons[_ngcontent-%COMP%]{padding:0 16px;margin-top:24px;margin-bottom:32px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-bottom:12px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-buttons[_ngcontent-%COMP%]   ion-button.save-draft-button[_ngcontent-%COMP%]{margin:10px 0 12px}.form-buttons[_ngcontent-%COMP%]   .save-draft-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--background: rgba(107, 124, 122, .1);--border-color: #6b7c7a;--color: #6b7c7a;--background-hover: rgba(107, 124, 122, .2);--background-activated: rgba(107, 124, 122, .3)}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{margin:0;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #4fb3bf;--background-hover: #3d9daa;--background-activated: #3d9daa}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}.form-buttons[_ngcontent-%COMP%]   .discard-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--color: #e76f51;--border-color: #e76f51;--border-width: 2px;--background-hover: rgba(231, 111, 81, .1);--background-activated: rgba(231, 111, 81, .2);--ripple-color: rgba(231, 111, 81, .3)}.form-buttons[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{margin-top:20px;--background: #d32f2f;--background-hover: #b71c1c;--background-activated: #b71c1c;font-weight:600;height:48px;font-size:1rem}.submit-button[_ngcontent-%COMP%]{margin:24px 16px 32px;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #4fb3bf;--background-hover: #3d9daa;--background-activated: #3d9daa}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}.counter-field[_ngcontent-%COMP%]{padding:12px 16px;background:#f9f9f9;border-radius:8px;margin:8px 0 18px}.counter-label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:500;color:#333;margin-bottom:8px}.counter-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:16px}.counter-controls[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: #52a676;--border-color: #0d3d2f;--color: #0d3d2f;--background-hover: rgba(13, 61, 47, .1);--border-radius: 50%;width:40px;height:40px;margin:0}.counter-value[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#0d3d2f;min-width:50px;text-align:center}.counter-note[_ngcontent-%COMP%]{display:block;text-align:center;margin-top:8px;font-size:12px;color:#666}.mixed-soil-note[_ngcontent-%COMP%]{display:block;padding:8px 16px;margin-top:4px;font-size:12px;color:#52a676;font-style:italic}.soil-badges-section[_ngcontent-%COMP%]{padding:12px 16px;background:#f9f9f9;border-radius:8px;margin:8px 0}.badges-label[_ngcontent-%COMP%]{display:block;font-size:13px;color:#333;margin-bottom:10px}.soil-badges[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.soil-badges[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{padding:8px 16px;font-size:14px;border-radius:20px;cursor:pointer;background:#e0e0e0;color:#666;transition:all .2s ease}.soil-badges[_ngcontent-%COMP%]   ion-badge.selected[_ngcontent-%COMP%]{background:#52a676;color:#fff}ion-select[_ngcontent-%COMP%]{--placeholder-color: #999;--placeholder-opacity: 1;font-size:.95rem;max-width:100%}  ion-popover.select-popover{--width: auto;--min-width: 250px;--max-width: 90vw}  ion-popover.select-popover .popover-content{border-radius:12px;box-shadow:0 4px 16px #00000026}  ion-popover.select-popover ion-list{padding:8px 0}  ion-popover.select-popover ion-item{--padding-start: 16px;--padding-end: 16px;--min-height: 44px;font-size:.95rem}  ion-popover.select-popover ion-checkbox{--size: 20px;margin-right:12px;--checkbox-background-checked: #52a676 !important;--border-color-checked: #52a676 !important;--border-color: #52a676 !important;--color-checked: #52a676 !important;--checkmark-color: white !important;--background: white !important}  ion-popover.select-popover ion-item.item-checkbox-checked{--color: #52a676}  ion-popover.select-popover ion-item.item-checkbox-checked ion-label{color:#52a676!important;font-weight:500}  .select-interface-option{border-radius:8px}ion-error[_ngcontent-%COMP%]{color:#e76f51!important;font-size:.75rem!important;margin-top:4px;padding-left:16px}ion-item.item-disabled[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%], ion-item.item-select-disabled[_ngcontent-%COMP%]{opacity:1!important;--opacity: 1 !important}ion-item.item-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-item.item-select-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:1!important;color:#000!important;--color: #000 !important}ion-item.item-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%], ion-item.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{opacity:1!important;--opacity: 1 !important;color:#000!important;--color: #000 !important;--placeholder-color: #000 !important;--placeholder-opacity: 1 !important}  .item-disabled,   .item-interactive-disabled,   .item-select-disabled,   ion-item:has(ion-select.select-disabled),   ion-item:has(ion-toggle.toggle-disabled),   ion-item:has(ion-checkbox.checkbox-disabled),   ion-item:has(ion-input.input-disabled){opacity:1!important}  .item-disabled ion-label,   .item-disabled .label-text,   .item-disabled .label-text-wrapper,   .item-disabled .native-input,   .item-disabled .select-text,   .item-disabled .select-icon,   .item-interactive-disabled ion-label,   .item-interactive-disabled .label-text,   .item-interactive-disabled .label-text-wrapper,   .item-interactive-disabled .native-input,   .item-interactive-disabled .select-text,   .item-interactive-disabled .select-icon,   .item-select-disabled ion-label,   .item-select-disabled .label-text,   .item-select-disabled .label-text-wrapper,   .item-select-disabled .native-input,   .item-select-disabled .select-text,   .item-select-disabled .select-icon,   ion-item:has(ion-select.select-disabled) ion-label,   ion-item:has(ion-select.select-disabled) .label-text,   ion-item:has(ion-select.select-disabled) .label-text-wrapper,   ion-item:has(ion-select.select-disabled) .native-input,   ion-item:has(ion-select.select-disabled) .select-text,   ion-item:has(ion-select.select-disabled) .select-icon,   ion-item:has(ion-toggle.toggle-disabled) ion-label,   ion-item:has(ion-toggle.toggle-disabled) .label-text,   ion-item:has(ion-toggle.toggle-disabled) .label-text-wrapper,   ion-item:has(ion-toggle.toggle-disabled) .native-input,   ion-item:has(ion-toggle.toggle-disabled) .select-text,   ion-item:has(ion-toggle.toggle-disabled) .select-icon,   ion-item:has(ion-checkbox.checkbox-disabled) ion-label,   ion-item:has(ion-checkbox.checkbox-disabled) .label-text,   ion-item:has(ion-checkbox.checkbox-disabled) .label-text-wrapper,   ion-item:has(ion-checkbox.checkbox-disabled) .native-input,   ion-item:has(ion-checkbox.checkbox-disabled) .select-text,   ion-item:has(ion-checkbox.checkbox-disabled) .select-icon,   ion-item:has(ion-input.input-disabled) ion-label,   ion-item:has(ion-input.input-disabled) .label-text,   ion-item:has(ion-input.input-disabled) .label-text-wrapper,   ion-item:has(ion-input.input-disabled) .native-input,   ion-item:has(ion-input.input-disabled) .select-text,   ion-item:has(ion-input.input-disabled) .select-icon{opacity:1!important;color:#000!important;--color: #000 !important}  ion-label[position=stacked],   ion-label.label-stacked{opacity:1!important;color:#000!important;--color: #000 !important}  ion-select.select-disabled,   ion-select[disabled]{opacity:1!important;--opacity: 1 !important;color:#000!important;--color: #000 !important;--placeholder-color: #000 !important;--placeholder-opacity: 1 !important}  ion-select.select-disabled .select-text,   ion-select.select-disabled .select-icon,   ion-select.select-disabled .select-placeholder,   ion-select.select-disabled .select-icon-inner,   ion-select[disabled] .select-text,   ion-select[disabled] .select-icon,   ion-select[disabled] .select-placeholder,   ion-select[disabled] .select-icon-inner{opacity:1!important;color:#000!important}  ion-select.select-disabled::part(text),   ion-select.select-disabled::part(icon),   ion-select.select-disabled::part(placeholder),   ion-select[disabled]::part(text),   ion-select[disabled]::part(icon),   ion-select[disabled]::part(placeholder){opacity:1!important;color:#000!important}  ion-toggle.toggle-disabled,   ion-toggle[disabled]{opacity:1!important;--opacity: 1 !important}  ion-checkbox.checkbox-disabled,   ion-checkbox[disabled]{opacity:1!important;--opacity: 1 !important}  ion-input.input-disabled,   ion-input[disabled],   ion-textarea.textarea-disabled,   ion-textarea[disabled]{opacity:1!important;--opacity: 1 !important}  ion-input.input-disabled .native-input,   ion-input.input-disabled .native-textarea,   ion-input.input-disabled input,   ion-input.input-disabled textarea,   ion-input[disabled] .native-input,   ion-input[disabled] .native-textarea,   ion-input[disabled] input,   ion-input[disabled] textarea,   ion-textarea.textarea-disabled .native-input,   ion-textarea.textarea-disabled .native-textarea,   ion-textarea.textarea-disabled input,   ion-textarea.textarea-disabled textarea,   ion-textarea[disabled] .native-input,   ion-textarea[disabled] .native-textarea,   ion-textarea[disabled] input,   ion-textarea[disabled] textarea{opacity:1!important;color:#000!important;-webkit-text-fill-color:#000!important}  ion-input.input-disabled::part(native),   ion-input[disabled]::part(native),   ion-textarea.textarea-disabled::part(native),   ion-textarea[disabled]::part(native){opacity:1!important;color:#000!important;-webkit-text-fill-color:#000!important}  ion-content.view-mode ion-checkbox{pointer-events:none!important;cursor:default!important}@media (max-width: 768px){.photo-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.photo-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:200px}ion-card[_ngcontent-%COMP%]{margin:12px}}  .fullscreen-photo-modal{--width: 100%;--height: 100%;--border-radius: 0}  .fullscreen-photo-modal .modal-wrapper{position:absolute;top:0;left:0;width:100%;height:100%}"]}))}return i(),l})(),at=(()=>{var i;class l{constructor(t){this.modalController=t}dismiss(){this.modalController.dismiss()}static#e=i=()=>(this.\u0275fac=function(o){return new(o||l)(e.rXU(m.W3))},this.\u0275cmp=e.VBU({type:l,selectors:[["app-health-fullscreen-photo"]],decls:4,vars:2,consts:[[1,"fullscreen-container",3,"click"],["fill","clear",1,"close-button",3,"click"],["name","close","slot","icon-only"],[3,"src","alt"]],template:function(o,n){1&o&&(e.j41(0,"div",0),e.bIt("click",function(){return n.dismiss()}),e.j41(1,"ion-button",1),e.bIt("click",function(){return n.dismiss()}),e.nrm(2,"ion-icon",2),e.k0s(),e.nrm(3,"img",3),e.k0s()),2&o&&(e.R7$(3),e.Y8G("src",n.photoUrl,e.B4B)("alt",n.photoType+" photo"))},dependencies:[m.bv,m.Jm,m.iq,M.MD],styles:[".fullscreen-container[_ngcontent-%COMP%]{width:100vw;height:100vh;background:#000000f2;display:flex;align-items:center;justify-content:center;position:relative}.close-button[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;z-index:1000;--color: white;--background: rgba(0, 0, 0, .5);--border-radius: 50%;width:44px;height:44px;font-size:28px}img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain;touch-action:none;-webkit-user-select:none;user-select:none}"]}))}return i(),l})();const lt=[{path:"",component:rt}];let st=(()=>{var i;class l{static#e=i=()=>(this.\u0275fac=function(o){return new(o||l)},this.\u0275mod=e.$C({type:l}),this.\u0275inj=d.G2t({imports:[$.iI.forChild(lt),$.iI]}))}return i(),l})();var ct=f(4670);let dt=(()=>{var i;class l{static#e=i=()=>(this.\u0275fac=function(o){return new(o||l)},this.\u0275mod=e.$C({type:l}),this.\u0275inj=d.G2t({imports:[M.MD,y.YN,y.X1,m.bv,st,ct.k]}))}return i(),l})()},9187(ee,H,f){f.d(H,{C:()=>e});var M=f(467),y=f(2084),m=f(2615),$=f(5029),_=f(918),S=f(8863);let e=(()=>{var d;class k{constructor(s,h,u){this.supabase=s,this.sharedDataService=h,this.monitoringLog=u}deleteEntry(s){var h=this;return(0,M.A)(function*(){console.log("[EntryDeletionService] Starting deletion process for:",s);try{const u=yield h.fetchOriginalEntry(s.tableName,s.reportId);if(!u)throw new Error(`Entry not found in table ${s.tableName} with reportId ${s.reportId}`);console.log("[EntryDeletionService] Original entry fetched:",u);const p=yield h.backupToDeletedFiles(s,u);console.log("[EntryDeletionService] Backup completed:",p),yield h.recordDeletionMetadata(s,p,u),console.log("[EntryDeletionService] Deletion metadata recorded"),yield h.deleteImagesFromBucket(u,s.formType,s.reportId),console.log("[EntryDeletionService] Images deleted from bucket"),yield h.deleteJsonFromStorage(s.formType,s.reportId),console.log("[EntryDeletionService] JSON file deleted from storage"),yield h.deleteFromTable(s.tableName,s.reportId),console.log("[EntryDeletionService] Entry deleted from table"),yield h.deleteLocalFile(s.formType,s.reportId),console.log("[EntryDeletionService] Local file deleted");const v=h.getEntrySummary(u,s.formType);h.monitoringLog.recordFormDeleted(s.deletedBy,s.formType,s.reportId,v),console.log("[EntryDeletionService] \u2705 Deletion process completed successfully")}catch(u){throw console.error("[EntryDeletionService] \u274c Deletion process failed:",u),u}})()}getEntrySummary(s,h){const u=[];return s?.location&&u.push(s.location),s?.zone_number&&u.push(`Z${s.zone_number}`),s?.quad_number&&u.push(`Q${s.quad_number}`),s?.observation_date&&u.push(s.observation_date),u.join(", ")||h}fetchOriginalEntry(s,h){var u=this;return(0,M.A)(function*(){const{data:p,error:v}=yield u.supabase.getClient().from(s).select("*").eq("report_id",h).single();if(v)throw console.error("[EntryDeletionService] Error fetching original entry:",v),v;return p})()}backupToDeletedFiles(s,h){var u=this;return(0,M.A)(function*(){const p=`${s.formType}/${s.reportId}`,v=`${p}/${s.reportId}.json`,C=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),{error:E}=yield u.supabase.getClient().storage.from("deleted_files").upload(v,C);if(E)throw console.error("[EntryDeletionService] Error backing up JSON:",E),E;const O=[],Q=u.getImageBucketName(s.formType),W=u.extractImagePathsFromEntry(h,s.formType,s.reportId);for(const j of W)if(j)try{const{data:z,error:Y}=yield u.supabase.getClient().storage.from(Q).download(j);if(Y){console.warn("[EntryDeletionService] Could not download image:",j,Y);continue}const A=`${p}/${j.split("/").pop()}`,{error:V}=yield u.supabase.getClient().storage.from("deleted_files").upload(A,z);V?console.warn("[EntryDeletionService] Could not backup image:",A,V):O.push(A)}catch(z){console.warn("[EntryDeletionService] Error processing image:",z)}return{backupFolderPath:p,jsonBackupPath:v,imageBackupPaths:O}})()}recordDeletionMetadata(s,h,u){var p=this;return(0,M.A)(function*(){const v={original_entry:u,backup_paths:{json:h.jsonBackupPath,images:h.imageBackupPaths},deletion_timestamp:(0,y.E)()},{error:C}=yield p.supabase.getClient().from("deleted_metadata_files").insert({original_report_id:s.reportId,form_type:s.formType,deleted_by:s.deletedBy,deleted_by_email:s.deletedByEmail,original_submitted_by:s.originalSubmittedBy||u.submittedBy,original_submitted_at:s.originalSubmittedAt||u.createdAt,backup_folder_path:h.backupFolderPath,original_table_name:s.tableName,original_storage_path:p.getStoragePath(s.tableName,s.reportId),metadata:v});if(C)throw console.error("[EntryDeletionService] Error recording deletion metadata:",C),C})()}deleteImagesFromBucket(s,h,u){var p=this;return(0,M.A)(function*(){const v=p.getImageBucketName(h),C=p.extractImagePathsFromEntry(s,h,u);for(const E of C)if(E)try{const{error:O}=yield p.supabase.getClient().storage.from(v).remove([E]);O&&console.warn("[EntryDeletionService] Could not delete image:",E,O)}catch(O){console.warn("[EntryDeletionService] Error deleting image:",O)}})()}deleteJsonFromStorage(s,h){var u=this;return(0,M.A)(function*(){const p=u.getReportsBucketName(s),v=`${h}.json`,{error:C}=yield u.supabase.getClient().storage.from(p).remove([v]);C&&console.warn("[EntryDeletionService] Could not delete JSON from storage:",v,C)})()}deleteFromTable(s,h){var u=this;return(0,M.A)(function*(){const{error:p}=yield u.supabase.getClient().from(s).delete().eq("report_id",h);if(p)throw console.error("[EntryDeletionService] Error deleting from table:",p),p})()}deleteLocalFile(s,h){var u=this;return(0,M.A)(function*(){try{const p=u.getLocalFileName(s,h);yield u.sharedDataService.deleteJsonFile(p)}catch(p){console.warn("[EntryDeletionService] Could not delete local file:",p)}})()}getReportsBucketName(s){return s}getImageBucketName(s){return{"flora-fauna":"flora-fauna-images",biomass:"biomass-images",health:"health-images",outplanting:"outplanting-images",restoration:"restoration-images",cleanup:"cleanup-images",pollution:"pollution-images",disturbances:"disturbances-images"}[s]||`${s}-images`}extractImagePathsFromEntry(s,h,u){const p=[];if("health"===h)return p.push(`${u}/soil.jpg`),p.push(`${u}/predation.jpg`),p.push(`${u}/pollution.jpg`),p;if("pollution"===h){p.push(`${u}/greyWater.jpg`),p.push(`${u}/trash.jpg`),p.push(`${u}/sewage.jpg`);for(let v=1;v<=10;v++)p.push(`${u}/photo_${v}.jpg`);return p}if("disturbances"===h)return p.push(`${u}/harvest.jpg`),p.push(`${u}/clearing.jpg`),p.push(`${u}/construction.jpg`),p.push(`${u}/fallenTree.jpg`),p.push(`${u}/erosion.jpg`),p.push(`${u}/accretion.jpg`),p.push(`${u}/diseases.jpg`),p;for(let v=1;v<=20;v++)p.push(`${u}/photo_${v}.jpg`);return p}getStoragePath(s,h){return`${s}/${h}.json`}getLocalFileName(s,h){return`${h}.json`}static#e=d=()=>(this.\u0275fac=function(h){return new(h||k)(m.KVO($.L),m.KVO(_.H),m.KVO(S.u))},this.\u0275prov=m.jDH({token:k,factory:k.\u0275fac,providedIn:"root"}))}return d(),k})()}}]);