"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3800],{152(X,N,f){f.d(N,{B:()=>T});var C=f(8839),x=f(9974),h=f(4360);function T(b,j=C.E){return(0,x.N)((R,e)=>{let c=null,S=null,l=null;const p=()=>{if(c){c.unsubscribe(),c=null;const g=S;S=null,e.next(g)}};function d(){const g=l+b,v=j.now();if(v<g)return c=this.schedule(void 0,g-v),void e.add(c);p()}R.subscribe((0,h._)(e,g=>{S=g,l=j.now(),c||(c=j.schedule(d,b),e.add(c))},()=>{p(),e.complete()},void 0,()=>{S=c=null}))})}},3800(X,N,f){f.d(N,{DisturbancesPageModule:()=>ke});var C=f(2200),x=f(4341),h=f(7343),T=f(8132),b=f(467),j=f(7762),R=f(152),e=f(3664),c=f(2615),S=f(5921),l=f(3205),p=f(6201),d=f(5010),g=f(918),v=f(9187),M=f(7643);function D(i,u){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.SpI(" (edited: ",r.getEditedDateTime(),")")}}function O(i,u){1&i&&e.nrm(0,"ion-icon",53)}function V(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",8),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(!n.viewMode&&n.editZone())}),e.nrm(1,"ion-icon",54),e.j41(2,"span",10),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.JRh(t.getZoneName(null==(r=t.disturbancesForm.get("zoneNumber"))?null:r.value))}}function Y(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",8),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(!n.viewMode&&n.editQuad())}),e.nrm(1,"ion-icon",55),e.j41(2,"span",10),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.SpI("Quad ",t.getQuadDisplay(null==(r=t.disturbancesForm.get("quadNumber"))?null:r.value))}}function w(i,u){if(1&i){const r=e.RV6();e.j41(0,"span",56),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.editLocationAdmin())}),e.EFF(1," Edit location "),e.k0s()}}function $(i,u){1&i&&(e.j41(0,"ion-error",57),e.EFF(1," Location is required "),e.k0s())}function A(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",58)(1,"ion-button",59),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.enableEditMode())}),e.nrm(2,"ion-icon",60),e.EFF(3," Edit This Entry "),e.k0s()()}}function I(i,u){1&i&&(e.j41(0,"div",61),e.nrm(1,"ion-icon",62),e.j41(2,"span"),e.EFF(3,"Editing Entry - Changes will replace the original submission"),e.k0s()())}function z(i,u){1&i&&(e.j41(0,"p",63),e.nrm(1,"ion-icon",64),e.EFF(2," Tap to get current GPS location "),e.k0s())}function U(i,u){if(1&i&&(e.j41(0,"p",65),e.nrm(1,"ion-icon",66),e.EFF(2),e.k0s()),2&i){const r=e.XpG();e.R7$(2),e.Lme(" ",r.coordinates.latitude.toFixed(6),", ",r.coordinates.longitude.toFixed(6)," ")}}function L(i,u){1&i&&(e.j41(0,"p",67),e.nrm(1,"ion-icon",68),e.EFF(2," GPS captured when creating new site "),e.k0s())}function q(i,u){1&i&&(e.j41(0,"ion-item")(1,"ion-label",29),e.EFF(2,"Please specify"),e.k0s(),e.nrm(3,"ion-input",69),e.k0s())}function Q(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",70),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.capturePhoto("harvest"))}),e.nrm(1,"ion-icon",71),e.EFF(2," Take Photo "),e.k0s()}}function K(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",77),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.removePhoto("harvest"))}),e.nrm(1,"ion-icon",78),e.k0s()}}function Z(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",72)(1,"div",73)(2,"img",74),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.openFullScreenPhoto(n.harvestPhoto,"Harvest"))}),e.k0s(),e.j41(3,"small",75),e.EFF(4,"Tap to view full size"),e.k0s()(),e.DNE(5,K,2,0,"ion-button",76),e.k0s()}if(2&i){const r=e.XpG();e.R7$(2),e.Y8G("src",r.harvestPhoto,e.B4B),e.R7$(3),e.Y8G("ngIf",!r.viewMode)}}function W(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",70),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.capturePhoto("clearing"))}),e.nrm(1,"ion-icon",71),e.EFF(2," Take Photo "),e.k0s()}}function H(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",77),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.removePhoto("clearing"))}),e.nrm(1,"ion-icon",78),e.k0s()}}function J(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",72)(1,"div",73)(2,"img",79),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.openFullScreenPhoto(n.clearingPhoto,"Clearing"))}),e.k0s(),e.j41(3,"small",75),e.EFF(4,"Tap to view full size"),e.k0s()(),e.DNE(5,H,2,0,"ion-button",76),e.k0s()}if(2&i){const r=e.XpG();e.R7$(2),e.Y8G("src",r.clearingPhoto,e.B4B),e.R7$(3),e.Y8G("ngIf",!r.viewMode)}}function ee(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",70),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.capturePhoto("construction"))}),e.nrm(1,"ion-icon",71),e.EFF(2," Take Photo "),e.k0s()}}function te(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",77),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.removePhoto("construction"))}),e.nrm(1,"ion-icon",78),e.k0s()}}function ne(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",72)(1,"div",73)(2,"img",80),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.openFullScreenPhoto(n.constructionPhoto,"Construction"))}),e.k0s(),e.j41(3,"small",75),e.EFF(4,"Tap to view full size"),e.k0s()(),e.DNE(5,te,2,0,"ion-button",76),e.k0s()}if(2&i){const r=e.XpG();e.R7$(2),e.Y8G("src",r.constructionPhoto,e.B4B),e.R7$(3),e.Y8G("ngIf",!r.viewMode)}}function oe(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",70),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.capturePhoto("fallenTree"))}),e.nrm(1,"ion-icon",71),e.EFF(2," Take Photo "),e.k0s()}}function ie(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",77),e.bIt("click",function(){c.eBV(r);const n=e.XpG(3);return c.Njj(n.removePhoto("fallenTree"))}),e.nrm(1,"ion-icon",78),e.k0s()}}function re(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",72)(1,"div",73)(2,"img",87),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.openFullScreenPhoto(n.fallenTreePhoto,"Fallen Tree"))}),e.k0s(),e.j41(3,"small",75),e.EFF(4,"Tap to view full size"),e.k0s()(),e.DNE(5,ie,2,0,"ion-button",76),e.k0s()}if(2&i){const r=e.XpG(2);e.R7$(2),e.Y8G("src",r.fallenTreePhoto,e.B4B),e.R7$(3),e.Y8G("ngIf",!r.viewMode)}}function ae(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",70),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.capturePhoto("erosion"))}),e.nrm(1,"ion-icon",71),e.EFF(2," Take Photo "),e.k0s()}}function se(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",77),e.bIt("click",function(){c.eBV(r);const n=e.XpG(3);return c.Njj(n.removePhoto("erosion"))}),e.nrm(1,"ion-icon",78),e.k0s()}}function ce(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",72)(1,"div",73)(2,"img",88),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.openFullScreenPhoto(n.erosionPhoto,"Erosion"))}),e.k0s(),e.j41(3,"small",75),e.EFF(4,"Tap to view full size"),e.k0s()(),e.DNE(5,se,2,0,"ion-button",76),e.k0s()}if(2&i){const r=e.XpG(2);e.R7$(2),e.Y8G("src",r.erosionPhoto,e.B4B),e.R7$(3),e.Y8G("ngIf",!r.viewMode)}}function le(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",70),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.capturePhoto("diseases"))}),e.nrm(1,"ion-icon",71),e.EFF(2," Take Photo "),e.k0s()}}function de(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",77),e.bIt("click",function(){c.eBV(r);const n=e.XpG(3);return c.Njj(n.removePhoto("diseases"))}),e.nrm(1,"ion-icon",78),e.k0s()}}function ue(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",72)(1,"div",73)(2,"img",89),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.openFullScreenPhoto(n.diseasesPhoto,"Diseases"))}),e.k0s(),e.j41(3,"small",75),e.EFF(4,"Tap to view full size"),e.k0s()(),e.DNE(5,de,2,0,"ion-button",76),e.k0s()}if(2&i){const r=e.XpG(2);e.R7$(2),e.Y8G("src",r.diseasesPhoto,e.B4B),e.R7$(3),e.Y8G("ngIf",!r.viewMode)}}function ge(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",70),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.capturePhoto("accretion"))}),e.nrm(1,"ion-icon",71),e.EFF(2," Take Photo "),e.k0s()}}function pe(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",77),e.bIt("click",function(){c.eBV(r);const n=e.XpG(3);return c.Njj(n.removePhoto("accretion"))}),e.nrm(1,"ion-icon",78),e.k0s()}}function me(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",72)(1,"div",73)(2,"img",90),e.bIt("click",function(){c.eBV(r);const n=e.XpG(2);return c.Njj(n.openFullScreenPhoto(n.accretionPhoto,"Accretion"))}),e.k0s(),e.j41(3,"small",75),e.EFF(4,"Tap to view full size"),e.k0s()(),e.DNE(5,pe,2,0,"ion-button",76),e.k0s()}if(2&i){const r=e.XpG(2);e.R7$(2),e.Y8G("src",r.accretionPhoto,e.B4B),e.R7$(3),e.Y8G("ngIf",!r.viewMode)}}function he(i,u){if(1&i&&(e.j41(0,"ion-card")(1,"ion-card-header",0)(2,"ion-card-title"),e.EFF(3,"Evidence of Natural Disturbances"),e.k0s()(),e.j41(4,"ion-card-content")(5,"div",28)(6,"div",42),e.EFF(7,"Fallen tree"),e.k0s(),e.j41(8,"ion-item",43)(9,"div",44)(10,"span",45),e.EFF(11,"No"),e.k0s(),e.nrm(12,"ion-toggle",81),e.j41(13,"span",47),e.EFF(14,"Yes"),e.k0s()(),e.j41(15,"div",35),e.DNE(16,oe,3,0,"ion-button",36),e.k0s()(),e.DNE(17,re,6,2,"div",37),e.k0s(),e.nrm(18,"ion-item-divider"),e.j41(19,"div",28)(20,"div",42),e.EFF(21,"Bank erosion"),e.k0s(),e.j41(22,"ion-item",43)(23,"div",44)(24,"span",45),e.EFF(25,"No"),e.k0s(),e.nrm(26,"ion-toggle",82),e.j41(27,"span",47),e.EFF(28,"Yes"),e.k0s()(),e.j41(29,"div",35),e.DNE(30,ae,3,0,"ion-button",36),e.k0s()(),e.DNE(31,ce,6,2,"div",37),e.k0s(),e.nrm(32,"ion-item-divider"),e.j41(33,"div",28)(34,"div",42),e.EFF(35,"Diseases"),e.k0s(),e.j41(36,"ion-item",43)(37,"div",44)(38,"span",45),e.EFF(39,"No"),e.k0s(),e.nrm(40,"ion-toggle",83),e.j41(41,"span",47),e.EFF(42,"Yes"),e.k0s()(),e.j41(43,"div",35),e.DNE(44,le,3,0,"ion-button",36),e.k0s()(),e.DNE(45,ue,6,2,"div",37),e.k0s(),e.nrm(46,"ion-item-divider"),e.j41(47,"div",28)(48,"div",42),e.EFF(49,"Accretion"),e.k0s(),e.j41(50,"ion-item"),e.nrm(51,"ion-label",29),e.j41(52,"ion-select",84)(53,"ion-select-option",85),e.EFF(54,"Sand deposition"),e.k0s(),e.j41(55,"ion-select-option",86),e.EFF(56,"Soil deposition"),e.k0s()()(),e.j41(57,"div",35),e.DNE(58,ge,3,0,"ion-button",36),e.k0s(),e.DNE(59,me,6,2,"div",37),e.k0s()()()),2&i){let r,t,n,o,a,s;const m=e.XpG();e.R7$(10),e.Y8G("hidden",null==(r=m.disturbancesForm.get("fallenTree"))?null:r.value),e.R7$(3),e.Y8G("hidden",!(null!=(t=m.disturbancesForm.get("fallenTree"))&&t.value)),e.R7$(3),e.Y8G("ngIf",!m.viewMode),e.R7$(),e.Y8G("ngIf",m.fallenTreePhoto),e.R7$(7),e.Y8G("hidden",null==(n=m.disturbancesForm.get("bankErosion"))?null:n.value),e.R7$(3),e.Y8G("hidden",!(null!=(o=m.disturbancesForm.get("bankErosion"))&&o.value)),e.R7$(3),e.Y8G("ngIf",!m.viewMode),e.R7$(),e.Y8G("ngIf",m.erosionPhoto),e.R7$(7),e.Y8G("hidden",null==(a=m.disturbancesForm.get("diseases"))?null:a.value),e.R7$(3),e.Y8G("hidden",!(null!=(s=m.disturbancesForm.get("diseases"))&&s.value)),e.R7$(3),e.Y8G("ngIf",!m.viewMode),e.R7$(),e.Y8G("ngIf",m.diseasesPhoto),e.R7$(13),e.Y8G("ngIf",!m.viewMode),e.R7$(),e.Y8G("ngIf",m.accretionPhoto)}}function _e(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",91)(1,"ion-button",92),e.nrm(2,"ion-icon",93),e.EFF(3," Submit Disturbances Report "),e.k0s(),e.j41(4,"ion-button",94),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.saveDraft())}),e.nrm(5,"ion-icon",95),e.EFF(6," Save Draft "),e.k0s(),e.j41(7,"ion-button",96),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.discardForm())}),e.nrm(8,"ion-icon",97),e.EFF(9," Discard "),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(),e.Y8G("disabled",!(null!=(r=t.disturbancesForm.get("location"))&&r.value))}}function fe(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",98)(1,"ion-button",99),e.bIt("click",function(){c.eBV(r);const n=e.XpG();return c.Njj(n.deleteEntry())}),e.nrm(2,"ion-icon",97),e.EFF(3," Delete Entry "),e.k0s()()}}let be=(()=>{var i;class u{forceDeleteDraftFile(t){var n=this;return(0,b.A)(function*(){for(let o=0;o<3;o++)try{yield n.sharedDataService.deleteJsonFile(t),console.log(`Draft file force deleted successfully (attempt ${o+1})`);break}catch(a){if(console.error(`Error force deleting draft file (attempt ${o+1}):`,a),2===o)try{yield n.sharedDataService.writeJsonFile(t,null),console.log("Draft file cleared with null write")}catch(s){console.error("Failed to clear draft file with null write:",s)}yield new Promise(s=>setTimeout(s,100))}})()}constructor(t,n,o,a,s,m,P,_,k,y,F,E){this.formBuilder=t,this.alertController=n,this.loadingController=o,this.modalController=a,this.router=s,this.route=m,this.auth=P,this.disturbancesSyncService=_,this.photoService=k,this.sharedDataService=y,this.entryDeletionService=F,this.siteSyncService=E,this.progress=0,this.coordinates=null,this.currentDateTime="",this.canAccessNaturalDisturbances=!1,this.harvestPhoto="",this.clearingPhoto="",this.constructionPhoto="",this.fallenTreePhoto="",this.erosionPhoto="",this.accretionPhoto="",this.diseasesPhoto="",this.viewMode=!1,this.currentReportId="",this.currentUser=null,this.loadedReport=null,this.gpsFromLocation=!1,this.autosaveSub=null,this.isDiscarded=!1,this.isSubmitted=!1,this.isSubmitting=!1,this.isEditMode=!1,this.originalSubmittedBy="",this.availableLocations=[{name:"Ramsar",hasZones:!0,hasQuads:!0,zones:["1","2","3","4","5","6"],quads:Array.from({length:30},(G,B)=>`quad${B+1}`),zoneQuadMap:{1:[1,2,3],2:[13,14,15,16,17,18,20,21,22,23,25,27,28,29],3:[19,26],4:[4,5],5:[6,7,11,12,24,30],6:[8,9,10]}},{name:"Grand Anse",hasZones:!0,hasQuads:!0,zones:["1","2","3","4"],quads:Array.from({length:22},(G,B)=>`ga${B+1}`),zoneQuadMap:{1:[1,2,3,4],2:[5,6,7,8,9,10,21,22],3:[11,12,13,14,15,16,17,18],4:[19,20]}},{name:"Caiman",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4","quad5"]},{name:"Canopy",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4"]},{name:"Petit Barbarons",hasZones:!0,hasQuads:!1,zones:["1","2","3","4"],quads:[]},{name:"Kempinski",hasZones:!1,hasQuads:!1,zones:[],quads:[]},{name:"Roche Caiman",hasZones:!1,hasQuads:!1,zones:[],quads:[]}]}ngOnInit(){var t=this;return(0,b.A)(function*(){t.currentUser=t.auth.getCurrentUser(),t.initializeForm(),t.setCurrentDateTime(),yield t.loadDynamicSites();const n=t.route.snapshot.queryParams;"true"===n.viewMode&&n.reportId?yield t.loadReportForViewing(n.reportId):(t.route.queryParams.subscribe(o=>{o.location&&t.disturbancesForm.patchValue({location:o.location}),o.zone&&t.disturbancesForm.patchValue({zoneNumber:o.zone}),o.quad&&t.disturbancesForm.patchValue({quadNumber:o.quad}),o.lat&&o.lng&&(t.coordinates={latitude:parseFloat(o.lat),longitude:parseFloat(o.lng)},t.gpsFromLocation=!0,t.updateProgress())}),"true"!==n.fresh&&(yield t.restoreDraftIfAny(),t.setCurrentDateTime()),t.currentReportId||(t.currentReportId=t.disturbancesSyncService.generateReportId()),t.subscribeToFormChanges(),t.canAccessNaturalDisturbances=t.auth.hasMinimumLevel(2))})()}ngOnDestroy(){this.autosaveSub&&(this.autosaveSub.unsubscribe(),this.autosaveSub=null),this.isSubmitted||this.saveDraftOnExit().catch(t=>console.error("DisturbancesPage: saveDraftOnExit failed:",t))}setCurrentDateTime(t){if(this.disturbancesForm){const _=this.disturbancesForm.get("reportDate")?.value,k=this.disturbancesForm.get("observationTime")?.value;if(_&&k){const[y,F,E]=_.split("-"),[G,B]=k.split(":");return void(this.currentDateTime=`${E}/${F}/${y}  \u2022  ${G}:${B}`)}}if(t){const _=this.extractDateTimeFromReportId(t);if(_)return void(this.currentDateTime=_)}const n=new Date,o=String(n.getDate()).padStart(2,"0"),a=String(n.getMonth()+1).padStart(2,"0"),s=n.getFullYear(),m=String(n.getHours()).padStart(2,"0"),P=String(n.getMinutes()).padStart(2,"0");this.currentDateTime=`${o}/${a}/${s}  \u2022  ${m}:${P}`}extractDateTimeFromReportId(t){const n=t.match(/(\d{2})(\d{2})(\d{4})_(\d{2})(\d{2})(\d{2})/);if(n){const[,o,a,s,m,P]=n;return`${o}/${a}/${s}  \u2022  ${m}:${P}`}return null}getCurrentDate(){return(new Date).toISOString().split("T")[0]}initializeForm(){const t=this.getCurrentDate(),n=new Date,o=`${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}`;this.disturbancesForm=this.formBuilder.group({reportDate:[t,x.k0.required],observationTime:[o],location:["",x.k0.required],zoneNumber:[""],quadNumber:[""],harvestBiodiversity:[""],harvestOtherSpecify:[""],clearingMangroves:[""],ongoingConstruction:[!1],fallenTree:[!1],bankErosion:[!1],accretion:[""],diseases:[!1],description:[""],requiresUrgentAction:[!1]}),this.updateProgress()}editLocation(){var t=this;return(0,b.A)(function*(){yield(yield t.alertController.create({header:"Location/Site",inputs:[{name:"location",type:"text",placeholder:"Enter location",value:t.disturbancesForm.get("location")?.value||""}],buttons:[{text:"Cancel",role:"cancel"},{text:"Save",handler:o=>{t.disturbancesForm.patchValue({location:o.location})}}]})).present()})()}editZone(){var t=this;return(0,b.A)(function*(){yield(yield t.alertController.create({header:"Zone Number",inputs:[{name:"zoneNumber",type:"text",placeholder:"Enter zone number",value:t.disturbancesForm.get("zoneNumber")?.value||""}],buttons:[{text:"Cancel",role:"cancel"},{text:"Save",handler:o=>{t.disturbancesForm.patchValue({zoneNumber:o.zoneNumber})}}]})).present()})()}editQuad(){var t=this;return(0,b.A)(function*(){yield(yield t.alertController.create({header:"Quad Number",inputs:[{name:"quadNumber",type:"text",placeholder:"Enter quad number",value:t.disturbancesForm.get("quadNumber")?.value||""}],buttons:[{text:"Cancel",role:"cancel"},{text:"Save",handler:o=>{t.disturbancesForm.patchValue({quadNumber:o.quadNumber})}}]})).present()})()}getZoneName(t){return t?`Zone ${t}`:""}getQuadDisplay(t){if(!t)return"";const n=t.match(/\d+/);return n?n[0]:""}locationHasZones(){const t=this.disturbancesForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Petit Barbarons"].includes(t)}locationHasQuads(){const t=this.disturbancesForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Caiman","Canopy"].includes(t)}editLocationAdmin(){var t=this;return(0,b.A)(function*(){if(!t.currentUser||t.currentUser.level<4)return;const n=yield t.selectLocationStep();if(!n)return;const o=t.availableLocations.find(m=>m.name===n);let a="";if(o?.hasZones&&o.zones.length>0){const m=yield t.selectZoneStep(o);if(null===m)return;a=m}let s="";if(o?.hasQuads&&o.quads.length>0){const m=yield t.selectQuadStep(o,a);if(null===m)return;s=m}t.disturbancesForm.patchValue({location:n,zoneNumber:a,quadNumber:s}),t.isEditMode&&t.disturbancesForm.markAsDirty()})()}selectLocationStep(){var t=this;return new Promise(function(){var n=(0,b.A)(function*(o){const a=t.disturbancesForm.get("location")?.value||"",s=t.availableLocations.map(P=>({name:"location",type:"radio",label:P.name,value:P.name,checked:P.name===a}));yield(yield t.alertController.create({header:"Select Location",cssClass:"location-edit-alert",inputs:s,buttons:[{text:"Cancel",role:"cancel",handler:()=>o(null)},{text:"Next",handler:P=>o(P)}]})).present()});return function(o){return n.apply(this,arguments)}}())}selectZoneStep(t){var n=this;return new Promise(function(){var o=(0,b.A)(function*(a){const s=n.disturbancesForm.get("zoneNumber")?.value||"",m=t.zones.map(_=>({name:"zone",type:"radio",label:`Zone ${_}`,value:_,checked:_===s}));yield(yield n.alertController.create({header:"Select Zone",subHeader:t.name,cssClass:"location-edit-alert",inputs:m,buttons:[{text:"Cancel",role:"cancel",handler:()=>a(null)},{text:"Next",handler:_=>a(_)}]})).present()});return function(a){return o.apply(this,arguments)}}())}selectQuadStep(t,n){var o=this;return new Promise(function(){var a=(0,b.A)(function*(s){const m=o.disturbancesForm.get("quadNumber")?.value||"";let P=t.quads;if(n&&t.zoneQuadMap&&t.zoneQuadMap[n]){const y=t.zoneQuadMap[n];P=t.quads.filter(F=>{const E=parseInt(o.getQuadDisplay(F));return y.includes(E)})}const _=P.map(y=>({name:"quad",type:"radio",label:`Quad ${o.getQuadDisplay(y)}`,value:y,checked:o.getQuadDisplay(y)===m||y===m}));yield(yield o.alertController.create({header:"Select Quad",subHeader:t.name,cssClass:"location-edit-alert",inputs:_,buttons:[{text:"Cancel",role:"cancel",handler:()=>s(null)},{text:"Save",handler:y=>s(y)}]})).present()});return function(s){return a.apply(this,arguments)}}())}loadDynamicSites(){var t=this;return(0,b.A)(function*(){try{(yield t.siteSyncService.getAllSites()).forEach(o=>{t.availableLocations.some(a=>a.name===o.name)||t.availableLocations.push({name:o.name,hasZones:o.zones&&o.zones.length>0||!1,hasQuads:o.sample_points&&o.sample_points.length>0||!1,zones:o.zones?o.zones.map(a=>a.name?.replace("Zone ","")||a.id):[],quads:o.sample_points?o.sample_points.map(a=>a.id||a.label):[]})})}catch(n){console.error("Error loading dynamic sites:",n)}})()}getGPSCoordinates(){var t=this;return(0,b.A)(function*(){try{const n=yield t.loadingController.create({message:"Getting GPS coordinates..."});yield n.present();const o=yield j.L.getCurrentPosition({enableHighAccuracy:!0,timeout:15e3,maximumAge:0});t.coordinates={latitude:o.coords.latitude,longitude:o.coords.longitude},yield t.saveDraftOnExit(),yield n.dismiss(),t.updateProgress(),yield(yield t.alertController.create({header:"GPS Captured",message:`Location: ${t.coordinates.latitude.toFixed(6)}, ${t.coordinates.longitude.toFixed(6)}`,buttons:["OK"]})).present()}catch(n){console.error("Error getting GPS coordinates:",n);let o="Failed to get GPS coordinates. Please ensure location services are enabled and try again.";n instanceof Error&&(n.message.includes("Location services are not enabled")?o="Location services are disabled. Please enable GPS/location services on your device.":n.message.includes("User denied")?o="Location permission was denied. Please enable location access for this app in your device settings.":n.message.includes("timeout")&&(o="GPS signal timeout. Please try again with a clear view of the sky.")),yield(yield t.alertController.create({header:"GPS Error",message:o,buttons:["OK"]})).present()}})()}capturePhoto(t){var n=this;return(0,b.A)(function*(){try{const o=yield n.photoService.TakePicture();if(o){switch(t){case"harvest":n.harvestPhoto=o;break;case"clearing":n.clearingPhoto=o;break;case"construction":n.constructionPhoto=o;break;case"fallenTree":n.fallenTreePhoto=o;break;case"erosion":n.erosionPhoto=o;break;case"accretion":n.accretionPhoto=o;break;case"diseases":n.diseasesPhoto=o}n.updateProgress(),yield n.saveDraftOnExit()}else yield(yield n.alertController.create({header:"Photo Error",message:"Failed to capture photo",buttons:["OK"]})).present()}catch(o){console.error("Error capturing photo:",o),yield(yield n.alertController.create({header:"Photo Error",message:"Failed to capture photo",buttons:["OK"]})).present()}})()}removePhoto(t){switch(t){case"harvest":this.harvestPhoto="";break;case"clearing":this.clearingPhoto="";break;case"construction":this.constructionPhoto="";break;case"fallenTree":this.fallenTreePhoto="";break;case"erosion":this.erosionPhoto="";break;case"accretion":this.accretionPhoto="";break;case"diseases":this.diseasesPhoto=""}this.updateProgress()}updateProgress(){const t=this.disturbancesForm.value;let n=0,o=1;t.location&&n++,this.coordinates&&(n++,o++),t.harvestBiodiversity&&(n++,o++),t.clearingMangroves&&(n++,o++),t.ongoingConstruction&&(n++,o++),t.fallenTree&&(n++,o++),t.bankErosion&&(n++,o++),t.accretion&&(n++,o++),t.diseases&&(n++,o++),[this.harvestPhoto,this.clearingPhoto,this.constructionPhoto,this.fallenTreePhoto,this.erosionPhoto,this.accretionPhoto,this.diseasesPhoto].filter(s=>s).length>0&&(n++,o++),t.description&&(n++,o++),this.progress=o>0?n/o:0}subscribeToFormChanges(){this.autosaveSub&&this.autosaveSub.unsubscribe(),this.autosaveSub=this.disturbancesForm.valueChanges.pipe((0,R.B)(750)).subscribe(()=>{this.isSubmitted||(this.updateProgress(),this.saveDraftOnExit().catch(t=>console.error("DisturbancesPage: autosave failed:",t)))})}restoreDraftIfAny(){var t=this;return(0,b.A)(function*(){const n=t.route.snapshot.queryParams,o={location:n.location||t.disturbancesForm.get("location")?.value,zoneNumber:n.zone||t.disturbancesForm.get("zoneNumber")?.value,quadNumber:n.quad||t.disturbancesForm.get("quadNumber")?.value},a=yield t.disturbancesSyncService.loadDraft(o);if(a)try{a.reportId&&(t.currentReportId=a.reportId),a.form&&t.disturbancesForm.patchValue(a.form),t.coordinates=a.coordinates||null,t.harvestPhoto=a.photos?.harvest||"",t.clearingPhoto=a.photos?.clearing||"",t.constructionPhoto=a.photos?.construction||"",t.fallenTreePhoto=a.photos?.fallenTree||"",t.erosionPhoto=a.photos?.erosion||"",t.accretionPhoto=a.photos?.accretion||"",t.diseasesPhoto=a.photos?.diseases||"",t.updateProgress()}catch(s){console.error("DisturbancesPage: failed to restore draft:",s)}})()}saveDraft(){var t=this;return(0,b.A)(function*(){var o;t.disturbancesForm&&(yield(yield t.alertController.create({header:"Save Draft",message:"Are you sure you want to save this form as a draft? You can return to complete it later.",buttons:[{text:"Cancel",role:"cancel"},{text:"Save Draft",handler:(o=(0,b.A)(function*(){try{yield t.saveDraftOnExit(),yield(yield t.alertController.create({header:"Draft Saved",message:"Your form has been saved as a draft. You can access it from the threats page.",buttons:[{text:"OK",handler:()=>{t.router.navigate(["/threats"])}}]})).present()}catch(a){console.error("Failed to save draft:",a),yield(yield t.alertController.create({header:"Save Failed",message:"Failed to save the draft. Please try again.",buttons:["OK"]})).present()}}),function(){return o.apply(this,arguments)})}]})).present())})()}saveDraftOnExit(){var t=this;return(0,b.A)(function*(){if(!t.disturbancesForm||t.viewMode||t.isDiscarded||t.isSubmitted)return;const n=t.disturbancesForm.value;if(n?.location||n?.description||t.coordinates||t.harvestPhoto||t.clearingPhoto||t.constructionPhoto||t.fallenTreePhoto||t.erosionPhoto||t.accretionPhoto||t.diseasesPhoto)try{yield t.disturbancesSyncService.saveDraft({reportId:t.currentReportId,form:t.disturbancesForm.value,coordinates:t.coordinates,photos:{harvest:t.harvestPhoto,clearing:t.clearingPhoto,construction:t.constructionPhoto,fallenTree:t.fallenTreePhoto,erosion:t.erosionPhoto,accretion:t.accretionPhoto,diseases:t.diseasesPhoto}})}catch(a){console.error("DisturbancesPage: failed to save draft:",a)}})()}onSubmit(){var t=this;return(0,b.A)(function*(){if(t.isSubmitting)return;if(t.isSubmitting=!0,t.disturbancesForm.markAllAsTouched(),!t.disturbancesForm.get("location")?.value)return t.isSubmitting=!1,void(yield(yield t.alertController.create({header:"Incomplete Form",message:"Please fill in Location.",buttons:["OK"]})).present());t.isSubmitted=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null);const n=yield t.loadingController.create({message:"Submitting disturbances report..."});yield n.present();try{const o={...t.disturbancesForm.value};o.status={incomplete:!1,sent:!0,pending:!1};const a={formValue:o,coordinates:t.coordinates,photos:{harvest:t.harvestPhoto,clearing:t.clearingPhoto,construction:t.constructionPhoto,fallenTree:t.fallenTreePhoto,erosion:t.erosionPhoto,accretion:t.accretionPhoto,diseases:t.diseasesPhoto},existingReportId:t.currentReportId||void 0};t.isEditMode&&(a.isEditMode=!0,a.originalSubmittedBy=t.originalSubmittedBy);const s=yield t.disturbancesSyncService.submitFinal(a);yield n.dismiss();try{t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(G=>setTimeout(G,1e3));const _=t.disturbancesForm.value;yield t.disturbancesSyncService.clearDraft(_);const k=(_?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),y=_?.zoneNumber||"",F=_?.quadNumber||"";let E=`disturbances_draft_${k}`;y&&(E+=`_zone${y}`),F&&(E+=`_quad${F}`),yield t.forceDeleteDraftFile(`${E}.json`),t.isSubmitted=!0,console.log("DisturbancesPage: Draft cleared and form reset successfully")}catch(_){console.error("DisturbancesPage: Failed to clear draft:",_)}const m=t.isEditMode?s.queued?"Updated report saved locally and queued for upload when online.":"Disturbances report updated successfully!":s.queued?"Disturbances report saved locally and queued for upload when online.":"Disturbances report submitted successfully!";yield(yield t.alertController.create({header:"Success",message:m,buttons:[{text:"OK",handler:()=>{t.router.navigate(["/threats"])}}]})).present()}catch(o){yield n.dismiss(),console.error("Error submitting report:",o),yield(yield t.alertController.create({header:"Error",message:"Failed to submit disturbances report. Please try again.",buttons:["OK"]})).present()}})()}discardForm(){var t=this;return(0,b.A)(function*(){var o;yield(yield t.alertController.create({header:"Discard Form",message:"Are you sure you want to discard this form? All entered data will be lost.",buttons:[{text:"Cancel",role:"cancel"},{text:"Discard",role:"destructive",handler:(o=(0,b.A)(function*(){t.isDiscarded=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(k=>setTimeout(k,1e3));const a=t.disturbancesForm.value;yield t.disturbancesSyncService.clearDraft(a);const s=(a?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),m=a?.zoneNumber||"",P=a?.quadNumber||"";let _=`disturbances_draft_${s}`;m&&(_+=`_zone${m}`),P&&(_+=`_quad${P}`),yield t.forceDeleteDraftFile(`${_}.json`),yield new Promise(k=>setTimeout(k,200)),t.initializeForm(),t.router.navigate(["/threats"])}),function(){return o.apply(this,arguments)})}]})).present()})()}setViewMode(t){this.viewMode=t,t?(this.disturbancesForm.disable(),this.enableToggleAndCheckboxControls()):this.disturbancesForm.enable()}enableEditMode(){!this.currentUser||this.currentUser.level<4||(this.isEditMode=!0,this.viewMode=!1,this.disturbancesForm.enable(),this.originalSubmittedBy=this.loadedReport?.submittedBy||"")}getEditedDateTime(){if(!this.loadedReport)return null;let t=this.loadedReport.editedAt||null;if(!t){const _=this.loadedReport.updatedAt,k=this.loadedReport.createdAt;_&&k&&_!==k&&Math.abs(new Date(_).getTime()-new Date(k).getTime())>5e3&&(t=_)}if(!t)return null;const n=new Date(t);return isNaN(n.getTime())?null:`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`}enableToggleAndCheckboxControls(){this.disturbancesForm.get("ongoingConstruction")?.enable(),this.disturbancesForm.get("fallenTree")?.enable(),this.disturbancesForm.get("bankErosion")?.enable(),this.disturbancesForm.get("diseases")?.enable(),this.disturbancesForm.get("requiresUrgentAction")?.enable()}loadReportForViewing(t){var n=this;return(0,b.A)(function*(){try{const o=yield n.disturbancesSyncService.getAllReports();console.log("DisturbancesPage: All reports:",o);const a=o.find(m=>m.report.reportId===t);if(!a)return console.error("DisturbancesPage: Report not found for viewing:",t),yield(yield n.alertController.create({header:"Report Not Found",message:"The requested report could not be found.",buttons:["OK"]})).present(),void n.router.navigate(["/threats"]);const s=a.report;console.log("DisturbancesPage: Loading report for viewing:",s),n.loadedReport=s,n.disturbancesForm.patchValue({reportDate:s.form.reportDate||s.form.date||"",observationTime:s.form.observationTime||"",location:s.form.location||"",zoneNumber:s.form.zoneNumber||"",quadNumber:s.form.quadNumber||"",harvestBiodiversity:s.form.harvestBiodiversity||"",harvestOtherSpecify:s.form.harvestOtherSpecify||"",clearingMangroves:s.form.clearingMangroves||"",ongoingConstruction:s.form.ongoingConstruction||!1,fallenTree:s.form.fallenTree||!1,bankErosion:s.form.bankErosion||!1,accretion:s.form.accretion||"",diseases:s.form.diseases||!1,description:s.form.description||"",requiresUrgentAction:s.form.requiresUrgentAction||!1}),s.coordinates&&(n.coordinates=s.coordinates),s.photos&&(s.photos.harvest&&(n.harvestPhoto=s.photos.harvest),s.photos.clearing&&(n.clearingPhoto=s.photos.clearing),s.photos.construction&&(n.constructionPhoto=s.photos.construction),s.photos.fallenTree&&(n.fallenTreePhoto=s.photos.fallenTree),s.photos.erosion&&(n.erosionPhoto=s.photos.erosion),s.photos.accretion&&(n.accretionPhoto=s.photos.accretion),s.photos.diseases&&(n.diseasesPhoto=s.photos.diseases)),n.currentReportId=t,n.setCurrentDateTime(t),n.updateProgress(),n.setViewMode(!0),n.canAccessNaturalDisturbances=n.auth.hasMinimumLevel(2)}catch(o){console.error("DisturbancesPage: Error loading report for viewing:",o),yield(yield n.alertController.create({header:"Error",message:"Failed to load the report.",buttons:["OK"]})).present(),n.router.navigate(["/threats"])}})()}deleteEntry(){var t=this;return(0,b.A)(function*(){const n=t.auth.getCurrentUser();var a;!n||n.level<4?yield(yield t.alertController.create({header:"Permission Denied",message:"Only Level 4 users can delete entries.",buttons:["OK"]})).present():yield(yield t.alertController.create({header:"Delete Entry",message:"Are you sure you want to permanently delete this entry? This will remove it from the database and back it up to deleted files storage. This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",role:"destructive",handler:(a=(0,b.A)(function*(){yield t.performDeletion()}),function(){return a.apply(this,arguments)})}]})).present()})()}performDeletion(){var t=this;return(0,b.A)(function*(){const n=yield t.loadingController.create({message:"Deleting entry..."});yield n.present();try{const o=t.auth.getCurrentUser();yield t.entryDeletionService.deleteEntry({reportId:t.currentReportId,formType:"disturbances",tableName:"disturbances_reports",deletedBy:o?.username||"Unknown",deletedByEmail:o?.email||"",originalSubmittedBy:t.loadedReport?.submittedBy,originalSubmittedAt:t.loadedReport?.createdAt}),yield n.dismiss(),yield(yield t.alertController.create({header:"Success",message:"Entry has been deleted and backed up successfully.",buttons:[{text:"OK",handler:()=>{t.router.navigate(["/threats"])}}]})).present()}catch(o){yield n.dismiss(),console.error("Error deleting entry:",o),yield(yield t.alertController.create({header:"Error",message:"Failed to delete entry. Please try again.",buttons:["OK"]})).present()}})()}openFullScreenPhoto(t,n){var o=this;return(0,b.A)(function*(){yield(yield o.modalController.create({component:ve,componentProps:{photoUrl:t,photoType:n},cssClass:"fullscreen-photo-modal"})).present()})()}static#e=i=()=>(this.\u0275fac=function(n){return new(n||u)(e.rXU(x.ok),e.rXU(h.hG),e.rXU(h.Xi),e.rXU(h.W3),e.rXU(S.Ix),e.rXU(S.nX),e.rXU(l.N),e.rXU(p.s),e.rXU(d.I),e.rXU(g.H),e.rXU(v.C),e.rXU(M.k))},this.\u0275cmp=e.VBU({type:u,selectors:[["app-disturbances"]],standalone:!1,decls:110,vars:37,consts:[[1,"coral"],["slot","start"],["defaultHref","/threats"],[1,"coral","compact-toolbar"],[1,"date-time-text"],[4,"ngIf"],[1,"coral","metadata-toolbar"],[1,"metadata-container"],[1,"metadata-item",3,"click"],["name","location",1,"metadata-icon"],[1,"metadata-label"],["name","alert-circle","class","status-icon required",4,"ngIf"],["class","metadata-item",3,"click",4,"ngIf"],["class","edit-location-link",3,"click",4,"ngIf"],["style","padding: 0 16px; font-size: 0.75rem; color: #e76f51;",4,"ngIf"],["color","light",3,"value"],[1,"progress-text"],[3,"ngSubmit","formGroup"],["class","edit-mode-banner",4,"ngIf"],["class","edit-mode-banner editing",4,"ngIf"],[1,"gps-card"],["lines","none",1,"gps-item",3,"click","button"],["slot","start",1,"gps-icon-container"],["name","navigate",3,"color"],[1,"gps-title"],["class","gps-hint",4,"ngIf"],["class","coordinates-text",4,"ngIf"],["class","gps-source-hint",4,"ngIf"],[1,"disturbance-item"],["position","stacked"],["formControlName","harvestBiodiversity","placeholder","Select option","interface","popover"],["value","mangrove_whelk"],["value","giant_mud_crab"],["value","juvenile_sharks"],["value","other"],[1,"inline-photo-section"],["size","small","class","coastal-button",3,"click",4,"ngIf"],["class","photo-preview-only",4,"ngIf"],["formControlName","clearingMangroves","placeholder","Select number of trees","interface","popover"],["value","<2"],["value","2-10"],["value",">20"],[1,"disturbance-title"],["lines","none",1,"toggle-item"],[1,"toggle-labels"],[1,"toggle-no",3,"hidden"],["formControlName","ongoingConstruction",1,"coastal-toggle"],[1,"toggle-yes",3,"hidden"],["lines","none",2,"margin-top","12px"],["formControlName","requiresUrgentAction","slot","start"],["formControlName","description","rows","6","placeholder","Provide any additional details about the disturbances observed..."],["class","form-buttons",4,"ngIf"],["class","button-container",4,"ngIf"],["name","alert-circle",1,"status-icon","required"],["name","grid",1,"metadata-icon"],["name","apps",1,"metadata-icon"],[1,"edit-location-link",3,"click"],[2,"padding","0 16px","font-size","0.75rem","color","#e76f51"],[1,"edit-mode-banner"],["expand","block","color","warning",3,"click"],["name","create-outline","slot","start"],[1,"edit-mode-banner","editing"],["name","create-outline"],[1,"gps-hint"],["name","location","size","small"],[1,"coordinates-text"],["name","pin","size","small"],[1,"gps-source-hint"],["name","information-circle","size","small"],["formControlName","harvestOtherSpecify","placeholder","Specify what was harvested"],["size","small",1,"coastal-button",3,"click"],["name","camera","slot","start"],[1,"photo-preview-only"],[1,"photo-wrapper"],["alt","Harvest photo",2,"cursor","pointer",3,"click","src"],[1,"click-hint"],["size","small","color","danger",3,"click",4,"ngIf"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"],["alt","Clearing photo",2,"cursor","pointer",3,"click","src"],["alt","Construction photo",2,"cursor","pointer",3,"click","src"],["formControlName","fallenTree",1,"coastal-toggle"],["formControlName","bankErosion",1,"coastal-toggle"],["formControlName","diseases",1,"coastal-toggle"],["formControlName","accretion","placeholder","Select type","interface","popover"],["value","sand_deposition"],["value","soil_deposition"],["alt","Fallen tree photo",2,"cursor","pointer",3,"click","src"],["alt","Erosion photo",2,"cursor","pointer",3,"click","src"],["alt","Diseases photo",2,"cursor","pointer",3,"click","src"],["alt","Accretion photo",2,"cursor","pointer",3,"click","src"],[1,"form-buttons"],["expand","block","type","submit",1,"submit-button",3,"disabled"],["name","checkmark-circle","slot","start"],["expand","block","fill","outline","color","medium",1,"save-draft-button",3,"click"],["name","save-outline","slot","start"],["expand","block","fill","outline",1,"discard-button",3,"click"],["name","trash-outline","slot","start"],[1,"button-container"],["expand","block","color","danger",1,"delete-button",3,"click"]],template:function(n,o){if(1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Disturbances Report"),e.k0s()(),e.j41(6,"ion-toolbar",3)(7,"ion-text",4),e.EFF(8),e.DNE(9,D,2,1,"span",5),e.k0s()(),e.j41(10,"ion-toolbar",6)(11,"div",7)(12,"div",8),e.bIt("click",function(){return!o.viewMode&&o.editLocation()}),e.nrm(13,"ion-icon",9),e.j41(14,"span",10),e.EFF(15),e.k0s(),e.DNE(16,O,1,0,"ion-icon",11),e.k0s(),e.DNE(17,V,4,1,"div",12)(18,Y,4,1,"div",12)(19,w,2,0,"span",13),e.k0s(),e.DNE(20,$,2,0,"ion-error",14),e.k0s(),e.j41(21,"ion-toolbar",3),e.nrm(22,"ion-progress-bar",15),e.j41(23,"ion-text",16),e.EFF(24),e.k0s()()(),e.j41(25,"ion-content")(26,"form",17),e.bIt("ngSubmit",function(){return o.onSubmit()}),e.DNE(27,A,4,0,"div",18)(28,I,4,0,"div",19),e.j41(29,"ion-card",20)(30,"ion-card-header",0)(31,"ion-card-title"),e.EFF(32,"GPS Coordinates"),e.k0s()(),e.j41(33,"ion-card-content")(34,"ion-item",21),e.bIt("click",function(){return!o.viewMode&&o.getGPSCoordinates()}),e.j41(35,"div",22),e.nrm(36,"ion-icon",23),e.k0s(),e.j41(37,"ion-label")(38,"h3",24),e.EFF(39),e.k0s(),e.DNE(40,z,3,0,"p",25)(41,U,3,2,"p",26)(42,L,3,0,"p",27),e.k0s()()()(),e.j41(43,"ion-card")(44,"ion-card-header",0)(45,"ion-card-title"),e.EFF(46,"Human Activity"),e.k0s()(),e.j41(47,"ion-card-content")(48,"div",28)(49,"ion-item")(50,"ion-label",29),e.EFF(51,"Harvesting of biodiversity"),e.k0s(),e.j41(52,"ion-select",30)(53,"ion-select-option",31),e.EFF(54,"Mangrove whelk - Fizo"),e.k0s(),e.j41(55,"ion-select-option",32),e.EFF(56,"Giant Mud Crab - Krab ble"),e.k0s(),e.j41(57,"ion-select-option",33),e.EFF(58,"Juvenile sharks"),e.k0s(),e.j41(59,"ion-select-option",34),e.EFF(60,"Other (specify below)"),e.k0s()()(),e.DNE(61,q,4,0,"ion-item",5),e.j41(62,"div",35),e.DNE(63,Q,3,0,"ion-button",36),e.k0s(),e.DNE(64,Z,6,2,"div",37),e.k0s(),e.nrm(65,"ion-item-divider"),e.j41(66,"div",28)(67,"ion-item")(68,"ion-label",29),e.EFF(69,"Clearing of mangrove trees"),e.k0s(),e.j41(70,"ion-select",38)(71,"ion-select-option",39),e.EFF(72,"<2"),e.k0s(),e.j41(73,"ion-select-option",40),e.EFF(74,"2-10"),e.k0s(),e.j41(75,"ion-select-option",41),e.EFF(76,">20"),e.k0s()()(),e.j41(77,"div",35),e.DNE(78,W,3,0,"ion-button",36),e.k0s(),e.DNE(79,J,6,2,"div",37),e.k0s(),e.nrm(80,"ion-item-divider"),e.j41(81,"div",28)(82,"div",42),e.EFF(83,"On-going construction"),e.k0s(),e.j41(84,"ion-item",43)(85,"div",44)(86,"span",45),e.EFF(87,"No"),e.k0s(),e.nrm(88,"ion-toggle",46),e.j41(89,"span",47),e.EFF(90,"Yes"),e.k0s()(),e.j41(91,"div",35),e.DNE(92,ee,3,0,"ion-button",36),e.k0s()(),e.DNE(93,ne,6,2,"div",37),e.j41(94,"ion-item",48),e.nrm(95,"ion-checkbox",49),e.j41(96,"ion-label"),e.EFF(97,"Requires urgent action/intervention"),e.k0s()()()()(),e.DNE(98,he,60,14,"ion-card",5),e.j41(99,"ion-card")(100,"ion-card-header",0)(101,"ion-card-title"),e.EFF(102,"Additional Notes"),e.k0s()(),e.j41(103,"ion-card-content")(104,"ion-item")(105,"ion-label",29),e.EFF(106,"Description"),e.k0s(),e.nrm(107,"ion-textarea",50),e.k0s()()(),e.DNE(108,_e,10,1,"div",51)(109,fe,4,0,"div",52),e.k0s()()),2&n){let a,s,m,P,_,k,y,F;e.R7$(8),e.SpI(" ",o.currentDateTime),e.R7$(),e.Y8G("ngIf",(o.viewMode||o.isEditMode)&&o.getEditedDateTime()),e.R7$(6),e.JRh((null==(a=o.disturbancesForm.get("location"))?null:a.value)||"Add location"),e.R7$(),e.Y8G("ngIf",!(null!=(s=o.disturbancesForm.get("location"))&&s.value||o.viewMode)),e.R7$(),e.Y8G("ngIf",(null==(m=o.disturbancesForm.get("zoneNumber"))?null:m.value)&&o.locationHasZones()),e.R7$(),e.Y8G("ngIf",(null==(P=o.disturbancesForm.get("quadNumber"))?null:P.value)&&o.locationHasQuads()),e.R7$(),e.Y8G("ngIf",o.isEditMode&&o.currentUser&&o.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",(null==(_=o.disturbancesForm.get("location"))?null:_.hasError("required"))&&(null==(_=o.disturbancesForm.get("location"))?null:_.touched)),e.R7$(2),e.Y8G("value",o.progress),e.R7$(2),e.SpI(" ",(100*o.progress).toFixed(0),"% Complete "),e.R7$(),e.AVh("view-mode",o.viewMode),e.R7$(),e.Y8G("formGroup",o.disturbancesForm),e.R7$(),e.Y8G("ngIf",o.viewMode&&o.currentUser&&o.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",o.isEditMode),e.R7$(6),e.AVh("gps-captured",o.coordinates),e.Y8G("button",!o.viewMode),e.R7$(2),e.Y8G("color",o.coordinates?"success":"medium"),e.R7$(3),e.SpI(" ",o.coordinates?o.gpsFromLocation?"GPS Location from New Site":"GPS Location Captured":"Capture GPS Location"," "),e.R7$(),e.Y8G("ngIf",!o.coordinates),e.R7$(),e.Y8G("ngIf",o.coordinates),e.R7$(),e.Y8G("ngIf",o.coordinates&&o.gpsFromLocation),e.R7$(19),e.Y8G("ngIf","other"===(null==(k=o.disturbancesForm.get("harvestBiodiversity"))?null:k.value)),e.R7$(2),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.harvestPhoto),e.R7$(14),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.clearingPhoto),e.R7$(7),e.Y8G("hidden",null==(y=o.disturbancesForm.get("ongoingConstruction"))?null:y.value),e.R7$(3),e.Y8G("hidden",!(null!=(F=o.disturbancesForm.get("ongoingConstruction"))&&F.value)),e.R7$(3),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.constructionPhoto),e.R7$(),e.AVh("view-mode-item",o.viewMode),e.R7$(4),e.Y8G("ngIf",o.canAccessNaturalDisturbances),e.R7$(10),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.viewMode&&(null==o.currentUser?null:o.currentUser.level)>=4)}},dependencies:[C.bT,x.qT,x.BC,x.cb,x.j4,x.JD,h.Jm,h.QW,h.b_,h.I9,h.ME,h.tN,h.eY,h.W9,h.eU,h.iq,h.$w,h.uz,h.Dg,h.he,h.FH,h.Nm,h.Ip,h.IO,h.nc,h.BC,h.BY,h.ai,h.hB,h.Je,h.Gw,h.el],styles:[".coral[_ngcontent-%COMP%]{--background: #e76f51;color:#fff}.coral[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]{--color: white;transition:transform .2s}.coral[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]:hover{transform:translate(-4px)}.coral[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;text-align:center}.coral.compact-toolbar[_ngcontent-%COMP%]{--min-height: 28px;--padding-top: 5px;--padding-bottom: 5px}.edit-mode-banner[_ngcontent-%COMP%]{padding:.75rem 1rem;margin:.5rem;border-radius:.5rem}.edit-mode-banner[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: .5rem;font-weight:600}.edit-mode-banner.editing[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;display:flex;align-items:center;gap:.5rem;color:#856404;font-weight:500}.edit-mode-banner.editing[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.date-time-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fffffff2;font-size:14px;padding:0;margin:3px 0;font-weight:400;letter-spacing:.3px;line-height:1.2}.metadata-toolbar[_ngcontent-%COMP%]{--min-height: 40px;--padding-top: 6px;--padding-bottom: 6px}.metadata-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px;padding:0 12px;flex-wrap:wrap}.metadata-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;background:#ffffff26;border-radius:16px;padding:5px 10px;cursor:pointer;transition:all .2s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2)}.metadata-item[_ngcontent-%COMP%]:active{transform:scale(.95);background:#ffffff40}.metadata-icon[_ngcontent-%COMP%]{font-size:14px;color:#ffffffe6;min-width:14px}.metadata-label[_ngcontent-%COMP%]{color:#fff;font-size:12px;font-weight:500;letter-spacing:.2px;white-space:nowrap;max-width:120px;overflow:hidden;text-overflow:ellipsis}.edit-location-link[_ngcontent-%COMP%]{color:#ffffffe6;font-size:11px;text-decoration:underline;cursor:pointer;margin-left:8px;padding:4px 8px}.edit-location-link[_ngcontent-%COMP%]:active{opacity:.7}.status-icon[_ngcontent-%COMP%]{font-size:14px;margin-left:2px}.status-icon.success[_ngcontent-%COMP%]{color:#52a676}.status-icon.required[_ngcontent-%COMP%]{color:#ffd93d;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.6}}.progress-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fff;font-size:13px;padding:0;margin:0 0 4px;font-weight:400;line-height:1}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 2px 8px #0000001a}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0;padding:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#fff}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#ffffffe6;font-size:.875rem;margin-top:4px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{background:#fff;padding:16px}.gps-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 2px 8px #0000001a;overflow:hidden}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;--background: #f8f9fa;--border-radius: 8px;margin:0;border-radius:8px;transition:all .2s ease}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]:hover:not(.item-disabled){--background: #e9ecef;transform:translateY(-1px);box-shadow:0 4px 12px #0000001a}.gps-card[_ngcontent-%COMP%]   .gps-item.gps-captured[_ngcontent-%COMP%]{--background: #e8f5e9;border:1px solid #4caf50}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-icon-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;background:#ffffffe6;margin:12px;box-shadow:0 2px 4px #0000001a}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-icon-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:#333;margin-bottom:4px}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-hint[_ngcontent-%COMP%]{display:flex;align-items:center;color:#666;font-size:.9rem}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-hint[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:#999}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .coordinates-text[_ngcontent-%COMP%]{display:flex;align-items:center;color:#e76f51!important;font-weight:600;font-family:SF Mono,Monaco,Inconsolata,Roboto Mono,monospace;font-size:.9rem}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .coordinates-text[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:#e76f51}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-source-hint[_ngcontent-%COMP%]{display:flex;align-items:center;color:#666;font-size:.8rem;font-style:italic;margin-top:4px}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-source-hint[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:#999}.coordinates-text[_ngcontent-%COMP%]{color:#e76f51!important;font-weight:600;font-family:monospace}ion-item-divider[_ngcontent-%COMP%]{--padding-top: 4px;--padding-bottom: 4px;min-height:0;margin:8px 0}.disturbance-item[_ngcontent-%COMP%]{padding:12px 0 0}.disturbance-item[_ngcontent-%COMP%]:not(:last-child){margin-bottom:0}.disturbance-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#0d3d2f;margin-bottom:12px}.inline-photo-section[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:16px}.toggle-item[_ngcontent-%COMP%]   .inline-photo-section[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.photo-preview-only[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;margin-top:8px;background:#f9f9f9;border-radius:8px;border-left:4px solid #52a676}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;object-fit:cover;border-radius:8px;border:2px solid #52a676;transition:transform .2s ease,box-shadow .2s ease;touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #2d865966}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:active{transform:scale(.98)}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   .click-hint[_ngcontent-%COMP%]{font-size:10px;color:#999;font-style:italic;text-align:center;white-space:nowrap}.photos-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.photo-item[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:12px;padding:12px;background:#f9f9f9;border-radius:8px;border-left:4px solid #e76f51}.photo-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:120px;object-fit:cover;border-radius:8px;border:2px solid #e76f51;touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.photo-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: #dc2626;--background-hover: #b91c1c;--background-activated: #b91c1c}.add-photo-button[_ngcontent-%COMP%]{--border-color: #e76f51;--color: #e76f51;margin-top:8px}.add-photo-button[_ngcontent-%COMP%]:hover{--background: rgba(231, 111, 81, .1)}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;margin-bottom:12px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;color:#0d3d2f;margin:0}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6b7c7a;font-size:.875rem;margin:4px 0 0}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px;border:1px solid #ddd;border-radius:8px;margin-top:4px}ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{--padding-top: 12px;--padding-bottom: 12px}ion-item[button][_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s}ion-item[button][_ngcontent-%COMP%]:hover{--background: rgba(231, 111, 81, .05)}ion-select[_ngcontent-%COMP%]{width:100%}ion-checkbox[_ngcontent-%COMP%]{--size: 24px;--checkbox-background-checked: #e76f51 !important;--border-color-checked: #e76f51 !important;--border-color: #e76f51 !important;--background: white !important;--checkmark-color: white !important}.coastal-button[_ngcontent-%COMP%]{--background: #4fb3bf;--background-hover: #3a9aa5;--background-activated: #3a9aa5;--color: white;--border-radius: 8px;font-weight:600;text-transform:none;letter-spacing:.3px;margin-left:20px;margin-right:5px}.coastal-button[_ngcontent-%COMP%]:hover{--background: #3a9aa5}.toggle-item[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;--inner-padding-end: 0;margin-bottom:0;display:flex;align-items:center;justify-content:space-between;gap:16px}.toggle-labels[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0px;position:relative}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[_ngcontent-%COMP%], .toggle-labels[_ngcontent-%COMP%]   .toggle-yes[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;min-width:35px;width:35px;text-align:center;flex-shrink:0}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[_ngcontent-%COMP%]{color:#888;visibility:visible}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[_ngcontent-%COMP%]:not(:last-child){margin-right:5px}.toggle-labels[_ngcontent-%COMP%]   .toggle-yes[_ngcontent-%COMP%]{color:#52a676;visibility:visible}.toggle-labels[_ngcontent-%COMP%]   .toggle-yes[_ngcontent-%COMP%]:not(:first-child){margin-left:5px}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[hidden][_ngcontent-%COMP%], .toggle-labels[_ngcontent-%COMP%]   .toggle-yes[hidden][_ngcontent-%COMP%]{visibility:hidden;display:block!important}.coastal-toggle[_ngcontent-%COMP%]{--background: #ddd;--background-checked: #52a676;--handle-background: white;--handle-background-checked: white;--handle-width: 26px;--handle-height: 26px;--handle-spacing: 3px;width:52px;height:32px;min-width:52px;flex-shrink:0}.coastal-toggle[_ngcontent-%COMP%]::part(track){height:32px;width:52px;border-radius:16px}.coastal-toggle[_ngcontent-%COMP%]::part(handle){width:26px;height:26px}.form-buttons[_ngcontent-%COMP%]{padding:0 16px;margin-top:24px;margin-bottom:32px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-bottom:12px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-buttons[_ngcontent-%COMP%]   ion-button.save-draft-button[_ngcontent-%COMP%]{margin:10px 0 12px}.form-buttons[_ngcontent-%COMP%]   .save-draft-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--background: rgba(107, 124, 122, .1);--border-color: #6b7c7a;--color: #6b7c7a;--background-hover: rgba(107, 124, 122, .2);--background-activated: rgba(107, 124, 122, .3)}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{margin:0;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #e76f51;--background-hover: #d65d43;--background-activated: #d65d43}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}.form-buttons[_ngcontent-%COMP%]   .discard-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--color: #e76f51;--border-color: #e76f51;--border-width: 2px;--background-hover: rgba(231, 111, 81, .1);--background-activated: rgba(231, 111, 81, .2);--ripple-color: rgba(231, 111, 81, .3)}.form-buttons[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{margin-top:20px;--background: #d32f2f;--background-hover: #b71c1c;--background-activated: #b71c1c;font-weight:600;height:48px;font-size:1rem}.submit-button[_ngcontent-%COMP%]{margin:24px 16px 32px;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #e76f51;--background-hover: #d65d43;--background-activated: #d65d43}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}ion-error[_ngcontent-%COMP%]{color:#e76f51!important;font-size:.75rem!important;margin-top:4px;padding-left:16px}ion-item.item-disabled[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]{opacity:1!important;--opacity: 1 !important}ion-item.item-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:1!important;color:#000!important}  .item-disabled,   .item-interactive-disabled{opacity:1!important}  .item-disabled ion-label,   .item-disabled .label-text,   .item-disabled .native-input,   .item-disabled .select-text,   .item-disabled .select-icon,   .item-interactive-disabled ion-label,   .item-interactive-disabled .label-text,   .item-interactive-disabled .native-input,   .item-interactive-disabled .select-text,   .item-interactive-disabled .select-icon{opacity:1!important;color:#000!important}  ion-select.select-disabled{opacity:1!important}  ion-select.select-disabled .select-text,   ion-select.select-disabled .select-icon,   ion-select.select-disabled .select-placeholder{opacity:1!important;color:#000!important}  ion-toggle.toggle-disabled{opacity:1!important}  ion-checkbox.checkbox-disabled{opacity:1!important}  ion-input.input-disabled,   ion-textarea.textarea-disabled{opacity:1!important}  ion-input.input-disabled .native-input,   ion-input.input-disabled .native-textarea,   ion-textarea.textarea-disabled .native-input,   ion-textarea.textarea-disabled .native-textarea{opacity:1!important;color:#000!important;-webkit-text-fill-color:#000!important}  ion-content.view-mode ion-checkbox,   ion-content.view-mode ion-toggle{pointer-events:none!important;cursor:default!important}  ion-content.view-mode ion-item:has(ion-checkbox){pointer-events:none!important}@media (max-width: 768px){.photo-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.photo-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:200px}ion-card[_ngcontent-%COMP%]{margin:12px}}"]}))}return i(),u})(),ve=(()=>{var i;class u{constructor(t){this.modalController=t}dismiss(){this.modalController.dismiss()}static#e=i=()=>(this.\u0275fac=function(n){return new(n||u)(e.rXU(h.W3))},this.\u0275cmp=e.VBU({type:u,selectors:[["app-fullscreen-photo-modal-disturbances"]],decls:10,vars:2,consts:[["slot","end"],[3,"click"],["name","close"],[1,"ion-padding"],[1,"photo-container"],["alt","Full screen photo",3,"src"]],template:function(n,o){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return o.dismiss()}),e.nrm(6,"ion-icon",2),e.k0s()()()(),e.j41(7,"ion-content",3)(8,"div",4),e.nrm(9,"img",5),e.k0s()()),2&n&&(e.R7$(3),e.SpI("",o.photoType," Photo"),e.R7$(6),e.Y8G("src",o.photoUrl,e.B4B))},dependencies:[h.bv,h.Jm,h.QW,h.W9,h.eU,h.iq,h.BC,h.ai,C.MD],styles:[".photo-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.photo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}"]}))}return i(),u})();const Pe=[{path:"",component:be}];let ye=(()=>{var i;class u{static#e=i=()=>(this.\u0275fac=function(n){return new(n||u)},this.\u0275mod=e.$C({type:u}),this.\u0275inj=c.G2t({imports:[T.iI.forChild(Pe),T.iI]}))}return i(),u})(),ke=(()=>{var i;class u{static#e=i=()=>(this.\u0275fac=function(n){return new(n||u)},this.\u0275mod=e.$C({type:u}),this.\u0275inj=c.G2t({imports:[C.MD,x.YN,x.X1,h.bv,ye]}))}return i(),u})()},9187(X,N,f){f.d(N,{C:()=>R});var C=f(467),x=f(2084),h=f(2615),T=f(5029),b=f(918),j=f(8863);let R=(()=>{var e;class c{constructor(l,p,d){this.supabase=l,this.sharedDataService=p,this.monitoringLog=d}deleteEntry(l){var p=this;return(0,C.A)(function*(){console.log("[EntryDeletionService] Starting deletion process for:",l);try{const d=yield p.fetchOriginalEntry(l.tableName,l.reportId);if(!d)throw new Error(`Entry not found in table ${l.tableName} with reportId ${l.reportId}`);console.log("[EntryDeletionService] Original entry fetched:",d);const g=yield p.backupToDeletedFiles(l,d);console.log("[EntryDeletionService] Backup completed:",g),yield p.recordDeletionMetadata(l,g,d),console.log("[EntryDeletionService] Deletion metadata recorded"),yield p.deleteImagesFromBucket(d,l.formType,l.reportId),console.log("[EntryDeletionService] Images deleted from bucket"),yield p.deleteJsonFromStorage(l.formType,l.reportId),console.log("[EntryDeletionService] JSON file deleted from storage"),yield p.deleteFromTable(l.tableName,l.reportId),console.log("[EntryDeletionService] Entry deleted from table"),yield p.deleteLocalFile(l.formType,l.reportId),console.log("[EntryDeletionService] Local file deleted");const v=p.getEntrySummary(d,l.formType);p.monitoringLog.recordFormDeleted(l.deletedBy,l.formType,l.reportId,v),console.log("[EntryDeletionService] \u2705 Deletion process completed successfully")}catch(d){throw console.error("[EntryDeletionService] \u274c Deletion process failed:",d),d}})()}getEntrySummary(l,p){const d=[];return l?.location&&d.push(l.location),l?.zone_number&&d.push(`Z${l.zone_number}`),l?.quad_number&&d.push(`Q${l.quad_number}`),l?.observation_date&&d.push(l.observation_date),d.join(", ")||p}fetchOriginalEntry(l,p){var d=this;return(0,C.A)(function*(){const{data:g,error:v}=yield d.supabase.getClient().from(l).select("*").eq("report_id",p).single();if(v)throw console.error("[EntryDeletionService] Error fetching original entry:",v),v;return g})()}backupToDeletedFiles(l,p){var d=this;return(0,C.A)(function*(){const g=`${l.formType}/${l.reportId}`,v=`${g}/${l.reportId}.json`,M=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),{error:D}=yield d.supabase.getClient().storage.from("deleted_files").upload(v,M);if(D)throw console.error("[EntryDeletionService] Error backing up JSON:",D),D;const O=[],V=d.getImageBucketName(l.formType),Y=d.extractImagePathsFromEntry(p,l.formType,l.reportId);for(const w of Y)if(w)try{const{data:$,error:A}=yield d.supabase.getClient().storage.from(V).download(w);if(A){console.warn("[EntryDeletionService] Could not download image:",w,A);continue}const I=`${g}/${w.split("/").pop()}`,{error:z}=yield d.supabase.getClient().storage.from("deleted_files").upload(I,$);z?console.warn("[EntryDeletionService] Could not backup image:",I,z):O.push(I)}catch($){console.warn("[EntryDeletionService] Error processing image:",$)}return{backupFolderPath:g,jsonBackupPath:v,imageBackupPaths:O}})()}recordDeletionMetadata(l,p,d){var g=this;return(0,C.A)(function*(){const v={original_entry:d,backup_paths:{json:p.jsonBackupPath,images:p.imageBackupPaths},deletion_timestamp:(0,x.E)()},{error:M}=yield g.supabase.getClient().from("deleted_metadata_files").insert({original_report_id:l.reportId,form_type:l.formType,deleted_by:l.deletedBy,deleted_by_email:l.deletedByEmail,original_submitted_by:l.originalSubmittedBy||d.submittedBy,original_submitted_at:l.originalSubmittedAt||d.createdAt,backup_folder_path:p.backupFolderPath,original_table_name:l.tableName,original_storage_path:g.getStoragePath(l.tableName,l.reportId),metadata:v});if(M)throw console.error("[EntryDeletionService] Error recording deletion metadata:",M),M})()}deleteImagesFromBucket(l,p,d){var g=this;return(0,C.A)(function*(){const v=g.getImageBucketName(p),M=g.extractImagePathsFromEntry(l,p,d);for(const D of M)if(D)try{const{error:O}=yield g.supabase.getClient().storage.from(v).remove([D]);O&&console.warn("[EntryDeletionService] Could not delete image:",D,O)}catch(O){console.warn("[EntryDeletionService] Error deleting image:",O)}})()}deleteJsonFromStorage(l,p){var d=this;return(0,C.A)(function*(){const g=d.getReportsBucketName(l),v=`${p}.json`,{error:M}=yield d.supabase.getClient().storage.from(g).remove([v]);M&&console.warn("[EntryDeletionService] Could not delete JSON from storage:",v,M)})()}deleteFromTable(l,p){var d=this;return(0,C.A)(function*(){const{error:g}=yield d.supabase.getClient().from(l).delete().eq("report_id",p);if(g)throw console.error("[EntryDeletionService] Error deleting from table:",g),g})()}deleteLocalFile(l,p){var d=this;return(0,C.A)(function*(){try{const g=d.getLocalFileName(l,p);yield d.sharedDataService.deleteJsonFile(g)}catch(g){console.warn("[EntryDeletionService] Could not delete local file:",g)}})()}getReportsBucketName(l){return l}getImageBucketName(l){return{"flora-fauna":"flora-fauna-images",biomass:"biomass-images",health:"health-images",outplanting:"outplanting-images",restoration:"restoration-images",cleanup:"cleanup-images",pollution:"pollution-images",disturbances:"disturbances-images"}[l]||`${l}-images`}extractImagePathsFromEntry(l,p,d){const g=[];if("health"===p)return g.push(`${d}/soil.jpg`),g.push(`${d}/predation.jpg`),g.push(`${d}/pollution.jpg`),g;if("pollution"===p){g.push(`${d}/greyWater.jpg`),g.push(`${d}/trash.jpg`),g.push(`${d}/sewage.jpg`);for(let v=1;v<=10;v++)g.push(`${d}/photo_${v}.jpg`);return g}if("disturbances"===p)return g.push(`${d}/harvest.jpg`),g.push(`${d}/clearing.jpg`),g.push(`${d}/construction.jpg`),g.push(`${d}/fallenTree.jpg`),g.push(`${d}/erosion.jpg`),g.push(`${d}/accretion.jpg`),g.push(`${d}/diseases.jpg`),g;for(let v=1;v<=20;v++)g.push(`${d}/photo_${v}.jpg`);return g}getStoragePath(l,p){return`${l}/${p}.json`}getLocalFileName(l,p){return`${p}.json`}static#e=e=()=>(this.\u0275fac=function(p){return new(p||c)(h.KVO(T.L),h.KVO(b.H),h.KVO(j.u))},this.\u0275prov=h.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}))}return e(),c})()}}]);