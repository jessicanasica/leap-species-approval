"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3800],{152(U,S,b){b.d(S,{B:()=>I});var k=b(8839),C=b(9974),h=b(4360);function I(v,E=k.E){return(0,C.N)((w,e)=>{let s=null,j=null,l=null;const m=()=>{if(s){s.unsubscribe(),s=null;const g=j;j=null,e.next(g)}};function d(){const g=l+v,f=E.now();if(f<g)return s=this.schedule(void 0,g-f),void e.add(s);m()}w.subscribe((0,h._)(e,g=>{j=g,l=E.now(),s||(s=E.schedule(d,v),e.add(s))},()=>{m(),e.complete()},void 0,()=>{j=s=null}))})}},3800(U,S,b){b.d(S,{DisturbancesPageModule:()=>Re});var k=b(2200),C=b(4341),h=b(7343),I=b(8132),v=b(467),E=b(7762),w=b(152),e=b(3664),s=b(2615),j=b(5921),l=b(3205),m=b(6201),d=b(5010),g=b(918),f=b(9187),D=b(7643),O=b(6845),T=b(7314);function A(i,u){if(1&i){const r=e.RV6();e.j41(0,"span",58),e.bIt("click",function(){s.eBV(r),e.XpG();const n=e.sdS(15);return s.Njj(n.showPicker())}),e.EFF(1),e.k0s()}if(2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentDateDisplay)}}function V(i,u){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentDateDisplay)}}function $(i,u){if(1&i){const r=e.RV6();e.j41(0,"span",58),e.bIt("click",function(){s.eBV(r),e.XpG();const n=e.sdS(17);return s.Njj(n.showPicker())}),e.EFF(1),e.k0s()}if(2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentTimeDisplay)}}function N(i,u){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.JRh(r.currentTimeDisplay)}}function B(i,u){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.SpI(" (edited: ",r.getEditedDateTime(),")")}}function G(i,u){1&i&&e.nrm(0,"ion-icon",59)}function z(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",13),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(!n.viewMode&&n.editZone())}),e.nrm(1,"ion-icon",60),e.j41(2,"span",15),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.JRh(t.getZoneName(null==(r=t.disturbancesForm.get("zoneNumber"))?null:r.value))}}function L(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",13),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(!n.viewMode&&n.editQuad())}),e.nrm(1,"ion-icon",61),e.j41(2,"span",15),e.EFF(3),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(3),e.SpI("Quad ",t.getQuadDisplay(null==(r=t.disturbancesForm.get("quadNumber"))?null:r.value))}}function J(i,u){if(1&i){const r=e.RV6();e.j41(0,"span",62),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.editLocationAdmin())}),e.EFF(1),e.nI1(2,"t"),e.k0s()}2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Edit location")," "))}function q(i,u){1&i&&(e.j41(0,"ion-error",63),e.EFF(1),e.nI1(2,"t"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Location is required")," "))}function Q(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",64)(1,"ion-button",65),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.enableEditMode())}),e.nrm(2,"ion-icon",66),e.EFF(3),e.nI1(4,"t"),e.k0s()()}2&i&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"Edit This Entry")," "))}function K(i,u){1&i&&(e.j41(0,"div",67),e.nrm(1,"ion-icon",68),e.j41(2,"span"),e.EFF(3),e.nI1(4,"t"),e.k0s()()),2&i&&(e.R7$(3),e.JRh(e.bMT(4,1,"Editing Entry - Changes will replace the original submission")))}function Z(i,u){1&i&&(e.j41(0,"p",69),e.nrm(1,"ion-icon",70),e.EFF(2),e.nI1(3,"t"),e.k0s()),2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"Tap to get current GPS location")," "))}function W(i,u){if(1&i&&(e.j41(0,"p",71),e.nrm(1,"ion-icon",72),e.EFF(2),e.k0s()),2&i){const r=e.XpG();e.R7$(2),e.Lme(" ",r.coordinates.latitude.toFixed(6),", ",r.coordinates.longitude.toFixed(6)," ")}}function H(i,u){1&i&&(e.j41(0,"p",73),e.nrm(1,"ion-icon",74),e.EFF(2),e.nI1(3,"t"),e.k0s()),2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"GPS captured when creating new site")," "))}function ee(i,u){1&i&&(e.j41(0,"ion-item")(1,"ion-label",34),e.EFF(2),e.nI1(3,"t"),e.k0s(),e.nrm(4,"ion-input",75),e.nI1(5,"t"),e.k0s()),2&i&&(e.R7$(2),e.JRh(e.bMT(3,2,"Please specify")),e.R7$(2),e.Y8G("placeholder",e.bMT(5,4,"Specify what was harvested")))}function te(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",76),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.capturePhoto("harvest"))}),e.nrm(1,"ion-icon",77),e.EFF(2),e.nI1(3,"t"),e.k0s()}2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"Take Photo")," "))}function ne(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",83),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.removePhoto("harvest"))}),e.nrm(1,"ion-icon",84),e.k0s()}}function oe(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",78)(1,"div",79)(2,"img",80),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.openFullScreenPhoto(n.harvestPhoto,"Harvest"))}),e.k0s(),e.j41(3,"small",81),e.EFF(4),e.nI1(5,"t"),e.k0s()(),e.DNE(6,ne,2,0,"ion-button",82),e.k0s()}if(2&i){const r=e.XpG();e.R7$(2),e.Y8G("src",r.harvestPhoto,e.B4B),e.R7$(2),e.JRh(e.bMT(5,3,"Tap to view full size")),e.R7$(2),e.Y8G("ngIf",!r.viewMode)}}function ie(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",76),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.capturePhoto("clearing"))}),e.nrm(1,"ion-icon",77),e.EFF(2),e.nI1(3,"t"),e.k0s()}2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"Take Photo")," "))}function re(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",83),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.removePhoto("clearing"))}),e.nrm(1,"ion-icon",84),e.k0s()}}function ae(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",78)(1,"div",79)(2,"img",85),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.openFullScreenPhoto(n.clearingPhoto,"Clearing"))}),e.k0s(),e.j41(3,"small",81),e.EFF(4),e.nI1(5,"t"),e.k0s()(),e.DNE(6,re,2,0,"ion-button",82),e.k0s()}if(2&i){const r=e.XpG();e.R7$(2),e.Y8G("src",r.clearingPhoto,e.B4B),e.R7$(2),e.JRh(e.bMT(5,3,"Tap to view full size")),e.R7$(2),e.Y8G("ngIf",!r.viewMode)}}function se(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",76),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.capturePhoto("construction"))}),e.nrm(1,"ion-icon",77),e.EFF(2),e.nI1(3,"t"),e.k0s()}2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"Take Photo")," "))}function ce(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",83),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.removePhoto("construction"))}),e.nrm(1,"ion-icon",84),e.k0s()}}function le(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",78)(1,"div",79)(2,"img",86),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.openFullScreenPhoto(n.constructionPhoto,"Construction"))}),e.k0s(),e.j41(3,"small",81),e.EFF(4),e.nI1(5,"t"),e.k0s()(),e.DNE(6,ce,2,0,"ion-button",82),e.k0s()}if(2&i){const r=e.XpG();e.R7$(2),e.Y8G("src",r.constructionPhoto,e.B4B),e.R7$(2),e.JRh(e.bMT(5,3,"Tap to view full size")),e.R7$(2),e.Y8G("ngIf",!r.viewMode)}}function de(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",76),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.capturePhoto("fallenTree"))}),e.nrm(1,"ion-icon",77),e.EFF(2),e.nI1(3,"t"),e.k0s()}2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"Take Photo")," "))}function ue(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",83),e.bIt("click",function(){s.eBV(r);const n=e.XpG(3);return s.Njj(n.removePhoto("fallenTree"))}),e.nrm(1,"ion-icon",84),e.k0s()}}function ge(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",78)(1,"div",79)(2,"img",93),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.openFullScreenPhoto(n.fallenTreePhoto,"Fallen Tree"))}),e.k0s(),e.j41(3,"small",81),e.EFF(4),e.nI1(5,"t"),e.k0s()(),e.DNE(6,ue,2,0,"ion-button",82),e.k0s()}if(2&i){const r=e.XpG(2);e.R7$(2),e.Y8G("src",r.fallenTreePhoto,e.B4B),e.R7$(2),e.JRh(e.bMT(5,3,"Tap to view full size")),e.R7$(2),e.Y8G("ngIf",!r.viewMode)}}function pe(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",76),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.capturePhoto("erosion"))}),e.nrm(1,"ion-icon",77),e.EFF(2),e.nI1(3,"t"),e.k0s()}2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"Take Photo")," "))}function me(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",83),e.bIt("click",function(){s.eBV(r);const n=e.XpG(3);return s.Njj(n.removePhoto("erosion"))}),e.nrm(1,"ion-icon",84),e.k0s()}}function he(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",78)(1,"div",79)(2,"img",94),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.openFullScreenPhoto(n.erosionPhoto,"Erosion"))}),e.k0s(),e.j41(3,"small",81),e.EFF(4),e.nI1(5,"t"),e.k0s()(),e.DNE(6,me,2,0,"ion-button",82),e.k0s()}if(2&i){const r=e.XpG(2);e.R7$(2),e.Y8G("src",r.erosionPhoto,e.B4B),e.R7$(2),e.JRh(e.bMT(5,3,"Tap to view full size")),e.R7$(2),e.Y8G("ngIf",!r.viewMode)}}function _e(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",76),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.capturePhoto("diseases"))}),e.nrm(1,"ion-icon",77),e.EFF(2),e.nI1(3,"t"),e.k0s()}2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"Take Photo")," "))}function be(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",83),e.bIt("click",function(){s.eBV(r);const n=e.XpG(3);return s.Njj(n.removePhoto("diseases"))}),e.nrm(1,"ion-icon",84),e.k0s()}}function fe(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",78)(1,"div",79)(2,"img",95),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.openFullScreenPhoto(n.diseasesPhoto,"Diseases"))}),e.k0s(),e.j41(3,"small",81),e.EFF(4),e.nI1(5,"t"),e.k0s()(),e.DNE(6,be,2,0,"ion-button",82),e.k0s()}if(2&i){const r=e.XpG(2);e.R7$(2),e.Y8G("src",r.diseasesPhoto,e.B4B),e.R7$(2),e.JRh(e.bMT(5,3,"Tap to view full size")),e.R7$(2),e.Y8G("ngIf",!r.viewMode)}}function ve(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",76),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.capturePhoto("accretion"))}),e.nrm(1,"ion-icon",77),e.EFF(2),e.nI1(3,"t"),e.k0s()}2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"Take Photo")," "))}function Pe(i,u){if(1&i){const r=e.RV6();e.j41(0,"ion-button",83),e.bIt("click",function(){s.eBV(r);const n=e.XpG(3);return s.Njj(n.removePhoto("accretion"))}),e.nrm(1,"ion-icon",84),e.k0s()}}function ye(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",78)(1,"div",79)(2,"img",96),e.nI1(3,"t"),e.bIt("click",function(){s.eBV(r);const n=e.XpG(2);return s.Njj(n.openFullScreenPhoto(n.accretionPhoto,"Accretion"))}),e.k0s(),e.j41(4,"small",81),e.EFF(5),e.nI1(6,"t"),e.k0s()(),e.DNE(7,Pe,2,0,"ion-button",82),e.k0s()}if(2&i){const r=e.XpG(2);e.R7$(2),e.Y8G("src",r.accretionPhoto,e.B4B)("alt",e.bMT(3,4,"Accretion photo")),e.R7$(3),e.JRh(e.bMT(6,6,"Tap to view full size")),e.R7$(2),e.Y8G("ngIf",!r.viewMode)}}function Me(i,u){if(1&i&&(e.j41(0,"ion-card")(1,"ion-card-header",2)(2,"ion-card-title"),e.EFF(3),e.nI1(4,"t"),e.k0s()(),e.j41(5,"ion-card-content")(6,"div",33)(7,"div",47),e.EFF(8),e.nI1(9,"t"),e.k0s(),e.j41(10,"ion-item",48)(11,"div",49)(12,"span",50),e.EFF(13),e.nI1(14,"t"),e.k0s(),e.nrm(15,"ion-toggle",87),e.j41(16,"span",52),e.EFF(17),e.nI1(18,"t"),e.k0s()(),e.j41(19,"div",40),e.DNE(20,de,4,3,"ion-button",41),e.k0s()(),e.DNE(21,ge,7,5,"div",42),e.k0s(),e.nrm(22,"ion-item-divider"),e.j41(23,"div",33)(24,"div",47),e.EFF(25),e.nI1(26,"t"),e.k0s(),e.j41(27,"ion-item",48)(28,"div",49)(29,"span",50),e.EFF(30),e.nI1(31,"t"),e.k0s(),e.nrm(32,"ion-toggle",88),e.j41(33,"span",52),e.EFF(34),e.nI1(35,"t"),e.k0s()(),e.j41(36,"div",40),e.DNE(37,pe,4,3,"ion-button",41),e.k0s()(),e.DNE(38,he,7,5,"div",42),e.k0s(),e.nrm(39,"ion-item-divider"),e.j41(40,"div",33)(41,"div",47),e.EFF(42),e.nI1(43,"t"),e.k0s(),e.j41(44,"ion-item",48)(45,"div",49)(46,"span",50),e.EFF(47),e.nI1(48,"t"),e.k0s(),e.nrm(49,"ion-toggle",89),e.j41(50,"span",52),e.EFF(51),e.nI1(52,"t"),e.k0s()(),e.j41(53,"div",40),e.DNE(54,_e,4,3,"ion-button",41),e.k0s()(),e.DNE(55,fe,7,5,"div",42),e.k0s(),e.nrm(56,"ion-item-divider"),e.j41(57,"div",33)(58,"div",47),e.EFF(59),e.nI1(60,"t"),e.k0s(),e.j41(61,"ion-item"),e.nrm(62,"ion-label",34),e.j41(63,"ion-select",90),e.nI1(64,"t"),e.j41(65,"ion-select-option",91),e.EFF(66),e.nI1(67,"t"),e.k0s(),e.j41(68,"ion-select-option",92),e.EFF(69),e.nI1(70,"t"),e.k0s()()(),e.j41(71,"div",40),e.DNE(72,ve,4,3,"ion-button",41),e.k0s(),e.DNE(73,ye,8,8,"div",42),e.k0s()()()),2&i){let r,t,n,o,c,a;const p=e.XpG();e.R7$(3),e.JRh(e.bMT(4,28,"Evidence of Natural Disturbances")),e.R7$(5),e.JRh(e.bMT(9,30,"Fallen tree")),e.R7$(4),e.Y8G("hidden",null==(r=p.disturbancesForm.get("fallenTree"))?null:r.value),e.R7$(),e.JRh(e.bMT(14,32,"No")),e.R7$(3),e.Y8G("hidden",!(null!=(t=p.disturbancesForm.get("fallenTree"))&&t.value)),e.R7$(),e.JRh(e.bMT(18,34,"Yes")),e.R7$(3),e.Y8G("ngIf",!p.viewMode),e.R7$(),e.Y8G("ngIf",p.fallenTreePhoto),e.R7$(4),e.JRh(e.bMT(26,36,"Bank erosion")),e.R7$(4),e.Y8G("hidden",null==(n=p.disturbancesForm.get("bankErosion"))?null:n.value),e.R7$(),e.JRh(e.bMT(31,38,"No")),e.R7$(3),e.Y8G("hidden",!(null!=(o=p.disturbancesForm.get("bankErosion"))&&o.value)),e.R7$(),e.JRh(e.bMT(35,40,"Yes")),e.R7$(3),e.Y8G("ngIf",!p.viewMode),e.R7$(),e.Y8G("ngIf",p.erosionPhoto),e.R7$(4),e.JRh(e.bMT(43,42,"Diseases")),e.R7$(4),e.Y8G("hidden",null==(c=p.disturbancesForm.get("diseases"))?null:c.value),e.R7$(),e.JRh(e.bMT(48,44,"No")),e.R7$(3),e.Y8G("hidden",!(null!=(a=p.disturbancesForm.get("diseases"))&&a.value)),e.R7$(),e.JRh(e.bMT(52,46,"Yes")),e.R7$(3),e.Y8G("ngIf",!p.viewMode),e.R7$(),e.Y8G("ngIf",p.diseasesPhoto),e.R7$(4),e.JRh(e.bMT(60,48,"Accretion")),e.R7$(4),e.Y8G("placeholder",e.bMT(64,50,"Select type")),e.R7$(3),e.JRh(e.bMT(67,52,"Sand deposition")),e.R7$(3),e.JRh(e.bMT(70,54,"Soil deposition")),e.R7$(3),e.Y8G("ngIf",!p.viewMode),e.R7$(),e.Y8G("ngIf",p.accretionPhoto)}}function ke(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",97)(1,"ion-button",98),e.nrm(2,"ion-icon",99),e.EFF(3),e.nI1(4,"t"),e.k0s(),e.j41(5,"ion-button",100),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.saveDraft())}),e.nrm(6,"ion-icon",101),e.EFF(7),e.nI1(8,"t"),e.k0s(),e.j41(9,"ion-button",102),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.discardForm())}),e.nrm(10,"ion-icon",103),e.EFF(11),e.nI1(12,"t"),e.k0s()()}if(2&i){let r;const t=e.XpG();e.R7$(),e.Y8G("disabled",!(null!=(r=t.disturbancesForm.get("location"))&&r.value)),e.R7$(2),e.SpI(" ",e.bMT(4,4,"Submit Disturbances Report")," "),e.R7$(4),e.SpI(" ",e.bMT(8,6,"Save Draft")," "),e.R7$(4),e.SpI(" ",e.bMT(12,8,"Discard")," ")}}function Ce(i,u){if(1&i){const r=e.RV6();e.j41(0,"div",104)(1,"ion-button",105),e.bIt("click",function(){s.eBV(r);const n=e.XpG();return s.Njj(n.deleteEntry())}),e.nrm(2,"ion-icon",103),e.EFF(3),e.nI1(4,"t"),e.k0s()()}2&i&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"Delete Entry")," "))}let De=(()=>{var i;class u{forceDeleteDraftFile(t){var n=this;return(0,v.A)(function*(){for(let o=0;o<3;o++)try{yield n.sharedDataService.deleteJsonFile(t),console.log(`Draft file force deleted successfully (attempt ${o+1})`);break}catch(c){if(console.error(`Error force deleting draft file (attempt ${o+1}):`,c),2===o)try{yield n.sharedDataService.writeJsonFile(t,null),console.log("Draft file cleared with null write")}catch(a){console.error("Failed to clear draft file with null write:",a)}yield new Promise(a=>setTimeout(a,100))}})()}constructor(t,n,o,c,a,p,P,_,y,M,F,x,R){this.formBuilder=t,this.alertController=n,this.loadingController=o,this.modalController=c,this.router=a,this.route=p,this.auth=P,this.disturbancesSyncService=_,this.photoService=y,this.sharedDataService=M,this.entryDeletionService=F,this.siteSyncService=x,this.ts=R,this.progress=0,this.coordinates=null,this.currentDateTime="",this.currentDateDisplay="",this.currentTimeDisplay="",this.canAccessNaturalDisturbances=!1,this.harvestPhoto="",this.clearingPhoto="",this.constructionPhoto="",this.fallenTreePhoto="",this.erosionPhoto="",this.accretionPhoto="",this.diseasesPhoto="",this.viewMode=!1,this.currentReportId="",this.currentUser=null,this.loadedReport=null,this.gpsFromLocation=!1,this.autosaveSub=null,this.isDiscarded=!1,this.isSubmitted=!1,this.isSubmitting=!1,this.isEditMode=!1,this.originalSubmittedBy="",this.availableLocations=[{name:"Ramsar",hasZones:!0,hasQuads:!0,zones:["1","2","3","4","5","6"],quads:Array.from({length:30},(Y,X)=>`quad${X+1}`),zoneQuadMap:{1:[1,2,3],2:[13,14,15,16,17,18,20,21,22,23,25,27,28,29],3:[19,26],4:[4,5],5:[6,7,11,12,24,30],6:[8,9,10]}},{name:"Grand Anse",hasZones:!0,hasQuads:!0,zones:["1","2","3","4"],quads:Array.from({length:22},(Y,X)=>`ga${X+1}`),zoneQuadMap:{1:[1,2,3,4],2:[5,6,7,8,9,10,21,22],3:[11,12,13,14,15,16,17,18],4:[19,20]}},{name:"Caiman",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4","quad5"]},{name:"Canopy",hasZones:!1,hasQuads:!0,zones:[],quads:["quad1","quad2","quad3","quad4"]},{name:"Petit Barbarons",hasZones:!0,hasQuads:!1,zones:["1","2","3","4"],quads:[]},{name:"Kempinski",hasZones:!1,hasQuads:!1,zones:[],quads:[]},{name:"Roche Caiman",hasZones:!1,hasQuads:!1,zones:[],quads:[]}]}ngOnInit(){var t=this;return(0,v.A)(function*(){t.currentUser=t.auth.getCurrentUser(),t.initializeForm(),t.setCurrentDateTime(),yield t.loadDynamicSites();const n=t.route.snapshot.queryParams;"true"===n.viewMode&&n.reportId?yield t.loadReportForViewing(n.reportId):(t.route.queryParams.subscribe(o=>{o.location&&t.disturbancesForm.patchValue({location:o.location}),o.zone&&t.disturbancesForm.patchValue({zoneNumber:o.zone}),o.quad&&t.disturbancesForm.patchValue({quadNumber:o.quad}),o.lat&&o.lng&&(t.coordinates={latitude:parseFloat(o.lat),longitude:parseFloat(o.lng)},t.gpsFromLocation=!0,t.updateProgress())}),"true"!==n.fresh&&(yield t.restoreDraftIfAny(),t.setCurrentDateTime()),t.currentReportId||(t.currentReportId=t.disturbancesSyncService.generateReportId()),t.subscribeToFormChanges(),t.canAccessNaturalDisturbances=t.auth.hasMinimumLevel(2))})()}ngOnDestroy(){this.autosaveSub&&(this.autosaveSub.unsubscribe(),this.autosaveSub=null),!this.isSubmitted&&!this.isDiscarded&&this.saveDraftOnExit().catch(t=>console.error("DisturbancesPage: saveDraftOnExit failed:",t))}setCurrentDateTime(t){if(this.disturbancesForm){const _=this.disturbancesForm.get("reportDate")?.value,y=this.disturbancesForm.get("observationTime")?.value;if(_&&y){const[M,F,x]=_.split("-"),[R,Y]=y.split(":");return this.currentDateDisplay=`${x}/${F}/${M}`,this.currentTimeDisplay=`${R}:${Y}`,void(this.currentDateTime=`${this.currentDateDisplay}  \u2022  ${this.currentTimeDisplay}`)}}if(t){const _=this.extractDateTimeFromReportId(t);if(_){this.currentDateTime=_;const y=_.split("  \u2022  ");return void(2===y.length&&(this.currentDateDisplay=y[0],this.currentTimeDisplay=y[1]))}}const n=new Date,o=String(n.getDate()).padStart(2,"0"),c=String(n.getMonth()+1).padStart(2,"0"),a=n.getFullYear(),p=String(n.getHours()).padStart(2,"0"),P=String(n.getMinutes()).padStart(2,"0");this.currentDateDisplay=`${o}/${c}/${a}`,this.currentTimeDisplay=`${p}:${P}`,this.currentDateTime=`${this.currentDateDisplay}  \u2022  ${this.currentTimeDisplay}`}extractDateTimeFromReportId(t){const n=t.match(/(\d{2})(\d{2})(\d{4})_(\d{2})(\d{2})(\d{2})/);if(n){const[,o,c,a,p,P]=n;return`${o}/${c}/${a}  \u2022  ${p}:${P}`}return null}getCurrentDate(){return(new Date).toISOString().split("T")[0]}initializeForm(){const t=this.getCurrentDate(),n=new Date,o=`${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}`;this.disturbancesForm=this.formBuilder.group({reportDate:[t,C.k0.required],observationTime:[o],location:["",C.k0.required],zoneNumber:[""],quadNumber:[""],harvestBiodiversity:[""],harvestOtherSpecify:[""],clearingMangroves:[""],ongoingConstruction:[!1],fallenTree:[!1],bankErosion:[!1],accretion:[""],diseases:[!1],description:[""],requiresUrgentAction:[!1]}),this.updateProgress()}editLocation(){var t=this;return(0,v.A)(function*(){yield(yield t.alertController.create({header:t.ts.t("Location/Site"),inputs:[{name:"location",type:"text",placeholder:t.ts.t("Enter location"),value:t.disturbancesForm.get("location")?.value||""}],buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Save"),handler:o=>{t.disturbancesForm.patchValue({location:o.location})}}]})).present()})()}editZone(){var t=this;return(0,v.A)(function*(){yield(yield t.alertController.create({header:t.ts.t("Zone Number"),inputs:[{name:"zoneNumber",type:"text",placeholder:t.ts.t("Enter zone number"),value:t.disturbancesForm.get("zoneNumber")?.value||""}],buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Save"),handler:o=>{t.disturbancesForm.patchValue({zoneNumber:o.zoneNumber})}}]})).present()})()}editQuad(){var t=this;return(0,v.A)(function*(){yield(yield t.alertController.create({header:t.ts.t("Quad Number"),inputs:[{name:"quadNumber",type:"text",placeholder:t.ts.t("Enter quad number"),value:t.disturbancesForm.get("quadNumber")?.value||""}],buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Save"),handler:o=>{t.disturbancesForm.patchValue({quadNumber:o.quadNumber})}}]})).present()})()}getZoneName(t){return t?`Zone ${t}`:""}getQuadDisplay(t){if(!t)return"";const n=t.match(/\d+/);return n?n[0]:""}locationHasZones(){const t=this.disturbancesForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Petit Barbarons"].includes(t)}locationHasQuads(){const t=this.disturbancesForm.get("location")?.value;return!!t&&["Ramsar","Grand Anse","Caiman","Canopy"].includes(t)}editLocationAdmin(){var t=this;return(0,v.A)(function*(){if(!t.currentUser||t.currentUser.level<4)return;const n=yield t.selectLocationStep();if(!n)return;const o=t.availableLocations.find(p=>p.name===n);let c="";if(o?.hasZones&&o.zones.length>0){const p=yield t.selectZoneStep(o);if(null===p)return;c=p}let a="";if(o?.hasQuads&&o.quads.length>0){const p=yield t.selectQuadStep(o,c);if(null===p)return;a=p}t.disturbancesForm.patchValue({location:n,zoneNumber:c,quadNumber:a}),t.isEditMode&&t.disturbancesForm.markAsDirty()})()}selectLocationStep(){var t=this;return new Promise(function(){var n=(0,v.A)(function*(o){const c=t.disturbancesForm.get("location")?.value||"",a=t.availableLocations.map(P=>({name:"location",type:"radio",label:P.name,value:P.name,checked:P.name===c}));yield(yield t.alertController.create({header:t.ts.t("Select Location"),cssClass:"location-edit-alert",inputs:a,buttons:[{text:t.ts.t("Cancel"),role:"cancel",handler:()=>o(null)},{text:t.ts.t("Next"),handler:P=>o(P)}]})).present()});return function(o){return n.apply(this,arguments)}}())}selectZoneStep(t){var n=this;return new Promise(function(){var o=(0,v.A)(function*(c){const a=n.disturbancesForm.get("zoneNumber")?.value||"",p=t.zones.map(_=>({name:"zone",type:"radio",label:`Zone ${_}`,value:_,checked:_===a}));yield(yield n.alertController.create({header:n.ts.t("Select Zone"),subHeader:t.name,cssClass:"location-edit-alert",inputs:p,buttons:[{text:n.ts.t("Cancel"),role:"cancel",handler:()=>c(null)},{text:n.ts.t("Next"),handler:_=>c(_)}]})).present()});return function(c){return o.apply(this,arguments)}}())}selectQuadStep(t,n){var o=this;return new Promise(function(){var c=(0,v.A)(function*(a){const p=o.disturbancesForm.get("quadNumber")?.value||"";let P=t.quads;if(n&&t.zoneQuadMap&&t.zoneQuadMap[n]){const M=t.zoneQuadMap[n];P=t.quads.filter(F=>{const x=parseInt(o.getQuadDisplay(F));return M.includes(x)})}const _=P.map(M=>({name:"quad",type:"radio",label:`Quad ${o.getQuadDisplay(M)}`,value:M,checked:o.getQuadDisplay(M)===p||M===p}));yield(yield o.alertController.create({header:o.ts.t("Select Quad"),subHeader:t.name,cssClass:"location-edit-alert",inputs:_,buttons:[{text:o.ts.t("Cancel"),role:"cancel",handler:()=>a(null)},{text:o.ts.t("Save"),handler:M=>a(M)}]})).present()});return function(a){return c.apply(this,arguments)}}())}loadDynamicSites(){var t=this;return(0,v.A)(function*(){try{(yield t.siteSyncService.getAllSites()).forEach(o=>{t.availableLocations.some(c=>c.name===o.name)||t.availableLocations.push({name:o.name,hasZones:o.zones&&o.zones.length>0||!1,hasQuads:o.sample_points&&o.sample_points.length>0||!1,zones:o.zones?o.zones.map(c=>c.name?.replace("Zone ","")||c.id):[],quads:o.sample_points?o.sample_points.map(c=>c.id||c.label):[]})})}catch(n){console.error("Error loading dynamic sites:",n)}})()}getGPSCoordinates(){var t=this;return(0,v.A)(function*(){try{const n=yield t.loadingController.create({message:t.ts.t("Getting GPS coordinates...")});yield n.present();const o=yield E.L.getCurrentPosition({enableHighAccuracy:!0,timeout:15e3,maximumAge:0});t.coordinates={latitude:o.coords.latitude,longitude:o.coords.longitude},yield t.saveDraftOnExit(),yield n.dismiss(),t.updateProgress(),yield(yield t.alertController.create({header:t.ts.t("GPS Captured"),message:`${t.ts.t("Location")}: ${t.coordinates.latitude.toFixed(6)}, ${t.coordinates.longitude.toFixed(6)}`,buttons:["OK"]})).present()}catch(n){console.error("Error getting GPS coordinates:",n);let o=t.ts.t("Failed to get GPS coordinates. Please ensure location services are enabled and try again.");n instanceof Error&&(n.message.includes("Location services are not enabled")?o=t.ts.t("Location services are disabled. Please enable GPS/location services on your device."):n.message.includes("User denied")?o=t.ts.t("Location permission was denied. Please enable location access for this app in your device settings."):n.message.includes("timeout")&&(o=t.ts.t("GPS signal timeout. Please try again with a clear view of the sky."))),yield(yield t.alertController.create({header:t.ts.t("GPS Error"),message:o,buttons:["OK"]})).present()}})()}capturePhoto(t){var n=this;return(0,v.A)(function*(){try{const o=yield n.photoService.TakePicture();if(o){switch(t){case"harvest":n.harvestPhoto=o;break;case"clearing":n.clearingPhoto=o;break;case"construction":n.constructionPhoto=o;break;case"fallenTree":n.fallenTreePhoto=o;break;case"erosion":n.erosionPhoto=o;break;case"accretion":n.accretionPhoto=o;break;case"diseases":n.diseasesPhoto=o}n.updateProgress(),yield n.saveDraftOnExit()}else yield(yield n.alertController.create({header:n.ts.t("Photo Error"),message:n.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}catch(o){console.error("Error capturing photo:",o),yield(yield n.alertController.create({header:n.ts.t("Photo Error"),message:n.ts.t("Failed to capture photo"),buttons:["OK"]})).present()}})()}removePhoto(t){switch(t){case"harvest":this.harvestPhoto="";break;case"clearing":this.clearingPhoto="";break;case"construction":this.constructionPhoto="";break;case"fallenTree":this.fallenTreePhoto="";break;case"erosion":this.erosionPhoto="";break;case"accretion":this.accretionPhoto="";break;case"diseases":this.diseasesPhoto=""}this.updateProgress()}updateProgress(){const t=this.disturbancesForm.value;let n=0,o=1;t.location&&n++,this.coordinates&&(n++,o++),t.harvestBiodiversity&&(n++,o++),t.clearingMangroves&&(n++,o++),t.ongoingConstruction&&(n++,o++),t.fallenTree&&(n++,o++),t.bankErosion&&(n++,o++),t.accretion&&(n++,o++),t.diseases&&(n++,o++),[this.harvestPhoto,this.clearingPhoto,this.constructionPhoto,this.fallenTreePhoto,this.erosionPhoto,this.accretionPhoto,this.diseasesPhoto].filter(a=>a).length>0&&(n++,o++),t.description&&(n++,o++),this.progress=o>0?n/o:0}subscribeToFormChanges(){this.autosaveSub&&this.autosaveSub.unsubscribe(),this.autosaveSub=this.disturbancesForm.valueChanges.pipe((0,w.B)(750)).subscribe(()=>{this.isSubmitted||this.isDiscarded||(this.updateProgress(),this.saveDraftOnExit().catch(t=>console.error("DisturbancesPage: autosave failed:",t)))})}restoreDraftIfAny(){var t=this;return(0,v.A)(function*(){const n=t.route.snapshot.queryParams,o={location:n.location||t.disturbancesForm.get("location")?.value,zoneNumber:n.zone||t.disturbancesForm.get("zoneNumber")?.value,quadNumber:n.quad||t.disturbancesForm.get("quadNumber")?.value},c=yield t.disturbancesSyncService.loadDraft(o);if(c)try{c.reportId&&(t.currentReportId=c.reportId),c.form&&t.disturbancesForm.patchValue(c.form),t.coordinates=c.coordinates||null,t.harvestPhoto=c.photos?.harvest||"",t.clearingPhoto=c.photos?.clearing||"",t.constructionPhoto=c.photos?.construction||"",t.fallenTreePhoto=c.photos?.fallenTree||"",t.erosionPhoto=c.photos?.erosion||"",t.accretionPhoto=c.photos?.accretion||"",t.diseasesPhoto=c.photos?.diseases||"",t.updateProgress()}catch(a){console.error("DisturbancesPage: failed to restore draft:",a)}})()}saveDraft(){var t=this;return(0,v.A)(function*(){if(!t.disturbancesForm)return;const n=yield t.alertController.create({header:t.ts.t("Save Draft"),message:t.ts.t("Are you sure you want to save this form as a draft? You can return to complete it later."),buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Save Draft"),role:"confirm"}]});yield n.present();const{role:o}=yield n.onDidDismiss();if("confirm"!==o)return;const c=yield t.loadingController.create({message:t.ts.t("Saving draft...")});yield c.present();try{yield t.saveDraftOnExit(),yield c.dismiss();const a=yield t.alertController.create({header:t.ts.t("Draft Saved"),message:t.ts.t("Your form has been saved as a draft. You can access it from the threats page."),buttons:[{text:"OK",role:"confirm"}]});yield a.present(),yield a.onDidDismiss(),t.router.navigate(["/threats"])}catch(a){yield c.dismiss(),console.error("Failed to save draft:",a),yield(yield t.alertController.create({header:t.ts.t("Save Failed"),message:t.ts.t("Failed to save the draft. Please try again."),buttons:["OK"]})).present()}})()}saveDraftOnExit(){var t=this;return(0,v.A)(function*(){if(!t.disturbancesForm||t.viewMode||t.isDiscarded||t.isSubmitted)return;const n=t.disturbancesForm.value;if(n?.location||n?.description||t.coordinates||t.harvestPhoto||t.clearingPhoto||t.constructionPhoto||t.fallenTreePhoto||t.erosionPhoto||t.accretionPhoto||t.diseasesPhoto)try{yield t.disturbancesSyncService.saveDraft({reportId:t.currentReportId,form:t.disturbancesForm.value,coordinates:t.coordinates,photos:{harvest:t.harvestPhoto,clearing:t.clearingPhoto,construction:t.constructionPhoto,fallenTree:t.fallenTreePhoto,erosion:t.erosionPhoto,accretion:t.accretionPhoto,diseases:t.diseasesPhoto}})}catch(c){console.error("DisturbancesPage: failed to save draft:",c)}})()}onSubmit(){var t=this;return(0,v.A)(function*(){if(t.isSubmitting)return;if(t.isSubmitting=!0,t.disturbancesForm.markAllAsTouched(),!t.disturbancesForm.get("location")?.value)return t.isSubmitting=!1,void(yield(yield t.alertController.create({header:t.ts.t("Incomplete Form"),message:t.ts.t("Please fill in Location."),buttons:["OK"]})).present());t.isSubmitted=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null);const n=yield t.loadingController.create({message:t.ts.t("Submitting disturbances report...")});yield n.present();try{const o={...t.disturbancesForm.value};o.status={incomplete:!1,sent:!0,pending:!1};const c={formValue:o,coordinates:t.coordinates,photos:{harvest:t.harvestPhoto,clearing:t.clearingPhoto,construction:t.constructionPhoto,fallenTree:t.fallenTreePhoto,erosion:t.erosionPhoto,accretion:t.accretionPhoto,diseases:t.diseasesPhoto},existingReportId:t.currentReportId||void 0};t.isEditMode&&(c.isEditMode=!0,c.originalSubmittedBy=t.originalSubmittedBy);const a=yield t.disturbancesSyncService.submitFinal(c);yield n.dismiss();try{t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(R=>setTimeout(R,1e3));const _=t.disturbancesForm.value;yield t.disturbancesSyncService.clearDraft(_);const y=(_?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),M=_?.zoneNumber||"",F=_?.quadNumber||"";let x=`disturbances_draft_${y}`;M&&(x+=`_zone${M}`),F&&(x+=`_quad${F}`),yield t.forceDeleteDraftFile(`${x}.json`),t.isSubmitted=!0,console.log("DisturbancesPage: Draft cleared and form reset successfully")}catch(_){console.error("DisturbancesPage: Failed to clear draft:",_)}const p=t.ts.t(t.isEditMode?a.queued?"Updated report saved locally and queued for upload when online.":"Disturbances report updated successfully!":a.queued?"Disturbances report saved locally and queued for upload when online.":"Disturbances report submitted successfully!");yield(yield t.alertController.create({header:t.ts.t("Success"),message:p,buttons:[{text:"OK",handler:()=>{t.router.navigate(["/threats"])}}]})).present()}catch(o){yield n.dismiss(),console.error("Error submitting report:",o),yield(yield t.alertController.create({header:t.ts.t("Error"),message:t.ts.t("Failed to submit disturbances report. Please try again."),buttons:["OK"]})).present()}})()}discardForm(){var t=this;return(0,v.A)(function*(){const n=yield t.alertController.create({header:t.ts.t("Discard Form"),message:t.ts.t("Are you sure you want to discard this form? All entered data will be lost."),buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Discard"),role:"destructive"}]});yield n.present();const{role:o}=yield n.onDidDismiss();if("destructive"!==o)return;const c=yield t.loadingController.create({message:t.ts.t("Discarding...")});yield c.present(),t.isDiscarded=!0,t.autosaveSub&&(t.autosaveSub.unsubscribe(),t.autosaveSub=null),yield new Promise(a=>setTimeout(a,1e3));try{const a=t.disturbancesForm.value;yield t.disturbancesSyncService.clearDraft(a);const p=(a?.location||"unknown").replace(/[^a-zA-Z0-9]/g,"_"),P=a?.zoneNumber||"",_=a?.quadNumber||"";let y=`disturbances_draft_${p}`;P&&(y+=`_zone${P}`),_&&(y+=`_quad${_}`),yield t.forceDeleteDraftFile(`${y}.json`)}catch(a){console.error("DisturbancesPage: Error clearing draft during discard:",a)}yield c.dismiss(),t.initializeForm(),t.router.navigate(["/threats"])})()}setViewMode(t){this.viewMode=t,t?(this.disturbancesForm.disable(),this.enableToggleAndCheckboxControls()):this.disturbancesForm.enable()}enableEditMode(){!this.currentUser||this.currentUser.level<4||(this.isEditMode=!0,this.viewMode=!1,this.disturbancesForm.enable(),this.originalSubmittedBy=this.loadedReport?.submittedBy||"")}getEditedDateTime(){if(!this.loadedReport)return null;let t=this.loadedReport.editedAt||null;if(!t){const _=this.loadedReport.updatedAt,y=this.loadedReport.createdAt;_&&y&&_!==y&&Math.abs(new Date(_).getTime()-new Date(y).getTime())>5e3&&(t=_)}if(!t)return null;const n=new Date(t);return isNaN(n.getTime())?null:`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`}onDateChanged(t){const n=t.target;n.value&&(this.disturbancesForm.get("reportDate")?.setValue(n.value),this.setCurrentDateTime())}onTimeChanged(t){const n=t.target;n.value&&(this.disturbancesForm.get("observationTime")?.setValue(n.value),this.setCurrentDateTime())}enableToggleAndCheckboxControls(){this.disturbancesForm.get("ongoingConstruction")?.enable(),this.disturbancesForm.get("fallenTree")?.enable(),this.disturbancesForm.get("bankErosion")?.enable(),this.disturbancesForm.get("diseases")?.enable(),this.disturbancesForm.get("requiresUrgentAction")?.enable()}loadReportForViewing(t){var n=this;return(0,v.A)(function*(){try{const o=yield n.disturbancesSyncService.getAllReports();console.log("DisturbancesPage: All reports:",o);const c=o.find(p=>p.report.reportId===t);if(!c)return console.error("DisturbancesPage: Report not found for viewing:",t),yield(yield n.alertController.create({header:n.ts.t("Report Not Found"),message:n.ts.t("The requested report could not be found."),buttons:["OK"]})).present(),void n.router.navigate(["/threats"]);const a=c.report;console.log("DisturbancesPage: Loading report for viewing:",a),n.loadedReport=a,n.disturbancesForm.patchValue({reportDate:a.form.reportDate||a.form.date||"",observationTime:a.form.observationTime||"",location:a.form.location||"",zoneNumber:a.form.zoneNumber||"",quadNumber:a.form.quadNumber||"",harvestBiodiversity:a.form.harvestBiodiversity||"",harvestOtherSpecify:a.form.harvestOtherSpecify||"",clearingMangroves:a.form.clearingMangroves||"",ongoingConstruction:a.form.ongoingConstruction||!1,fallenTree:a.form.fallenTree||!1,bankErosion:a.form.bankErosion||!1,accretion:a.form.accretion||"",diseases:a.form.diseases||!1,description:a.form.description||"",requiresUrgentAction:a.form.requiresUrgentAction||!1}),a.coordinates&&(n.coordinates=a.coordinates),a.photos&&(a.photos.harvest&&(n.harvestPhoto=a.photos.harvest),a.photos.clearing&&(n.clearingPhoto=a.photos.clearing),a.photos.construction&&(n.constructionPhoto=a.photos.construction),a.photos.fallenTree&&(n.fallenTreePhoto=a.photos.fallenTree),a.photos.erosion&&(n.erosionPhoto=a.photos.erosion),a.photos.accretion&&(n.accretionPhoto=a.photos.accretion),a.photos.diseases&&(n.diseasesPhoto=a.photos.diseases)),n.currentReportId=t,n.setCurrentDateTime(t),n.updateProgress(),n.setViewMode(!0),n.canAccessNaturalDisturbances=n.auth.hasMinimumLevel(2)}catch(o){console.error("DisturbancesPage: Error loading report for viewing:",o),yield(yield n.alertController.create({header:n.ts.t("Error"),message:n.ts.t("Failed to load the report."),buttons:["OK"]})).present(),n.router.navigate(["/threats"])}})()}deleteEntry(){var t=this;return(0,v.A)(function*(){const n=t.auth.getCurrentUser();var c;!n||n.level<4?yield(yield t.alertController.create({header:t.ts.t("Permission Denied"),message:t.ts.t("Only Level 4 users can delete entries."),buttons:["OK"]})).present():yield(yield t.alertController.create({header:t.ts.t("Delete Entry"),message:t.ts.t("Are you sure you want to permanently delete this entry? This will remove it from the database and back it up to deleted files storage. This action cannot be undone."),buttons:[{text:t.ts.t("Cancel"),role:"cancel"},{text:t.ts.t("Delete"),role:"destructive",handler:(c=(0,v.A)(function*(){yield t.performDeletion()}),function(){return c.apply(this,arguments)})}]})).present()})()}performDeletion(){var t=this;return(0,v.A)(function*(){const n=yield t.loadingController.create({message:t.ts.t("Deleting entry...")});yield n.present();try{const o=t.auth.getCurrentUser();yield t.entryDeletionService.deleteEntry({reportId:t.currentReportId,formType:"disturbances",tableName:"disturbances_reports",deletedBy:o?.username||"Unknown",deletedByEmail:o?.email||"",originalSubmittedBy:t.loadedReport?.submittedBy,originalSubmittedAt:t.loadedReport?.createdAt}),yield n.dismiss(),yield(yield t.alertController.create({header:t.ts.t("Success"),message:t.ts.t("Entry has been deleted and backed up successfully."),buttons:[{text:"OK",handler:()=>{t.router.navigate(["/threats"])}}]})).present()}catch(o){yield n.dismiss(),console.error("Error deleting entry:",o),yield(yield t.alertController.create({header:t.ts.t("Error"),message:t.ts.t("Failed to delete entry. Please try again."),buttons:["OK"]})).present()}})()}openFullScreenPhoto(t,n){var o=this;return(0,v.A)(function*(){yield(yield o.modalController.create({component:xe,componentProps:{photoUrl:t,photoType:n},cssClass:"fullscreen-photo-modal"})).present()})()}static#e=i=()=>(this.\u0275fac=function(n){return new(n||u)(e.rXU(C.ok),e.rXU(h.hG),e.rXU(h.Xi),e.rXU(h.W3),e.rXU(j.Ix),e.rXU(j.nX),e.rXU(l.N),e.rXU(m.s),e.rXU(d.I),e.rXU(g.H),e.rXU(f.C),e.rXU(D.k),e.rXU(O.L))},this.\u0275cmp=e.VBU({type:u,selectors:[["app-disturbances"]],standalone:!1,decls:135,vars:89,consts:[["dateInput",""],["timeInput",""],[1,"coral"],["slot","start"],["defaultHref","/threats"],[1,"coral","compact-toolbar"],[1,"date-time-text"],["style","cursor: pointer;",3,"click",4,"ngIf"],[4,"ngIf"],["type","date",2,"position","absolute","opacity","0","width","0","height","0","pointer-events","none",3,"change","value"],["type","time",2,"position","absolute","opacity","0","width","0","height","0","pointer-events","none",3,"change","value"],[1,"coral","metadata-toolbar"],[1,"metadata-container"],[1,"metadata-item",3,"click"],["name","location",1,"metadata-icon"],[1,"metadata-label"],["name","alert-circle","class","status-icon required",4,"ngIf"],["class","metadata-item",3,"click",4,"ngIf"],["class","edit-location-link",3,"click",4,"ngIf"],["style","padding: 0 16px; font-size: 0.75rem; color: #e76f51;",4,"ngIf"],["color","light",3,"value"],[1,"progress-text"],[3,"ngSubmit","formGroup"],["class","edit-mode-banner",4,"ngIf"],["class","edit-mode-banner editing",4,"ngIf"],[1,"gps-card"],["lines","none",1,"gps-item",3,"click","button"],["slot","start",1,"gps-icon-container"],["name","navigate",3,"color"],[1,"gps-title"],["class","gps-hint",4,"ngIf"],["class","coordinates-text",4,"ngIf"],["class","gps-source-hint",4,"ngIf"],[1,"disturbance-item"],["position","stacked"],["formControlName","harvestBiodiversity","interface","popover",3,"placeholder"],["value","mangrove_whelk"],["value","giant_mud_crab"],["value","juvenile_sharks"],["value","other"],[1,"inline-photo-section"],["size","small","class","coastal-button",3,"click",4,"ngIf"],["class","photo-preview-only",4,"ngIf"],["formControlName","clearingMangroves","interface","popover",3,"placeholder"],["value","<2"],["value","2-10"],["value",">20"],[1,"disturbance-title"],["lines","none",1,"toggle-item"],[1,"toggle-labels"],[1,"toggle-no",3,"hidden"],["formControlName","ongoingConstruction",1,"coastal-toggle"],[1,"toggle-yes",3,"hidden"],["lines","none",2,"margin-top","12px"],["formControlName","requiresUrgentAction","slot","start"],["formControlName","description","rows","6","placeholder","Provide any additional details about the disturbances observed..."],["class","form-buttons",4,"ngIf"],["class","button-container",4,"ngIf"],[2,"cursor","pointer",3,"click"],["name","alert-circle",1,"status-icon","required"],["name","grid",1,"metadata-icon"],["name","apps",1,"metadata-icon"],[1,"edit-location-link",3,"click"],[2,"padding","0 16px","font-size","0.75rem","color","#e76f51"],[1,"edit-mode-banner"],["expand","block","color","warning",3,"click"],["name","create-outline","slot","start"],[1,"edit-mode-banner","editing"],["name","create-outline"],[1,"gps-hint"],["name","location","size","small"],[1,"coordinates-text"],["name","pin","size","small"],[1,"gps-source-hint"],["name","information-circle","size","small"],["formControlName","harvestOtherSpecify",3,"placeholder"],["size","small",1,"coastal-button",3,"click"],["name","camera","slot","start"],[1,"photo-preview-only"],[1,"photo-wrapper"],["alt","Harvest photo",2,"cursor","pointer",3,"click","src"],[1,"click-hint"],["size","small","color","danger",3,"click",4,"ngIf"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"],["alt","Clearing photo",2,"cursor","pointer",3,"click","src"],["alt","Construction photo",2,"cursor","pointer",3,"click","src"],["formControlName","fallenTree",1,"coastal-toggle"],["formControlName","bankErosion",1,"coastal-toggle"],["formControlName","diseases",1,"coastal-toggle"],["formControlName","accretion","interface","popover",3,"placeholder"],["value","sand_deposition"],["value","soil_deposition"],["alt","Fallen tree photo",2,"cursor","pointer",3,"click","src"],["alt","Erosion photo",2,"cursor","pointer",3,"click","src"],["alt","Diseases photo",2,"cursor","pointer",3,"click","src"],[2,"cursor","pointer",3,"click","src","alt"],[1,"form-buttons"],["expand","block","type","submit",1,"submit-button",3,"disabled"],["name","checkmark-circle","slot","start"],["expand","block","fill","outline","color","medium",1,"save-draft-button",3,"click"],["name","save-outline","slot","start"],["expand","block","fill","outline",1,"discard-button",3,"click"],["name","trash-outline","slot","start"],[1,"button-container"],["expand","block","color","danger",1,"delete-button",3,"click"]],template:function(n,o){if(1&n){const c=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3),e.nrm(3,"ion-back-button",4),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.nI1(6,"t"),e.k0s()(),e.j41(7,"ion-toolbar",5)(8,"ion-text",6),e.DNE(9,A,2,1,"span",7)(10,V,2,1,"span",8),e.EFF(11," \xa0 \u2022 \xa0 "),e.DNE(12,$,2,1,"span",7)(13,N,2,1,"span",8),e.j41(14,"input",9,0),e.bIt("change",function(p){return s.eBV(c),s.Njj(o.onDateChanged(p))}),e.k0s(),e.j41(16,"input",10,1),e.bIt("change",function(p){return s.eBV(c),s.Njj(o.onTimeChanged(p))}),e.k0s(),e.DNE(18,B,2,1,"span",8),e.k0s()(),e.j41(19,"ion-toolbar",11)(20,"div",12)(21,"div",13),e.bIt("click",function(){return s.eBV(c),s.Njj(!o.viewMode&&o.editLocation())}),e.nrm(22,"ion-icon",14),e.j41(23,"span",15),e.EFF(24),e.nI1(25,"t"),e.k0s(),e.DNE(26,G,1,0,"ion-icon",16),e.k0s(),e.DNE(27,z,4,1,"div",17)(28,L,4,1,"div",17)(29,J,3,3,"span",18),e.k0s(),e.DNE(30,q,3,3,"ion-error",19),e.k0s(),e.j41(31,"ion-toolbar",5),e.nrm(32,"ion-progress-bar",20),e.j41(33,"ion-text",21),e.EFF(34),e.nI1(35,"t"),e.k0s()()(),e.j41(36,"ion-content")(37,"form",22),e.bIt("ngSubmit",function(){return s.eBV(c),s.Njj(o.onSubmit())}),e.DNE(38,Q,5,3,"div",23)(39,K,5,3,"div",24),e.j41(40,"ion-card",25)(41,"ion-card-header",2)(42,"ion-card-title"),e.EFF(43),e.nI1(44,"t"),e.k0s()(),e.j41(45,"ion-card-content")(46,"ion-item",26),e.bIt("click",function(){return s.eBV(c),s.Njj(!o.viewMode&&o.getGPSCoordinates())}),e.j41(47,"div",27),e.nrm(48,"ion-icon",28),e.k0s(),e.j41(49,"ion-label")(50,"h3",29),e.EFF(51),e.nI1(52,"t"),e.nI1(53,"t"),e.nI1(54,"t"),e.k0s(),e.DNE(55,Z,4,3,"p",30)(56,W,3,2,"p",31)(57,H,4,3,"p",32),e.k0s()()()(),e.j41(58,"ion-card")(59,"ion-card-header",2)(60,"ion-card-title"),e.EFF(61),e.nI1(62,"t"),e.k0s()(),e.j41(63,"ion-card-content")(64,"div",33)(65,"ion-item")(66,"ion-label",34),e.EFF(67),e.nI1(68,"t"),e.k0s(),e.j41(69,"ion-select",35),e.nI1(70,"t"),e.j41(71,"ion-select-option",36),e.EFF(72,"Mangrove whelk - Fizo"),e.k0s(),e.j41(73,"ion-select-option",37),e.EFF(74,"Giant Mud Crab - Krab ble"),e.k0s(),e.j41(75,"ion-select-option",38),e.EFF(76,"Juvenile sharks"),e.k0s(),e.j41(77,"ion-select-option",39),e.EFF(78),e.nI1(79,"t"),e.k0s()()(),e.DNE(80,ee,6,6,"ion-item",8),e.j41(81,"div",40),e.DNE(82,te,4,3,"ion-button",41),e.k0s(),e.DNE(83,oe,7,5,"div",42),e.k0s(),e.nrm(84,"ion-item-divider"),e.j41(85,"div",33)(86,"ion-item")(87,"ion-label",34),e.EFF(88),e.nI1(89,"t"),e.k0s(),e.j41(90,"ion-select",43),e.nI1(91,"t"),e.j41(92,"ion-select-option",44),e.EFF(93,"<2"),e.k0s(),e.j41(94,"ion-select-option",45),e.EFF(95,"2-10"),e.k0s(),e.j41(96,"ion-select-option",46),e.EFF(97,">20"),e.k0s()()(),e.j41(98,"div",40),e.DNE(99,ie,4,3,"ion-button",41),e.k0s(),e.DNE(100,ae,7,5,"div",42),e.k0s(),e.nrm(101,"ion-item-divider"),e.j41(102,"div",33)(103,"div",47),e.EFF(104),e.nI1(105,"t"),e.k0s(),e.j41(106,"ion-item",48)(107,"div",49)(108,"span",50),e.EFF(109),e.nI1(110,"t"),e.k0s(),e.nrm(111,"ion-toggle",51),e.j41(112,"span",52),e.EFF(113),e.nI1(114,"t"),e.k0s()(),e.j41(115,"div",40),e.DNE(116,se,4,3,"ion-button",41),e.k0s()(),e.DNE(117,le,7,5,"div",42),e.j41(118,"ion-item",53),e.nrm(119,"ion-checkbox",54),e.j41(120,"ion-label"),e.EFF(121),e.nI1(122,"t"),e.k0s()()()()(),e.DNE(123,Me,74,56,"ion-card",8),e.j41(124,"ion-card")(125,"ion-card-header",2)(126,"ion-card-title"),e.EFF(127,"Additional Notes"),e.k0s()(),e.j41(128,"ion-card-content")(129,"ion-item")(130,"ion-label",34),e.EFF(131,"Description"),e.k0s(),e.nrm(132,"ion-textarea",55),e.k0s()()(),e.DNE(133,ke,13,10,"div",56)(134,Ce,5,3,"div",57),e.k0s()()}if(2&n){let c,a,p,P,_,y,M,F,x,R;e.R7$(5),e.JRh(e.bMT(6,55,"Disturbances Report")),e.R7$(4),e.Y8G("ngIf",(null==o.currentUser?null:o.currentUser.level)>=4&&!o.viewMode),e.R7$(),e.Y8G("ngIf",!((null==o.currentUser?null:o.currentUser.level)>=4&&!o.viewMode)),e.R7$(2),e.Y8G("ngIf",(null==o.currentUser?null:o.currentUser.level)>=4&&!o.viewMode),e.R7$(),e.Y8G("ngIf",!((null==o.currentUser?null:o.currentUser.level)>=4&&!o.viewMode)),e.R7$(),e.Y8G("value",null==(c=o.disturbancesForm.get("reportDate"))?null:c.value),e.R7$(2),e.Y8G("value",null==(a=o.disturbancesForm.get("observationTime"))?null:a.value),e.R7$(2),e.Y8G("ngIf",(o.viewMode||o.isEditMode)&&o.getEditedDateTime()),e.R7$(6),e.JRh((null==(p=o.disturbancesForm.get("location"))?null:p.value)||e.bMT(25,57,"Add location")),e.R7$(2),e.Y8G("ngIf",!(null!=(P=o.disturbancesForm.get("location"))&&P.value||o.viewMode)),e.R7$(),e.Y8G("ngIf",(null==(_=o.disturbancesForm.get("zoneNumber"))?null:_.value)&&o.locationHasZones()),e.R7$(),e.Y8G("ngIf",(null==(y=o.disturbancesForm.get("quadNumber"))?null:y.value)&&o.locationHasQuads()),e.R7$(),e.Y8G("ngIf",o.isEditMode&&o.currentUser&&o.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",(null==(M=o.disturbancesForm.get("location"))?null:M.hasError("required"))&&(null==(M=o.disturbancesForm.get("location"))?null:M.touched)),e.R7$(2),e.Y8G("value",o.progress),e.R7$(2),e.Lme(" ",(100*o.progress).toFixed(0),"% ",e.bMT(35,59,"Complete")," "),e.R7$(2),e.AVh("view-mode",o.viewMode),e.R7$(),e.Y8G("formGroup",o.disturbancesForm),e.R7$(),e.Y8G("ngIf",o.viewMode&&o.currentUser&&o.currentUser.level>=4),e.R7$(),e.Y8G("ngIf",o.isEditMode),e.R7$(4),e.JRh(e.bMT(44,61,"GPS Coordinates")),e.R7$(3),e.AVh("gps-captured",o.coordinates),e.Y8G("button",!o.viewMode),e.R7$(2),e.Y8G("color",o.coordinates?"success":"medium"),e.R7$(3),e.SpI(" ",o.coordinates?o.gpsFromLocation?e.bMT(52,63,"GPS Location from New Site"):e.bMT(53,65,"GPS Location Captured"):e.bMT(54,67,"Capture GPS Location")," "),e.R7$(4),e.Y8G("ngIf",!o.coordinates),e.R7$(),e.Y8G("ngIf",o.coordinates),e.R7$(),e.Y8G("ngIf",o.coordinates&&o.gpsFromLocation),e.R7$(4),e.JRh(e.bMT(62,69,"Human Activity")),e.R7$(6),e.JRh(e.bMT(68,71,"Harvesting of biodiversity")),e.R7$(2),e.Y8G("placeholder",e.bMT(70,73,"Select option")),e.R7$(9),e.JRh(e.bMT(79,75,"Other (specify below)")),e.R7$(2),e.Y8G("ngIf","other"===(null==(F=o.disturbancesForm.get("harvestBiodiversity"))?null:F.value)),e.R7$(2),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.harvestPhoto),e.R7$(5),e.JRh(e.bMT(89,77,"Clearing of mangrove trees")),e.R7$(2),e.Y8G("placeholder",e.bMT(91,79,"Select number of trees")),e.R7$(9),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.clearingPhoto),e.R7$(4),e.JRh(e.bMT(105,81,"On-going construction")),e.R7$(4),e.Y8G("hidden",null==(x=o.disturbancesForm.get("ongoingConstruction"))?null:x.value),e.R7$(),e.JRh(e.bMT(110,83,"No")),e.R7$(3),e.Y8G("hidden",!(null!=(R=o.disturbancesForm.get("ongoingConstruction"))&&R.value)),e.R7$(),e.JRh(e.bMT(114,85,"Yes")),e.R7$(3),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.constructionPhoto),e.R7$(),e.AVh("view-mode-item",o.viewMode),e.R7$(3),e.JRh(e.bMT(122,87,"Requires urgent action/intervention")),e.R7$(2),e.Y8G("ngIf",o.canAccessNaturalDisturbances),e.R7$(10),e.Y8G("ngIf",!o.viewMode),e.R7$(),e.Y8G("ngIf",o.viewMode&&(null==o.currentUser?null:o.currentUser.level)>=4)}},dependencies:[k.bT,C.qT,C.BC,C.cb,C.j4,C.JD,h.Jm,h.QW,h.b_,h.I9,h.ME,h.tN,h.eY,h.W9,h.eU,h.iq,h.$w,h.uz,h.Dg,h.he,h.FH,h.Nm,h.Ip,h.IO,h.nc,h.BC,h.BY,h.ai,h.hB,h.Je,h.Gw,h.el,T.D],styles:[".coral[_ngcontent-%COMP%]{--background: #e76f51;color:#fff}.coral[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]{--color: white;transition:transform .2s}.coral[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]:hover{transform:translate(-4px)}.coral[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);width:100%;pointer-events:none}.coral.compact-toolbar[_ngcontent-%COMP%]{--min-height: 28px;--padding-top: 5px;--padding-bottom: 5px}.edit-mode-banner[_ngcontent-%COMP%]{padding:.75rem 1rem;margin:.5rem;border-radius:.5rem}.edit-mode-banner[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: .5rem;font-weight:600}.edit-mode-banner.editing[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;display:flex;align-items:center;gap:.5rem;color:#856404;font-weight:500}.edit-mode-banner.editing[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.date-time-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fffffff2;font-size:14px;padding:0;margin:3px 0;font-weight:400;letter-spacing:.3px;line-height:1.2}.metadata-toolbar[_ngcontent-%COMP%]{--min-height: 40px;--padding-top: 6px;--padding-bottom: 6px}.metadata-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px;padding:0 12px;flex-wrap:wrap}.metadata-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;background:#ffffff26;border-radius:16px;padding:5px 10px;cursor:pointer;transition:all .2s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2)}.metadata-item[_ngcontent-%COMP%]:active{transform:scale(.95);background:#ffffff40}.metadata-icon[_ngcontent-%COMP%]{font-size:14px;color:#ffffffe6;min-width:14px}.metadata-label[_ngcontent-%COMP%]{color:#fff;font-size:12px;font-weight:500;letter-spacing:.2px;white-space:nowrap;max-width:120px;overflow:hidden;text-overflow:ellipsis}.edit-location-link[_ngcontent-%COMP%]{color:#ffffffe6;font-size:11px;text-decoration:underline;cursor:pointer;margin-left:8px;padding:4px 8px}.edit-location-link[_ngcontent-%COMP%]:active{opacity:.7}.status-icon[_ngcontent-%COMP%]{font-size:14px;margin-left:2px}.status-icon.success[_ngcontent-%COMP%]{color:#52a676}.status-icon.required[_ngcontent-%COMP%]{color:#ffd93d;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.6}}.progress-text[_ngcontent-%COMP%]{display:block;text-align:center;color:#fff;font-size:13px;padding:0;margin:0 0 4px;font-weight:400;line-height:1}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 2px 8px #0000001a}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{border-radius:12px 12px 0 0;padding:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#fff}@media (min-width: 400px) and (max-width: 800px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.25rem}}@media (max-width: 399px) and (max-width: 360px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.1rem}}@media (max-width: 359px){ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:.95rem}}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:#ffffffe6;font-size:.875rem;margin-top:4px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{background:#fff;padding:16px}.gps-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 2px 8px #0000001a;overflow:hidden}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;--background: #f8f9fa;--border-radius: 8px;margin:0;border-radius:8px;transition:all .2s ease}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]:hover:not(.item-disabled){--background: #e9ecef;transform:translateY(-1px);box-shadow:0 4px 12px #0000001a}.gps-card[_ngcontent-%COMP%]   .gps-item.gps-captured[_ngcontent-%COMP%]{--background: #e8f5e9;border:1px solid #4caf50}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-icon-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;background:#ffffffe6;margin:12px;box-shadow:0 2px 4px #0000001a}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-icon-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:#333;margin-bottom:4px}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-hint[_ngcontent-%COMP%]{display:flex;align-items:center;color:#666;font-size:.9rem}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-hint[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:#999}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .coordinates-text[_ngcontent-%COMP%]{display:flex;align-items:center;color:#e76f51!important;font-weight:600;font-family:SF Mono,Monaco,Inconsolata,Roboto Mono,monospace;font-size:.9rem}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .coordinates-text[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:#e76f51}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-source-hint[_ngcontent-%COMP%]{display:flex;align-items:center;color:#666;font-size:.8rem;font-style:italic;margin-top:4px}.gps-card[_ngcontent-%COMP%]   .gps-item[_ngcontent-%COMP%]   .gps-source-hint[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:#999}.coordinates-text[_ngcontent-%COMP%]{color:#e76f51!important;font-weight:600;font-family:monospace}ion-item-divider[_ngcontent-%COMP%]{--padding-top: 4px;--padding-bottom: 4px;min-height:0;margin:8px 0}.disturbance-item[_ngcontent-%COMP%]{padding:12px 0 0}.disturbance-item[_ngcontent-%COMP%]:not(:last-child){margin-bottom:0}.disturbance-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#0d3d2f;margin-bottom:12px}@media (max-width: 359px){.disturbance-title[_ngcontent-%COMP%]{font-size:.85rem;font-weight:700}}.inline-photo-section[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:16px}.toggle-item[_ngcontent-%COMP%]   .inline-photo-section[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.photo-preview-only[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;margin-top:8px;background:#f9f9f9;border-radius:8px;border-left:4px solid #52a676}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;object-fit:cover;border-radius:8px;border:2px solid #52a676;transition:transform .2s ease,box-shadow .2s ease;touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #2d865966}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:active{transform:scale(.98)}.photo-preview-only[_ngcontent-%COMP%]   .photo-wrapper[_ngcontent-%COMP%]   .click-hint[_ngcontent-%COMP%]{font-size:10px;color:#999;font-style:italic;text-align:center;white-space:nowrap}.photos-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.photo-item[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:12px;padding:12px;background:#f9f9f9;border-radius:8px;border-left:4px solid #e76f51}.photo-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:120px;object-fit:cover;border-radius:8px;border:2px solid #e76f51;touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.photo-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: #dc2626;--background-hover: #b91c1c;--background-activated: #b91c1c}.add-photo-button[_ngcontent-%COMP%]{--border-color: #e76f51;--color: #e76f51;margin-top:8px}.add-photo-button[_ngcontent-%COMP%]:hover{--background: rgba(231, 111, 81, .1)}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;margin-bottom:12px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;color:#0d3d2f;margin:0}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6b7c7a;font-size:.875rem;margin:4px 0 0}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px;border:1px solid #ddd;border-radius:8px;margin-top:4px}ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{--padding-top: 12px;--padding-bottom: 12px}ion-item[button][_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s}ion-item[button][_ngcontent-%COMP%]:hover{--background: rgba(231, 111, 81, .05)}ion-select[_ngcontent-%COMP%]{width:100%}ion-checkbox[_ngcontent-%COMP%]{--size: 24px;--checkbox-background-checked: #e76f51 !important;--border-color-checked: #e76f51 !important;--border-color: #e76f51 !important;--background: white !important;--checkmark-color: white !important}.coastal-button[_ngcontent-%COMP%]{--background: #4fb3bf;--background-hover: #3a9aa5;--background-activated: #3a9aa5;--color: white;--border-radius: 8px;font-weight:600;text-transform:none;letter-spacing:.3px;margin-left:20px;margin-right:5px}.coastal-button[_ngcontent-%COMP%]:hover{--background: #3a9aa5}.toggle-item[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;--inner-padding-end: 0;margin-bottom:0;display:flex;align-items:center;justify-content:space-between;gap:16px}.toggle-labels[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0px;position:relative}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[_ngcontent-%COMP%], .toggle-labels[_ngcontent-%COMP%]   .toggle-yes[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;min-width:35px;width:35px;text-align:center;flex-shrink:0}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[_ngcontent-%COMP%]{color:#888;visibility:visible}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[_ngcontent-%COMP%]:not(:last-child){margin-right:5px}.toggle-labels[_ngcontent-%COMP%]   .toggle-yes[_ngcontent-%COMP%]{color:#52a676;visibility:visible}.toggle-labels[_ngcontent-%COMP%]   .toggle-yes[_ngcontent-%COMP%]:not(:first-child){margin-left:5px}.toggle-labels[_ngcontent-%COMP%]   .toggle-no[hidden][_ngcontent-%COMP%], .toggle-labels[_ngcontent-%COMP%]   .toggle-yes[hidden][_ngcontent-%COMP%]{visibility:hidden;display:block!important}.coastal-toggle[_ngcontent-%COMP%]{--background: #ddd;--background-checked: #52a676;--handle-background: white;--handle-background-checked: white;--handle-width: 26px;--handle-height: 26px;--handle-spacing: 3px;width:52px;height:32px;min-width:52px;flex-shrink:0}.coastal-toggle[_ngcontent-%COMP%]::part(track){height:32px;width:52px;border-radius:16px}.coastal-toggle[_ngcontent-%COMP%]::part(handle){width:26px;height:26px}.form-buttons[_ngcontent-%COMP%]{padding:0 16px;margin-top:24px;margin-bottom:32px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-bottom:12px}.form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-buttons[_ngcontent-%COMP%]   ion-button.save-draft-button[_ngcontent-%COMP%]{margin:10px 0 12px}.form-buttons[_ngcontent-%COMP%]   .save-draft-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--background: rgba(107, 124, 122, .1);--border-color: #6b7c7a;--color: #6b7c7a;--background-hover: rgba(107, 124, 122, .2);--background-activated: rgba(107, 124, 122, .3)}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{margin:0;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #e76f51;--background-hover: #d65d43;--background-activated: #d65d43}.form-buttons[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}.form-buttons[_ngcontent-%COMP%]   .discard-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-size:1rem;font-weight:500;--color: #e76f51;--border-color: #e76f51;--border-width: 2px;--background-hover: rgba(231, 111, 81, .1);--background-activated: rgba(231, 111, 81, .2);--ripple-color: rgba(231, 111, 81, .3)}.form-buttons[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{margin-top:20px;--background: #d32f2f;--background-hover: #b71c1c;--background-activated: #b71c1c;font-weight:600;height:48px;font-size:1rem}.submit-button[_ngcontent-%COMP%]{margin:24px 16px 32px;--border-radius: 8px;height:48px;font-size:1.125rem;font-weight:600;--background: #e76f51;--background-hover: #d65d43;--background-activated: #d65d43}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.5}@media (max-width: 399px){.gps-title[_ngcontent-%COMP%]{font-size:.9rem!important}.gps-hint[_ngcontent-%COMP%], .coordinates-text[_ngcontent-%COMP%], .gps-source-hint[_ngcontent-%COMP%]{font-size:.75rem!important}}@media (max-width: 359px){.submit-button[_ngcontent-%COMP%]{font-size:1rem!important}}ion-error[_ngcontent-%COMP%]{color:#e76f51!important;font-size:.75rem!important;margin-top:4px;padding-left:16px}ion-item.item-disabled[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]{opacity:1!important;--opacity: 1 !important}ion-item.item-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], ion-item.item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:1!important;color:#000!important}  .item-disabled,   .item-interactive-disabled{opacity:1!important}  .item-disabled ion-label,   .item-disabled .label-text,   .item-disabled .native-input,   .item-disabled .select-text,   .item-disabled .select-icon,   .item-interactive-disabled ion-label,   .item-interactive-disabled .label-text,   .item-interactive-disabled .native-input,   .item-interactive-disabled .select-text,   .item-interactive-disabled .select-icon{opacity:1!important;color:#000!important}  ion-select.select-disabled{opacity:1!important}  ion-select.select-disabled .select-text,   ion-select.select-disabled .select-icon,   ion-select.select-disabled .select-placeholder{opacity:1!important;color:#000!important}  ion-toggle.toggle-disabled{opacity:1!important}  ion-checkbox.checkbox-disabled{opacity:1!important}  ion-input.input-disabled,   ion-textarea.textarea-disabled{opacity:1!important}  ion-input.input-disabled .native-input,   ion-input.input-disabled .native-textarea,   ion-textarea.textarea-disabled .native-input,   ion-textarea.textarea-disabled .native-textarea{opacity:1!important;color:#000!important;-webkit-text-fill-color:#000!important}  ion-content.view-mode ion-checkbox,   ion-content.view-mode ion-toggle{pointer-events:none!important;cursor:default!important}  ion-content.view-mode ion-item:has(ion-checkbox){pointer-events:none!important}@media (max-width: 768px){.photo-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.photo-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:200px}ion-card[_ngcontent-%COMP%]{margin:12px}}"]}))}return i(),u})(),xe=(()=>{var i;class u{constructor(t){this.modalController=t}dismiss(){this.modalController.dismiss()}static#e=i=()=>(this.\u0275fac=function(n){return new(n||u)(e.rXU(h.W3))},this.\u0275cmp=e.VBU({type:u,selectors:[["app-fullscreen-photo-modal-disturbances"]],decls:10,vars:2,consts:[["slot","end"],[3,"click"],["name","close"],[1,"ion-padding"],[1,"photo-container"],["alt","Full screen photo",3,"src"]],template:function(n,o){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return o.dismiss()}),e.nrm(6,"ion-icon",2),e.k0s()()()(),e.j41(7,"ion-content",3)(8,"div",4),e.nrm(9,"img",5),e.k0s()()),2&n&&(e.R7$(3),e.SpI("",o.photoType," Photo"),e.R7$(6),e.Y8G("src",o.photoUrl,e.B4B))},dependencies:[h.bv,h.Jm,h.QW,h.W9,h.eU,h.iq,h.BC,h.ai,k.MD],styles:[".photo-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.photo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}"]}))}return i(),u})();const Fe=[{path:"",component:De}];let Oe=(()=>{var i;class u{static#e=i=()=>(this.\u0275fac=function(n){return new(n||u)},this.\u0275mod=e.$C({type:u}),this.\u0275inj=s.G2t({imports:[I.iI.forChild(Fe),I.iI]}))}return i(),u})();var Te=b(4670);let Re=(()=>{var i;class u{static#e=i=()=>(this.\u0275fac=function(n){return new(n||u)},this.\u0275mod=e.$C({type:u}),this.\u0275inj=s.G2t({imports:[k.MD,C.YN,C.X1,h.bv,Oe,Te.k]}))}return i(),u})()},9187(U,S,b){b.d(S,{C:()=>w});var k=b(467),C=b(2084),h=b(2615),I=b(5029),v=b(918),E=b(8863);let w=(()=>{var e;class s{constructor(l,m,d){this.supabase=l,this.sharedDataService=m,this.monitoringLog=d}deleteEntry(l){var m=this;return(0,k.A)(function*(){console.log("[EntryDeletionService] Starting deletion process for:",l);try{const d=yield m.fetchOriginalEntry(l.tableName,l.reportId);if(!d)throw new Error(`Entry not found in table ${l.tableName} with reportId ${l.reportId}`);console.log("[EntryDeletionService] Original entry fetched:",d);const g=yield m.backupToDeletedFiles(l,d);console.log("[EntryDeletionService] Backup completed:",g),yield m.recordDeletionMetadata(l,g,d),console.log("[EntryDeletionService] Deletion metadata recorded"),yield m.deleteImagesFromBucket(d,l.formType,l.reportId),console.log("[EntryDeletionService] Images deleted from bucket"),yield m.deleteJsonFromStorage(l.formType,l.reportId),console.log("[EntryDeletionService] JSON file deleted from storage"),yield m.deleteFromTable(l.tableName,l.reportId),console.log("[EntryDeletionService] Entry deleted from table"),yield m.deleteLocalFile(l.formType,l.reportId),console.log("[EntryDeletionService] Local file deleted");const f=m.getEntrySummary(d,l.formType);m.monitoringLog.recordFormDeleted(l.deletedBy,l.formType,l.reportId,f),console.log("[EntryDeletionService] \u2705 Deletion process completed successfully")}catch(d){throw console.error("[EntryDeletionService] \u274c Deletion process failed:",d),d}})()}getEntrySummary(l,m){const d=[];return l?.location&&d.push(l.location),l?.zone_number&&d.push(`Z${l.zone_number}`),l?.quad_number&&d.push(`Q${l.quad_number}`),l?.observation_date&&d.push(l.observation_date),d.join(", ")||m}fetchOriginalEntry(l,m){var d=this;return(0,k.A)(function*(){const{data:g,error:f}=yield d.supabase.getClient().from(l).select("*").eq("report_id",m).single();if(f)throw console.error("[EntryDeletionService] Error fetching original entry:",f),f;return g})()}backupToDeletedFiles(l,m){var d=this;return(0,k.A)(function*(){const g=`${l.formType}/${l.reportId}`,f=`${g}/${l.reportId}.json`,D=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),{error:O}=yield d.supabase.getClient().storage.from("deleted_files").upload(f,D);if(O)throw console.error("[EntryDeletionService] Error backing up JSON:",O),O;const T=[],A=d.getImageBucketName(l.formType),V=d.extractImagePathsFromEntry(m,l.formType,l.reportId);for(const $ of V)if($)try{const{data:N,error:B}=yield d.supabase.getClient().storage.from(A).download($);if(B){console.warn("[EntryDeletionService] Could not download image:",$,B);continue}const G=`${g}/${$.split("/").pop()}`,{error:z}=yield d.supabase.getClient().storage.from("deleted_files").upload(G,N);z?console.warn("[EntryDeletionService] Could not backup image:",G,z):T.push(G)}catch(N){console.warn("[EntryDeletionService] Error processing image:",N)}return{backupFolderPath:g,jsonBackupPath:f,imageBackupPaths:T}})()}recordDeletionMetadata(l,m,d){var g=this;return(0,k.A)(function*(){const f={original_entry:d,backup_paths:{json:m.jsonBackupPath,images:m.imageBackupPaths},deletion_timestamp:(0,C.E)()},{error:D}=yield g.supabase.getClient().from("deleted_metadata_files").insert({original_report_id:l.reportId,form_type:l.formType,deleted_by:l.deletedBy,deleted_by_email:l.deletedByEmail,original_submitted_by:l.originalSubmittedBy||d.submittedBy,original_submitted_at:l.originalSubmittedAt||d.createdAt,backup_folder_path:m.backupFolderPath,original_table_name:l.tableName,original_storage_path:g.getStoragePath(l.tableName,l.reportId),metadata:f});if(D)throw console.error("[EntryDeletionService] Error recording deletion metadata:",D),D})()}deleteImagesFromBucket(l,m,d){var g=this;return(0,k.A)(function*(){const f=g.getImageBucketName(m),D=g.extractImagePathsFromEntry(l,m,d);for(const O of D)if(O)try{const{error:T}=yield g.supabase.getClient().storage.from(f).remove([O]);T&&console.warn("[EntryDeletionService] Could not delete image:",O,T)}catch(T){console.warn("[EntryDeletionService] Error deleting image:",T)}})()}deleteJsonFromStorage(l,m){var d=this;return(0,k.A)(function*(){const g=d.getReportsBucketName(l),f=`${m}.json`,{error:D}=yield d.supabase.getClient().storage.from(g).remove([f]);D&&console.warn("[EntryDeletionService] Could not delete JSON from storage:",f,D)})()}deleteFromTable(l,m){var d=this;return(0,k.A)(function*(){const{error:g}=yield d.supabase.getClient().from(l).delete().eq("report_id",m);if(g)throw console.error("[EntryDeletionService] Error deleting from table:",g),g})()}deleteLocalFile(l,m){var d=this;return(0,k.A)(function*(){try{const g=d.getLocalFileName(l,m);yield d.sharedDataService.deleteJsonFile(g)}catch(g){console.warn("[EntryDeletionService] Could not delete local file:",g)}})()}getReportsBucketName(l){return l}getImageBucketName(l){return{"flora-fauna":"flora-fauna-images",biomass:"biomass-images",health:"health-images",outplanting:"outplanting-images",restoration:"restoration-images",cleanup:"cleanup-images",pollution:"pollution-images",disturbances:"disturbances-images"}[l]||`${l}-images`}extractImagePathsFromEntry(l,m,d){const g=[];if("health"===m)return g.push(`${d}/soil.jpg`),g.push(`${d}/predation.jpg`),g.push(`${d}/pollution.jpg`),g;if("pollution"===m){g.push(`${d}/greyWater.jpg`),g.push(`${d}/trash.jpg`),g.push(`${d}/sewage.jpg`);for(let f=1;f<=10;f++)g.push(`${d}/photo_${f}.jpg`);return g}if("disturbances"===m)return g.push(`${d}/harvest.jpg`),g.push(`${d}/clearing.jpg`),g.push(`${d}/construction.jpg`),g.push(`${d}/fallenTree.jpg`),g.push(`${d}/erosion.jpg`),g.push(`${d}/accretion.jpg`),g.push(`${d}/diseases.jpg`),g;for(let f=1;f<=20;f++)g.push(`${d}/photo_${f}.jpg`);return g}getStoragePath(l,m){return`${l}/${m}.json`}getLocalFileName(l,m){return`${m}.json`}static#e=e=()=>(this.\u0275fac=function(m){return new(m||s)(h.KVO(I.L),h.KVO(v.H),h.KVO(E.u))},this.\u0275prov=h.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}))}return e(),s})()}}]);